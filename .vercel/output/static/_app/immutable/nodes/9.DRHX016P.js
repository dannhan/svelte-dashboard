import{s as xr,C as Sn,i as At,f as ct,w as Tn,k as yr,q as Xr,x as il,F as xs,e as Er,c as Mr,b as kr,J as vh,h as sn,aa as vd,n as Ga,a5 as Ha,a6 as Wa,a7 as Xa,a8 as Ka,r as bh,a as Hi,u as wh,g as Wi,l as Ih,m as Zt,ab as Qo,t as uc,d as dc,p as Cf,j as Th,ac as bd,ad as wd,I as Sd,ae as el,af as Xs,ag as rd,a4 as Za,ah as Af,o as kf,L as Ef}from"../chunks/scheduler.Cglc-E-6.js";import{S as Or,i as Vr,g as In,b as st,e as Cn,t as $e,c as ui,a as di,m as pi,d as fi,f as tl}from"../chunks/index.9iPnfnGV.js";import{M as Mf}from"../chunks/mode-toggle.Cs9G0DsI.js";import{e as nd}from"../chunks/each.Dtgx6mEA.js";import{g as Pf,a as zf,i as Df,C as Lf,b as Rf,c as Bf,d as Ff,e as Of}from"../chunks/command-input.CeEokZ8F.js";import{g as Td,c as pc,b as Vf}from"../chunks/index.BALLBs5G.js";import{M as Uf}from"../chunks/MagnifyingGlass.1BoxrdsM.js";import{c as Nf,g as jf}from"../chunks/_commonjsHelpers.Cpj98o6Y.js";import{w as Yn,r as Sh}from"../chunks/index.C4PciY-_.js";import{d as qf}from"../chunks/mode.BQ9atwLW.js";const Zf=O=>({}),sd=O=>({list:O[7],sizer:O[8]});function Gf(O){let C,M,E=O[2].search==="",F,R,b,h=ad(O),le=[O[6]],he={};for(let K=0;K<le.length;K+=1)he=Xr(he,le[K]);let fe=[O[5],O[9]],re={};for(let K=0;K<fe.length;K+=1)re=Xr(re,fe[K]);return{c(){C=Er("div"),M=Er("div"),h.c(),this.h()},l(K){C=Mr(K,"DIV",{});var je=kr(C);M=Mr(je,"DIV",{});var Qe=kr(M);h.l(Qe),Qe.forEach(ct),je.forEach(ct),this.h()},h(){vh(M,he),vh(C,re)},m(K,je){At(K,C,je),sn(C,M),h.m(M,null),O[12](C),F=!0,R||(b=vd(O[4].call(null,M)),R=!0)},p(K,je){je&4&&xr(E,E=K[2].search==="")?(In(),st(h,1,1,Ga),Cn(),h=ad(K),h.c(),$e(h,1),h.m(M,null)):h.p(K,je),vh(C,re=Td(fe,[K[5],je&512&&K[9]]))},i(K){F||($e(h),F=!0)},o(K){st(h),F=!1},d(K){K&&ct(C),h.d(K),O[12](null),R=!1,b()}}}function Hf(O){let C=O[2].search==="",M,E,F=od(O);return{c(){F.c(),M=Sn()},l(R){F.l(R),M=Sn()},m(R,b){F.m(R,b),At(R,M,b),E=!0},p(R,b){b&4&&xr(C,C=R[2].search==="")?(In(),st(F,1,1,Ga),Cn(),F=od(R),F.c(),$e(F,1),F.m(M.parentNode,M)):F.p(R,b)},i(R){E||($e(F),E=!0)},o(R){st(F),E=!1},d(R){R&&ct(M),F.d(R)}}}function ad(O){let C;const M=O[11].default,E=Ha(M,O,O[10],null);return{c(){E&&E.c()},l(F){E&&E.l(F)},m(F,R){E&&E.m(F,R),C=!0},p(F,R){E&&E.p&&(!C||R&1024)&&Wa(E,M,F,F[10],C?Ka(M,F[10],R,null):Xa(F[10]),null)},i(F){C||($e(E,F),C=!0)},o(F){st(E,F),C=!1},d(F){E&&E.d(F)}}}function od(O){let C;const M=O[11].default,E=Ha(M,O,O[10],sd);return{c(){E&&E.c()},l(F){E&&E.l(F)},m(F,R){E&&E.m(F,R),C=!0},p(F,R){E&&E.p&&(!C||R&1024)&&Wa(E,M,F,F[10],C?Ka(M,F[10],R,Zf):Xa(F[10]),sd)},i(F){C||($e(E,F),C=!0)},o(F){st(E,F),C=!1},d(F){E&&E.d(F)}}}function Wf(O){let C,M,E,F;const R=[Hf,Gf],b=[];function h(le,he){return le[1]?0:1}return C=h(O),M=b[C]=R[C](O),{c(){M.c(),E=Sn()},l(le){M.l(le),E=Sn()},m(le,he){b[C].m(le,he),At(le,E,he),F=!0},p(le,[he]){let fe=C;C=h(le),C===fe?b[C].p(le,he):(In(),st(b[fe],1,1,()=>{b[fe]=null}),Cn(),M=b[C],M?M.p(le,he):(M=b[C]=R[C](le),M.c()),$e(M,1),M.m(E.parentNode,E))},i(le){F||($e(M),F=!0)},o(le){st(M),F=!1},d(le){le&&ct(E),b[C].d(le)}}}function Xf(O,C,M){const E=["el","asChild"];let F=Tn(C,E),R,{$$slots:b={},$$scope:h}=C;const{ids:le}=Pf(),he=zf();yr(O,he,De=>M(2,R=De));let{el:fe=void 0}=C,{asChild:re=!1}=C;function K(De){let ht;const gt=De.closest("[data-cmdk-list]");if(!Df(gt))return;const Ot=new ResizeObserver(()=>{ht=requestAnimationFrame(()=>{const mi=De.offsetHeight;gt.style.setProperty("--cmdk-list-height",mi.toFixed(1)+"px")})});return Ot.observe(De),{destroy(){cancelAnimationFrame(ht),Ot.unobserve(De)}}}const je={"data-cmdk-list":"",role:"listbox","aria-label":"Suggestions",id:le.list,"aria-labelledby":le.input},Qe={"data-cmdk-list-sizer":""},Ye={attrs:je},_t={attrs:Qe,action:K};function Be(De){xs[De?"unshift":"push"](()=>{fe=De,M(0,fe)})}return O.$$set=De=>{C=Xr(Xr({},C),il(De)),M(9,F=Tn(C,E)),"el"in De&&M(0,fe=De.el),"asChild"in De&&M(1,re=De.asChild),"$$scope"in De&&M(10,h=De.$$scope)},[fe,re,R,he,K,je,Qe,Ye,_t,F,h,b,Be]}class Kf extends Or{constructor(C){super(),Vr(this,C,Xf,Wf,xr,{el:0,asChild:1})}}function Yf(O){let C;const M=O[2].default,E=Ha(M,O,O[3],null);return{c(){E&&E.c()},l(F){E&&E.l(F)},m(F,R){E&&E.m(F,R),C=!0},p(F,R){E&&E.p&&(!C||R&8)&&Wa(E,M,F,F[3],C?Ka(M,F[3],R,null):Xa(F[3]),null)},i(F){C||($e(E,F),C=!0)},o(F){st(E,F),C=!1},d(F){E&&E.d(F)}}}function Jf(O){let C,M;const E=[{class:pc("max-h-[300px] overflow-y-auto overflow-x-hidden",O[0])},O[1]];let F={$$slots:{default:[Yf]},$$scope:{ctx:O}};for(let R=0;R<E.length;R+=1)F=Xr(F,E[R]);return C=new Kf({props:F}),{c(){ui(C.$$.fragment)},l(R){di(C.$$.fragment,R)},m(R,b){pi(C,R,b),M=!0},p(R,[b]){const h=b&3?Td(E,[b&1&&{class:pc("max-h-[300px] overflow-y-auto overflow-x-hidden",R[0])},b&2&&Vf(R[1])]):{};b&8&&(h.$$scope={dirty:b,ctx:R}),C.$set(h)},i(R){M||($e(C.$$.fragment,R),M=!0)},o(R){st(C.$$.fragment,R),M=!1},d(R){fi(C,R)}}}function $f(O,C,M){const E=["class"];let F=Tn(C,E),{$$slots:R={},$$scope:b}=C,{class:h=void 0}=C;return O.$$set=le=>{C=Xr(Xr({},C),il(le)),M(1,F=Tn(C,E)),"class"in le&&M(0,h=le.class),"$$scope"in le&&M(3,b=le.$$scope)},[h,F,R,b]}class Qf extends Or{constructor(C){super(),Vr(this,C,$f,Jf,xr,{class:0})}}function em(O){let C,M,E,F,R,b,h="Loading...",le;return{c(){C=Er("div"),M=bh("svg"),E=bh("path"),F=bh("path"),R=Hi(),b=Er("span"),b.textContent=h,this.h()},l(he){C=Mr(he,"DIV",{class:!0});var fe=kr(C);M=wh(fe,"svg",{"aria-hidden":!0,class:!0,viewBox:!0,fill:!0,xmlns:!0});var re=kr(M);E=wh(re,"path",{d:!0,fill:!0}),kr(E).forEach(ct),F=wh(re,"path",{d:!0,fill:!0}),kr(F).forEach(ct),re.forEach(ct),R=Wi(fe),b=Mr(fe,"SPAN",{class:!0,"data-svelte-h":!0}),Ih(b)!=="svelte-1wtojot"&&(b.textContent=h),fe.forEach(ct),this.h()},h(){Zt(E,"d","M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"),Zt(E,"fill","currentColor"),Zt(F,"d","M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"),Zt(F,"fill","currentFill"),Zt(M,"aria-hidden","true"),Zt(M,"class","h-5 w-5 animate-spin fill-blue-600 text-gray-200 dark:text-gray-600"),Zt(M,"viewBox","0 0 100 101"),Zt(M,"fill","none"),Zt(M,"xmlns","http://www.w3.org/2000/svg"),Zt(b,"class","sr-only"),Zt(C,"class",le=O[0].class)},m(he,fe){At(he,C,fe),sn(C,M),sn(M,E),sn(M,F),sn(C,R),sn(C,b)},p(he,[fe]){fe&1&&le!==(le=he[0].class)&&Zt(C,"class",le)},i:Ga,o:Ga,d(he){he&&ct(C)}}}function tm(O,C,M){const E=[];let F=Tn(C,E);return O.$$set=R=>{C=Xr(Xr({},C),il(R)),M(0,F=Tn(C,E))},[F]}class im extends Or{constructor(C){super(),Vr(this,C,tm,em,xr,{})}}function ld(O,C,M){const E=O.slice();return E[11]=C[M],E}function cd(O){let C,M;return C=new im({props:{class:"absolute right-2 top-1/2 -translate-y-1/2"}}),{c(){ui(C.$$.fragment)},l(E){di(C.$$.fragment,E)},m(E,F){pi(C,E,F),M=!0},i(E){M||($e(C.$$.fragment,E),M=!0)},o(E){st(C.$$.fragment,E),M=!1},d(E){fi(C,E)}}}function hd(O){let C,M;return C=new Qf({props:{class:"invisible absolute left-0 top-10 z-10 box-border w-full rounded-b-lg border bg-card shadow hover:visible peer-focus-within:visible",$$slots:{default:[am]},$$scope:{ctx:O}}}),{c(){ui(C.$$.fragment)},l(E){di(C.$$.fragment,E)},m(E,F){pi(C,E,F),M=!0},p(E,F){const R={};F&16405&&(R.$$scope={dirty:F,ctx:E}),C.$set(R)},i(E){M||($e(C.$$.fragment,E),M=!0)},o(E){st(C.$$.fragment,E),M=!1},d(E){fi(C,E)}}}function rm(O){let C;return{c(){C=uc("Not Found.")},l(M){C=dc(M,"Not Found.")},m(M,E){At(M,C,E)},d(M){M&&ct(C)}}}function nm(O){let C,M,E,F=O[11].properties.display_name+"",R,b,h,le=O[11].properties.place_id+"",he,fe,re;return C=new Uf({props:{class:"mr-2 h-4 w-4 shrink-0 opacity-50"}}),{c(){ui(C.$$.fragment),M=Hi(),E=Er("span"),R=uc(F),b=Hi(),h=Er("span"),he=uc(le),fe=Hi(),this.h()},l(K){di(C.$$.fragment,K),M=Wi(K),E=Mr(K,"SPAN",{class:!0});var je=kr(E);R=dc(je,F),je.forEach(ct),b=Wi(K),h=Mr(K,"SPAN",{class:!0});var Qe=kr(h);he=dc(Qe,le),Qe.forEach(ct),fe=Wi(K),this.h()},h(){Zt(E,"class","truncate"),Zt(h,"class","hidden")},m(K,je){pi(C,K,je),At(K,M,je),At(K,E,je),sn(E,R),At(K,b,je),At(K,h,je),sn(h,he),At(K,fe,je),re=!0},p(K,je){(!re||je&4)&&F!==(F=K[11].properties.display_name+"")&&Th(R,F),(!re||je&4)&&le!==(le=K[11].properties.place_id+"")&&Th(he,le)},i(K){re||($e(C.$$.fragment,K),re=!0)},o(K){st(C.$$.fragment,K),re=!1},d(K){K&&(ct(M),ct(E),ct(b),ct(h),ct(fe)),fi(C,K)}}}function ud(O){let C,M;function E(){return O[8](O[11])}return C=new Of({props:{onSelect:E,$$slots:{default:[nm]},$$scope:{ctx:O}}}),{c(){ui(C.$$.fragment)},l(F){di(C.$$.fragment,F)},m(F,R){pi(C,F,R),M=!0},p(F,R){O=F;const b={};R&21&&(b.onSelect=E),R&16388&&(b.$$scope={dirty:R,ctx:O}),C.$set(b)},i(F){M||($e(C.$$.fragment,F),M=!0)},o(F){st(C.$$.fragment,F),M=!1},d(F){fi(C,F)}}}function sm(O){let C,M,E=nd(O[2]),F=[];for(let b=0;b<E.length;b+=1)F[b]=ud(ld(O,E,b));const R=b=>st(F[b],1,1,()=>{F[b]=null});return{c(){for(let b=0;b<F.length;b+=1)F[b].c();C=Sn()},l(b){for(let h=0;h<F.length;h+=1)F[h].l(b);C=Sn()},m(b,h){for(let le=0;le<F.length;le+=1)F[le]&&F[le].m(b,h);At(b,C,h),M=!0},p(b,h){if(h&21){E=nd(b[2]);let le;for(le=0;le<E.length;le+=1){const he=ld(b,E,le);F[le]?(F[le].p(he,h),$e(F[le],1)):(F[le]=ud(he),F[le].c(),$e(F[le],1),F[le].m(C.parentNode,C))}for(In(),le=E.length;le<F.length;le+=1)R(le);Cn()}},i(b){if(!M){for(let h=0;h<E.length;h+=1)$e(F[h]);M=!0}},o(b){F=F.filter(Boolean);for(let h=0;h<F.length;h+=1)st(F[h]);M=!1},d(b){b&&ct(C),Cf(F,b)}}}function am(O){let C,M,E,F;return C=new Bf({props:{$$slots:{default:[rm]},$$scope:{ctx:O}}}),E=new Ff({props:{$$slots:{default:[sm]},$$scope:{ctx:O}}}),{c(){ui(C.$$.fragment),M=Hi(),ui(E.$$.fragment)},l(R){di(C.$$.fragment,R),M=Wi(R),di(E.$$.fragment,R)},m(R,b){pi(C,R,b),At(R,M,b),pi(E,R,b),F=!0},p(R,b){const h={};b&16384&&(h.$$scope={dirty:b,ctx:R}),C.$set(h);const le={};b&16405&&(le.$$scope={dirty:b,ctx:R}),E.$set(le)},i(R){F||($e(C.$$.fragment,R),$e(E.$$.fragment,R),F=!0)},o(R){st(C.$$.fragment,R),st(E.$$.fragment,R),F=!1},d(R){R&&ct(M),fi(C,R),fi(E,R)}}}function om(O){let C,M,E,F,R,b;function h(re){O[6](re)}let le={placeholder:"Search location...",class:"peer rounded-none"};O[1]!==void 0&&(le.value=O[1]),C=new Rf({props:le}),xs.push(()=>tl(C,"value",h)),C.$on("focus",O[7]);let he=O[3]&&cd(),fe=O[4]&&hd(O);return{c(){ui(C.$$.fragment),E=Hi(),he&&he.c(),F=Hi(),fe&&fe.c(),R=Sn()},l(re){di(C.$$.fragment,re),E=Wi(re),he&&he.l(re),F=Wi(re),fe&&fe.l(re),R=Sn()},m(re,K){pi(C,re,K),At(re,E,K),he&&he.m(re,K),At(re,F,K),fe&&fe.m(re,K),At(re,R,K),b=!0},p(re,K){const je={};!M&&K&2&&(M=!0,je.value=re[1],Qo(()=>M=!1)),C.$set(je),re[3]?he?K&8&&$e(he,1):(he=cd(),he.c(),$e(he,1),he.m(F.parentNode,F)):he&&(In(),st(he,1,1,()=>{he=null}),Cn()),re[4]?fe?(fe.p(re,K),K&16&&$e(fe,1)):(fe=hd(re),fe.c(),$e(fe,1),fe.m(R.parentNode,R)):fe&&(In(),st(fe,1,1,()=>{fe=null}),Cn())},i(re){b||($e(C.$$.fragment,re),$e(he),$e(fe),b=!0)},o(re){st(C.$$.fragment,re),st(he),st(fe),b=!1},d(re){re&&(ct(E),ct(F),ct(R)),fi(C,re),he&&he.d(re),fe&&fe.d(re)}}}function lm(O){let C,M,E,F;return M=new Lf({props:{class:pc("w-full rounded-lg border border-b-0 bg-card shadow",O[4]&&"rounded-lg focus-within:rounded-b-none"),shouldFilter:!1,$$slots:{default:[om]},$$scope:{ctx:O}}}),{c(){C=Er("div"),ui(M.$$.fragment),this.h()},l(R){C=Mr(R,"DIV",{class:!0});var b=kr(C);di(M.$$.fragment,b),b.forEach(ct),this.h()},h(){Zt(C,"class",E=O[5].class)},m(R,b){At(R,C,b),pi(M,C,null),F=!0},p(R,[b]){const h={};b&16&&(h.class=pc("w-full rounded-lg border border-b-0 bg-card shadow",R[4]&&"rounded-lg focus-within:rounded-b-none")),b&16415&&(h.$$scope={dirty:b,ctx:R}),M.$set(h),(!F||b&32&&E!==(E=R[5].class))&&Zt(C,"class",E)},i(R){F||($e(M.$$.fragment,R),F=!0)},o(R){st(M.$$.fragment,R),F=!1},d(R){R&&ct(C),fi(M)}}}function cm(O,C,M){const E=["lngLat"];let F=Tn(C,E),{lngLat:R}=C,b,h=[],le="",he=!1,fe=!1;const re=Ye=>{clearTimeout(b),b=setTimeout(async()=>{M(3,he=!0);const _t=`https://nominatim.openstreetmap.org/search?format=geojson&accept-language=id&countrycodes=id&limit=5&q=${Ye}`,Be=await fetch(_t).then(De=>De.json()).catch(()=>console.error("An exception occurred"));M(2,h=Be==null?void 0:Be.features),M(3,he=!1),M(4,fe=!0)},500)};function K(Ye){le=Ye,M(1,le)}const je=()=>M(4,fe=h.length>0&&le.length>1),Qe=Ye=>{M(0,R=Ye.geometry.coordinates),M(4,fe=!1)};return O.$$set=Ye=>{C=Xr(Xr({},C),il(Ye)),M(5,F=Tn(C,E)),"lngLat"in Ye&&M(0,R=Ye.lngLat)},O.$$.update=()=>{O.$$.dirty&2&&(M(4,fe=!1),le.length>1&&re(le))},[R,le,h,he,fe,F,K,je,Qe]}class hm extends Or{constructor(C){super(),Vr(this,C,cm,lm,xr,{lngLat:0})}}const Ch=Symbol.for("svelte-maplibre");function Ya(){return wd(Ch)}function um(O){let C=new WeakMap;return M=>{var b;let E=C.get(M.originalEvent);if(E!==void 0)return E;let R=(b=M.target.queryRenderedFeatures(M.point).find(h=>{var le;return(le=O.get(h.layer.id))==null?void 0:le.interactive}))==null?void 0:b.layer.id;return C.set(M.originalEvent,R),R}}function dm(){let O=new Map;return bd(Ch,{map:Yn(null),source:Sh(null),layer:Sh(null),popupTarget:Sh(null),cluster:Yn(),loadedImages:Yn(new Set),minzoom:Yn(0),maxzoom:Yn(24),layerEvent:Yn(null),layerInfo:O,eventTopMost:um(O)})}function dd(O){return{subscribe:O.subscribe}}function pm({key:O,setPopupTarget:C=!1,setCluster:M=!1,setMouseEvent:E=!1}){let F=Ya(),R=Yn(null),b=dd(R),h={...F,[O]:dd(R)};if(C&&(h.popupTarget=b),E){let le=Yn(null);h.layerEvent=le,F.layerEvent=le}return M&&(h.cluster=Yn()),bd(Ch,h),{...F,self:R}}function fm(){return pm({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function mm(O){return"layerType"in O&&O.layerType==="deckgl"}var Id={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.0/LICENSE.txt
 */(function(O,C){(function(M,E){O.exports=E()})(Nf,function(){var M={},E={};function F(b,h,le){if(E[b]=le,b==="index"){var he="var sharedModule = {}; ("+E.shared+")(sharedModule); ("+E.worker+")(sharedModule);",fe={};return E.shared(fe),E.index(M,fe),typeof window<"u"&&M.setWorkerUrl(window.URL.createObjectURL(new Blob([he],{type:"text/javascript"}))),M}}F("shared",["exports"],function(b){function h(i,e,r,s){return new(r||(r=Promise))(function(o,d){function p(x){try{g(s.next(x))}catch(w){d(w)}}function f(x){try{g(s.throw(x))}catch(w){d(w)}}function g(x){var w;x.done?o(x.value):(w=x.value,w instanceof r?w:new r(function(T){T(w)})).then(p,f)}g((s=s.apply(i,e||[])).next())})}function le(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var he=fe;function fe(i,e){this.x=i,this.y=e}fe.prototype={clone:function(){return new fe(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,e){var r=Math.cos(i),s=Math.sin(i),o=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},fe.convert=function(i){return i instanceof fe?i:Array.isArray(i)?new fe(i[0],i[1]):i};var re=le(he),K=je;function je(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=s}je.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var o=this.sampleCurveX(r)-i;if(Math.abs(o)<e)return r;var d=this.sampleCurveDerivativeX(r);if(Math.abs(d)<1e-6)break;r-=o/d}var p=0,f=1;for(r=i,s=0;s<20&&(o=this.sampleCurveX(r),!(Math.abs(o-i)<e));s++)i>o?p=r:f=r,r=.5*(f-p)+p;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var Qe=le(K);let Ye,_t;function Be(){return Ye==null&&(Ye=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ye}function De(){if(_t==null&&(_t=!1,Be())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let s=0;s<5*5;s++){const o=4*s;e.fillStyle=`rgb(${o},${o+1},${o+2})`,e.fillRect(s%5,Math.floor(s/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){_t=!0;break}}}return _t||!1}function ht(i,e,r,s){const o=new Qe(i,e,r,s);return function(d){return o.solve(d)}}const gt=ht(.25,.1,.25,1);function Ot(i,e,r){return Math.min(r,Math.max(e,i))}function mi(i,e,r){const s=r-e,o=((i-e)%s+s)%s+e;return o===e?r:o}function It(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let it=1;function Tt(i,e,r){const s={};for(const o in i)s[o]=e.call(r||this,i[o],o,i);return s}function ar(i,e,r){const s={};for(const o in i)e.call(r||this,i[o],o,i)&&(s[o]=i[o]);return s}function Wt(i){return Array.isArray(i)?i.map(Wt):typeof i=="object"&&i?Tt(i,Wt):i}const Ct={};function Xt(i){Ct[i]||(typeof console<"u"&&console.warn(i),Ct[i]=!0)}function zi(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function or(i){let e=0;for(let r,s,o=0,d=i.length,p=d-1;o<d;p=o++)r=i[o],s=i[p],e+=(s.x-r.x)*(r.y+s.y);return e}function pt(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let ni=null;function Kt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Pr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Xi(i,e,r,s,o){return h(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const d=new VideoFrame(i,{timestamp:0});try{const p=d==null?void 0:d.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const f=p.startsWith("BGR"),g=new Uint8ClampedArray(s*o*4);if(yield d.copyTo(g,function(x,w,T,k,z){const L=4*Math.max(-w,0),V=(Math.max(0,T)-T)*k*4+L,G=4*k,X=Math.max(0,w),se=Math.max(0,T);return{rect:{x:X,y:se,width:Math.min(x.width,w+k)-X,height:Math.min(x.height,T+z)-se},layout:[{offset:V,stride:G}]}}(i,e,r,s,o)),f)for(let x=0;x<g.length;x+=4){const w=g[x];g[x]=g[x+2],g[x+2]=w}return g}finally{d.close()}})}let Ft,Pt;const gi="AbortError";function si(){return new Error(gi)}const Ki={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function lr(i){return Ki.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Di="global-dispatcher";class Ie extends Error{constructor(e,r,s,o){super(`AJAXError: ${r} (${e}): ${s}`),this.status=e,this.statusText=r,this.url=s,this.body=o}}const et=()=>pt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,kt=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const s=lr(i.url);if(s)return s(i,e);if(pt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:i,targetMapId:Di},e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(et())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(s,o){return h(this,void 0,void 0,function*(){const d=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:et(),signal:o.signal});s.type==="json"&&d.headers.set("Accept","application/json");const p=yield fetch(d);if(!p.ok){const x=yield p.blob();throw new Ie(p.status,p.statusText,s.url,x)}const f=s.type==="arrayBuffer"||s.type==="image"?p.arrayBuffer():s.type==="json"?p.json():p.text(),g=yield f;if(o.signal.aborted)throw si();return{data:g,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}})}(i,e);if(pt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:i,mustQueue:!0,targetMapId:Di},e)}var r;return function(s,o){return new Promise((d,p)=>{const f=new XMLHttpRequest;f.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(f.responseType="arraybuffer");for(const g in s.headers)f.setRequestHeader(g,s.headers[g]);s.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=s.credentials==="include",f.onerror=()=>{p(new Error(f.statusText))},f.onload=()=>{if(!o.signal.aborted)if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let g=f.response;if(s.type==="json")try{g=JSON.parse(f.response)}catch(x){return void p(x)}d({data:g,cacheControl:f.getResponseHeader("Cache-Control"),expires:f.getResponseHeader("Expires")})}else{const g=new Blob([f.response],{type:f.getResponseHeader("Content-Type")});p(new Ie(f.status,f.statusText,s.url,g))}},o.signal.addEventListener("abort",()=>{f.abort(),p(si())}),f.send(s.body)})}(i,e)};function Ur(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function Kr(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function ke(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class zr{constructor(e,r={}){It(this,r),this.type=e}}class Jt extends zr{constructor(e,r={}){super("error",It({error:e},r))}}class An{on(e,r){return this._listeners=this._listeners||{},Kr(e,r,this._listeners),this}off(e,r){return ke(e,r,this._listeners),ke(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Kr(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){typeof e=="string"&&(e=new zr(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const o=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const f of o)f.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const f of d)ke(s,f,this._oneTimeListeners),f.call(this,e);const p=this._eventedParent;p&&(It(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Jt&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var de={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const kn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function vs(i,e){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return kn.forEach(s=>{s in e&&(r[s]=e[s])}),r}function xt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!xt(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!xt(i[r],e[r]))return!1;return!0}return i===e}function Fi(i,e){i.push(e)}function Yr(i,e,r){Fi(r,{command:"addSource",args:[i,e[i]]})}function Jn(i,e,r){Fi(e,{command:"removeSource",args:[i]}),r[i]=!0}function $n(i,e,r,s){Jn(i,r,s),Yr(i,e,r)}function Qn(i,e,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!xt(i[r][s],e[r][s]))return!1;for(s in e[r])if(Object.prototype.hasOwnProperty.call(e[r],s)&&s!=="data"&&!xt(i[r][s],e[r][s]))return!1;return!0}function En(i,e,r,s,o,d){i=i||{},e=e||{};for(const p in i)Object.prototype.hasOwnProperty.call(i,p)&&(xt(i[p],e[p])||r.push({command:d,args:[s,p,e[p],o]}));for(const p in e)Object.prototype.hasOwnProperty.call(e,p)&&!Object.prototype.hasOwnProperty.call(i,p)&&(xt(i[p],e[p])||r.push({command:d,args:[s,p,e[p],o]}))}function Ks(i){return i.id}function Mn(i,e){return i[e.id]=e,i}class Te{constructor(e,r,s,o){this.message=(e?`${e}: `:"")+s,o&&(this.identifier=o),r!=null&&r.__line__&&(this.line=r.__line__)}}function Jr(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}class vr extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class bs{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,o]of r)this.bindings[s]=o}concat(e){return new bs(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Vi={kind:"null"},Ee={kind:"number"},ut={kind:"string"},at={kind:"boolean"},_i={kind:"color"},$r={kind:"object"},rt={kind:"value"},Pn={kind:"collator"},bi={kind:"formatted"},H={kind:"padding"},A={kind:"resolvedImage"},P={kind:"variableAnchorOffsetCollection"};function B(i,e){return{kind:"array",itemType:i,N:e}}function j(i){if(i.kind==="array"){const e=j(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Q=[Vi,Ee,ut,at,_i,bi,$r,B(rt),H,A,P];function ee(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ee(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of Q)if(!ee(r,e))return null}}return`Expected ${j(i)} but found ${j(e)} instead.`}function ne(i,e){return e.some(r=>r.kind===i.kind)}function J(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function ae(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const xe=.96422,me=.82521,ge=4/29,Ge=6/29,We=3*Ge*Ge,nt=Ge*Ge*Ge,tt=Math.PI/180,vt=180/Math.PI;function zt(i){return(i%=360)<0&&(i+=360),i}function Gt([i,e,r,s]){let o,d;const p=ot((.2225045*(i=yi(i))+.7168786*(e=yi(e))+.0606169*(r=yi(r)))/1);i===e&&e===r?o=d=p:(o=ot((.4360747*i+.3850649*e+.1430804*r)/xe),d=ot((.0139322*i+.0971045*e+.7141733*r)/me));const f=116*p-16;return[f<0?0:f,500*(o-p),200*(p-d),s]}function yi(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ot(i){return i>nt?Math.pow(i,1/3):i/We+ge}function $t([i,e,r,s]){let o=(i+16)/116,d=isNaN(e)?o:o+e/500,p=isNaN(r)?o:o-r/200;return o=1*Yi(o),d=xe*Yi(d),p=me*Yi(p),[wi(3.1338561*d-1.6168667*o-.4906146*p),wi(-.9787684*d+1.9161415*o+.033454*p),wi(.0719453*d-.2289914*o+1.4052427*p),s]}function wi(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Yi(i){return i>Ge?i*i*i:We*(i-ge)}function cr(i){return parseInt(i.padEnd(2,i),16)/255}function Li(i,e){return Qr(e?i/100:i,0,1)}function Qr(i,e,r){return Math.min(Math.max(e,i),r)}function nl(i){return!i.some(Number.isNaN)}const mc={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Et{constructor(e,r,s,o=1,d=!0){this.r=e,this.g=r,this.b=s,this.a=o,d||(this.r*=o,this.g*=o,this.b*=o,o||this.overwriteGetter("rgb",[e,r,s,o]))}static parse(e){if(e instanceof Et)return e;if(typeof e!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const o=mc[s];if(o){const[p,f,g]=o;return[p/255,f/255,g/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const p=s.length<6?1:2;let f=1;return[cr(s.slice(f,f+=p)),cr(s.slice(f,f+=p)),cr(s.slice(f,f+=p)),cr(s.slice(f,f+p)||"ff")]}if(s.startsWith("rgb")){const p=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[f,g,x,w,T,k,z,L,V,G,X,se]=p,Y=[w||" ",z||" ",G].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const te=[x,k,V].join(""),pe=te==="%%%"?100:te===""?255:0;if(pe){const ye=[Qr(+g/pe,0,1),Qr(+T/pe,0,1),Qr(+L/pe,0,1),X?Li(+X,se):1];if(nl(ye))return ye}}return}}const d=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[p,f,g,x,w,T,k,z,L]=d,V=[g||" ",w||" ",k].join("");if(V==="  "||V==="  /"||V===",,"||V===",,,"){const G=[+f,Qr(+x,0,100),Qr(+T,0,100),z?Li(+z,L):1];if(nl(G))return function([X,se,Y,te]){function pe(ye){const Re=(ye+X/30)%12,Ne=se*Math.min(Y,1-Y);return Y-Ne*Math.max(-1,Math.min(Re-3,9-Re,1))}return X=zt(X),se/=100,Y/=100,[pe(0),pe(8),pe(4),te]}(G)}}}(e);return r?new Et(...r,!1):void 0}get rgb(){const{r:e,g:r,b:s,a:o}=this,d=o||1/0;return this.overwriteGetter("rgb",[e/d,r/d,s/d,o])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,s,o,d]=Gt(e),p=Math.sqrt(s*s+o*o);return[Math.round(1e4*p)?zt(Math.atan2(o,s)*vt):NaN,p,r,d]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Gt(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,s,o]=this.rgb;return`rgba(${[e,r,s].map(d=>Math.round(255*d)).join(",")},${o})`}}Et.black=new Et(0,0,0,1),Et.white=new Et(1,1,1,1),Et.transparent=new Et(0,0,0,0),Et.red=new Et(1,0,0,1);class Ja{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class $a{constructor(e,r,s,o,d){this.text=e,this.image=r,this.scale=s,this.fontStack=o,this.textColor=d}}class br{constructor(e){this.sections=e}static fromString(e){return new br([new $a(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof br?e:br.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class hr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof hr)return e;if(typeof e=="number")return new hr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new hr(e)}}toString(){return JSON.stringify(this.values)}}const ws=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Dr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Dr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const s=e[r],o=e[r+1];if(typeof s!="string"||!ws.has(s)||!Array.isArray(o)||o.length!==2||typeof o[0]!="number"||typeof o[1]!="number")return}return new Dr(e)}}toString(){return JSON.stringify(this.values)}}class Lr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Lr({name:e,available:!1}):null}}function es(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ys(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Et||i instanceof Ja||i instanceof br||i instanceof hr||i instanceof Dr||i instanceof Lr)return!0;if(Array.isArray(i)){for(const e of i)if(!Ys(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Ys(i[e]))return!1;return!0}return!1}function xi(i){if(i===null)return Vi;if(typeof i=="string")return ut;if(typeof i=="boolean")return at;if(typeof i=="number")return Ee;if(i instanceof Et)return _i;if(i instanceof Ja)return Pn;if(i instanceof br)return bi;if(i instanceof hr)return H;if(i instanceof Dr)return P;if(i instanceof Lr)return A;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const o=xi(s);if(r){if(r===o)continue;r=rt;break}r=o}return B(r||rt,e)}return $r}function Ss(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Et||i instanceof br||i instanceof hr||i instanceof Dr||i instanceof Lr?i.toString():JSON.stringify(i)}class fn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ys(e[1]))return r.error("invalid value");const s=e[1];let o=xi(s);const d=r.expectedType;return o.kind!=="array"||o.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(o=d),new fn(o,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Yt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Js={string:ut,number:Ee,boolean:at,object:$r};class wr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,o=1;const d=e[0];if(d==="array"){let f,g;if(e.length>2){const x=e[1];if(typeof x!="string"||!(x in Js)||x==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);f=Js[x],o++}else f=rt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);g=e[2],o++}s=B(f,g)}else{if(!Js[d])throw new Error(`Types doesn't contain name = ${d}`);s=Js[d]}const p=[];for(;o<e.length;o++){const f=r.parse(e[o],o,rt);if(!f)return null;p.push(f)}return new wr(s,p)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!ee(this.type,xi(s)))return s;if(r===this.args.length-1)throw new Yt(`Expected value to be of type ${j(this.type)}, but found ${j(xi(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const $s={"to-boolean":at,"to-color":_i,"to-number":Ee,"to-string":ut};class en{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(!$s[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const o=$s[s],d=[];for(let p=1;p<e.length;p++){const f=r.parse(e[p],p,rt);if(!f)return null;d.push(f)}return new en(o,d)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,s;for(const o of this.args){if(r=o.evaluate(e),s=null,r instanceof Et)return r;if(typeof r=="string"){const d=e.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:es(r[0],r[1],r[2],r[3]),!s))return new Et(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Yt(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(e);const o=hr.parse(r);if(o)return o}throw new Yt(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(e);const o=Dr.parse(r);if(o)return o}throw new Yt(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const o=Number(r);if(!isNaN(o))return o}throw new Yt(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return br.fromString(Ss(this.args[0].evaluate(e)));case"resolvedImage":return Lr.fromString(Ss(this.args[0].evaluate(e)));default:return Ss(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ts=["Unknown","Point","LineString","Polygon"];class Mt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ts[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Et.parse(e)),r}}class Qs{constructor(e,r,s=[],o,d=new bs,p=[]){this.registry=e,this.path=s,this.key=s.map(f=>`[${f}]`).join(""),this.scope=d,this.errors=p,this.expectedType=o,this._isConstant=r}parse(e,r,s,o,d={}){return r?this.concat(r,s,o)._parse(e,d):this._parse(e,d)}_parse(e,r){function s(o,d,p){return p==="assert"?new wr(d,[o]):p==="coerce"?new en(d,[o]):o}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const o=e[0];if(typeof o!="string")return this.error(`Expression name must be a string, but found ${typeof o} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[o];if(d){let p=d.parse(e,this);if(!p)return null;if(this.expectedType){const f=this.expectedType,g=p.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||g.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string")if(f.kind!=="padding"||g.kind!=="value"&&g.kind!=="number"&&g.kind!=="array")if(f.kind!=="variableAnchorOffsetCollection"||g.kind!=="value"&&g.kind!=="array"){if(this.checkSubtype(f,g))return null}else p=s(p,f,r.typeAnnotation||"coerce");else p=s(p,f,r.typeAnnotation||"coerce");else p=s(p,f,r.typeAnnotation||"coerce");else p=s(p,f,r.typeAnnotation||"assert")}if(!(p instanceof fn)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const f=new Mt;try{p=new fn(p.type,p.evaluate(f))}catch(g){return this.error(g.message),null}}return p}return this.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const o=typeof e=="number"?this.path.concat(e):this.path,d=s?this.scope.concat(s):this.scope;return new Qs(this.registry,this._isConstant,o,r||null,d,this.errors)}error(e,...r){const s=`${this.key}${r.map(o=>`[${o}]`).join("")}`;this.errors.push(new vr(s,e))}checkSubtype(e,r){const s=ee(e,r);return s&&this.error(s),s}}class ts{constructor(e,r,s){this.type=Pn,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const o=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,at);if(!o)return null;const d=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,at);if(!d)return null;let p=null;return s.locale&&(p=r.parse(s.locale,1,ut),!p)?null:new ts(o,d,p)}evaluate(e){return new Ja(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const mn=8192;function ea(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Is(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function gc(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,o=Math.pow(2,e.z);return[Math.round(r*o*mn),Math.round(s*o*mn)]}function sl(i,e,r){const s=i[0]-e[0],o=i[1]-e[1],d=i[0]-r[0],p=i[1]-r[1];return s*p-d*o==0&&s*d<=0&&o*p<=0}function ta(i,e){let r=!1;for(let p=0,f=e.length;p<f;p++){const g=e[p];for(let x=0,w=g.length;x<w-1;x++){if(sl(i,g[x],g[x+1]))return!1;(o=g[x])[1]>(s=i)[1]!=(d=g[x+1])[1]>s[1]&&s[0]<(d[0]-o[0])*(s[1]-o[1])/(d[1]-o[1])+o[0]&&(r=!r)}}var s,o,d;return r}function _c(i,e){for(let r=0;r<e.length;r++)if(ta(i,e[r]))return!0;return!1}function al(i,e,r,s){const o=s[0]-r[0],d=s[1]-r[1],p=(i[0]-r[0])*d-o*(i[1]-r[1]),f=(e[0]-r[0])*d-o*(e[1]-r[1]);return p>0&&f<0||p<0&&f>0}function yc(i,e,r){for(const x of r)for(let w=0;w<x.length-1;++w)if((f=[(p=x[w+1])[0]-(d=x[w])[0],p[1]-d[1]])[0]*(g=[(o=e)[0]-(s=i)[0],o[1]-s[1]])[1]-f[1]*g[0]!=0&&al(s,o,d,p)&&al(d,p,s,o))return!0;var s,o,d,p,f,g;return!1}function ol(i,e){for(let r=0;r<i.length;++r)if(!ta(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(yc(i[r],i[r+1],e))return!1;return!0}function ll(i,e){for(let r=0;r<e.length;r++)if(ol(i,e[r]))return!0;return!1}function ia(i,e,r){const s=[];for(let o=0;o<i.length;o++){const d=[];for(let p=0;p<i[o].length;p++){const f=gc(i[o][p],r);ea(e,f),d.push(f)}s.push(d)}return s}function cl(i,e,r){const s=[];for(let o=0;o<i.length;o++){const d=ia(i[o],e,r);s.push(d)}return s}function hl(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const o=.5*s;let d=i[0]-r[0]>o?-s:r[0]-i[0]>o?s:0;d===0&&(d=i[0]-r[2]>o?-s:r[2]-i[0]>o?s:0),i[0]+=d}ea(e,i)}function ra(i,e,r,s){const o=Math.pow(2,s.z)*mn,d=[s.x*mn,s.y*mn],p=[];for(const f of i)for(const g of f){const x=[g.x+d[0],g.y+d[1]];hl(x,e,r,o),p.push(x)}return p}function ul(i,e,r,s){const o=Math.pow(2,s.z)*mn,d=[s.x*mn,s.y*mn],p=[];for(const g of i){const x=[];for(const w of g){const T=[w.x+d[0],w.y+d[1]];ea(e,T),x.push(T)}p.push(x)}if(e[2]-e[0]<=o/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const g of p)for(const x of g)hl(x,e,r,o)}var f;return p}class zn{constructor(e,r){this.type=at,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ys(e[1])){const s=e[1];if(s.type==="FeatureCollection"){const o=[];for(const d of s.features){const{type:p,coordinates:f}=d.geometry;p==="Polygon"&&o.push(f),p==="MultiPolygon"&&o.push(...f)}if(o.length)return new zn(s,{type:"MultiPolygon",coordinates:o})}else if(s.type==="Feature"){const o=s.geometry.type;if(o==="Polygon"||o==="MultiPolygon")return new zn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new zn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const o=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(s.type==="Polygon"){const f=ia(s.coordinates,d,p),g=ra(r.geometry(),o,d,p);if(!Is(o,d))return!1;for(const x of g)if(!ta(x,f))return!1}if(s.type==="MultiPolygon"){const f=cl(s.coordinates,d,p),g=ra(r.geometry(),o,d,p);if(!Is(o,d))return!1;for(const x of g)if(!_c(x,f))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const o=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(s.type==="Polygon"){const f=ia(s.coordinates,d,p),g=ul(r.geometry(),o,d,p);if(!Is(o,d))return!1;for(const x of g)if(!ol(x,f))return!1}if(s.type==="MultiPolygon"){const f=cl(s.coordinates,d,p),g=ul(r.geometry(),o,d,p);if(!Is(o,d))return!1;for(const x of g)if(!ll(x,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class na{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new na(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Sr{constructor(e,r,s,o){this.name=e,this.type=r,this._evaluate=s,this.args=o}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const s=e[0],o=Sr.definitions[s];if(!o)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(o)?o[0]:o.type,p=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,f=p.filter(([x])=>!Array.isArray(x)||x.length===e.length-1);let g=null;for(const[x,w]of f){g=new Qs(r.registry,Cs,r.path,null,r.scope);const T=[];let k=!1;for(let z=1;z<e.length;z++){const L=e[z],V=Array.isArray(x)?x[z-1]:x.type,G=g.parse(L,1+T.length,V);if(!G){k=!0;break}T.push(G)}if(!k)if(Array.isArray(x)&&x.length!==T.length)g.error(`Expected ${x.length} arguments, but found ${T.length} instead.`);else{for(let z=0;z<T.length;z++){const L=Array.isArray(x)?x[z]:x.type,V=T[z];g.concat(z+1).checkSubtype(L,V.type)}if(g.errors.length===0)return new Sr(s,d,w,T)}}if(f.length===1)r.errors.push(...g.errors);else{const x=(f.length?f:p).map(([T])=>{return k=T,Array.isArray(k)?`(${k.map(j).join(", ")})`:`(${j(k.type)}...)`;var k}).join(" | "),w=[];for(let T=1;T<e.length;T++){const k=r.parse(e[T],1+w.length);if(!k)return null;w.push(j(k.type))}r.error(`Expected arguments of type ${x}, but found (${w.join(", ")}) instead.`)}return null}static register(e,r){Sr.definitions=r;for(const s in r)e[s]=Sr}}function Cs(i){if(i instanceof na)return Cs(i.boundExpression);if(i instanceof Sr&&i.name==="error"||i instanceof ts||i instanceof zn)return!1;const e=i instanceof en||i instanceof wr;let r=!0;return i.eachChild(s=>{r=e?r&&Cs(s):r&&s instanceof fn}),!!r&&sa(i)&&ks(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function sa(i){if(i instanceof Sr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof zn)return!1;let e=!0;return i.eachChild(r=>{e&&!sa(r)&&(e=!1)}),e}function As(i){if(i instanceof Sr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!As(r)&&(e=!1)}),e}function ks(i,e){if(i instanceof Sr&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!ks(s,e)&&(r=!1)}),r}function Es(i,e){const r=i.length-1;let s,o,d=0,p=r,f=0;for(;d<=p;)if(f=Math.floor((d+p)/2),s=i[f],o=i[f+1],s<=e){if(f===r||e<o)return f;d=f+1}else{if(!(s>e))throw new Yt("Input is not a number.");p=f-1}return 0}class Ms{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[o,d]of s)this.labels.push(o),this.outputs.push(d)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Ee);if(!s)return null;const o=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let p=1;p<e.length;p+=2){const f=p===1?-1/0:e[p],g=e[p+1],x=p,w=p+1;if(typeof f!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(o.length&&o[o.length-1][0]>=f)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const T=r.parse(g,w,d);if(!T)return null;d=d||T.type,o.push([f,T])}return new Ms(d,s,o)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const o=this.input.evaluate(e);if(o<=r[0])return s[0].evaluate(e);const d=r.length;return o>=r[d-1]?s[d-1].evaluate(e):s[Es(r,o)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function xc(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var vc=dl;function dl(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=s}dl.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var o=this.sampleCurveX(r)-i;if(Math.abs(o)<e)return r;var d=this.sampleCurveDerivativeX(r);if(Math.abs(d)<1e-6)break;r-=o/d}var p=0,f=1;for(r=i,s=0;s<20&&(o=this.sampleCurveX(r),!(Math.abs(o-i)<e));s++)i>o?p=r:f=r,r=.5*(f-p)+p;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var bc=xc(vc);function Dn(i,e,r){return i+r*(e-i)}function aa(i,e,r){return i.map((s,o)=>Dn(s,e[o],r))}const Ji={number:Dn,color:function(i,e,r,s="rgb"){switch(s){case"rgb":{const[o,d,p,f]=aa(i.rgb,e.rgb,r);return new Et(o,d,p,f,!1)}case"hcl":{const[o,d,p,f]=i.hcl,[g,x,w,T]=e.hcl;let k,z;if(isNaN(o)||isNaN(g))isNaN(o)?isNaN(g)?k=NaN:(k=g,p!==1&&p!==0||(z=x)):(k=o,w!==1&&w!==0||(z=d));else{let se=g-o;g>o&&se>180?se-=360:g<o&&o-g>180&&(se+=360),k=o+r*se}const[L,V,G,X]=function([se,Y,te,pe]){return se=isNaN(se)?0:se*tt,$t([te,Math.cos(se)*Y,Math.sin(se)*Y,pe])}([k,z??Dn(d,x,r),Dn(p,w,r),Dn(f,T,r)]);return new Et(L,V,G,X,!1)}case"lab":{const[o,d,p,f]=$t(aa(i.lab,e.lab,r));return new Et(o,d,p,f,!1)}}},array:aa,padding:function(i,e,r){return new hr(aa(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const s=i.values,o=e.values;if(s.length!==o.length)throw new Yt(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const d=[];for(let p=0;p<s.length;p+=2){if(s[p]!==o[p])throw new Yt(`Cannot interpolate values containing mismatched anchors. from[${p}]: ${s[p]}, to[${p}]: ${o[p]}`);d.push(s[p]);const[f,g]=s[p+1],[x,w]=o[p+1];d.push([Dn(f,x,r),Dn(g,w,r)])}return new Dr(d)}};class Ui{constructor(e,r,s,o,d){this.type=e,this.operator=r,this.interpolation=s,this.input=o,this.labels=[],this.outputs=[];for(const[p,f]of d)this.labels.push(p),this.outputs.push(f)}static interpolationFactor(e,r,s,o){let d=0;if(e.name==="exponential")d=St(r,e.base,s,o);else if(e.name==="linear")d=St(r,1,s,o);else if(e.name==="cubic-bezier"){const p=e.controlPoints;d=new bc(p[0],p[1],p[2],p[3]).solve(St(r,1,s,o))}return d}static parse(e,r){let[s,o,d,...p]=e;if(!Array.isArray(o)||o.length===0)return r.error("Expected an interpolation type expression.",1);if(o[0]==="linear")o={name:"linear"};else if(o[0]==="exponential"){const x=o[1];if(typeof x!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:x}}else{if(o[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(o[0])}`,1,0);{const x=o.slice(1);if(x.length!==4||x.some(w=>typeof w!="number"||w<0||w>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,Ee),!d)return null;const f=[];let g=null;s==="interpolate-hcl"||s==="interpolate-lab"?g=_i:r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let x=0;x<p.length;x+=2){const w=p[x],T=p[x+1],k=x+3,z=x+4;if(typeof w!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(f.length&&f[f.length-1][0]>=w)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const L=r.parse(T,z,g);if(!L)return null;g=g||L.type,f.push([w,L])}return ae(g,Ee)||ae(g,_i)||ae(g,H)||ae(g,P)||ae(g,B(Ee))?new Ui(g,s,o,d,f):r.error(`Type ${j(g)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const o=this.input.evaluate(e);if(o<=r[0])return s[0].evaluate(e);const d=r.length;if(o>=r[d-1])return s[d-1].evaluate(e);const p=Es(r,o),f=Ui.interpolationFactor(this.interpolation,o,r[p],r[p+1]),g=s[p].evaluate(e),x=s[p+1].evaluate(e);switch(this.operator){case"interpolate":return Ji[this.type.kind](g,x,f);case"interpolate-hcl":return Ji.color(g,x,f,"hcl");case"interpolate-lab":return Ji.color(g,x,f,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function St(i,e,r,s){const o=s-r,d=i-r;return o===0?0:e===1?d/o:(Math.pow(e,d)-1)/(Math.pow(e,o)-1)}class oa{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const o=r.expectedType;o&&o.kind!=="value"&&(s=o);const d=[];for(const f of e.slice(1)){const g=r.parse(f,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!g)return null;s=s||g.type,d.push(g)}if(!s)throw new Error("No output type");const p=o&&d.some(f=>ee(o,f.type));return new oa(p?rt:s,d)}evaluate(e){let r,s=null,o=0;for(const d of this.args)if(o++,s=d.evaluate(e),s&&s instanceof Lr&&!s.available&&(r||(r=s.name),s=null,o===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class la{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let d=1;d<e.length-1;d+=2){const p=e[d];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const f=r.parse(e[d+1],d+1);if(!f)return null;s.push([p,f])}const o=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return o?new la(s,o):null}outputDefined(){return this.result.outputDefined()}}class Qa{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Ee),o=r.parse(e[2],2,B(r.expectedType||rt));return s&&o?new Qa(o.type.itemType,s,o):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new Yt(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new Yt(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new Yt(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class eo{constructor(e,r){this.type=at,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,rt),o=r.parse(e[2],2,rt);return s&&o?ne(s.type,[at,ut,Ee,Vi,rt])?new eo(s,o):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!J(r,["boolean","string","number","null"]))throw new Yt(`Expected first argument to be of type boolean, string, number or null, but found ${j(xi(r))} instead.`);if(!J(s,["string","array"]))throw new Yt(`Expected second argument to be of type array or string, but found ${j(xi(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ca{constructor(e,r,s){this.type=Ee,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,rt),o=r.parse(e[2],2,rt);if(!s||!o)return null;if(!ne(s.type,[at,ut,Ee,Vi,rt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(s.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,Ee);return d?new ca(s,o,d):null}return new ca(s,o)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!J(r,["boolean","string","number","null"]))throw new Yt(`Expected first argument to be of type boolean, string, number or null, but found ${j(xi(r))} instead.`);if(!J(s,["string","array"]))throw new Yt(`Expected second argument to be of type array or string, but found ${j(xi(s))} instead.`);if(this.fromIndex){const o=this.fromIndex.evaluate(e);return s.indexOf(r,o)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class to{constructor(e,r,s,o,d,p){this.inputType=e,this.type=r,this.input=s,this.cases=o,this.outputs=d,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const d={},p=[];for(let x=2;x<e.length-1;x+=2){let w=e[x];const T=e[x+1];Array.isArray(w)||(w=[w]);const k=r.concat(x);if(w.length===0)return k.error("Expected at least one branch label.");for(const L of w){if(typeof L!="number"&&typeof L!="string")return k.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return k.error("Numeric branch labels must be integer values.");if(s){if(k.checkSubtype(s,xi(L)))return null}else s=xi(L);if(d[String(L)]!==void 0)return k.error("Branch labels must be unique.");d[String(L)]=p.length}const z=r.parse(T,x,o);if(!z)return null;o=o||z.type,p.push(z)}const f=r.parse(e[1],1,rt);if(!f)return null;const g=r.parse(e[e.length-1],e.length-1,o);return g?f.type.kind!=="value"&&r.concat(1).checkSubtype(s,f.type)?null:new to(s,o,f,d,p,g):null}evaluate(e){const r=this.input.evaluate(e);return(xi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class io{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const o=[];for(let p=1;p<e.length-1;p+=2){const f=r.parse(e[p],p,at);if(!f)return null;const g=r.parse(e[p+1],p+1,s);if(!g)return null;o.push([f,g]),s=s||g.type}const d=r.parse(e[e.length-1],e.length-1,s);if(!d)return null;if(!s)throw new Error("Can't infer output type");return new io(s,o,d)}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class ha{constructor(e,r,s,o){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,rt),o=r.parse(e[2],2,Ee);if(!s||!o)return null;if(!ne(s.type,[B(rt),ut,rt]))return r.error(`Expected first argument to be of type array or string, but found ${j(s.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,Ee);return d?new ha(s.type,s,o,d):null}return new ha(s.type,s,o)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!J(r,["string","array"]))throw new Yt(`Expected first argument to be of type array or string, but found ${j(xi(r))} instead.`);if(this.endIndex){const o=this.endIndex.evaluate(e);return r.slice(s,o)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function pl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function fl(i,e,r,s){return s.compare(e,r)===0}function is(i,e,r){const s=i!=="=="&&i!=="!=";return class Cd{constructor(d,p,f){this.type=at,this.lhs=d,this.rhs=p,this.collator=f,this.hasUntypedArgument=d.type.kind==="value"||p.type.kind==="value"}static parse(d,p){if(d.length!==3&&d.length!==4)return p.error("Expected two or three arguments.");const f=d[0];let g=p.parse(d[1],1,rt);if(!g)return null;if(!pl(f,g.type))return p.concat(1).error(`"${f}" comparisons are not supported for type '${j(g.type)}'.`);let x=p.parse(d[2],2,rt);if(!x)return null;if(!pl(f,x.type))return p.concat(2).error(`"${f}" comparisons are not supported for type '${j(x.type)}'.`);if(g.type.kind!==x.type.kind&&g.type.kind!=="value"&&x.type.kind!=="value")return p.error(`Cannot compare types '${j(g.type)}' and '${j(x.type)}'.`);s&&(g.type.kind==="value"&&x.type.kind!=="value"?g=new wr(x.type,[g]):g.type.kind!=="value"&&x.type.kind==="value"&&(x=new wr(g.type,[x])));let w=null;if(d.length===4){if(g.type.kind!=="string"&&x.type.kind!=="string"&&g.type.kind!=="value"&&x.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(w=p.parse(d[3],3,Pn),!w)return null}return new Cd(g,x,w)}evaluate(d){const p=this.lhs.evaluate(d),f=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const g=xi(p),x=xi(f);if(g.kind!==x.kind||g.kind!=="string"&&g.kind!=="number")throw new Yt(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${g.kind}, ${x.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const g=xi(p),x=xi(f);if(g.kind!=="string"||x.kind!=="string")return e(d,p,f)}return this.collator?r(d,p,f,this.collator.evaluate(d)):e(d,p,f)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const wc=is("==",function(i,e,r){return e===r},fl),Sc=is("!=",function(i,e,r){return e!==r},function(i,e,r,s){return!fl(0,e,r,s)}),Tc=is("<",function(i,e,r){return e<r},function(i,e,r,s){return s.compare(e,r)<0}),Ic=is(">",function(i,e,r){return e>r},function(i,e,r,s){return s.compare(e,r)>0}),Cc=is("<=",function(i,e,r){return e<=r},function(i,e,r,s){return s.compare(e,r)<=0}),Ac=is(">=",function(i,e,r){return e>=r},function(i,e,r,s){return s.compare(e,r)>=0});class ro{constructor(e,r,s,o,d){this.type=ut,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=o,this.maxFractionDigits=d}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Ee);if(!s)return null;const o=e[2];if(typeof o!="object"||Array.isArray(o))return r.error("NumberFormat options argument must be an object.");let d=null;if(o.locale&&(d=r.parse(o.locale,1,ut),!d))return null;let p=null;if(o.currency&&(p=r.parse(o.currency,1,ut),!p))return null;let f=null;if(o["min-fraction-digits"]&&(f=r.parse(o["min-fraction-digits"],1,Ee),!f))return null;let g=null;return o["max-fraction-digits"]&&(g=r.parse(o["max-fraction-digits"],1,Ee),!g)?null:new ro(s,d,p,f,g)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class ua{constructor(e){this.type=bi,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const o=[];let d=!1;for(let p=1;p<=e.length-1;++p){const f=e[p];if(d&&typeof f=="object"&&!Array.isArray(f)){d=!1;let g=null;if(f["font-scale"]&&(g=r.parse(f["font-scale"],1,Ee),!g))return null;let x=null;if(f["text-font"]&&(x=r.parse(f["text-font"],1,B(ut)),!x))return null;let w=null;if(f["text-color"]&&(w=r.parse(f["text-color"],1,_i),!w))return null;const T=o[o.length-1];T.scale=g,T.font=x,T.textColor=w}else{const g=r.parse(e[p],1,rt);if(!g)return null;const x=g.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,o.push({content:g,scale:null,font:null,textColor:null})}}return new ua(o)}evaluate(e){return new br(this.sections.map(r=>{const s=r.content.evaluate(e);return xi(s)===A?new $a("",s,null,null,null):new $a(Ss(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class no{constructor(e){this.type=A,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,ut);return s?new no(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=Lr.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class so{constructor(e){this.type=Ee,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${j(s.type)} instead.`):new so(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Yt(`Expected value to be of type string or array, but found ${j(xi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const rs={"==":wc,"!=":Sc,">":Ic,"<":Tc,">=":Ac,"<=":Cc,array:wr,at:Qa,boolean:wr,case:io,coalesce:oa,collator:ts,format:ua,image:no,in:eo,"index-of":ca,interpolate:Ui,"interpolate-hcl":Ui,"interpolate-lab":Ui,length:so,let:la,literal:fn,match:to,number:wr,"number-format":ro,object:wr,slice:ha,step:Ms,string:wr,"to-boolean":en,"to-color":en,"to-number":en,"to-string":en,var:na,within:zn};function ml(i,[e,r,s,o]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const d=o?o.evaluate(i):1,p=es(e,r,s,d);if(p)throw new Yt(p);return new Et(e/255,r/255,s/255,d,!1)}function gl(i,e){return i in e}function ao(i,e){const r=e[i];return r===void 0?null:r}function Ln(i){return{type:i}}function _l(i){return{result:"success",value:i}}function ns(i){return{result:"error",value:i}}function ss(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function yl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function oo(i){return!!i.expression&&i.expression.interpolated}function wt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function da(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function kc(i){return i}function xl(i,e){const r=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",o=s||!(s||i.property!==void 0),d=i.type||(oo(e)?"exponential":"interval");if(r||e.type==="padding"){const w=r?Et.parse:hr.parse;(i=Jr({},i)).stops&&(i.stops=i.stops.map(T=>[T[0],w(T[1])])),i.default=w(i.default?i.default:e.default)}if(i.colorSpace&&(p=i.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var p;let f,g,x;if(d==="exponential")f=bt;else if(d==="interval")f=Ec;else if(d==="categorical"){f=ai,g=Object.create(null);for(const w of i.stops)g[w[0]]=w[1];x=typeof i.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);f=lo}if(s){const w={},T=[];for(let L=0;L<i.stops.length;L++){const V=i.stops[L],G=V[0].zoom;w[G]===void 0&&(w[G]={zoom:G,type:i.type,property:i.property,default:i.default,stops:[]},T.push(G)),w[G].stops.push([V[0].value,V[1]])}const k=[];for(const L of T)k.push([w[L].zoom,xl(w[L],e)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:Ui.interpolationFactor.bind(void 0,z),zoomStops:k.map(L=>L[0]),evaluate:({zoom:L},V)=>bt({stops:k,base:i.base},e,L).evaluate(L,V)}}if(o){const w=d==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Ui.interpolationFactor.bind(void 0,w),zoomStops:i.stops.map(T=>T[0]),evaluate:({zoom:T})=>f(i,e,T,g,x)}}return{kind:"source",evaluate(w,T){const k=T&&T.properties?T.properties[i.property]:void 0;return k===void 0?Ps(i.default,e.default):f(i,e,k,g,x)}}}function Ps(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function ai(i,e,r,s,o){return Ps(typeof r===o?s[r]:void 0,i.default,e.default)}function Ec(i,e,r){if(wt(r)!=="number")return Ps(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const o=Es(i.stops.map(d=>d[0]),r);return i.stops[o][1]}function bt(i,e,r){const s=i.base!==void 0?i.base:1;if(wt(r)!=="number")return Ps(i.default,e.default);const o=i.stops.length;if(o===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[o-1][0])return i.stops[o-1][1];const d=Es(i.stops.map(w=>w[0]),r),p=function(w,T,k,z){const L=z-k,V=w-k;return L===0?0:T===1?V/L:(Math.pow(T,V)-1)/(Math.pow(T,L)-1)}(r,s,i.stops[d][0],i.stops[d+1][0]),f=i.stops[d][1],g=i.stops[d+1][1],x=Ji[e.type]||kc;return typeof f.evaluate=="function"?{evaluate(...w){const T=f.evaluate.apply(void 0,w),k=g.evaluate.apply(void 0,w);if(T!==void 0&&k!==void 0)return x(T,k,p,i.colorSpace)}}:x(f,g,p,i.colorSpace)}function lo(i,e,r){switch(e.type){case"color":r=Et.parse(r);break;case"formatted":r=br.fromString(r.toString());break;case"resolvedImage":r=Lr.fromString(r.toString());break;case"padding":r=hr.parse(r);break;default:wt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Ps(r,i.default,e.default)}Sr.register(rs,{error:[{kind:"error"},[ut],(i,[e])=>{throw new Yt(e.evaluate(i))}],typeof:[ut,[rt],(i,[e])=>j(xi(e.evaluate(i)))],"to-rgba":[B(Ee,4),[_i],(i,[e])=>{const[r,s,o,d]=e.evaluate(i).rgb;return[255*r,255*s,255*o,d]}],rgb:[_i,[Ee,Ee,Ee],ml],rgba:[_i,[Ee,Ee,Ee,Ee],ml],has:{type:at,overloads:[[[ut],(i,[e])=>gl(e.evaluate(i),i.properties())],[[ut,$r],(i,[e,r])=>gl(e.evaluate(i),r.evaluate(i))]]},get:{type:rt,overloads:[[[ut],(i,[e])=>ao(e.evaluate(i),i.properties())],[[ut,$r],(i,[e,r])=>ao(e.evaluate(i),r.evaluate(i))]]},"feature-state":[rt,[ut],(i,[e])=>ao(e.evaluate(i),i.featureState||{})],properties:[$r,[],i=>i.properties()],"geometry-type":[ut,[],i=>i.geometryType()],id:[rt,[],i=>i.id()],zoom:[Ee,[],i=>i.globals.zoom],"heatmap-density":[Ee,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ee,[],i=>i.globals.lineProgress||0],accumulated:[rt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ee,Ln(Ee),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[Ee,Ln(Ee),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:Ee,overloads:[[[Ee,Ee],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Ee],(i,[e])=>-e.evaluate(i)]]},"/":[Ee,[Ee,Ee],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Ee,[Ee,Ee],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Ee,[],()=>Math.LN2],pi:[Ee,[],()=>Math.PI],e:[Ee,[],()=>Math.E],"^":[Ee,[Ee,Ee],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Ee,[Ee],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Ee,[Ee],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Ee,[Ee],(i,[e])=>Math.log(e.evaluate(i))],log2:[Ee,[Ee],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Ee,[Ee],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Ee,[Ee],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Ee,[Ee],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Ee,[Ee],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Ee,[Ee],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Ee,[Ee],(i,[e])=>Math.atan(e.evaluate(i))],min:[Ee,Ln(Ee),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Ee,Ln(Ee),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Ee,[Ee],(i,[e])=>Math.abs(e.evaluate(i))],round:[Ee,[Ee],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ee,[Ee],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Ee,[Ee],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[at,[ut,rt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[at,[rt],(i,[e])=>i.id()===e.value],"filter-type-==":[at,[ut],(i,[e])=>i.geometryType()===e.value],"filter-<":[at,[ut,rt],(i,[e,r])=>{const s=i.properties()[e.value],o=r.value;return typeof s==typeof o&&s<o}],"filter-id-<":[at,[rt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[at,[ut,rt],(i,[e,r])=>{const s=i.properties()[e.value],o=r.value;return typeof s==typeof o&&s>o}],"filter-id->":[at,[rt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[at,[ut,rt],(i,[e,r])=>{const s=i.properties()[e.value],o=r.value;return typeof s==typeof o&&s<=o}],"filter-id-<=":[at,[rt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[at,[ut,rt],(i,[e,r])=>{const s=i.properties()[e.value],o=r.value;return typeof s==typeof o&&s>=o}],"filter-id->=":[at,[rt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[at,[rt],(i,[e])=>e.value in i.properties()],"filter-has-id":[at,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[at,[B(ut)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[at,[B(rt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[at,[ut,B(rt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[at,[ut,B(rt)],(i,[e,r])=>function(s,o,d,p){for(;d<=p;){const f=d+p>>1;if(o[f]===s)return!0;o[f]>s?p=f-1:d=f+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:at,overloads:[[[at,at],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Ln(at),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:at,overloads:[[[at,at],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Ln(at),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[at,[at],(i,[e])=>!e.evaluate(i)],"is-supported-script":[at,[ut],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[ut,[ut],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[ut,[ut],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[ut,Ln(rt),(i,e)=>e.map(r=>Ss(r.evaluate(i))).join("")],"resolved-locale":[ut,[Pn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Vt{constructor(e,r){var s;this.expression=e,this._warningHistory={},this._evaluator=new Mt,this._defaultValue=r?(s=r).type==="color"&&da(s.default)?new Et(0,0,0,0):s.type==="color"?Et.parse(s.default)||null:s.type==="padding"?hr.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?Dr.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,o,d,p){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=o,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,o,d,p){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=o,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null;try{const f=this.expression.evaluate(this._evaluator);if(f==null||typeof f=="number"&&f!=f)return this._defaultValue;if(this._enumValues&&!(f in this._enumValues))throw new Yt(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(f)} instead.`);return f}catch(f){return this._warningHistory[f.message]||(this._warningHistory[f.message]=!0,typeof console<"u"&&console.warn(f.message)),this._defaultValue}}}function Bt(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in rs}function Rn(i,e){const r=new Qs(rs,Cs,[],e?function(o){const d={color:_i,string:ut,number:Ee,enum:ut,boolean:at,formatted:bi,padding:H,resolvedImage:A,variableAnchorOffsetCollection:P};return o.type==="array"?B(d[o.value]||rt,o.length):d[o.type]}(e):void 0),s=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?_l(new Vt(s,e)):ns(r.errors)}class pa{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!As(r.expression)}evaluateWithoutErrorHandling(e,r,s,o,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,o,d,p)}evaluate(e,r,s,o,d,p){return this._styleExpression.evaluate(e,r,s,o,d,p)}}class co{constructor(e,r,s,o){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!As(r.expression),this.interpolationType=o}evaluateWithoutErrorHandling(e,r,s,o,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,o,d,p)}evaluate(e,r,s,o,d,p){return this._styleExpression.evaluate(e,r,s,o,d,p)}interpolationFactor(e,r,s){return this.interpolationType?Ui.interpolationFactor(this.interpolationType,e,r,s):0}}function vl(i,e){const r=Rn(i,e);if(r.result==="error")return r;const s=r.value.expression,o=sa(s);if(!o&&!ss(e))return ns([new vr("","data expressions not supported")]);const d=ks(s,["zoom"]);if(!d&&!yl(e))return ns([new vr("","zoom expressions not supported")]);const p=ma(s);return p||d?p instanceof vr?ns([p]):p instanceof Ui&&!oo(e)?ns([new vr("",'"interpolate" expressions cannot be used with this property')]):_l(p?new co(o?"camera":"composite",r.value,p.labels,p instanceof Ui?p.interpolation:void 0):new pa(o?"constant":"source",r.value)):ns([new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class fa{constructor(e,r){this._parameters=e,this._specification=r,Jr(this,xl(this._parameters,this._specification))}static deserialize(e){return new fa(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ma(i){let e=null;if(i instanceof la)e=ma(i.result);else if(i instanceof oa){for(const r of i.args)if(e=ma(r),e)break}else(i instanceof Ms||i instanceof Ui)&&i.input instanceof Sr&&i.input.name==="zoom"&&(e=i);return e instanceof vr||i.eachChild(r=>{const s=ma(r);s instanceof vr?e=s:!e&&s?e=new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new vr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function ga(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ga(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const bl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _a(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ga(i)||(i=xa(i));const e=Rn(i,bl);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,o)=>e.value.evaluate(r,s,{},o),needGeometry:ya(i)}}function wl(i,e){return i<e?-1:i>e?1:0}function ya(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(ya(i[e]))return!0;return!1}function xa(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ho(i[1],i[2],"=="):e==="!="?va(ho(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ho(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(xa))):e==="all"?["all"].concat(i.slice(1).map(xa)):e==="none"?["all"].concat(i.slice(1).map(xa).map(va)):e==="in"?Sl(i[1],i.slice(2)):e==="!in"?va(Sl(i[1],i.slice(2))):e==="has"?Tl(i[1]):e==="!has"?va(Tl(i[1])):e!=="within"||i;var r}function ho(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Sl(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(wl)]]:["filter-in-small",i,["literal",e]]}}function Tl(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function va(i){return["!",i]}function uo(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let o="[";for(const d of i)o+=`${uo(d)},`;return`${o}]`}const r=Object.keys(i).sort();let s="{";for(let o=0;o<r.length;o++)s+=`${JSON.stringify(r[o])}:${uo(i[r[o]])},`;return`${s}}`}function Mc(i){let e="";for(const r of kn)e+=`/${uo(i[r])}`;return e}function Il(i){const e=i.value;return e?[new Te(i.key,e,"constants have been deprecated as of v8")]:[]}function Qt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function gn(i){if(Array.isArray(i))return i.map(gn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=gn(i[r]);return e}return Qt(i)}function $i(i){const e=i.key,r=i.value,s=i.valueSpec||{},o=i.objectElementValidators||{},d=i.style,p=i.styleSpec,f=i.validateSpec;let g=[];const x=wt(r);if(x!=="object")return[new Te(e,r,`object expected, ${x} found`)];for(const w in r){const T=w.split(".")[0],k=s[T]||s["*"];let z;if(o[T])z=o[T];else if(s[T])z=f;else if(o["*"])z=o["*"];else{if(!s["*"]){g.push(new Te(e,r[w],`unknown property "${w}"`));continue}z=f}g=g.concat(z({key:(e&&`${e}.`)+w,value:r[w],valueSpec:k,style:d,styleSpec:p,object:r,objectKey:w,validateSpec:f},r))}for(const w in s)o[w]||s[w].required&&s[w].default===void 0&&r[w]===void 0&&g.push(new Te(e,r,`missing required property "${w}"`));return g}function po(i){const e=i.value,r=i.valueSpec,s=i.style,o=i.styleSpec,d=i.key,p=i.arrayElementValidator||i.validateSpec;if(wt(e)!=="array")return[new Te(d,e,`array expected, ${wt(e)} found`)];if(r.length&&e.length!==r.length)return[new Te(d,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Te(d,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let f={type:r.value,values:r.values};o.$version<7&&(f.function=r.function),wt(r.value)==="object"&&(f=r.value);let g=[];for(let x=0;x<e.length;x++)g=g.concat(p({array:e,arrayIndex:x,value:e[x],valueSpec:f,validateSpec:i.validateSpec,style:s,styleSpec:o,key:`${d}[${x}]`}));return g}function ba(i){const e=i.key,r=i.value,s=i.valueSpec;let o=wt(r);return o==="number"&&r!=r&&(o="NaN"),o!=="number"?[new Te(e,r,`number expected, ${o} found`)]:"minimum"in s&&r<s.minimum?[new Te(e,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new Te(e,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function Cl(i){const e=i.valueSpec,r=Qt(i.value.type);let s,o,d,p={};const f=r!=="categorical"&&i.value.property===void 0,g=!f,x=wt(i.value.stops)==="array"&&wt(i.value.stops[0])==="array"&&wt(i.value.stops[0][0])==="object",w=$i({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(z){if(r==="identity")return[new Te(z.key,z.value,'identity function may not have a "stops" property')];let L=[];const V=z.value;return L=L.concat(po({key:z.key,value:V,valueSpec:z.valueSpec,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:T})),wt(V)==="array"&&V.length===0&&L.push(new Te(z.key,V,"array must have at least one stop")),L},default:function(z){return z.validateSpec({key:z.key,value:z.value,valueSpec:e,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec})}}});return r==="identity"&&f&&w.push(new Te(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||w.push(new Te(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!oo(i.valueSpec)&&w.push(new Te(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(g&&!ss(i.valueSpec)?w.push(new Te(i.key,i.value,"property functions not supported")):f&&!yl(i.valueSpec)&&w.push(new Te(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!x||i.value.property!==void 0||w.push(new Te(i.key,i.value,'"property" property is required')),w;function T(z){let L=[];const V=z.value,G=z.key;if(wt(V)!=="array")return[new Te(G,V,`array expected, ${wt(V)} found`)];if(V.length!==2)return[new Te(G,V,`array length 2 expected, length ${V.length} found`)];if(x){if(wt(V[0])!=="object")return[new Te(G,V,`object expected, ${wt(V[0])} found`)];if(V[0].zoom===void 0)return[new Te(G,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new Te(G,V,"object stop key must have value")];if(d&&d>Qt(V[0].zoom))return[new Te(G,V[0].zoom,"stop zoom values must appear in ascending order")];Qt(V[0].zoom)!==d&&(d=Qt(V[0].zoom),o=void 0,p={}),L=L.concat($i({key:`${G}[0]`,value:V[0],valueSpec:{zoom:{}},validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:ba,value:k}}))}else L=L.concat(k({key:`${G}[0]`,value:V[0],valueSpec:{},validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec},V));return Bt(gn(V[1]))?L.concat([new Te(`${G}[1]`,V[1],"expressions are not allowed in function stops.")]):L.concat(z.validateSpec({key:`${G}[1]`,value:V[1],valueSpec:e,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec}))}function k(z,L){const V=wt(z.value),G=Qt(z.value),X=z.value!==null?z.value:L;if(s){if(V!==s)return[new Te(z.key,X,`${V} stop domain type must match previous stop domain type ${s}`)]}else s=V;if(V!=="number"&&V!=="string"&&V!=="boolean")return[new Te(z.key,X,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&r!=="categorical"){let se=`number expected, ${V} found`;return ss(e)&&r===void 0&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Te(z.key,X,se)]}return r!=="categorical"||V!=="number"||isFinite(G)&&Math.floor(G)===G?r!=="categorical"&&V==="number"&&o!==void 0&&G<o?[new Te(z.key,X,"stop domain values must appear in ascending order")]:(o=G,r==="categorical"&&G in p?[new Te(z.key,X,"stop domain values must be unique")]:(p[G]=!0,[])):[new Te(z.key,X,`integer expected, found ${G}`)]}}function _n(i){const e=(i.expressionContext==="property"?vl:Rn)(gn(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new Te(`${i.key}${s.key}`,i.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Te(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!As(r))return[new Te(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!As(r))return[new Te(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ks(r,["zoom","feature-state"]))return[new Te(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!sa(r))return[new Te(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function yn(i){const e=i.key,r=i.value,s=i.valueSpec,o=[];return Array.isArray(s.values)?s.values.indexOf(Qt(r))===-1&&o.push(new Te(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(Qt(r))===-1&&o.push(new Te(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),o}function as(i){return ga(gn(i.value))?_n(Jr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):wa(i)}function wa(i){const e=i.value,r=i.key;if(wt(e)!=="array")return[new Te(r,e,`array expected, ${wt(e)} found`)];const s=i.styleSpec;let o,d=[];if(e.length<1)return[new Te(r,e,"filter array must have at least 1 element")];switch(d=d.concat(yn({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),Qt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Qt(e[1])==="$type"&&d.push(new Te(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new Te(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(o=wt(e[1]),o!=="string"&&d.push(new Te(`${r}[1]`,e[1],`string expected, ${o} found`)));for(let p=2;p<e.length;p++)o=wt(e[p]),Qt(e[1])==="$type"?d=d.concat(yn({key:`${r}[${p}]`,value:e[p],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):o!=="string"&&o!=="number"&&o!=="boolean"&&d.push(new Te(`${r}[${p}]`,e[p],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)d=d.concat(wa({key:`${r}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":o=wt(e[1]),e.length!==2?d.push(new Te(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):o!=="string"&&d.push(new Te(`${r}[1]`,e[1],`string expected, ${o} found`));break;case"within":o=wt(e[1]),e.length!==2?d.push(new Te(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):o!=="object"&&d.push(new Te(`${r}[1]`,e[1],`object expected, ${o} found`))}return d}function fo(i,e){const r=i.key,s=i.validateSpec,o=i.style,d=i.styleSpec,p=i.value,f=i.objectKey,g=d[`${e}_${i.layerType}`];if(!g)return[];const x=f.match(/^(.*)-transition$/);if(e==="paint"&&x&&g[x[1]]&&g[x[1]].transition)return s({key:r,value:p,valueSpec:d.transition,style:o,styleSpec:d});const w=i.valueSpec||g[f];if(!w)return[new Te(r,p,`unknown property "${f}"`)];let T;if(wt(p)==="string"&&ss(w)&&!w.tokens&&(T=/^{([^}]+)}$/.exec(p)))return[new Te(r,p,`"${f}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(T[1])} }\`.`)];const k=[];return i.layerType==="symbol"&&(f==="text-field"&&o&&!o.glyphs&&k.push(new Te(r,p,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&da(gn(p))&&Qt(p.type)==="identity"&&k.push(new Te(r,p,'"text-font" does not support identity functions'))),k.concat(s({key:i.key,value:p,valueSpec:w,style:o,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:f}))}function mo(i){return fo(i,"paint")}function zs(i){return fo(i,"layout")}function Al(i){let e=[];const r=i.value,s=i.key,o=i.style,d=i.styleSpec;r.type||r.ref||e.push(new Te(s,r,'either "type" or "ref" is required'));let p=Qt(r.type);const f=Qt(r.ref);if(r.id){const g=Qt(r.id);for(let x=0;x<i.arrayIndex;x++){const w=o.layers[x];Qt(w.id)===g&&e.push(new Te(s,r.id,`duplicate layer id "${r.id}", previously used at line ${w.id.__line__}`))}}if("ref"in r){let g;["type","source","source-layer","filter","layout"].forEach(x=>{x in r&&e.push(new Te(s,r[x],`"${x}" is prohibited for ref layers`))}),o.layers.forEach(x=>{Qt(x.id)===f&&(g=x)}),g?g.ref?e.push(new Te(s,r.ref,"ref cannot reference another ref layer")):p=Qt(g.type):e.push(new Te(s,r.ref,`ref layer "${f}" not found`))}else if(p!=="background")if(r.source){const g=o.sources&&o.sources[r.source],x=g&&Qt(g.type);g?x==="vector"&&p==="raster"?e.push(new Te(s,r.source,`layer "${r.id}" requires a raster source`)):x!=="raster-dem"&&p==="hillshade"?e.push(new Te(s,r.source,`layer "${r.id}" requires a raster-dem source`)):x==="raster"&&p!=="raster"?e.push(new Te(s,r.source,`layer "${r.id}" requires a vector source`)):x!=="vector"||r["source-layer"]?x==="raster-dem"&&p!=="hillshade"?e.push(new Te(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]||x==="geojson"&&g.lineMetrics||e.push(new Te(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Te(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Te(s,r.source,`source "${r.source}" not found`))}else e.push(new Te(s,r,'missing required property "source"'));return e=e.concat($i({key:s,value:r,valueSpec:d.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:d.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:as,layout:g=>$i({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":x=>zs(Jr({layerType:p},x))}}),paint:g=>$i({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":x=>mo(Jr({layerType:p},x))}})}})),e}function Bn(i){const e=i.value,r=i.key,s=wt(e);return s!=="string"?[new Te(r,e,`string expected, ${s} found`)]:[]}const kl={promoteId:function({key:i,value:e}){if(wt(e)==="string")return Bn({key:i,value:e});{const r=[];for(const s in e)r.push(...Bn({key:`${i}.${s}`,value:e[s]}));return r}}};function El(i){const e=i.value,r=i.key,s=i.styleSpec,o=i.style,d=i.validateSpec;if(!e.type)return[new Te(r,e,'"type" is required')];const p=Qt(e.type);let f;switch(p){case"vector":case"raster":return f=$i({key:r,value:e,valueSpec:s[`source_${p.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:kl,validateSpec:d}),f;case"raster-dem":return f=function(g){var x;const w=(x=g.sourceName)!==null&&x!==void 0?x:"",T=g.value,k=g.styleSpec,z=k.source_raster_dem,L=g.style;let V=[];const G=wt(T);if(T===void 0)return V;if(G!=="object")return V.push(new Te("source_raster_dem",T,`object expected, ${G} found`)),V;const X=Qt(T.encoding)==="custom",se=["redFactor","greenFactor","blueFactor","baseShift"],Y=g.value.encoding?`"${g.value.encoding}"`:"Default";for(const te in T)!X&&se.includes(te)?V.push(new Te(te,T[te],`In "${w}": "${te}" is only valid when "encoding" is set to "custom". ${Y} encoding found`)):z[te]?V=V.concat(g.validateSpec({key:te,value:T[te],valueSpec:z[te],validateSpec:g.validateSpec,style:L,styleSpec:k})):V.push(new Te(te,T[te],`unknown property "${te}"`));return V}({sourceName:r,value:e,style:i.style,styleSpec:s,validateSpec:d}),f;case"geojson":if(f=$i({key:r,value:e,valueSpec:s.source_geojson,style:o,styleSpec:s,validateSpec:d,objectElementValidators:kl}),e.cluster)for(const g in e.clusterProperties){const[x,w]=e.clusterProperties[g],T=typeof x=="string"?[x,["accumulated"],["get",g]]:x;f.push(..._n({key:`${r}.${g}.map`,value:w,validateSpec:d,expressionContext:"cluster-map"})),f.push(..._n({key:`${r}.${g}.reduce`,value:T,validateSpec:d,expressionContext:"cluster-reduce"}))}return f;case"video":return $i({key:r,value:e,valueSpec:s.source_video,style:o,validateSpec:d,styleSpec:s});case"image":return $i({key:r,value:e,valueSpec:s.source_image,style:o,validateSpec:d,styleSpec:s});case"canvas":return[new Te(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yn({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:o,validateSpec:d,styleSpec:s})}}function Ml(i){const e=i.value,r=i.styleSpec,s=r.light,o=i.style;let d=[];const p=wt(e);if(e===void 0)return d;if(p!=="object")return d=d.concat([new Te("light",e,`object expected, ${p} found`)]),d;for(const f in e){const g=f.match(/^(.*)-transition$/);d=d.concat(g&&s[g[1]]&&s[g[1]].transition?i.validateSpec({key:f,value:e[f],valueSpec:r.transition,validateSpec:i.validateSpec,style:o,styleSpec:r}):s[f]?i.validateSpec({key:f,value:e[f],valueSpec:s[f],validateSpec:i.validateSpec,style:o,styleSpec:r}):[new Te(f,e[f],`unknown property "${f}"`)])}return d}function Ds(i){const e=i.value,r=i.styleSpec,s=r.sky,o=i.style,d=wt(e);if(e===void 0)return[];if(d!=="object")return[new Te("sky",e,`object expected, ${d} found`)];let p=[];for(const f in e)p=p.concat(s[f]?Fn({key:f,value:e[f],valueSpec:s[f],style:o,styleSpec:r}):[new Te(f,e[f],`unknown property "${f}"`)]);return p}function Ls(i){const e=i.value,r=i.styleSpec,s=r.terrain,o=i.style;let d=[];const p=wt(e);if(e===void 0)return d;if(p!=="object")return d=d.concat([new Te("terrain",e,`object expected, ${p} found`)]),d;for(const f in e)d=d.concat(s[f]?i.validateSpec({key:f,value:e[f],valueSpec:s[f],validateSpec:i.validateSpec,style:o,styleSpec:r}):[new Te(f,e[f],`unknown property "${f}"`)]);return d}function ur(i){let e=[];const r=i.value,s=i.key;if(Array.isArray(r)){const o=[],d=[];for(const p in r)r[p].id&&o.includes(r[p].id)&&e.push(new Te(s,r,`all the sprites' ids must be unique, but ${r[p].id} is duplicated`)),o.push(r[p].id),r[p].url&&d.includes(r[p].url)&&e.push(new Te(s,r,`all the sprites' URLs must be unique, but ${r[p].url} is duplicated`)),d.push(r[p].url),e=e.concat($i({key:`${s}[${p}]`,value:r[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return Bn({key:s,value:r})}const os={"*":()=>[],array:po,boolean:function(i){const e=i.value,r=i.key,s=wt(e);return s!=="boolean"?[new Te(r,e,`boolean expected, ${s} found`)]:[]},number:ba,color:function(i){const e=i.key,r=i.value,s=wt(r);return s!=="string"?[new Te(e,r,`color expected, ${s} found`)]:Et.parse(String(r))?[]:[new Te(e,r,`color expected, "${r}" found`)]},constants:Il,enum:yn,filter:as,function:Cl,layer:Al,object:$i,source:El,light:Ml,sky:Ds,terrain:Ls,string:Bn,formatted:function(i){return Bn(i).length===0?[]:_n(i)},resolvedImage:function(i){return Bn(i).length===0?[]:_n(i)},padding:function(i){const e=i.key,r=i.value;if(wt(r)==="array"){if(r.length<1||r.length>4)return[new Te(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let o=[];for(let d=0;d<r.length;d++)o=o.concat(i.validateSpec({key:`${e}[${d}]`,value:r[d],validateSpec:i.validateSpec,valueSpec:s}));return o}return ba({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,s=wt(r),o=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new Te(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let p=0;p<r.length;p+=2)d=d.concat(yn({key:`${e}[${p}]`,value:r[p],valueSpec:o.layout_symbol["text-anchor"]})),d=d.concat(po({key:`${e}[${p+1}]`,value:r[p+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:o}));return d},sprite:ur};function Fn(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=Fn,r.expression&&da(Qt(e))?Cl(i):r.expression&&Bt(gn(e))?_n(i):r.type&&os[r.type]?os[r.type](i):$i(Jr({},i,{valueSpec:r.type?s[r.type]:r}))}function Pl(i){const e=i.value,r=i.key,s=Bn(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new Te(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new Te(r,e,'"glyphs" url must include a "{range}" token'))),s}function Nr(i,e=de){let r=[];return r=r.concat(Fn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Fn,objectElementValidators:{glyphs:Pl,"*":()=>[]}})),i.constants&&(r=r.concat(Il({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:Fn}))),go(r)}function dr(i){return function(e){return i({...e,validateSpec:Fn})}}function go(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function Rr(i){return function(...e){return go(i.apply(this,e))}}Nr.source=Rr(dr(El)),Nr.sprite=Rr(dr(ur)),Nr.glyphs=Rr(dr(Pl)),Nr.light=Rr(dr(Ml)),Nr.sky=Rr(dr(Ds)),Nr.terrain=Rr(dr(Ls)),Nr.layer=Rr(dr(Al)),Nr.filter=Rr(dr(as)),Nr.paintProperty=Rr(dr(mo)),Nr.layoutProperty=Rr(dr(zs));const Rs=Nr,_o=Rs.light,Pc=Rs.paintProperty,Bs=Rs.layoutProperty;function zl(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new Jt(new Error(s.message))),r=!0;return r}class On{constructor(e,r,s){const o=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(r=p[1])+2*(s=p[2]);for(let g=0;g<this.d*this.d;g++){const x=p[3+g],w=p[3+g+1];o.push(x===w?null:p.subarray(x,w))}const f=p[3+o.length+1];this.keys=p.subarray(p[3+o.length],f),this.bboxes=p.subarray(f),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let p=0;p<this.d*this.d;p++)o.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=s,this.scale=r/e,this.uid=0;const d=s/r*e;this.min=-d,this.max=e+d}insert(e,r,s,o,d){this._forEachCell(r,s,o,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(o),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,s,o,d,p){this.cells[d].push(p)}query(e,r,s,o,d){const p=this.min,f=this.max;if(e<=p&&r<=p&&f<=s&&f<=o&&!d)return Array.prototype.slice.call(this.keys);{const g=[];return this._forEachCell(e,r,s,o,this._queryCell,g,{},d),g}}_queryCell(e,r,s,o,d,p,f,g){const x=this.cells[d];if(x!==null){const w=this.keys,T=this.bboxes;for(let k=0;k<x.length;k++){const z=x[k];if(f[z]===void 0){const L=4*z;(g?g(T[L+0],T[L+1],T[L+2],T[L+3]):e<=T[L+2]&&r<=T[L+3]&&s>=T[L+0]&&o>=T[L+1])?(f[z]=!0,p.push(w[z])):f[z]=!1}}}}_forEachCell(e,r,s,o,d,p,f,g){const x=this._convertToCellCoord(e),w=this._convertToCellCoord(r),T=this._convertToCellCoord(s),k=this._convertToCellCoord(o);for(let z=x;z<=T;z++)for(let L=w;L<=k;L++){const V=this.d*L+z;if((!g||g(this._convertFromCellCoord(z),this._convertFromCellCoord(L),this._convertFromCellCoord(z+1),this._convertFromCellCoord(L+1)))&&d.call(this,e,r,s,o,V,p,f,g))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let s=0;for(let p=0;p<this.cells.length;p++)s+=this.cells[p].length;const o=new Int32Array(r+s+this.keys.length+this.bboxes.length);o[0]=this.extent,o[1]=this.n,o[2]=this.padding;let d=r;for(let p=0;p<e.length;p++){const f=e[p];o[3+p]=d,o.set(f,d),d+=f.length}return o[3+e.length]=d,o.set(this.keys,d),d+=this.keys.length,o[3+e.length+1]=d,o.set(this.bboxes,d),d+=this.bboxes.length,o.buffer}static serialize(e,r){const s=e.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(e){return new On(e.buffer)}}const on={};function Fe(i,e,r={}){if(on[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),on[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Fe("Object",Object),Fe("TransferableGridIndex",On),Fe("Color",Et),Fe("Error",Error),Fe("AJAXError",Ie),Fe("ResolvedImage",Lr),Fe("StylePropertyFunction",fa),Fe("StyleExpression",Vt,{omit:["_evaluator"]}),Fe("ZoomDependentExpression",co),Fe("ZoomConstantExpression",pa),Fe("CompoundExpression",Sr,{omit:["_evaluate"]});for(const i in rs)rs[i]._classRegistryKey||Fe(`Expression_${i}`,rs[i]);function yo(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function ls(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error)return i;if(yo(i)||Kt(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const s of i)r.push(ls(s,e));return r}if(typeof i=="object"){const r=i.constructor,s=r._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${r.name}`);if(!on[s])throw new Error(`${s} is not registered.`);const o=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&o===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in i){if(!i.hasOwnProperty(d)||on[s].omit.indexOf(d)>=0)continue;const p=i[d];o[d]=on[s].shallow.indexOf(d)>=0?p:ls(p,e)}i instanceof Error&&(o.message=i.message)}if(o.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(o.$name=s),o}throw new Error("can't serialize object of type "+typeof i)}function Fs(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||yo(i)||Kt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Fs);if(typeof i=="object"){const e=i.$name||"Object";if(!on[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=on[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const o of Object.keys(i)){if(o==="$name")continue;const d=i[o];s[o]=on[e].shallow.indexOf(o)>=0?d:Fs(d)}return s}throw new Error("can't deserialize object of type "+typeof i)}class Sa{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const ze={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Ta(i){for(const e of i)if(Ia(e.charCodeAt(0)))return!0;return!1}function Dl(i){for(const e of i)if(!Ll(e.charCodeAt(0)))return!1;return!0}function Ll(i){return!(ze.Arabic(i)||ze["Arabic Supplement"](i)||ze["Arabic Extended-A"](i)||ze["Arabic Presentation Forms-A"](i)||ze["Arabic Presentation Forms-B"](i))}function Ia(i){return!(i!==746&&i!==747&&(i<4352||!(ze["Bopomofo Extended"](i)||ze.Bopomofo(i)||ze["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||ze["CJK Compatibility Ideographs"](i)||ze["CJK Compatibility"](i)||ze["CJK Radicals Supplement"](i)||ze["CJK Strokes"](i)||!(!ze["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||ze["CJK Unified Ideographs Extension A"](i)||ze["CJK Unified Ideographs"](i)||ze["Enclosed CJK Letters and Months"](i)||ze["Hangul Compatibility Jamo"](i)||ze["Hangul Jamo Extended-A"](i)||ze["Hangul Jamo Extended-B"](i)||ze["Hangul Jamo"](i)||ze["Hangul Syllables"](i)||ze.Hiragana(i)||ze["Ideographic Description Characters"](i)||ze.Kanbun(i)||ze["Kangxi Radicals"](i)||ze["Katakana Phonetic Extensions"](i)||ze.Katakana(i)&&i!==12540||!(!ze["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!ze["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||ze["Unified Canadian Aboriginal Syllabics"](i)||ze["Unified Canadian Aboriginal Syllabics Extended"](i)||ze["Vertical Forms"](i)||ze["Yijing Hexagram Symbols"](i)||ze["Yi Syllables"](i)||ze["Yi Radicals"](i))))}function Ca(i){return!(Ia(i)||function(e){return!!(ze["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ze["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ze["Letterlike Symbols"](e)||ze["Number Forms"](e)||ze["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ze["Control Pictures"](e)&&e!==9251||ze["Optical Character Recognition"](e)||ze["Enclosed Alphanumerics"](e)||ze["Geometric Shapes"](e)||ze["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ze["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ze["CJK Symbols and Punctuation"](e)||ze.Katakana(e)||ze["Private Use Area"](e)||ze["CJK Compatibility Forms"](e)||ze["Small Form Variants"](e)||ze["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function xo(i){return i>=1424&&i<=2303||ze["Arabic Presentation Forms-A"](i)||ze["Arabic Presentation Forms-B"](i)}function zc(i,e){return!(!e&&xo(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||ze.Khmer(i))}function Rl(i){for(const e of i)if(xo(e.charCodeAt(0)))return!0;return!1}const Vn=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ut{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Sa,this.transition={})}isSupportedScript(e){return function(r,s){for(const o of r)if(!zc(o.charCodeAt(0),s))return!1;return!0}(e,Vn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class Os{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,o){if(da(s))return new fa(s,o);if(Bt(s)){const d=vl(s,o);if(d.result==="error")throw new Error(d.value.map(p=>`${p.key}: ${p.message}`).join(", "));return d.value}{let d=s;return o.type==="color"&&typeof s=="string"?d=Et.parse(s):o.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?o.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(d=Dr.parse(s)):d=hr.parse(s),{kind:"constant",evaluate:()=>d}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class Aa{constructor(e){this.property=e,this.value=new Os(e,void 0)}transitioned(e,r){return new Fl(this.property,this.value,r,It({},e.transition,this.transition),e.now)}untransitioned(){return new Fl(this.property,this.value,null,{},0)}}class Bl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Wt(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Aa(this._values[e].property)),this._values[e].value=new Os(this._values[e].property,r===null?void 0:Wt(r))}getTransition(e){return Wt(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Aa(this._values[e].property)),this._values[e].transition=Wt(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const o=this.getTransition(r);o!==void 0&&(e[`${r}-transition`]=o)}return e}transitioned(e,r){const s=new vo(this._properties);for(const o of Object.keys(this._values))s._values[o]=this._values[o].transitioned(e,r._values[o]);return s}untransitioned(){const e=new vo(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Fl{constructor(e,r,s,o,d){this.property=e,this.value=r,this.begin=d+o.delay||0,this.end=this.begin+o.duration||0,e.specification.transition&&(o.delay||o.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const o=e.now||0,d=this.value.possiblyEvaluate(e,r,s),p=this.prior;if(p){if(o>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(o<this.begin)return p.possiblyEvaluate(e,r,s);{const f=(o-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,s),d,function(g){if(g<=0)return 0;if(g>=1)return 1;const x=g*g,w=x*g;return 4*(g<.5?w:3*(g-x)+w-.75)}(f))}}return d}}class vo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const o=new Vs(this._properties);for(const d of Object.keys(this._values))o._values[d]=this._values[d].possiblyEvaluate(e,r,s);return o}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ol{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Wt(this._values[e].value)}setValue(e,r){this._values[e]=new Os(this._values[e].property,r===null?void 0:Wt(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const o=new Vs(this._properties);for(const d of Object.keys(this._values))o._values[d]=this._values[d].possiblyEvaluate(e,r,s);return o}}class jr{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,o){return this.property.evaluate(this.value,this.parameters,e,r,s,o)}}class Vs{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class qe{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,s){const o=Ji[this.specification.type];return o?o(e,r,s):e}}class Je{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,o){return new jr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,o)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new jr(this,{kind:"constant",value:void 0},e.parameters);const o=Ji[this.specification.type];if(o){const d=o(e.value.value,r.value.value,s);return new jr(this,{kind:"constant",value:d},e.parameters)}return e}evaluate(e,r,s,o,d,p){return e.kind==="constant"?e.value:e.evaluate(r,s,o,d,p)}}class cs extends Je{possiblyEvaluate(e,r,s,o){if(e.value===void 0)return new jr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},s,o),p=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,f=this._calculate(p,p,p,r);return new jr(this,{kind:"constant",value:f},r)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new jr(this,{kind:"constant",value:d},r)}return new jr(this,e.expression,r)}evaluate(e,r,s,o,d,p){if(e.kind==="source"){const f=e.evaluate(r,s,o,d,p);return this._calculate(f,f,f,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,o),e.evaluate({zoom:Math.floor(r.zoom)},s,o),e.evaluate({zoom:Math.floor(r.zoom)+1},s,o),r):e.value}_calculate(e,r,s,o){return o.zoom>o.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class bo{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,o){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},s,o);return this._calculate(d,d,d,r)}return this._calculate(e.expression.evaluate(new Ut(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Ut(Math.floor(r.zoom),r)),e.expression.evaluate(new Ut(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,o){return o.zoom>o.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class wo{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,o){return!!e.expression.evaluate(r,null,{},s,o)}interpolate(){return!1}}class Qi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const o=this.defaultPropertyValues[r]=new Os(s,void 0),d=this.defaultTransitionablePropertyValues[r]=new Aa(s);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=o.possiblyEvaluate({})}}}Fe("DataDrivenProperty",Je),Fe("DataConstantProperty",qe),Fe("CrossFadedDataDrivenProperty",cs),Fe("CrossFadedProperty",bo),Fe("ColorRampProperty",wo);const So="-transition";class qr extends An{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Ol(r.layout)),r.paint)){this._transitionablePaint=new Bl(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vs(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(Bs,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(So)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(Pc,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(e.endsWith(So))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const o=this._transitionablePaint._values[e],d=o.property.specification["property-type"]==="cross-faded-data-driven",p=o.value.isDataDriven(),f=o.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const g=this._transitionablePaint._values[e].value;return g.isDataDriven()||p||d||this._handleOverridablePaintPropertyUpdate(e,f,g)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ar(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,o,d={}){return(!d||d.validate!==!1)&&zl(this,e.call(Rs,{key:r,layerType:this.type,objectKey:s,value:o,styleSpec:de,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof jr&&ss(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Dc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Us{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ei{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function oi(i,e=1){let r=0,s=0;return{members:i.map(o=>{const d=Dc[o.type].BYTES_PER_ELEMENT,p=r=Vl(r,Math.max(e,d)),f=o.components||1;return s=Math.max(s,d),r+=d*f,{name:o.name,type:o.type,components:f,offset:p}}),size:Vl(r,Math.max(s,e)),alignment:e}}function Vl(i,e){return Math.ceil(i/e)*e}class tn extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const o=2*e;return this.int16[o+0]=r,this.int16[o+1]=s,e}}tn.prototype.bytesPerElement=4,Fe("StructArrayLayout2i4",tn);class ka extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,s)}emplace(e,r,s,o){const d=3*e;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=o,e}}ka.prototype.bytesPerElement=6,Fe("StructArrayLayout3i6",ka);class To extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,o)}emplace(e,r,s,o,d){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=o,this.int16[p+3]=d,e}}To.prototype.bytesPerElement=8,Fe("StructArrayLayout4i8",To);class Io extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,o,d,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,o,d,p)}emplace(e,r,s,o,d,p,f){const g=6*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=o,this.int16[g+3]=d,this.int16[g+4]=p,this.int16[g+5]=f,e}}Io.prototype.bytesPerElement=12,Fe("StructArrayLayout2i4i12",Io);class Co extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,o,d,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,o,d,p)}emplace(e,r,s,o,d,p,f){const g=4*e,x=8*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.uint8[x+4]=o,this.uint8[x+5]=d,this.uint8[x+6]=p,this.uint8[x+7]=f,e}}Co.prototype.bytesPerElement=8,Fe("StructArrayLayout2i4ub8",Co);class hs extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const o=2*e;return this.float32[o+0]=r,this.float32[o+1]=s,e}}hs.prototype.bytesPerElement=8,Fe("StructArrayLayout2f8",hs);class Ao extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,o,d,p,f,g,x,w){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,s,o,d,p,f,g,x,w)}emplace(e,r,s,o,d,p,f,g,x,w,T){const k=10*e;return this.uint16[k+0]=r,this.uint16[k+1]=s,this.uint16[k+2]=o,this.uint16[k+3]=d,this.uint16[k+4]=p,this.uint16[k+5]=f,this.uint16[k+6]=g,this.uint16[k+7]=x,this.uint16[k+8]=w,this.uint16[k+9]=T,e}}Ao.prototype.bytesPerElement=20,Fe("StructArrayLayout10ui20",Ao);class ko extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,o,d,p,f,g,x,w,T,k){const z=this.length;return this.resize(z+1),this.emplace(z,e,r,s,o,d,p,f,g,x,w,T,k)}emplace(e,r,s,o,d,p,f,g,x,w,T,k,z){const L=12*e;return this.int16[L+0]=r,this.int16[L+1]=s,this.int16[L+2]=o,this.int16[L+3]=d,this.uint16[L+4]=p,this.uint16[L+5]=f,this.uint16[L+6]=g,this.uint16[L+7]=x,this.int16[L+8]=w,this.int16[L+9]=T,this.int16[L+10]=k,this.int16[L+11]=z,e}}ko.prototype.bytesPerElement=24,Fe("StructArrayLayout4i4ui4i24",ko);class ln extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,s)}emplace(e,r,s,o){const d=3*e;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=o,e}}ln.prototype.bytesPerElement=12,Fe("StructArrayLayout3f12",ln);class Ea extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Ea.prototype.bytesPerElement=4,Fe("StructArrayLayout1ul4",Ea);class Ns extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,o,d,p,f,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,s,o,d,p,f,g,x)}emplace(e,r,s,o,d,p,f,g,x,w){const T=10*e,k=5*e;return this.int16[T+0]=r,this.int16[T+1]=s,this.int16[T+2]=o,this.int16[T+3]=d,this.int16[T+4]=p,this.int16[T+5]=f,this.uint32[k+3]=g,this.uint16[T+8]=x,this.uint16[T+9]=w,e}}Ns.prototype.bytesPerElement=20,Fe("StructArrayLayout6i1ul2ui20",Ns);class Ma extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,o,d,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,o,d,p)}emplace(e,r,s,o,d,p,f){const g=6*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=o,this.int16[g+3]=d,this.int16[g+4]=p,this.int16[g+5]=f,e}}Ma.prototype.bytesPerElement=12,Fe("StructArrayLayout2i2i2i12",Ma);class js extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,o,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,o,d)}emplace(e,r,s,o,d,p){const f=4*e,g=8*e;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=o,this.int16[g+6]=d,this.int16[g+7]=p,e}}js.prototype.bytesPerElement=16,Fe("StructArrayLayout2f1f2i16",js);class Eo extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,o)}emplace(e,r,s,o,d){const p=12*e,f=3*e;return this.uint8[p+0]=r,this.uint8[p+1]=s,this.float32[f+1]=o,this.float32[f+2]=d,e}}Eo.prototype.bytesPerElement=12,Fe("StructArrayLayout2ub2f12",Eo);class Un extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,s)}emplace(e,r,s,o){const d=3*e;return this.uint16[d+0]=r,this.uint16[d+1]=s,this.uint16[d+2]=o,e}}Un.prototype.bytesPerElement=6,Fe("StructArrayLayout3ui6",Un);class Nn extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,o,d,p,f,g,x,w,T,k,z,L,V,G,X){const se=this.length;return this.resize(se+1),this.emplace(se,e,r,s,o,d,p,f,g,x,w,T,k,z,L,V,G,X)}emplace(e,r,s,o,d,p,f,g,x,w,T,k,z,L,V,G,X,se){const Y=24*e,te=12*e,pe=48*e;return this.int16[Y+0]=r,this.int16[Y+1]=s,this.uint16[Y+2]=o,this.uint16[Y+3]=d,this.uint32[te+2]=p,this.uint32[te+3]=f,this.uint32[te+4]=g,this.uint16[Y+10]=x,this.uint16[Y+11]=w,this.uint16[Y+12]=T,this.float32[te+7]=k,this.float32[te+8]=z,this.uint8[pe+36]=L,this.uint8[pe+37]=V,this.uint8[pe+38]=G,this.uint32[te+10]=X,this.int16[Y+22]=se,e}}Nn.prototype.bytesPerElement=48,Fe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Nn);class Mo extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,o,d,p,f,g,x,w,T,k,z,L,V,G,X,se,Y,te,pe,ye,Re,Ne,Le,Pe,Ce,Ve){const Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,e,r,s,o,d,p,f,g,x,w,T,k,z,L,V,G,X,se,Y,te,pe,ye,Re,Ne,Le,Pe,Ce,Ve)}emplace(e,r,s,o,d,p,f,g,x,w,T,k,z,L,V,G,X,se,Y,te,pe,ye,Re,Ne,Le,Pe,Ce,Ve,Ae){const we=32*e,He=16*e;return this.int16[we+0]=r,this.int16[we+1]=s,this.int16[we+2]=o,this.int16[we+3]=d,this.int16[we+4]=p,this.int16[we+5]=f,this.int16[we+6]=g,this.int16[we+7]=x,this.uint16[we+8]=w,this.uint16[we+9]=T,this.uint16[we+10]=k,this.uint16[we+11]=z,this.uint16[we+12]=L,this.uint16[we+13]=V,this.uint16[we+14]=G,this.uint16[we+15]=X,this.uint16[we+16]=se,this.uint16[we+17]=Y,this.uint16[we+18]=te,this.uint16[we+19]=pe,this.uint16[we+20]=ye,this.uint16[we+21]=Re,this.uint16[we+22]=Ne,this.uint32[He+12]=Le,this.float32[He+13]=Pe,this.float32[He+14]=Ce,this.uint16[we+30]=Ve,this.uint16[we+31]=Ae,e}}Mo.prototype.bytesPerElement=64,Fe("StructArrayLayout8i15ui1ul2f2ui64",Mo);class qs extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}qs.prototype.bytesPerElement=4,Fe("StructArrayLayout1f4",qs);class jn extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,s)}emplace(e,r,s,o){const d=3*e;return this.uint16[6*e+0]=r,this.float32[d+1]=s,this.float32[d+2]=o,e}}jn.prototype.bytesPerElement=12,Fe("StructArrayLayout1ui2f12",jn);class Po extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,r,s)}emplace(e,r,s,o){const d=4*e;return this.uint32[2*e+0]=r,this.uint16[d+2]=s,this.uint16[d+3]=o,e}}Po.prototype.bytesPerElement=8,Fe("StructArrayLayout1ul2ui8",Po);class zo extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const o=2*e;return this.uint16[o+0]=r,this.uint16[o+1]=s,e}}zo.prototype.bytesPerElement=4,Fe("StructArrayLayout2ui4",zo);class Pa extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Pa.prototype.bytesPerElement=2,Fe("StructArrayLayout1ui2",Pa);class Do extends ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,o)}emplace(e,r,s,o,d){const p=4*e;return this.float32[p+0]=r,this.float32[p+1]=s,this.float32[p+2]=o,this.float32[p+3]=d,e}}Do.prototype.bytesPerElement=16,Fe("StructArrayLayout4f16",Do);class c extends Us{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new re(this.anchorPointX,this.anchorPointY)}}c.prototype.size=20;class t extends Ns{get(e){return new c(this,e)}}Fe("CollisionBoxArray",t);class n extends Us{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}n.prototype.size=48;class a extends Nn{get(e){return new n(this,e)}}Fe("PlacedSymbolArray",a);class l extends Us{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}l.prototype.size=64;class u extends Mo{get(e){return new l(this,e)}}Fe("SymbolInstanceArray",u);class m extends qs{getoffsetX(e){return this.float32[1*e+0]}}Fe("GlyphOffsetArray",m);class _ extends ka{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Fe("SymbolLineVertexArray",_);class y extends Us{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}y.prototype.size=12;class v extends jn{get(e){return new y(this,e)}}Fe("TextAnchorOffsetArray",v);class S extends Us{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}S.prototype.size=8;class I extends Po{get(e){return new S(this,e)}}Fe("FeatureIndexArray",I);class D extends tn{}class q extends tn{}class N extends tn{}class Z extends Io{}class U extends Co{}class $ extends hs{}class oe extends Ao{}class W extends ko{}class ie extends ln{}class ue extends Ea{}class ce extends Ma{}class _e extends Eo{}class be extends Un{}class ve extends zo{}const Se=oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Oe}=Se;class Ke{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,o){let d=this.segments[this.segments.length-1];return e>Ke.MAX_VERTEX_ARRAY_LENGTH&&Xt(`Max vertices per segment is ${Ke.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>Ke.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==o)&&(d={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},o!==void 0&&(d.sortKey=o),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,o){return new Ke([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:o,vaos:{},sortKey:0}])}}function Me(i,e){return 256*(i=Ot(Math.floor(i),0,255))+Ot(Math.floor(e),0,255)}Ke.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fe("SegmentVector",Ke);const Xe=oi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ue={exports:{}},Nt={exports:{}};Nt.exports=function(i,e){var r,s,o,d,p,f,g,x;for(s=i.length-(r=3&i.length),o=e,p=3432918353,f=461845907,x=0;x<s;)g=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24,++x,o=27492+(65535&(d=5*(65535&(o=(o^=g=(65535&(g=(g=(65535&g)*p+(((g>>>16)*p&65535)<<16)&4294967295)<<15|g>>>17))*f+(((g>>>16)*f&65535)<<16)&4294967295)<<13|o>>>19))+((5*(o>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(g=0,r){case 3:g^=(255&i.charCodeAt(x+2))<<16;case 2:g^=(255&i.charCodeAt(x+1))<<8;case 1:o^=g=(65535&(g=(g=(65535&(g^=255&i.charCodeAt(x)))*p+(((g>>>16)*p&65535)<<16)&4294967295)<<15|g>>>17))*f+(((g>>>16)*f&65535)<<16)&4294967295}return o^=i.length,o=2246822507*(65535&(o^=o>>>16))+((2246822507*(o>>>16)&65535)<<16)&4294967295,o=3266489909*(65535&(o^=o>>>13))+((3266489909*(o>>>16)&65535)<<16)&4294967295,(o^=o>>>16)>>>0};var ft=Nt.exports,lt={exports:{}};lt.exports=function(i,e){for(var r,s=i.length,o=e^s,d=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(d)|(255&i.charCodeAt(++d))<<8|(255&i.charCodeAt(++d))<<16|(255&i.charCodeAt(++d))<<24))+((1540483477*(r>>>16)&65535)<<16),o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++d;switch(s){case 3:o^=(255&i.charCodeAt(d+2))<<16;case 2:o^=(255&i.charCodeAt(d+1))<<8;case 1:o=1540483477*(65535&(o^=255&i.charCodeAt(d)))+((1540483477*(o>>>16)&65535)<<16)}return o=1540483477*(65535&(o^=o>>>13))+((1540483477*(o>>>16)&65535)<<16),(o^=o>>>15)>>>0};var mt=ft,li=lt.exports;Ue.exports=mt,Ue.exports.murmur3=mt,Ue.exports.murmur2=li;var Dt=le(Ue.exports);class er{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,o){this.ids.push(Ri(e)),this.positions.push(r,s,o)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Ri(e);let s=0,o=this.ids.length-1;for(;s<o;){const p=s+o>>1;this.ids[p]>=r?o=p:s=p+1}const d=[];for(;this.ids[s]===r;)d.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return d}static serialize(e,r){const s=new Float64Array(e.ids),o=new Uint32Array(e.positions);return ti(s,o,0,s.length-1),r&&r.push(s.buffer,o.buffer),{ids:s,positions:o}}static deserialize(e){const r=new er;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Ri(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Dt(String(i))}function ti(i,e,r,s){for(;r<s;){const o=i[r+s>>1];let d=r-1,p=s+1;for(;;){do d++;while(i[d]<o);do p--;while(i[p]>o);if(d>=p)break;Ni(i,d,p),Ni(e,3*d,3*p),Ni(e,3*d+1,3*p+1),Ni(e,3*d+2,3*p+2)}p-r<s-p?(ti(i,e,r,p),r=p+1):(ti(i,e,p+1,s),s=p)}}function Ni(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}Fe("FeaturePositionMap",er);class ji{constructor(e,r){this.gl=e.gl,this.location=r}}class Br extends ji{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class xn extends ji{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class us extends ji{constructor(e,r){super(e,r),this.current=Et.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ds=new Float32Array(16);function vn(i){return[Me(255*i.r,255*i.g),Me(255*i.b,255*i.a)]}class Si{constructor(e,r,s){this.value=e,this.uniformNames=r.map(o=>`u_${o}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new us(e,r):new Br(e,r)}}class ci{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,s,o){const d=o==="u_pattern_to"?this.patternTo:o==="u_pattern_from"?this.patternFrom:o==="u_pixel_ratio_to"?this.pixelRatioTo:o==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&e.set(d)}getBinding(e,r,s){return s.substr(0,9)==="u_pattern"?new xn(e,r):new Br(e,r)}}class ii{constructor(e,r,s,o){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new o}populatePaintArray(e,r,s,o,d){const p=this.paintVertexArray.length,f=this.expression.evaluate(new Ut(0),r,{},o,[],d);this.paintVertexArray.resize(e),this._setPaintValue(p,e,f)}updatePaintArray(e,r,s,o){const d=this.expression.evaluate({zoom:0},s,o);this._setPaintValue(e,r,d)}_setPaintValue(e,r,s){if(this.type==="color"){const o=vn(s);for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,o[0],o[1])}else{for(let o=e;o<r;o++)this.paintVertexArray.emplace(o,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tr{constructor(e,r,s,o,d,p){this.expression=e,this.uniformNames=r.map(f=>`u_${f}_t`),this.type=s,this.useIntegerZoom=o,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,s,o,d){const p=this.expression.evaluate(new Ut(this.zoom),r,{},o,[],d),f=this.expression.evaluate(new Ut(this.zoom+1),r,{},o,[],d),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,p,f)}updatePaintArray(e,r,s,o){const d=this.expression.evaluate({zoom:this.zoom},s,o),p=this.expression.evaluate({zoom:this.zoom+1},s,o);this._setPaintValue(e,r,d,p)}_setPaintValue(e,r,s,o){if(this.type==="color"){const d=vn(s),p=vn(o);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,d[0],d[1],p[0],p[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,s,o);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,o=Ot(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(o)}getBinding(e,r,s){return new Br(e,r)}}class jt{constructor(e,r,s,o,d,p){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=o,this.layerId=p,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(e,r,s){const o=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(o,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,o,d){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],d)}_setPaintValues(e,r,s,o){if(!o||!s)return;const{min:d,mid:p,max:f}=s,g=o[d],x=o[p],w=o[f];if(g&&x&&w)for(let T=e;T<r;T++)this.zoomInPaintVertexArray.emplace(T,x.tl[0],x.tl[1],x.br[0],x.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],x.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(T,x.tl[0],x.tl[1],x.br[0],x.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],x.pixelRatio,w.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Xe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Xe.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ti{constructor(e,r,s){this.binders={},this._buffers=[];const o=[];for(const d in e.paint._values){if(!s(d))continue;const p=e.paint.get(d);if(!(p instanceof jr&&ss(p.property.specification)))continue;const f=Ii(d,e.type),g=p.value,x=p.property.specification.type,w=p.property.useIntegerZoom,T=p.property.specification["property-type"],k=T==="cross-faded"||T==="cross-faded-data-driven";if(g.kind==="constant")this.binders[d]=k?new ci(g.value,f):new Si(g.value,f,x),o.push(`/u_${d}`);else if(g.kind==="source"||k){const z=Ul(d,x,"source");this.binders[d]=k?new jt(g,x,w,r,z,e.id):new ii(g,f,x,z),o.push(`/a_${d}`)}else{const z=Ul(d,x,"composite");this.binders[d]=new tr(g,f,x,w,r,z),o.push(`/z_${d}`)}}this.cacheKey=o.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof ii||r instanceof tr?r.maxValue:0}populatePaintArrays(e,r,s,o,d){for(const p in this.binders){const f=this.binders[p];(f instanceof ii||f instanceof tr||f instanceof jt)&&f.populatePaintArray(e,r,s,o,d)}}setConstantPatternPositions(e,r){for(const s in this.binders){const o=this.binders[s];o instanceof ci&&o.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,o,d){let p=!1;for(const f in e){const g=r.getPositions(f);for(const x of g){const w=s.feature(x.index);for(const T in this.binders){const k=this.binders[T];if((k instanceof ii||k instanceof tr||k instanceof jt)&&k.expression.isStateDependent===!0){const z=o.paint.get(T);k.expression=z.value,k.updatePaintArray(x.start,x.end,w,e[f],d),p=!0}}}}return p}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Si||s instanceof ci)&&e.push(...s.uniformNames.map(o=>`#define HAS_UNIFORM_${o}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof ii||s instanceof tr)for(let o=0;o<s.paintVertexAttributes.length;o++)e.push(s.paintVertexAttributes[o].name);else if(s instanceof jt)for(let o=0;o<Xe.members.length;o++)e.push(Xe.members[o].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Si||s instanceof ci||s instanceof tr)for(const o of s.uniformNames)e.push(o)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const o in this.binders){const d=this.binders[o];if(d instanceof Si||d instanceof ci||d instanceof tr){for(const p of d.uniformNames)if(r[p]){const f=d.getBinding(e,r[p],p);s.push({name:p,property:o,binding:f})}}}return s}setUniforms(e,r,s,o){for(const{name:d,property:p,binding:f}of r)this.binders[p].setUniform(f,o,s.get(p),d)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof jt){const o=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;o&&this._buffers.push(o)}else(s instanceof ii||s instanceof tr)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof ii||s instanceof tr||s instanceof jt)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof ii||r instanceof tr||r instanceof jt)&&r.destroy()}}}class Bi{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const o of e)this.programConfigurations[o.id]=new Ti(o,r,s);this.needsUpload=!1,this._featureMap=new er,this._bufferOffset=0}populatePaintArrays(e,r,s,o,d,p){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,r,o,d,p);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,o){for(const d of s)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,r,d,o)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Ii(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Ul(i,e,r){const s={color:{source:hs,composite:Do},number:{source:qs,composite:hs}},o=function(d){return{"line-pattern":{source:oe,composite:oe},"fill-pattern":{source:oe,composite:oe},"fill-extrusion-pattern":{source:oe,composite:oe}}[d]}(i);return o&&o[r]||s[e][r]}Fe("ConstantBinder",Si),Fe("CrossFadedConstantBinder",ci),Fe("SourceExpressionBinder",ii),Fe("CrossFadedCompositeBinder",jt),Fe("CompositeExpressionBinder",tr),Fe("ProgramConfiguration",Ti,{omit:["_buffers"]}),Fe("ProgramConfigurationSet",Bi);const ri=8192,Lo=Math.pow(2,14)-1,Nl=-Lo-1;function qn(i){const e=ri/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const o=r[s];for(let d=0;d<o.length;d++){const p=o[d],f=Math.round(p.x*e),g=Math.round(p.y*e);p.x=Ot(f,Nl,Lo),p.y=Ot(g,Nl,Lo),(f<p.x||f>p.x+1||g<p.y||g>p.y+1)&&Xt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Zn(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?qn(i):[]}}function cn(i,e,r,s,o){i.emplaceBack(2*e+(s+1)/2,2*r+(o+1)/2)}class za{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new q,this.indexArray=new be,this.segments=new Ke,this.programConfigurations=new Bi(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){const o=this.layers[0],d=[];let p=null,f=!1;o.type==="circle"&&(p=o.layout.get("circle-sort-key"),f=!p.isConstant());for(const{feature:g,id:x,index:w,sourceLayerIndex:T}of e){const k=this.layers[0]._featureFilter.needGeometry,z=Zn(g,k);if(!this.layers[0]._featureFilter.filter(new Ut(this.zoom),z,s))continue;const L=f?p.evaluate(z,{},s):void 0,V={id:x,properties:g.properties,type:g.type,sourceLayerIndex:T,index:w,geometry:k?z.geometry:qn(g),patterns:{},sortKey:L};d.push(V)}f&&d.sort((g,x)=>g.sortKey-x.sortKey);for(const g of d){const{geometry:x,index:w,sourceLayerIndex:T}=g,k=e[w].feature;this.addFeature(g,x,w,s),r.featureIndex.insert(k,x,w,T,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Oe),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,o){for(const d of r)for(const p of d){const f=p.x,g=p.y;if(f<0||f>=ri||g<0||g>=ri)continue;const x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),w=x.vertexLength;cn(this.layoutVertexArray,f,g,-1,-1),cn(this.layoutVertexArray,f,g,1,-1),cn(this.layoutVertexArray,f,g,1,1),cn(this.layoutVertexArray,f,g,-1,1),this.indexArray.emplaceBack(w,w+1,w+2),this.indexArray.emplaceBack(w,w+3,w+2),x.vertexLength+=4,x.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},o)}}function Ro(i,e){for(let r=0;r<i.length;r++)if(La(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(La(i,e[r]))return!0;return!!Zs(i,e)}function jl(i,e,r){return!!La(i,e)||!!Lc(e,i,r)}function Da(i,e){if(i.length===1)return Eh(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let o=0;o<s.length;o++)if(La(i,s[o]))return!0}for(let r=0;r<i.length;r++)if(Eh(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Zs(i,e[r]))return!0;return!1}function ql(i,e,r){if(i.length>1){if(Zs(i,e))return!0;for(let s=0;s<e.length;s++)if(Lc(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(Lc(i[s],e,r))return!0;return!1}function Zs(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],o=i[r+1];for(let d=0;d<e.length-1;d++)if(Ld(s,o,e[d],e[d+1]))return!0}return!1}function Ld(i,e,r,s){return zi(i,r,s)!==zi(e,r,s)&&zi(i,e,r)!==zi(i,e,s)}function Lc(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let o=1;o<e.length;o++)if(kh(i,e[o-1],e[o])<s)return!0;return!1}function kh(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const o=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(o<0?e:o>1?r:r.sub(e)._mult(o)._add(e))}function Eh(i,e){let r,s,o,d=!1;for(let p=0;p<i.length;p++){r=i[p];for(let f=0,g=r.length-1;f<r.length;g=f++)s=r[f],o=r[g],s.y>e.y!=o.y>e.y&&e.x<(o.x-s.x)*(e.y-s.y)/(o.y-s.y)+s.x&&(d=!d)}return d}function La(i,e){let r=!1;for(let s=0,o=i.length-1;s<i.length;o=s++){const d=i[s],p=i[o];d.y>e.y!=p.y>e.y&&e.x<(p.x-d.x)*(e.y-d.y)/(p.y-d.y)+d.x&&(r=!r)}return r}function Rd(i,e,r){const s=r[0],o=r[2];if(i.x<s.x&&e.x<s.x||i.x>o.x&&e.x>o.x||i.y<s.y&&e.y<s.y||i.y>o.y&&e.y>o.y)return!1;const d=zi(i,e,r[0]);return d!==zi(i,e,r[1])||d!==zi(i,e,r[2])||d!==zi(i,e,r[3])}function Bo(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Zl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Gl(i,e,r,s,o){if(!e[0]&&!e[1])return i;const d=re.convert(e)._mult(o);r==="viewport"&&d._rotate(-s);const p=[];for(let f=0;f<i.length;f++)p.push(i[f].sub(d));return p}let Mh,Ph;Fe("CircleBucket",za,{omit:["layers"]});var Bd={get paint(){return Ph=Ph||new Qi({"circle-radius":new Je(de.paint_circle["circle-radius"]),"circle-color":new Je(de.paint_circle["circle-color"]),"circle-blur":new Je(de.paint_circle["circle-blur"]),"circle-opacity":new Je(de.paint_circle["circle-opacity"]),"circle-translate":new qe(de.paint_circle["circle-translate"]),"circle-translate-anchor":new qe(de.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new qe(de.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new qe(de.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Je(de.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Je(de.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Je(de.paint_circle["circle-stroke-opacity"])})},get layout(){return Mh=Mh||new Qi({"circle-sort-key":new Je(de.layout_circle["circle-sort-key"])})}},pr=1e-6,Ra=typeof Float32Array<"u"?Float32Array:Array;function Rc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function zh(i,e,r){var s=e[0],o=e[1],d=e[2],p=e[3],f=e[4],g=e[5],x=e[6],w=e[7],T=e[8],k=e[9],z=e[10],L=e[11],V=e[12],G=e[13],X=e[14],se=e[15],Y=r[0],te=r[1],pe=r[2],ye=r[3];return i[0]=Y*s+te*f+pe*T+ye*V,i[1]=Y*o+te*g+pe*k+ye*G,i[2]=Y*d+te*x+pe*z+ye*X,i[3]=Y*p+te*w+pe*L+ye*se,i[4]=(Y=r[4])*s+(te=r[5])*f+(pe=r[6])*T+(ye=r[7])*V,i[5]=Y*o+te*g+pe*k+ye*G,i[6]=Y*d+te*x+pe*z+ye*X,i[7]=Y*p+te*w+pe*L+ye*se,i[8]=(Y=r[8])*s+(te=r[9])*f+(pe=r[10])*T+(ye=r[11])*V,i[9]=Y*o+te*g+pe*k+ye*G,i[10]=Y*d+te*x+pe*z+ye*X,i[11]=Y*p+te*w+pe*L+ye*se,i[12]=(Y=r[12])*s+(te=r[13])*f+(pe=r[14])*T+(ye=r[15])*V,i[13]=Y*o+te*g+pe*k+ye*G,i[14]=Y*d+te*x+pe*z+ye*X,i[15]=Y*p+te*w+pe*L+ye*se,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Fo,Fd=zh;function Hl(i,e,r){var s=e[0],o=e[1],d=e[2],p=e[3];return i[0]=r[0]*s+r[4]*o+r[8]*d+r[12]*p,i[1]=r[1]*s+r[5]*o+r[9]*d+r[13]*p,i[2]=r[2]*s+r[6]*o+r[10]*d+r[14]*p,i[3]=r[3]*s+r[7]*o+r[11]*d+r[15]*p,i}Fo=new Ra(4),Ra!=Float32Array&&(Fo[0]=0,Fo[1]=0,Fo[2]=0,Fo[3]=0);class Od extends qr{constructor(e){super(e,Bd)}createBucket(e){return new za(e)}queryRadius(e){const r=e;return Bo("circle-radius",this,r)+Bo("circle-stroke-width",this,r)+Zl(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,s,o,d,p,f,g){const x=Gl(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,f),w=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),T=this.paint.get("circle-pitch-alignment")==="map",k=T?x:function(L,V){return L.map(G=>Dh(G,V))}(x,g),z=T?w*f:w;for(const L of o)for(const V of L){const G=T?V:Dh(V,g);let X=z;const se=Hl([],[V.x,V.y,0,1],g);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?X*=se[3]/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(X*=p.cameraToCenterDistance/se[3]),jl(k,G,X))return!0}return!1}}function Dh(i,e){const r=Hl([],[i.x,i.y,0,1],e);return new re(r[0]/r[3],r[1]/r[3])}class Lh extends za{}let Rh;Fe("HeatmapBucket",Lh,{omit:["layers"]});var Vd={get paint(){return Rh=Rh||new Qi({"heatmap-radius":new Je(de.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Je(de.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new qe(de.paint_heatmap["heatmap-intensity"]),"heatmap-color":new wo(de.paint_heatmap["heatmap-color"]),"heatmap-opacity":new qe(de.paint_heatmap["heatmap-opacity"])})}};function Bc(i,{width:e,height:r},s,o){if(o){if(o instanceof Uint8ClampedArray)o=new Uint8Array(o.buffer);else if(o.length!==e*r*s)throw new RangeError(`mismatched image size. expected: ${o.length} but got: ${e*r*s}`)}else o=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=o,i}function Bh(i,{width:e,height:r},s){if(e===i.width&&r===i.height)return;const o=Bc({},{width:e,height:r},s);Fc(i,o,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},s),i.width=e,i.height=r,i.data=o.data}function Fc(i,e,r,s,o,d){if(o.width===0||o.height===0)return e;if(o.width>i.width||o.height>i.height||r.x>i.width-o.width||r.y>i.height-o.height)throw new RangeError("out of range source coordinates for image copy");if(o.width>e.width||o.height>e.height||s.x>e.width-o.width||s.y>e.height-o.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,f=e.data;if(p===f)throw new Error("srcData equals dstData, so image is already copied");for(let g=0;g<o.height;g++){const x=((r.y+g)*i.width+r.x)*d,w=((s.y+g)*e.width+s.x)*d;for(let T=0;T<o.width*d;T++)f[w+T]=p[x+T]}return e}class Oo{constructor(e,r){Bc(this,e,1,r)}resize(e){Bh(this,e,1)}clone(){return new Oo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,o,d){Fc(e,r,s,o,d,1)}}class Zr{constructor(e,r){Bc(this,e,4,r)}resize(e){Bh(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Zr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,o,d){Fc(e,r,s,o,d,4)}}function Fh(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,o=i.image||new Zr({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const d=(p,f,g)=>{e[i.evaluationKey]=g;const x=i.expression.evaluate(e);o.data[p+f+0]=Math.floor(255*x.r/x.a),o.data[p+f+1]=Math.floor(255*x.g/x.a),o.data[p+f+2]=Math.floor(255*x.b/x.a),o.data[p+f+3]=Math.floor(255*x.a)};if(i.clips)for(let p=0,f=0;p<s;++p,f+=4*r)for(let g=0,x=0;g<r;g++,x+=4){const w=g/(r-1),{start:T,end:k}=i.clips[p];d(f,x,T*(1-w)+k*w)}else for(let p=0,f=0;p<r;p++,f+=4)d(0,f,p/(r-1));return o}Fe("AlphaImage",Oo),Fe("RGBAImage",Zr);class Ud extends qr{createBucket(e){return new Lh(e)}constructor(e){super(e,Vd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Fh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Oh;var Nd={get paint(){return Oh=Oh||new Qi({"hillshade-illumination-direction":new qe(de.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new qe(de.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new qe(de.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new qe(de.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new qe(de.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new qe(de.paint_hillshade["hillshade-accent-color"])})}};class jd extends qr{constructor(e){super(e,Nd)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const qd=oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zd}=qd;var Oc={exports:{}};function Wl(i,e,r){r=r||2;var s,o,d,p,f,g,x,w=e&&e.length,T=w?e[0]*r:i.length,k=Vh(i,0,T,r,!0),z=[];if(!k||k.next===k.prev)return z;if(w&&(k=function(V,G,X,se){var Y,te,pe,ye=[];for(Y=0,te=G.length;Y<te;Y++)(pe=Vh(V,G[Y]*se,Y<te-1?G[Y+1]*se:V.length,se,!1))===pe.next&&(pe.steiner=!0),ye.push($d(pe));for(ye.sort(Kd),Y=0;Y<ye.length;Y++)X=Yd(ye[Y],X);return X}(i,e,k,r)),i.length>80*r){s=d=i[0],o=p=i[1];for(var L=r;L<T;L+=r)(f=i[L])<s&&(s=f),(g=i[L+1])<o&&(o=g),f>d&&(d=f),g>p&&(p=g);x=(x=Math.max(d-s,p-o))!==0?32767/x:0}return Vo(k,z,r,s,o,x,0),z}function Vh(i,e,r,s,o){var d,p;if(o===Nc(i,e,r,s)>0)for(d=e;d<r;d+=s)p=jh(d,i[d],i[d+1],p);else for(d=r-s;d>=e;d-=s)p=jh(d,i[d],i[d+1],p);return p&&Xl(p,p.next)&&(No(p),p=p.next),p}function Gs(i,e){if(!i)return i;e||(e=i);var r,s=i;do if(r=!1,s.steiner||!Xl(s,s.next)&&hi(s.prev,s,s.next)!==0)s=s.next;else{if(No(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function Vo(i,e,r,s,o,d,p){if(i){!p&&d&&function(w,T,k,z){var L=w;do L.z===0&&(L.z=Vc(L.x,L.y,T,k,z)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==w);L.prevZ.nextZ=null,L.prevZ=null,function(V){var G,X,se,Y,te,pe,ye,Re,Ne=1;do{for(X=V,V=null,te=null,pe=0;X;){for(pe++,se=X,ye=0,G=0;G<Ne&&(ye++,se=se.nextZ);G++);for(Re=Ne;ye>0||Re>0&&se;)ye!==0&&(Re===0||!se||X.z<=se.z)?(Y=X,X=X.nextZ,ye--):(Y=se,se=se.nextZ,Re--),te?te.nextZ=Y:V=Y,Y.prevZ=te,te=Y;X=se}te.nextZ=null,Ne*=2}while(pe>1)}(L)}(i,s,o,d);for(var f,g,x=i;i.prev!==i.next;)if(f=i.prev,g=i.next,d?Hd(i,s,o,d):Gd(i))e.push(f.i/r|0),e.push(i.i/r|0),e.push(g.i/r|0),No(i),i=g.next,x=g.next;else if((i=g)===x){p?p===1?Vo(i=Wd(Gs(i),e,r),e,r,s,o,d,2):p===2&&Xd(i,e,r,s,o,d):Vo(Gs(i),e,r,s,o,d,1);break}}}function Gd(i){var e=i.prev,r=i,s=i.next;if(hi(e,r,s)>=0)return!1;for(var o=e.x,d=r.x,p=s.x,f=e.y,g=r.y,x=s.y,w=o<d?o<p?o:p:d<p?d:p,T=f<g?f<x?f:x:g<x?g:x,k=o>d?o>p?o:p:d>p?d:p,z=f>g?f>x?f:x:g>x?g:x,L=s.next;L!==e;){if(L.x>=w&&L.x<=k&&L.y>=T&&L.y<=z&&Ba(o,f,d,g,p,x,L.x,L.y)&&hi(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function Hd(i,e,r,s){var o=i.prev,d=i,p=i.next;if(hi(o,d,p)>=0)return!1;for(var f=o.x,g=d.x,x=p.x,w=o.y,T=d.y,k=p.y,z=f<g?f<x?f:x:g<x?g:x,L=w<T?w<k?w:k:T<k?T:k,V=f>g?f>x?f:x:g>x?g:x,G=w>T?w>k?w:k:T>k?T:k,X=Vc(z,L,e,r,s),se=Vc(V,G,e,r,s),Y=i.prevZ,te=i.nextZ;Y&&Y.z>=X&&te&&te.z<=se;){if(Y.x>=z&&Y.x<=V&&Y.y>=L&&Y.y<=G&&Y!==o&&Y!==p&&Ba(f,w,g,T,x,k,Y.x,Y.y)&&hi(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,te.x>=z&&te.x<=V&&te.y>=L&&te.y<=G&&te!==o&&te!==p&&Ba(f,w,g,T,x,k,te.x,te.y)&&hi(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;Y&&Y.z>=X;){if(Y.x>=z&&Y.x<=V&&Y.y>=L&&Y.y<=G&&Y!==o&&Y!==p&&Ba(f,w,g,T,x,k,Y.x,Y.y)&&hi(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;te&&te.z<=se;){if(te.x>=z&&te.x<=V&&te.y>=L&&te.y<=G&&te!==o&&te!==p&&Ba(f,w,g,T,x,k,te.x,te.y)&&hi(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function Wd(i,e,r){var s=i;do{var o=s.prev,d=s.next.next;!Xl(o,d)&&Uh(o,s,s.next,d)&&Uo(o,d)&&Uo(d,o)&&(e.push(o.i/r|0),e.push(s.i/r|0),e.push(d.i/r|0),No(s),No(s.next),s=i=d),s=s.next}while(s!==i);return Gs(s)}function Xd(i,e,r,s,o,d){var p=i;do{for(var f=p.next.next;f!==p.prev;){if(p.i!==f.i&&Qd(p,f)){var g=Nh(p,f);return p=Gs(p,p.next),g=Gs(g,g.next),Vo(p,e,r,s,o,d,0),void Vo(g,e,r,s,o,d,0)}f=f.next}p=p.next}while(p!==i)}function Kd(i,e){return i.x-e.x}function Yd(i,e){var r=function(o,d){var p,f=d,g=o.x,x=o.y,w=-1/0;do{if(x<=f.y&&x>=f.next.y&&f.next.y!==f.y){var T=f.x+(x-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(T<=g&&T>w&&(w=T,p=f.x<f.next.x?f:f.next,T===g))return p}f=f.next}while(f!==d);if(!p)return null;var k,z=p,L=p.x,V=p.y,G=1/0;f=p;do g>=f.x&&f.x>=L&&g!==f.x&&Ba(x<V?g:w,x,L,V,x<V?w:g,x,f.x,f.y)&&(k=Math.abs(x-f.y)/(g-f.x),Uo(f,o)&&(k<G||k===G&&(f.x>p.x||f.x===p.x&&Jd(p,f)))&&(p=f,G=k)),f=f.next;while(f!==z);return p}(i,e);if(!r)return e;var s=Nh(r,i);return Gs(s,s.next),Gs(r,r.next)}function Jd(i,e){return hi(i.prev,i,e.prev)<0&&hi(e.next,i,i.next)<0}function Vc(i,e,r,s,o){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*o|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $d(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Ba(i,e,r,s,o,d,p,f){return(o-p)*(e-f)>=(i-p)*(d-f)&&(i-p)*(s-f)>=(r-p)*(e-f)&&(r-p)*(d-f)>=(o-p)*(s-f)}function Qd(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,s){var o=r;do{if(o.i!==r.i&&o.next.i!==r.i&&o.i!==s.i&&o.next.i!==s.i&&Uh(o,o.next,r,s))return!0;o=o.next}while(o!==r);return!1}(i,e)&&(Uo(i,e)&&Uo(e,i)&&function(r,s){var o=r,d=!1,p=(r.x+s.x)/2,f=(r.y+s.y)/2;do o.y>f!=o.next.y>f&&o.next.y!==o.y&&p<(o.next.x-o.x)*(f-o.y)/(o.next.y-o.y)+o.x&&(d=!d),o=o.next;while(o!==r);return d}(i,e)&&(hi(i.prev,i,e.prev)||hi(i,e.prev,e))||Xl(i,e)&&hi(i.prev,i,i.next)>0&&hi(e.prev,e,e.next)>0)}function hi(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Xl(i,e){return i.x===e.x&&i.y===e.y}function Uh(i,e,r,s){var o=Yl(hi(i,e,r)),d=Yl(hi(i,e,s)),p=Yl(hi(r,s,i)),f=Yl(hi(r,s,e));return o!==d&&p!==f||!(o!==0||!Kl(i,r,e))||!(d!==0||!Kl(i,s,e))||!(p!==0||!Kl(r,i,s))||!(f!==0||!Kl(r,e,s))}function Kl(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Yl(i){return i>0?1:i<0?-1:0}function Uo(i,e){return hi(i.prev,i,i.next)<0?hi(i,e,i.next)>=0&&hi(i,i.prev,e)>=0:hi(i,e,i.prev)<0||hi(i,i.next,e)<0}function Nh(i,e){var r=new Uc(i.i,i.x,i.y),s=new Uc(e.i,e.x,e.y),o=i.next,d=e.prev;return i.next=e,e.prev=i,r.next=o,o.prev=r,s.next=r,r.prev=s,d.next=s,s.prev=d,s}function jh(i,e,r,s){var o=new Uc(i,e,r);return s?(o.next=s.next,o.prev=s,s.next.prev=o,s.next=o):(o.prev=o,o.next=o),o}function No(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Uc(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Nc(i,e,r,s){for(var o=0,d=e,p=r-s;d<r;d+=s)o+=(i[p]-i[d])*(i[d+1]+i[p+1]),p=d;return o}Oc.exports=Wl,Oc.exports.default=Wl,Wl.deviation=function(i,e,r,s){var o=e&&e.length,d=Math.abs(Nc(i,0,o?e[0]*r:i.length,r));if(o)for(var p=0,f=e.length;p<f;p++)d-=Math.abs(Nc(i,e[p]*r,p<f-1?e[p+1]*r:i.length,r));var g=0;for(p=0;p<s.length;p+=3){var x=s[p]*r,w=s[p+1]*r,T=s[p+2]*r;g+=Math.abs((i[x]-i[T])*(i[w+1]-i[x+1])-(i[x]-i[w])*(i[T+1]-i[x+1]))}return d===0&&g===0?0:Math.abs((g-d)/d)},Wl.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,o=0;o<i.length;o++){for(var d=0;d<i[o].length;d++)for(var p=0;p<e;p++)r.vertices.push(i[o][d][p]);o>0&&r.holes.push(s+=i[o-1].length)}return r};var qh=le(Oc.exports);function ep(i,e,r,s,o){Zh(i,e,r||0,s||i.length-1,o||tp)}function Zh(i,e,r,s,o){for(;s>r;){if(s-r>600){var d=s-r+1,p=e-r+1,f=Math.log(d),g=.5*Math.exp(2*f/3),x=.5*Math.sqrt(f*g*(d-g)/d)*(p-d/2<0?-1:1);Zh(i,e,Math.max(r,Math.floor(e-p*g/d+x)),Math.min(s,Math.floor(e+(d-p)*g/d+x)),o)}var w=i[e],T=r,k=s;for(jo(i,r,e),o(i[s],w)>0&&jo(i,r,s);T<k;){for(jo(i,T,k),T++,k--;o(i[T],w)<0;)T++;for(;o(i[k],w)>0;)k--}o(i[r],w)===0?jo(i,r,k):jo(i,++k,s),k<=e&&(r=k+1),e<=k&&(s=k-1)}}function jo(i,e,r){var s=i[e];i[e]=i[r],i[r]=s}function tp(i,e){return i<e?-1:i>e?1:0}function jc(i,e){const r=i.length;if(r<=1)return[i];const s=[];let o,d;for(let p=0;p<r;p++){const f=or(i[p]);f!==0&&(i[p].area=Math.abs(f),d===void 0&&(d=f<0),d===f<0?(o&&s.push(o),o=[i[p]]):o.push(i[p]))}if(o&&s.push(o),e>1)for(let p=0;p<s.length;p++)s[p].length<=e||(ep(s[p],e,1,s[p].length-1,ip),s[p]=s[p].slice(0,e));return s}function ip(i,e){return e.area-i.area}function qc(i,e,r){const s=r.patternDependencies;let o=!1;for(const d of e){const p=d.paint.get(`${i}-pattern`);p.isConstant()||(o=!0);const f=p.constantOr(null);f&&(o=!0,s[f.to]=!0,s[f.from]=!0)}return o}function Zc(i,e,r,s,o){const d=o.patternDependencies;for(const p of e){const f=p.paint.get(`${i}-pattern`).value;if(f.kind!=="constant"){let g=f.evaluate({zoom:s-1},r,{},o.availableImages),x=f.evaluate({zoom:s},r,{},o.availableImages),w=f.evaluate({zoom:s+1},r,{},o.availableImages);g=g&&g.name?g.name:g,x=x&&x.name?x.name:x,w=w&&w.name?w.name:w,d[g]=!0,d[x]=!0,d[w]=!0,r.patterns[p.id]={min:g,mid:x,max:w}}}return r}class Gc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new N,this.indexArray=new be,this.indexArray2=new ve,this.programConfigurations=new Bi(e.layers,e.zoom),this.segments=new Ke,this.segments2=new Ke,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=qc("fill",this.layers,r);const o=this.layers[0].layout.get("fill-sort-key"),d=!o.isConstant(),p=[];for(const{feature:f,id:g,index:x,sourceLayerIndex:w}of e){const T=this.layers[0]._featureFilter.needGeometry,k=Zn(f,T);if(!this.layers[0]._featureFilter.filter(new Ut(this.zoom),k,s))continue;const z=d?o.evaluate(k,{},s,r.availableImages):void 0,L={id:g,properties:f.properties,type:f.type,sourceLayerIndex:w,index:x,geometry:T?k.geometry:qn(f),patterns:{},sortKey:z};p.push(L)}d&&p.sort((f,g)=>f.sortKey-g.sortKey);for(const f of p){const{geometry:g,index:x,sourceLayerIndex:w}=f;if(this.hasPattern){const T=Zc("fill",this.layers,f,this.zoom,r);this.patternFeatures.push(T)}else this.addFeature(f,g,x,s,{});r.featureIndex.insert(e[x].feature,g,x,w,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,o,d){for(const p of jc(r,500)){let f=0;for(const z of p)f+=z.length;const g=this.segments.prepareSegment(f,this.layoutVertexArray,this.indexArray),x=g.vertexLength,w=[],T=[];for(const z of p){if(z.length===0)continue;z!==p[0]&&T.push(w.length/2);const L=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),V=L.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(V+z.length-1,V),w.push(z[0].x),w.push(z[0].y);for(let G=1;G<z.length;G++)this.layoutVertexArray.emplaceBack(z[G].x,z[G].y),this.indexArray2.emplaceBack(V+G-1,V+G),w.push(z[G].x),w.push(z[G].y);L.vertexLength+=z.length,L.primitiveLength+=z.length}const k=qh(w,T);for(let z=0;z<k.length;z+=3)this.indexArray.emplaceBack(x+k[z],x+k[z+1],x+k[z+2]);g.vertexLength+=f,g.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,o)}}let Gh,Hh;Fe("FillBucket",Gc,{omit:["layers","patternFeatures"]});var rp={get paint(){return Hh=Hh||new Qi({"fill-antialias":new qe(de.paint_fill["fill-antialias"]),"fill-opacity":new Je(de.paint_fill["fill-opacity"]),"fill-color":new Je(de.paint_fill["fill-color"]),"fill-outline-color":new Je(de.paint_fill["fill-outline-color"]),"fill-translate":new qe(de.paint_fill["fill-translate"]),"fill-translate-anchor":new qe(de.paint_fill["fill-translate-anchor"]),"fill-pattern":new cs(de.paint_fill["fill-pattern"])})},get layout(){return Gh=Gh||new Qi({"fill-sort-key":new Je(de.layout_fill["fill-sort-key"])})}};class np extends qr{constructor(e){super(e,rp)}recalculate(e,r){super.recalculate(e,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Gc(e)}queryRadius(){return Zl(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,s,o,d,p,f){return Da(Gl(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,f),o)}isTileClipped(){return!0}}const sp=oi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ap=oi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:op}=sp;var ps={},lp=he,Wh=Fa;function Fa(i,e,r,s,o){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=o,i.readFields(cp,this,e)}function cp(i,e,r){i==1?e.id=r.readVarint():i==2?function(s,o){for(var d=s.readVarint()+s.pos;s.pos<d;){var p=o._keys[s.readVarint()],f=o._values[s.readVarint()];o.properties[p]=f}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function hp(i){for(var e,r,s=0,o=0,d=i.length,p=d-1;o<d;p=o++)s+=((r=i[p]).x-(e=i[o]).x)*(e.y+r.y);return s}Fa.types=["Unknown","Point","LineString","Polygon"],Fa.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,s=1,o=0,d=0,p=0,f=[];i.pos<r;){if(o<=0){var g=i.readVarint();s=7&g,o=g>>3}if(o--,s===1||s===2)d+=i.readSVarint(),p+=i.readSVarint(),s===1&&(e&&f.push(e),e=[]),e.push(new lp(d,p));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&f.push(e),f},Fa.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,s=0,o=0,d=0,p=1/0,f=-1/0,g=1/0,x=-1/0;i.pos<e;){if(s<=0){var w=i.readVarint();r=7&w,s=w>>3}if(s--,r===1||r===2)(o+=i.readSVarint())<p&&(p=o),o>f&&(f=o),(d+=i.readSVarint())<g&&(g=d),d>x&&(x=d);else if(r!==7)throw new Error("unknown command "+r)}return[p,g,f,x]},Fa.prototype.toGeoJSON=function(i,e,r){var s,o,d=this.extent*Math.pow(2,r),p=this.extent*i,f=this.extent*e,g=this.loadGeometry(),x=Fa.types[this.type];function w(z){for(var L=0;L<z.length;L++){var V=z[L];z[L]=[360*(V.x+p)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+f)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var T=[];for(s=0;s<g.length;s++)T[s]=g[s][0];w(g=T);break;case 2:for(s=0;s<g.length;s++)w(g[s]);break;case 3:for(g=function(z){var L=z.length;if(L<=1)return[z];for(var V,G,X=[],se=0;se<L;se++){var Y=hp(z[se]);Y!==0&&(G===void 0&&(G=Y<0),G===Y<0?(V&&X.push(V),V=[z[se]]):V.push(z[se]))}return V&&X.push(V),X}(g),s=0;s<g.length;s++)for(o=0;o<g[s].length;o++)w(g[s][o])}g.length===1?g=g[0]:x="Multi"+x;var k={type:"Feature",geometry:{type:x,coordinates:g},properties:this.properties};return"id"in this&&(k.id=this.id),k};var up=Wh,Xh=Kh;function Kh(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(dp,this,e),this.length=this._features.length}function dp(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(s){for(var o=null,d=s.readVarint()+s.pos;s.pos<d;){var p=s.readVarint()>>3;o=p===1?s.readString():p===2?s.readFloat():p===3?s.readDouble():p===4?s.readVarint64():p===5?s.readVarint():p===6?s.readSVarint():p===7?s.readBoolean():null}return o}(r))}Kh.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new up(this._pbf,e,this.extent,this._keys,this._values)};var pp=Xh;function fp(i,e,r){if(i===3){var s=new pp(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}ps.VectorTile=function(i,e){this.layers=i.readFields(fp,{},e)},ps.VectorTileFeature=Wh,ps.VectorTileLayer=Xh;const mp=ps.VectorTileFeature.types,Hc=Math.pow(2,13);function qo(i,e,r,s,o,d,p,f){i.emplaceBack(e,r,2*Math.floor(s*Hc)+p,o*Hc*2,d*Hc*2,Math.round(f))}class Wc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Z,this.centroidVertexArray=new D,this.indexArray=new be,this.programConfigurations=new Bi(e.layers,e.zoom),this.segments=new Ke,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.features=[],this.hasPattern=qc("fill-extrusion",this.layers,r);for(const{feature:o,id:d,index:p,sourceLayerIndex:f}of e){const g=this.layers[0]._featureFilter.needGeometry,x=Zn(o,g);if(!this.layers[0]._featureFilter.filter(new Ut(this.zoom),x,s))continue;const w={id:d,sourceLayerIndex:f,index:p,geometry:g?x.geometry:qn(o),properties:o.properties,type:o.type,patterns:{}};this.hasPattern?this.features.push(Zc("fill-extrusion",this.layers,w,this.zoom,r)):this.addFeature(w,w.geometry,p,s,{}),r.featureIndex.insert(o,w.geometry,p,f,this.index,!0)}}addFeatures(e,r,s){for(const o of this.features){const{geometry:d}=o;this.addFeature(o,d,o.index,r,s)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,op),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,ap.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,s,o,d){const p={x:0,y:0,vertexCount:0};for(const f of jc(r,500)){let g=0;for(const L of f)g+=L.length;let x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const L of f){if(L.length===0||_p(L))continue;let V=0;for(let G=0;G<L.length;G++){const X=L[G];if(G>=1){const se=L[G-1];if(!gp(X,se)){x.vertexLength+4>Ke.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Y=X.sub(se)._perp()._unit(),te=se.dist(X);V+te>32768&&(V=0),qo(this.layoutVertexArray,X.x,X.y,Y.x,Y.y,0,0,V),qo(this.layoutVertexArray,X.x,X.y,Y.x,Y.y,0,1,V),p.x+=2*X.x,p.y+=2*X.y,p.vertexCount+=2,V+=te,qo(this.layoutVertexArray,se.x,se.y,Y.x,Y.y,0,0,V),qo(this.layoutVertexArray,se.x,se.y,Y.x,Y.y,0,1,V),p.x+=2*se.x,p.y+=2*se.y,p.vertexCount+=2;const pe=x.vertexLength;this.indexArray.emplaceBack(pe,pe+2,pe+1),this.indexArray.emplaceBack(pe+1,pe+2,pe+3),x.vertexLength+=4,x.primitiveLength+=2}}}}if(x.vertexLength+g>Ke.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray)),mp[e.type]!=="Polygon")continue;const w=[],T=[],k=x.vertexLength;for(const L of f)if(L.length!==0){L!==f[0]&&T.push(w.length/2);for(let V=0;V<L.length;V++){const G=L[V];qo(this.layoutVertexArray,G.x,G.y,0,0,1,1,0),p.x+=G.x,p.y+=G.y,p.vertexCount+=1,w.push(G.x),w.push(G.y)}}const z=qh(w,T);for(let L=0;L<z.length;L+=3)this.indexArray.emplaceBack(k+z[L],k+z[L+2],k+z[L+1]);x.primitiveLength+=z.length/3,x.vertexLength+=g}for(let f=0;f<p.vertexCount;f++)this.centroidVertexArray.emplaceBack(Math.floor(p.x/p.vertexCount),Math.floor(p.y/p.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,o)}}function gp(i,e){return i.x===e.x&&(i.x<0||i.x>ri)||i.y===e.y&&(i.y<0||i.y>ri)}function _p(i){return i.every(e=>e.x<0)||i.every(e=>e.x>ri)||i.every(e=>e.y<0)||i.every(e=>e.y>ri)}let Yh;Fe("FillExtrusionBucket",Wc,{omit:["layers","features"]});var yp={get paint(){return Yh=Yh||new Qi({"fill-extrusion-opacity":new qe(de["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Je(de["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new qe(de["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new qe(de["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new cs(de["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Je(de["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Je(de["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new qe(de["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class xp extends qr{constructor(e){super(e,yp)}createBucket(e){return new Wc(e)}queryRadius(){return Zl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,s,o,d,p,f,g){const x=Gl(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,f),w=this.paint.get("fill-extrusion-height").evaluate(r,s),T=this.paint.get("fill-extrusion-base").evaluate(r,s),k=function(L,V,G,X){const se=[];for(const Y of L){const te=[Y.x,Y.y,0,1];Hl(te,te,V),se.push(new re(te[0]/te[3],te[1]/te[3]))}return se}(x,g),z=function(L,V,G,X){const se=[],Y=[],te=X[8]*V,pe=X[9]*V,ye=X[10]*V,Re=X[11]*V,Ne=X[8]*G,Le=X[9]*G,Pe=X[10]*G,Ce=X[11]*G;for(const Ve of L){const Ae=[],we=[];for(const He of Ve){const Ze=He.x,dt=He.y,qt=X[0]*Ze+X[4]*dt+X[12],Ht=X[1]*Ze+X[5]*dt+X[13],Ai=X[2]*Ze+X[6]*dt+X[14],Fr=X[3]*Ze+X[7]*dt+X[15],fr=Ai+ye,vi=Fr+Re,Oi=qt+Ne,Zi=Ht+Le,mr=Ai+Pe,gr=Fr+Ce,ki=new re((qt+te)/vi,(Ht+pe)/vi);ki.z=fr/vi,Ae.push(ki);const Ei=new re(Oi/gr,Zi/gr);Ei.z=mr/gr,we.push(Ei)}se.push(Ae),Y.push(we)}return[se,Y]}(o,T,w,g);return function(L,V,G){let X=1/0;Da(G,V)&&(X=Jh(G,V[0]));for(let se=0;se<V.length;se++){const Y=V[se],te=L[se];for(let pe=0;pe<Y.length-1;pe++){const ye=Y[pe],Re=[ye,Y[pe+1],te[pe+1],te[pe],ye];Ro(G,Re)&&(X=Math.min(X,Jh(G,Re)))}}return X!==1/0&&X}(z[0],z[1],k)}}function Zo(i,e){return i.x*e.x+i.y*e.y}function Jh(i,e){if(i.length===1){let r=0;const s=e[r++];let o;for(;!o||s.equals(o);)if(o=e[r++],!o)return 1/0;for(;r<e.length;r++){const d=e[r],p=i[0],f=o.sub(s),g=d.sub(s),x=p.sub(s),w=Zo(f,f),T=Zo(f,g),k=Zo(g,g),z=Zo(x,f),L=Zo(x,g),V=w*k-T*T,G=(k*z-T*L)/V,X=(w*L-T*z)/V,se=s.z*(1-G-X)+o.z*G+d.z*X;if(isFinite(se))return se}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}const vp=oi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:bp}=vp,wp=oi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Sp}=wp,Tp=ps.VectorTileFeature.types,Ip=Math.cos(Math.PI/180*37.5),$h=Math.pow(2,14)/.5;class Xc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new U,this.layoutVertexArray2=new $,this.indexArray=new be,this.programConfigurations=new Bi(e.layers,e.zoom),this.segments=new Ke,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=qc("line",this.layers,r);const o=this.layers[0].layout.get("line-sort-key"),d=!o.isConstant(),p=[];for(const{feature:f,id:g,index:x,sourceLayerIndex:w}of e){const T=this.layers[0]._featureFilter.needGeometry,k=Zn(f,T);if(!this.layers[0]._featureFilter.filter(new Ut(this.zoom),k,s))continue;const z=d?o.evaluate(k,{},s):void 0,L={id:g,properties:f.properties,type:f.type,sourceLayerIndex:w,index:x,geometry:T?k.geometry:qn(f),patterns:{},sortKey:z};p.push(L)}d&&p.sort((f,g)=>f.sortKey-g.sortKey);for(const f of p){const{geometry:g,index:x,sourceLayerIndex:w}=f;if(this.hasPattern){const T=Zc("line",this.layers,f,this.zoom,r);this.patternFeatures.push(T)}else this.addFeature(f,g,x,s,{});r.featureIndex.insert(e[x].feature,g,x,w,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Sp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bp),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,o,d){const p=this.layers[0].layout,f=p.get("line-join").evaluate(e,{}),g=p.get("line-cap"),x=p.get("line-miter-limit"),w=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const T of r)this.addLine(T,e,f,g,x,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,o)}addLine(e,r,s,o,d,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<e.length-1;X++)this.totalDistance+=e[X].dist(e[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const f=Tp[r.type]==="Polygon";let g=e.length;for(;g>=2&&e[g-1].equals(e[g-2]);)g--;let x=0;for(;x<g-1&&e[x].equals(e[x+1]);)x++;if(g<(f?3:2))return;s==="bevel"&&(d=1.05);const w=this.overscaling<=16?15*ri/(512*this.overscaling):0,T=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray);let k,z,L,V,G;this.e1=this.e2=-1,f&&(k=e[g-2],G=e[x].sub(k)._unit()._perp());for(let X=x;X<g;X++){if(L=X===g-1?f?e[x+1]:void 0:e[X+1],L&&e[X].equals(L))continue;G&&(V=G),k&&(z=k),k=e[X],G=L?L.sub(k)._unit()._perp():V,V=V||G;let se=V.add(G);se.x===0&&se.y===0||se._unit();const Y=V.x*G.x+V.y*G.y,te=se.x*G.x+se.y*G.y,pe=te!==0?1/te:1/0,ye=2*Math.sqrt(2-2*te),Re=te<Ip&&z&&L,Ne=V.x*G.y-V.y*G.x>0;if(Re&&X>x){const Ce=k.dist(z);if(Ce>2*w){const Ve=k.sub(k.sub(z)._mult(w/Ce)._round());this.updateDistance(z,Ve),this.addCurrentVertex(Ve,V,0,0,T),z=Ve}}const Le=z&&L;let Pe=Le?s:f?"butt":o;if(Le&&Pe==="round"&&(pe<p?Pe="miter":pe<=2&&(Pe="fakeround")),Pe==="miter"&&pe>d&&(Pe="bevel"),Pe==="bevel"&&(pe>2&&(Pe="flipbevel"),pe<d&&(Pe="miter")),z&&this.updateDistance(z,k),Pe==="miter")se._mult(pe),this.addCurrentVertex(k,se,0,0,T);else if(Pe==="flipbevel"){if(pe>100)se=G.mult(-1);else{const Ce=pe*V.add(G).mag()/V.sub(G).mag();se._perp()._mult(Ce*(Ne?-1:1))}this.addCurrentVertex(k,se,0,0,T),this.addCurrentVertex(k,se.mult(-1),0,0,T)}else if(Pe==="bevel"||Pe==="fakeround"){const Ce=-Math.sqrt(pe*pe-1),Ve=Ne?Ce:0,Ae=Ne?0:Ce;if(z&&this.addCurrentVertex(k,V,Ve,Ae,T),Pe==="fakeround"){const we=Math.round(180*ye/Math.PI/20);for(let He=1;He<we;He++){let Ze=He/we;if(Ze!==.5){const qt=Ze-.5;Ze+=Ze*qt*(Ze-1)*((1.0904+Y*(Y*(3.55645-1.43519*Y)-3.2452))*qt*qt+(.848013+Y*(.215638*Y-1.06021)))}const dt=G.sub(V)._mult(Ze)._add(V)._unit()._mult(Ne?-1:1);this.addHalfVertex(k,dt.x,dt.y,!1,Ne,0,T)}}L&&this.addCurrentVertex(k,G,-Ve,-Ae,T)}else if(Pe==="butt")this.addCurrentVertex(k,se,0,0,T);else if(Pe==="square"){const Ce=z?1:-1;this.addCurrentVertex(k,se,Ce,Ce,T)}else Pe==="round"&&(z&&(this.addCurrentVertex(k,V,0,0,T),this.addCurrentVertex(k,V,1,1,T,!0)),L&&(this.addCurrentVertex(k,G,-1,-1,T,!0),this.addCurrentVertex(k,G,0,0,T)));if(Re&&X<g-1){const Ce=k.dist(L);if(Ce>2*w){const Ve=k.add(L.sub(k)._mult(w/Ce)._round());this.updateDistance(k,Ve),this.addCurrentVertex(Ve,G,0,0,T),k=Ve}}}}addCurrentVertex(e,r,s,o,d,p=!1){const f=r.y*o-r.x,g=-r.y-r.x*o;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,p,!1,s,d),this.addHalfVertex(e,f,g,p,!0,-o,d),this.distance>$h/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,s,o,d,p))}addHalfVertex({x:e,y:r},s,o,d,p,f,g){const x=.5*(this.lineClips?this.scaledDistance*($h-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(r<<1)+(p?1:0),Math.round(63*s)+128,Math.round(63*o)+128,1+(f===0?0:f<0?-1:1)|(63&x)<<2,x>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const w=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),g.primitiveLength++),p?this.e2=w:this.e1=w}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let Qh,eu;Fe("LineBucket",Xc,{omit:["layers","patternFeatures"]});var tu={get paint(){return eu=eu||new Qi({"line-opacity":new Je(de.paint_line["line-opacity"]),"line-color":new Je(de.paint_line["line-color"]),"line-translate":new qe(de.paint_line["line-translate"]),"line-translate-anchor":new qe(de.paint_line["line-translate-anchor"]),"line-width":new Je(de.paint_line["line-width"]),"line-gap-width":new Je(de.paint_line["line-gap-width"]),"line-offset":new Je(de.paint_line["line-offset"]),"line-blur":new Je(de.paint_line["line-blur"]),"line-dasharray":new bo(de.paint_line["line-dasharray"]),"line-pattern":new cs(de.paint_line["line-pattern"]),"line-gradient":new wo(de.paint_line["line-gradient"])})},get layout(){return Qh=Qh||new Qi({"line-cap":new qe(de.layout_line["line-cap"]),"line-join":new Je(de.layout_line["line-join"]),"line-miter-limit":new qe(de.layout_line["line-miter-limit"]),"line-round-limit":new qe(de.layout_line["line-round-limit"]),"line-sort-key":new Je(de.layout_line["line-sort-key"])})}};class Cp extends Je{possiblyEvaluate(e,r){return r=new Ut(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,s,o){return r=It({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,s,o)}}let Jl;class Ap extends qr{constructor(e){super(e,tu),this.gradientVersion=0,Jl||(Jl=new Cp(tu.paint.properties["line-width"].specification),Jl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Ms,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Jl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Xc(e)}queryRadius(e){const r=e,s=iu(Bo("line-width",this,r),Bo("line-gap-width",this,r)),o=Bo("line-offset",this,r);return s/2+Math.abs(o)+Zl(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,s,o,d,p,f){const g=Gl(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,f),x=f/2*iu(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),w=this.paint.get("line-offset").evaluate(r,s);return w&&(o=function(T,k){const z=[];for(let L=0;L<T.length;L++){const V=T[L],G=[];for(let X=0;X<V.length;X++){const se=V[X-1],Y=V[X],te=V[X+1],pe=X===0?new re(0,0):Y.sub(se)._unit()._perp(),ye=X===V.length-1?new re(0,0):te.sub(Y)._unit()._perp(),Re=pe._add(ye)._unit(),Ne=Re.x*ye.x+Re.y*ye.y;Ne!==0&&Re._mult(1/Ne),G.push(Re._mult(k)._add(Y))}z.push(G)}return z}(o,w*f)),function(T,k,z){for(let L=0;L<k.length;L++){const V=k[L];if(T.length>=3){for(let G=0;G<V.length;G++)if(La(T,V[G]))return!0}if(ql(T,V,z))return!0}return!1}(g,o,x)}isTileClipped(){return!0}}function iu(i,e){return e>0?e+2*i:i}const kp=oi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ep=oi([{name:"a_projected_pos",components:3,type:"Float32"}],4);oi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Mp=oi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);oi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ru=oi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Pp=oi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function zp(i,e,r){return i.sections.forEach(s=>{s.text=function(o,d,p){const f=d.layout.get("text-transform").evaluate(p,{});return f==="uppercase"?o=o.toLocaleUpperCase():f==="lowercase"&&(o=o.toLocaleLowerCase()),Vn.applyArabicShaping&&(o=Vn.applyArabicShaping(o)),o}(s.text,e,r)}),i}oi([{name:"triangle",components:3,type:"Uint16"}]),oi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),oi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),oi([{type:"Float32",name:"offsetX"}]),oi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),oi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Go={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Ci=24,nu=Lt,su=function(i,e,r,s,o){var d,p,f=8*o-s-1,g=(1<<f)-1,x=g>>1,w=-7,T=r?o-1:0,k=r?-1:1,z=i[e+T];for(T+=k,d=z&(1<<-w)-1,z>>=-w,w+=f;w>0;d=256*d+i[e+T],T+=k,w-=8);for(p=d&(1<<-w)-1,d>>=-w,w+=s;w>0;p=256*p+i[e+T],T+=k,w-=8);if(d===0)d=1-x;else{if(d===g)return p?NaN:1/0*(z?-1:1);p+=Math.pow(2,s),d-=x}return(z?-1:1)*p*Math.pow(2,d-s)},au=function(i,e,r,s,o,d){var p,f,g,x=8*d-o-1,w=(1<<x)-1,T=w>>1,k=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=s?0:d-1,L=s?1:-1,V=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,p=w):(p=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-p))<1&&(p--,g*=2),(e+=p+T>=1?k/g:k*Math.pow(2,1-T))*g>=2&&(p++,g/=2),p+T>=w?(f=0,p=w):p+T>=1?(f=(e*g-1)*Math.pow(2,o),p+=T):(f=e*Math.pow(2,T-1)*Math.pow(2,o),p=0));o>=8;i[r+z]=255&f,z+=L,f/=256,o-=8);for(p=p<<o|f,x+=o;x>0;i[r+z]=255&p,z+=L,p/=256,x-=8);i[r+z-L]|=128*V};function Lt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Lt.Varint=0,Lt.Fixed64=1,Lt.Bytes=2,Lt.Fixed32=5;var Kc=4294967296,ou=1/Kc,lu=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Gn(i){return i.type===Lt.Bytes?i.readVarint()+i.pos:i.pos+1}function Oa(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function cu(i,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var o=r.pos-1;o>=i;o--)r.buf[o+s]=r.buf[o]}function Dp(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Lp(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Rp(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Bp(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Fp(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Op(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Vp(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Up(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Np(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function $l(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Va(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function hu(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Lt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),o=s>>3,d=this.pos;this.type=7&s,i(o,e,this),this.pos===d&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=$l(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=hu(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=$l(this.buf,this.pos)+$l(this.buf,this.pos+4)*Kc;return this.pos+=8,i},readSFixed64:function(){var i=$l(this.buf,this.pos)+hu(this.buf,this.pos+4)*Kc;return this.pos+=8,i},readFloat:function(){var i=su(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=su(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(o,d,p){var f,g,x=p.buf;if(f=(112&(g=x[p.pos++]))>>4,g<128||(f|=(127&(g=x[p.pos++]))<<3,g<128)||(f|=(127&(g=x[p.pos++]))<<10,g<128)||(f|=(127&(g=x[p.pos++]))<<17,g<128)||(f|=(127&(g=x[p.pos++]))<<24,g<128)||(f|=(1&(g=x[p.pos++]))<<31,g<128))return Oa(o,f,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&lu?function(r,s,o){return lu.decode(r.subarray(s,o))}(this.buf,e,i):function(r,s,o){for(var d="",p=s;p<o;){var f,g,x,w=r[p],T=null,k=w>239?4:w>223?3:w>191?2:1;if(p+k>o)break;k===1?w<128&&(T=w):k===2?(192&(f=r[p+1]))==128&&(T=(31&w)<<6|63&f)<=127&&(T=null):k===3?(g=r[p+2],(192&(f=r[p+1]))==128&&(192&g)==128&&((T=(15&w)<<12|(63&f)<<6|63&g)<=2047||T>=55296&&T<=57343)&&(T=null)):k===4&&(g=r[p+2],x=r[p+3],(192&(f=r[p+1]))==128&&(192&g)==128&&(192&x)==128&&((T=(15&w)<<18|(63&f)<<12|(63&g)<<6|63&x)<=65535||T>=1114112)&&(T=null)),T===null?(T=65533,k=1):T>65535&&(T-=65536,d+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),d+=String.fromCharCode(T),p+=k}return d}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Lt.Bytes)return i.push(this.readVarint(e));var r=Gn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Lt.Bytes)return i.push(this.readSVarint());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Lt.Bytes)return i.push(this.readBoolean());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Lt.Bytes)return i.push(this.readFloat());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Lt.Bytes)return i.push(this.readDouble());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Lt.Bytes)return i.push(this.readFixed32());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Lt.Bytes)return i.push(this.readSFixed32());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Lt.Bytes)return i.push(this.readFixed64());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Lt.Bytes)return i.push(this.readSFixed64());var e=Gn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Lt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Lt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Lt.Fixed32)this.pos+=4;else{if(e!==Lt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Va(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Va(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Va(this.buf,-1&i,this.pos),Va(this.buf,Math.floor(i*ou),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Va(this.buf,-1&i,this.pos),Va(this.buf,Math.floor(i*ou),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var s,o;if(e>=0?(s=e%4294967296|0,o=e/4294967296|0):(o=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,o=o+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(d,p,f){f.buf[f.pos++]=127&d|128,d>>>=7,f.buf[f.pos++]=127&d|128,d>>>=7,f.buf[f.pos++]=127&d|128,d>>>=7,f.buf[f.pos++]=127&d|128,f.buf[f.pos]=127&(d>>>=7)}(s,0,r),function(d,p){var f=(7&d)<<4;p.buf[p.pos++]|=f|((d>>>=3)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d)))))}(o,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,o,d){for(var p,f,g=0;g<o.length;g++){if((p=o.charCodeAt(g))>55295&&p<57344){if(!f){p>56319||g+1===o.length?(s[d++]=239,s[d++]=191,s[d++]=189):f=p;continue}if(p<56320){s[d++]=239,s[d++]=191,s[d++]=189,f=p;continue}p=f-55296<<10|p-56320|65536,f=null}else f&&(s[d++]=239,s[d++]=191,s[d++]=189,f=null);p<128?s[d++]=p:(p<2048?s[d++]=p>>6|192:(p<65536?s[d++]=p>>12|224:(s[d++]=p>>18|240,s[d++]=p>>12&63|128),s[d++]=p>>6&63|128),s[d++]=63&p|128)}return d}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&cu(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),au(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),au(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var s=this.pos-r;s>=128&&cu(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,r){this.writeTag(i,Lt.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Dp,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Lp,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Fp,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Rp,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Bp,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Op,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Vp,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Up,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Np,e)},writeBytesField:function(i,e){this.writeTag(i,Lt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Lt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Lt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Lt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Lt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Lt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Lt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Lt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Lt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Lt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Yc=le(nu);const Jc=3;function jp(i,e,r){i===1&&r.readMessage(qp,e)}function qp(i,e,r){if(i===3){const{id:s,bitmap:o,width:d,height:p,left:f,top:g,advance:x}=r.readMessage(Zp,{});e.push({id:s,bitmap:new Oo({width:d+2*Jc,height:p+2*Jc},o),metrics:{width:d,height:p,left:f,top:g,advance:x}})}}function Zp(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const uu=Jc;function du(i){let e=0,r=0;for(const p of i)e+=p.w*p.h,r=Math.max(r,p.w);i.sort((p,f)=>f.h-p.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let o=0,d=0;for(const p of i)for(let f=s.length-1;f>=0;f--){const g=s[f];if(!(p.w>g.w||p.h>g.h)){if(p.x=g.x,p.y=g.y,d=Math.max(d,p.y+p.h),o=Math.max(o,p.x+p.w),p.w===g.w&&p.h===g.h){const x=s.pop();f<s.length&&(s[f]=x)}else p.h===g.h?(g.x+=p.w,g.w-=p.w):p.w===g.w?(g.y+=p.h,g.h-=p.h):(s.push({x:g.x+p.w,y:g.y,w:g.w-p.w,h:p.h}),g.y+=p.h,g.h-=p.h);break}}return{w:o,h:d,fill:e/(o*d)||0}}const Tr=1;class $c{constructor(e,{pixelRatio:r,version:s,stretchX:o,stretchY:d,content:p}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=o,this.stretchY=d,this.content=p,this.version=s}get tl(){return[this.paddedRect.x+Tr,this.paddedRect.y+Tr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Tr,this.paddedRect.y+this.paddedRect.h-Tr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Tr)/this.pixelRatio,(this.paddedRect.h-2*Tr)/this.pixelRatio]}}class pu{constructor(e,r){const s={},o={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,s,d),this.addImages(r,o,d);const{w:p,h:f}=du(d),g=new Zr({width:p||1,height:f||1});for(const x in e){const w=e[x],T=s[x].paddedRect;Zr.copy(w.data,g,{x:0,y:0},{x:T.x+Tr,y:T.y+Tr},w.data)}for(const x in r){const w=r[x],T=o[x].paddedRect,k=T.x+Tr,z=T.y+Tr,L=w.data.width,V=w.data.height;Zr.copy(w.data,g,{x:0,y:0},{x:k,y:z},w.data),Zr.copy(w.data,g,{x:0,y:V-1},{x:k,y:z-1},{width:L,height:1}),Zr.copy(w.data,g,{x:0,y:0},{x:k,y:z+V},{width:L,height:1}),Zr.copy(w.data,g,{x:L-1,y:0},{x:k-1,y:z},{width:1,height:V}),Zr.copy(w.data,g,{x:0,y:0},{x:k+L,y:z},{width:1,height:V})}this.image=g,this.iconPositions=s,this.patternPositions=o}addImages(e,r,s){for(const o in e){const d=e[o],p={x:0,y:0,w:d.data.width+2*Tr,h:d.data.height+2*Tr};s.push(p),r[o]=new $c(p,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(o)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[o,d]=e.tl;s.update(r.data,void 0,{x:o,y:d})}}var fs;Fe("ImagePosition",$c),Fe("ImageAtlas",pu),b.ah=void 0,(fs=b.ah||(b.ah={}))[fs.none=0]="none",fs[fs.horizontal=1]="horizontal",fs[fs.vertical=2]="vertical",fs[fs.horizontalOnly=3]="horizontalOnly";const Ho=-17;class Wo{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new Wo;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new Wo;return r.imageName=e,r}}class Ua{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new Ua;for(let o=0;o<e.sections.length;o++){const d=e.sections[o];d.image?s.addImageSection(d):s.addTextSection(d,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let s=0;s<e.length;s++){const o=e.charCodeAt(s+1)||null,d=e.charCodeAt(s-1)||null;r+=o&&Ca(o)&&!Go[e[s+1]]||d&&Ca(d)&&!Go[e[s-1]]||!Go[e[s]]?e[s]:Go[e[s]]}return r}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&ec[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&ec[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new Ua;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Wo.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let o=0;o<e.text.length;++o)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Xt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Wo.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Xt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ql(i,e,r,s,o,d,p,f,g,x,w,T,k,z,L,V){const G=Ua.fromFeature(i,o);let X;T===b.ah.vertical&&G.verticalizePunctuation();const{processBidirectionalText:se,processStyledBidirectionalText:Y}=Vn;if(se&&G.sections.length===1){X=[];const ye=se(G.toString(),Qc(G,x,d,e,s,z,L));for(const Re of ye){const Ne=new Ua;Ne.text=Re,Ne.sections=G.sections;for(let Le=0;Le<Re.length;Le++)Ne.sectionIndex.push(0);X.push(Ne)}}else if(Y){X=[];const ye=Y(G.text,G.sectionIndex,Qc(G,x,d,e,s,z,L));for(const Re of ye){const Ne=new Ua;Ne.text=Re[0],Ne.sectionIndex=Re[1],Ne.sections=G.sections,X.push(Ne)}}else X=function(ye,Re){const Ne=[],Le=ye.text;let Pe=0;for(const Ce of Re)Ne.push(ye.substring(Pe,Ce)),Pe=Ce;return Pe<Le.length&&Ne.push(ye.substring(Pe,Le.length)),Ne}(G,Qc(G,x,d,e,s,z,L));const te=[],pe={positionedLines:te,text:G.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:T,iconsInText:!1,verticalizable:!1};return function(ye,Re,Ne,Le,Pe,Ce,Ve,Ae,we,He,Ze,dt){let qt=0,Ht=Ho,Ai=0,Fr=0;const fr=Ae==="right"?1:Ae==="left"?0:.5;let vi=0;for(const ki of Pe){ki.trim();const Ei=ki.getMaxScale(),ir=(Ei-1)*Ci,_r={positionedGlyphs:[],lineOffset:0};ye.positionedLines[vi]=_r;const rr=_r.positionedGlyphs;let Ir=0;if(!ki.length()){Ht+=Ce,++vi;continue}for(let Mi=0;Mi<ki.length();Mi++){const yt=ki.getSection(Mi),nr=ki.getSectionIndex(Mi),Gi=ki.getCharCode(Mi);let Pi=0,rn=null,hn=null,un=null,Hn=Ci;const nn=!(we===b.ah.horizontal||!Ze&&!Ia(Gi)||Ze&&(ec[Gi]||(Oi=Gi,ze.Arabic(Oi)||ze["Arabic Supplement"](Oi)||ze["Arabic Extended-A"](Oi)||ze["Arabic Presentation Forms-A"](Oi)||ze["Arabic Presentation Forms-B"](Oi))));if(yt.imageName){const Hr=Le[yt.imageName];if(!Hr)continue;un=yt.imageName,ye.iconsInText=ye.iconsInText||!0,hn=Hr.paddedRect;const Ar=Hr.displaySize;yt.scale=yt.scale*Ci/dt,rn={width:Ar[0],height:Ar[1],left:Tr,top:-uu,advance:nn?Ar[1]:Ar[0]},Pi=ir+(Ci-Ar[1]*yt.scale),Hn=rn.advance;const Wn=nn?Ar[0]*yt.scale-Ci*Ei:Ar[1]*yt.scale-Ci*Ei;Wn>0&&Wn>Ir&&(Ir=Wn)}else{const Hr=Ne[yt.fontStack],Ar=Hr&&Hr[Gi];if(Ar&&Ar.rect)hn=Ar.rect,rn=Ar.metrics;else{const Wn=Re[yt.fontStack],$o=Wn&&Wn[Gi];if(!$o)continue;rn=$o.metrics}Pi=(Ei-yt.scale)*Ci}nn?(ye.verticalizable=!0,rr.push({glyph:Gi,imageName:un,x:qt,y:Ht+Pi,vertical:nn,scale:yt.scale,fontStack:yt.fontStack,sectionIndex:nr,metrics:rn,rect:hn}),qt+=Hn*yt.scale+He):(rr.push({glyph:Gi,imageName:un,x:qt,y:Ht+Pi,vertical:nn,scale:yt.scale,fontStack:yt.fontStack,sectionIndex:nr,metrics:rn,rect:hn}),qt+=rn.advance*yt.scale+He)}rr.length!==0&&(Ai=Math.max(qt-He,Ai),Wp(rr,0,rr.length-1,fr,Ir)),qt=0;const Cr=Ce*Ei+Ir;_r.lineOffset=Math.max(Ir,ir),Ht+=Cr,Fr=Math.max(Cr,Fr),++vi}var Oi;const Zi=Ht-Ho,{horizontalAlign:mr,verticalAlign:gr}=eh(Ve);(function(ki,Ei,ir,_r,rr,Ir,Cr,Mi,yt){const nr=(Ei-ir)*rr;let Gi=0;Gi=Ir!==Cr?-Mi*_r-Ho:(-_r*yt+.5)*Cr;for(const Pi of ki)for(const rn of Pi.positionedGlyphs)rn.x+=nr,rn.y+=Gi})(ye.positionedLines,fr,mr,gr,Ai,Fr,Ce,Zi,Pe.length),ye.top+=-gr*Zi,ye.bottom=ye.top+Zi,ye.left+=-mr*Ai,ye.right=ye.left+Ai}(pe,e,r,s,X,p,f,g,T,x,k,V),!function(ye){for(const Re of ye)if(Re.positionedGlyphs.length!==0)return!1;return!0}(te)&&pe}const ec={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Gp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function fu(i,e,r,s,o,d){if(e.imageName){const p=s[e.imageName];return p?p.displaySize[0]*e.scale*Ci/d+o:0}{const p=r[e.fontStack],f=p&&p[i];return f?f.metrics.advance*e.scale+o:0}}function mu(i,e,r,s){const o=Math.pow(i-e,2);return s?i<e?o/2:2*o:o+Math.abs(r)*r}function Hp(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function gu(i,e,r,s,o,d){let p=null,f=mu(e,r,o,d);for(const g of s){const x=mu(e-g.x,r,o,d)+g.badness;x<=f&&(p=g,f=x)}return{index:i,x:e,priorBreak:p,badness:f}}function _u(i){return i?_u(i.priorBreak).concat(i.index):[]}function Qc(i,e,r,s,o,d,p){if(d!=="point")return[];if(!i)return[];const f=[],g=function(k,z,L,V,G,X){let se=0;for(let Y=0;Y<k.length();Y++){const te=k.getSection(Y);se+=fu(k.getCharCode(Y),te,V,G,z,X)}return se/Math.max(1,Math.ceil(se/L))}(i,e,r,s,o,p),x=i.text.indexOf("​")>=0;let w=0;for(let k=0;k<i.length();k++){const z=i.getSection(k),L=i.getCharCode(k);if(ec[L]||(w+=fu(L,z,s,o,e,p)),k<i.length()-1){const V=!((T=L)<11904||!(ze["Bopomofo Extended"](T)||ze.Bopomofo(T)||ze["CJK Compatibility Forms"](T)||ze["CJK Compatibility Ideographs"](T)||ze["CJK Compatibility"](T)||ze["CJK Radicals Supplement"](T)||ze["CJK Strokes"](T)||ze["CJK Symbols and Punctuation"](T)||ze["CJK Unified Ideographs Extension A"](T)||ze["CJK Unified Ideographs"](T)||ze["Enclosed CJK Letters and Months"](T)||ze["Halfwidth and Fullwidth Forms"](T)||ze.Hiragana(T)||ze["Ideographic Description Characters"](T)||ze["Kangxi Radicals"](T)||ze["Katakana Phonetic Extensions"](T)||ze.Katakana(T)||ze["Vertical Forms"](T)||ze["Yi Radicals"](T)||ze["Yi Syllables"](T)));(Gp[L]||V||z.imageName)&&f.push(gu(k+1,w,g,f,Hp(L,i.getCharCode(k+1),V&&x),!1))}}var T;return _u(gu(i.length(),w,g,f,0,!0))}function eh(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Wp(i,e,r,s,o){if(!s&&!o)return;const d=i[r],p=(i[r].x+d.metrics.advance*d.scale)*s;for(let f=e;f<=r;f++)i[f].x-=p,i[f].y+=o}function Xp(i,e,r){const{horizontalAlign:s,verticalAlign:o}=eh(r),d=e[0]-i.displaySize[0]*s,p=e[1]-i.displaySize[1]*o;return{image:i,top:p,bottom:p+i.displaySize[1],left:d,right:d+i.displaySize[0]}}function yu(i,e,r,s,o,d){const p=i.image;let f;if(p.content){const G=p.content,X=p.pixelRatio||1;f=[G[0]/X,G[1]/X,p.displaySize[0]-G[2]/X,p.displaySize[1]-G[3]/X]}const g=e.left*d,x=e.right*d;let w,T,k,z;r==="width"||r==="both"?(z=o[0]+g-s[3],T=o[0]+x+s[1]):(z=o[0]+(g+x-p.displaySize[0])/2,T=z+p.displaySize[0]);const L=e.top*d,V=e.bottom*d;return r==="height"||r==="both"?(w=o[1]+L-s[0],k=o[1]+V+s[2]):(w=o[1]+(L+V-p.displaySize[1])/2,k=w+p.displaySize[1]),{image:p,top:w,right:T,bottom:k,left:z,collisionPadding:f}}const Xo=255,bn=128,ms=Xo*bn;function xu(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Ut(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:o}=r;let d=0;for(;d<s.length&&s[d]<=i;)d++;d=Math.max(0,d-1);let p=d;for(;p<s.length&&s[p]<i+1;)p++;p=Math.min(s.length-1,p);const f=s[d],g=s[p];return r.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:g,interpolationType:o}:{kind:"camera",minZoom:f,maxZoom:g,minSize:r.evaluate(new Ut(f)),maxSize:r.evaluate(new Ut(g)),interpolationType:o}}}function th(i,e,r){let s="never";const o=i.get(e);return o?s=o:i.get(r)&&(s="always"),s}const Kp=ps.VectorTileFeature.types,Yp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tc(i,e,r,s,o,d,p,f,g,x,w,T,k){const z=f?Math.min(ms,Math.round(f[0])):0,L=f?Math.min(ms,Math.round(f[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*o),d,p,(z<<1)+(g?1:0),L,16*x,16*w,256*T,256*k)}function ih(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function Jp(i){for(const e of i.sections)if(Rl(e.text))return!0;return!1}class rh{constructor(e){this.layoutVertexArray=new W,this.indexArray=new be,this.programConfigurations=e,this.segments=new Ke,this.dynamicLayoutVertexArray=new ie,this.opacityVertexArray=new ue,this.hasVisibleVertices=!1,this.placedSymbolArray=new a}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,o){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Ep.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Yp,!0),this.opacityVertexBuffer.itemSize=1),(s||o)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Fe("SymbolBuffers",rh);class nh{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new Ke,this.collisionVertexArray=new _e}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Mp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Fe("CollisionBuffers",nh);class Na{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Rc([]),this.placementViewportMatrix=Rc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=xu(this.zoom,r["text-size"]),this.iconSizeData=xu(this.zoom,r["icon-size"]);const s=this.layers[0].layout,o=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=th(s,"text-overlap","text-allow-overlap")!=="never"||th(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!o.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(p=>b.ah[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new rh(new Bi(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new rh(new Bi(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new m,this.lineVertexArray=new _,this.symbolInstances=new u,this.textAnchorOffsets=new v}calculateGlyphDependencies(e,r,s,o,d){for(let p=0;p<e.length;p++)if(r[e.charCodeAt(p)]=!0,(s||o)&&d){const f=Go[e.charAt(p)];f&&(r[f.charCodeAt(0)]=!0)}}populate(e,r,s){const o=this.layers[0],d=o.layout,p=d.get("text-font"),f=d.get("text-field"),g=d.get("icon-image"),x=(f.value.kind!=="constant"||f.value.value instanceof br&&!f.value.value.isEmpty()||f.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),w=g.value.kind!=="constant"||!!g.value.value||Object.keys(g.parameters).length>0,T=d.get("symbol-sort-key");if(this.features=[],!x&&!w)return;const k=r.iconDependencies,z=r.glyphDependencies,L=r.availableImages,V=new Ut(this.zoom);for(const{feature:G,id:X,index:se,sourceLayerIndex:Y}of e){const te=o._featureFilter.needGeometry,pe=Zn(G,te);if(!o._featureFilter.filter(V,pe,s))continue;let ye,Re;if(te||(pe.geometry=qn(G)),x){const Le=o.getValueAndResolveTokens("text-field",pe,s,L),Pe=br.factory(Le);Jp(Pe)&&(this.hasRTLText=!0),(!this.hasRTLText||Vn.getRTLTextPluginStatus()==="unavailable"||this.hasRTLText&&Vn.isParsed())&&(ye=zp(Pe,o,pe))}if(w){const Le=o.getValueAndResolveTokens("icon-image",pe,s,L);Re=Le instanceof Lr?Le:Lr.fromString(Le)}if(!ye&&!Re)continue;const Ne=this.sortFeaturesByKey?T.evaluate(pe,{},s):void 0;if(this.features.push({id:X,text:ye,icon:Re,index:se,sourceLayerIndex:Y,geometry:pe.geometry,properties:G.properties,type:Kp[G.type],sortKey:Ne}),Re&&(k[Re.name]=!0),ye){const Le=p.evaluate(pe,{},s).join(","),Pe=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(b.ah.vertical)>=0;for(const Ce of ye.sections)if(Ce.image)k[Ce.image.name]=!0;else{const Ve=Ta(ye.toString()),Ae=Ce.fontStack||Le,we=z[Ae]=z[Ae]||{};this.calculateGlyphDependencies(Ce.text,we,Pe,this.allowVerticalPlacement,Ve)}}}d.get("symbol-placement")==="line"&&(this.features=function(G){const X={},se={},Y=[];let te=0;function pe(Le){Y.push(G[Le]),te++}function ye(Le,Pe,Ce){const Ve=se[Le];return delete se[Le],se[Pe]=Ve,Y[Ve].geometry[0].pop(),Y[Ve].geometry[0]=Y[Ve].geometry[0].concat(Ce[0]),Ve}function Re(Le,Pe,Ce){const Ve=X[Pe];return delete X[Pe],X[Le]=Ve,Y[Ve].geometry[0].shift(),Y[Ve].geometry[0]=Ce[0].concat(Y[Ve].geometry[0]),Ve}function Ne(Le,Pe,Ce){const Ve=Ce?Pe[0][Pe[0].length-1]:Pe[0][0];return`${Le}:${Ve.x}:${Ve.y}`}for(let Le=0;Le<G.length;Le++){const Pe=G[Le],Ce=Pe.geometry,Ve=Pe.text?Pe.text.toString():null;if(!Ve){pe(Le);continue}const Ae=Ne(Ve,Ce),we=Ne(Ve,Ce,!0);if(Ae in se&&we in X&&se[Ae]!==X[we]){const He=Re(Ae,we,Ce),Ze=ye(Ae,we,Y[He].geometry);delete X[Ae],delete se[we],se[Ne(Ve,Y[Ze].geometry,!0)]=Ze,Y[He].geometry=null}else Ae in se?ye(Ae,we,Ce):we in X?Re(Ae,we,Ce):(pe(Le),X[Ae]=te-1,se[we]=te-1)}return Y.filter(Le=>Le.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((G,X)=>G.sortKey-X.sortKey)}update(e,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let o=e.dist(r[e.segment+1]),d=e.dist(r[e.segment]);const p={};for(let f=e.segment+1;f<r.length;f++)p[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:o},f<r.length-1&&(o+=r[f+1].dist(r[f]));for(let f=e.segment||0;f>=0;f--)p[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:d},f>0&&(d+=r[f-1].dist(r[f]));for(let f=0;f<r.length;f++){const g=p[f];this.lineVertexArray.emplaceBack(g.x,g.y,g.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,o,d,p,f,g,x,w,T,k){const z=e.indexArray,L=e.layoutVertexArray,V=e.segments.prepareSegment(4*r.length,L,z,this.canOverlap?p.sortKey:void 0),G=this.glyphOffsetArray.length,X=V.vertexLength,se=this.allowVerticalPlacement&&f===b.ah.vertical?Math.PI/2:0,Y=p.text&&p.text.sections;for(let te=0;te<r.length;te++){const{tl:pe,tr:ye,bl:Re,br:Ne,tex:Le,pixelOffsetTL:Pe,pixelOffsetBR:Ce,minFontScaleX:Ve,minFontScaleY:Ae,glyphOffset:we,isSDF:He,sectionIndex:Ze}=r[te],dt=V.vertexLength,qt=we[1];tc(L,g.x,g.y,pe.x,qt+pe.y,Le.x,Le.y,s,He,Pe.x,Pe.y,Ve,Ae),tc(L,g.x,g.y,ye.x,qt+ye.y,Le.x+Le.w,Le.y,s,He,Ce.x,Pe.y,Ve,Ae),tc(L,g.x,g.y,Re.x,qt+Re.y,Le.x,Le.y+Le.h,s,He,Pe.x,Ce.y,Ve,Ae),tc(L,g.x,g.y,Ne.x,qt+Ne.y,Le.x+Le.w,Le.y+Le.h,s,He,Ce.x,Ce.y,Ve,Ae),ih(e.dynamicLayoutVertexArray,g,se),z.emplaceBack(dt,dt+1,dt+2),z.emplaceBack(dt+1,dt+2,dt+3),V.vertexLength+=4,V.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(we[0]),te!==r.length-1&&Ze===r[te+1].sectionIndex||e.programConfigurations.populatePaintArrays(L.length,p,p.index,{},k,Y&&Y[Ze])}e.placedSymbolArray.emplaceBack(g.x,g.y,G,this.glyphOffsetArray.length-G,X,x,w,g.segment,s?s[0]:0,s?s[1]:0,o[0],o[1],f,0,!1,0,T)}_addCollisionDebugVertex(e,r,s,o,d,p){return r.emplaceBack(0,0),e.emplaceBack(s.x,s.y,o,d,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,r,s,o,d,p,f){const g=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),x=g.vertexLength,w=d.layoutVertexArray,T=d.collisionVertexArray,k=f.anchorX,z=f.anchorY;this._addCollisionDebugVertex(w,T,p,k,z,new re(e,r)),this._addCollisionDebugVertex(w,T,p,k,z,new re(s,r)),this._addCollisionDebugVertex(w,T,p,k,z,new re(s,o)),this._addCollisionDebugVertex(w,T,p,k,z,new re(e,o)),g.vertexLength+=4;const L=d.indexArray;L.emplaceBack(x,x+1),L.emplaceBack(x+1,x+2),L.emplaceBack(x+2,x+3),L.emplaceBack(x+3,x),g.primitiveLength+=4}addDebugCollisionBoxes(e,r,s,o){for(let d=e;d<r;d++){const p=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,o?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new nh(ce,ru.members,ve),this.iconCollisionBox=new nh(ce,ru.members,ve);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,s,o,d,p,f,g,x){const w={};for(let T=r;T<s;T++){const k=e.get(T);w.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},w.textFeatureIndex=k.featureIndex;break}for(let T=o;T<d;T++){const k=e.get(T);w.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},w.verticalTextFeatureIndex=k.featureIndex;break}for(let T=p;T<f;T++){const k=e.get(T);w.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},w.iconFeatureIndex=k.featureIndex;break}for(let T=g;T<x;T++){const k=e.get(T);w.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},w.verticalIconFeatureIndex=k.featureIndex;break}return w}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),o=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<o;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),o=[],d=[],p=[];for(let f=0;f<this.symbolInstances.length;++f){p.push(f);const g=this.symbolInstances.get(f);o.push(0|Math.round(r*g.anchorX+s*g.anchorY)),d.push(g.featureIndex)}return p.sort((f,g)=>o[f]-o[g]||d[g]-d[f]),p}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((o,d,p)=>{o>=0&&p.indexOf(o)===d&&this.addIndicesForPlacedSymbol(this.text,o)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let vu,bu;Fe("SymbolBucket",Na,{omit:["layers","collisionBoxArray","features","compareText"]}),Na.MAX_GLYPHS=65535,Na.addDynamicAttributes=ih;var sh={get paint(){return bu=bu||new Qi({"icon-opacity":new Je(de.paint_symbol["icon-opacity"]),"icon-color":new Je(de.paint_symbol["icon-color"]),"icon-halo-color":new Je(de.paint_symbol["icon-halo-color"]),"icon-halo-width":new Je(de.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Je(de.paint_symbol["icon-halo-blur"]),"icon-translate":new qe(de.paint_symbol["icon-translate"]),"icon-translate-anchor":new qe(de.paint_symbol["icon-translate-anchor"]),"text-opacity":new Je(de.paint_symbol["text-opacity"]),"text-color":new Je(de.paint_symbol["text-color"],{runtimeType:_i,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Je(de.paint_symbol["text-halo-color"]),"text-halo-width":new Je(de.paint_symbol["text-halo-width"]),"text-halo-blur":new Je(de.paint_symbol["text-halo-blur"]),"text-translate":new qe(de.paint_symbol["text-translate"]),"text-translate-anchor":new qe(de.paint_symbol["text-translate-anchor"])})},get layout(){return vu=vu||new Qi({"symbol-placement":new qe(de.layout_symbol["symbol-placement"]),"symbol-spacing":new qe(de.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new qe(de.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Je(de.layout_symbol["symbol-sort-key"]),"symbol-z-order":new qe(de.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new qe(de.layout_symbol["icon-allow-overlap"]),"icon-overlap":new qe(de.layout_symbol["icon-overlap"]),"icon-ignore-placement":new qe(de.layout_symbol["icon-ignore-placement"]),"icon-optional":new qe(de.layout_symbol["icon-optional"]),"icon-rotation-alignment":new qe(de.layout_symbol["icon-rotation-alignment"]),"icon-size":new Je(de.layout_symbol["icon-size"]),"icon-text-fit":new qe(de.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new qe(de.layout_symbol["icon-text-fit-padding"]),"icon-image":new Je(de.layout_symbol["icon-image"]),"icon-rotate":new Je(de.layout_symbol["icon-rotate"]),"icon-padding":new Je(de.layout_symbol["icon-padding"]),"icon-keep-upright":new qe(de.layout_symbol["icon-keep-upright"]),"icon-offset":new Je(de.layout_symbol["icon-offset"]),"icon-anchor":new Je(de.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new qe(de.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new qe(de.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new qe(de.layout_symbol["text-rotation-alignment"]),"text-field":new Je(de.layout_symbol["text-field"]),"text-font":new Je(de.layout_symbol["text-font"]),"text-size":new Je(de.layout_symbol["text-size"]),"text-max-width":new Je(de.layout_symbol["text-max-width"]),"text-line-height":new qe(de.layout_symbol["text-line-height"]),"text-letter-spacing":new Je(de.layout_symbol["text-letter-spacing"]),"text-justify":new Je(de.layout_symbol["text-justify"]),"text-radial-offset":new Je(de.layout_symbol["text-radial-offset"]),"text-variable-anchor":new qe(de.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Je(de.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Je(de.layout_symbol["text-anchor"]),"text-max-angle":new qe(de.layout_symbol["text-max-angle"]),"text-writing-mode":new qe(de.layout_symbol["text-writing-mode"]),"text-rotate":new Je(de.layout_symbol["text-rotate"]),"text-padding":new qe(de.layout_symbol["text-padding"]),"text-keep-upright":new qe(de.layout_symbol["text-keep-upright"]),"text-transform":new Je(de.layout_symbol["text-transform"]),"text-offset":new Je(de.layout_symbol["text-offset"]),"text-allow-overlap":new qe(de.layout_symbol["text-allow-overlap"]),"text-overlap":new qe(de.layout_symbol["text-overlap"]),"text-ignore-placement":new qe(de.layout_symbol["text-ignore-placement"]),"text-optional":new qe(de.layout_symbol["text-optional"])})}};class wu{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Vi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Fe("FormatSectionOverride",wu,{omit:["defaultValue"]});class ic extends qr{constructor(e){super(e,sh)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const o=[];for(const d of s)o.indexOf(d)<0&&o.push(d);this.layout._values["text-writing-mode"]=o}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,o){const d=this.layout.get(e).evaluate(r,{},s,o),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Bt(p.value)||!d?d:function(f,g){return g.replace(/{([^{}]+)}/g,(x,w)=>f&&w in f?String(f[w]):"")}(r.properties,d)}createBucket(e){return new Na(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of sh.paint.overridableProperties){if(!ic.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new wu(r),o=new Vt(s,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new pa("source",o):new co("composite",o,r.value.zoomStops),this.paint._values[e]=new jr(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&ic.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),o=sh.paint.properties[r];let d=!1;const p=f=>{for(const g of f)if(o.overrides&&o.overrides.hasOverride(g))return void(d=!0)};if(s.value.kind==="constant"&&s.value.value instanceof br)p(s.value.value.sections);else if(s.value.kind==="source"){const f=x=>{d||(x instanceof fn&&xi(x.value)===bi?p(x.value.sections):x instanceof ua?p(x.sections):x.eachChild(f))},g=s.value;g._styleExpression&&f(g._styleExpression.expression)}return d}}let Su;var $p={get paint(){return Su=Su||new Qi({"background-color":new qe(de.paint_background["background-color"]),"background-pattern":new bo(de.paint_background["background-pattern"]),"background-opacity":new qe(de.paint_background["background-opacity"])})}};class Qp extends qr{constructor(e){super(e,$p)}}let Tu;var ef={get paint(){return Tu=Tu||new Qi({"raster-opacity":new qe(de.paint_raster["raster-opacity"]),"raster-hue-rotate":new qe(de.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new qe(de.paint_raster["raster-brightness-min"]),"raster-brightness-max":new qe(de.paint_raster["raster-brightness-max"]),"raster-saturation":new qe(de.paint_raster["raster-saturation"]),"raster-contrast":new qe(de.paint_raster["raster-contrast"]),"raster-resampling":new qe(de.paint_raster["raster-resampling"]),"raster-fade-duration":new qe(de.paint_raster["raster-fade-duration"])})}};class tf extends qr{constructor(e){super(e,ef)}}class rf extends qr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class nf{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const ah=63710088e-1;class gs{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new gs(mi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,o=e.lat*r,d=Math.sin(s)*Math.sin(o)+Math.cos(s)*Math.cos(o)*Math.cos((e.lng-this.lng)*r);return ah*Math.acos(Math.min(d,1))}static convert(e){if(e instanceof gs)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new gs(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new gs(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Iu=2*Math.PI*ah;function Cu(i){return Iu*Math.cos(i*Math.PI/180)}function Au(i){return(180+i)/360}function ku(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Eu(i,e){return i/Cu(e)}function oh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class rc{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=gs.convert(e);return new rc(Au(s.lng),ku(s.lat),Eu(r,s.lat))}toLngLat(){return new gs(360*this.x-180,oh(this.y))}toAltitude(){return this.z*Cu(oh(this.y))}meterInMercatorCoordinateUnits(){return 1/Iu*(e=oh(this.y),1/Math.cos(e*Math.PI/180));var e}}function Mu(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class lh{constructor(e,r,s){if(e<0||e>25||s<0||s>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=s,this.key=Ko(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,s){const o=(p=this.y,f=this.z,g=Mu(256*(d=this.x),256*(p=Math.pow(2,f)-p-1),f),x=Mu(256*(d+1),256*(p+1),f),g[0]+","+g[1]+","+x[0]+","+x[1]);var d,p,f,g,x;const w=function(T,k,z){let L,V="";for(let G=T;G>0;G--)L=1<<G-1,V+=(k&L?1:0)+(z&L?2:0);return V}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,w).replace(/{bbox-epsg-3857}/g,o)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new re((e.x*r-this.x)*ri,(e.y*r-this.y)*ri)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pu{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Ko(e,r.z,r.z,r.x,r.y)}}class Gr{constructor(e,r,s,o,d){if(e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=r,this.canonical=new lh(s,+o,+d),this.key=Ko(r,e,s,o,d)}clone(){return new Gr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Gr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Gr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?Ko(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Ko(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Gr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,o=2*this.canonical.y;return[new Gr(r,this.wrap,r,s,o),new Gr(r,this.wrap,r,s+1,o),new Gr(r,this.wrap,r,s,o+1),new Gr(r,this.wrap,r,s+1,o+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Gr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Gr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new rc(e.x-this.wrap,e.y))}}function Ko(i,e,r,s,o){(i*=2)<0&&(i=-1*i-1);const d=1<<r;return(d*d*i+d*o+s).toString(36)+r.toString(36)+e.toString(36)}Fe("CanonicalTileID",lh),Fe("OverscaledTileID",Gr,{omit:["posMatrix"]});class zu{constructor(e,r,s,o=1,d=1,p=1,f=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void Xt(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const g=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=o,this.greenFactor=d,this.blueFactor=p,this.baseShift=f;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let x=0;x<g;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(g,x)]=this.data[this._idx(g-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,g)]=this.data[this._idx(x,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let x=0;x<g;x++)for(let w=0;w<g;w++){const T=this.get(x,w);T>this.max&&(this.max=T),T<this.min&&(this.min=T)}}get(e,r){const s=new Uint8Array(this.data.buffer),o=4*this._idx(e,r);return this.unpack(s[o],s[o+1],s[o+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,s){return e*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new Zr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let o=r*this.dim,d=r*this.dim+this.dim,p=s*this.dim,f=s*this.dim+this.dim;switch(r){case-1:o=d-1;break;case 1:d=o+1}switch(s){case-1:p=f-1;break;case 1:f=p+1}const g=-r*this.dim,x=-s*this.dim;for(let w=p;w<f;w++)for(let T=o;T<d;T++)this.data[this._idx(T,w)]=e.data[this._idx(T+g,w+x)]}}Fe("DEMData",zu);class Du{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Lu{constructor(e,r,s,o,d){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=s,e._y=o,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Ru{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new On(ri,16,0),this.grid3D=new On(ri,16,0),this.featureIndexArray=new I,this.promoteId=r}insert(e,r,s,o,d,p){const f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,o,d);const g=p?this.grid3D:this.grid;for(let x=0;x<r.length;x++){const w=r[x],T=[1/0,1/0,-1/0,-1/0];for(let k=0;k<w.length;k++){const z=w[k];T[0]=Math.min(T[0],z.x),T[1]=Math.min(T[1],z.y),T[2]=Math.max(T[2],z.x),T[3]=Math.max(T[3],z.y)}T[0]<ri&&T[1]<ri&&T[2]>=0&&T[3]>=0&&g.insert(f,T[0],T[1],T[2],T[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ps.VectorTile(new Yc(this.rawTileData)).layers,this.sourceLayerCoder=new Du(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,s,o){this.loadVTLayers();const d=e.params||{},p=ri/e.tileSize/e.scale,f=_a(d.filter),g=e.queryGeometry,x=e.queryPadding*p,w=Fu(g),T=this.grid.query(w.minX-x,w.minY-x,w.maxX+x,w.maxY+x),k=Fu(e.cameraQueryGeometry),z=this.grid3D.query(k.minX-x,k.minY-x,k.maxX+x,k.maxY+x,(G,X,se,Y)=>function(te,pe,ye,Re,Ne){for(const Pe of te)if(pe<=Pe.x&&ye<=Pe.y&&Re>=Pe.x&&Ne>=Pe.y)return!0;const Le=[new re(pe,ye),new re(pe,Ne),new re(Re,Ne),new re(Re,ye)];if(te.length>2){for(const Pe of Le)if(La(te,Pe))return!0}for(let Pe=0;Pe<te.length-1;Pe++)if(Rd(te[Pe],te[Pe+1],Le))return!0;return!1}(e.cameraQueryGeometry,G-x,X-x,se+x,Y+x));for(const G of z)T.push(G);T.sort(sf);const L={};let V;for(let G=0;G<T.length;G++){const X=T[G];if(X===V)continue;V=X;const se=this.featureIndexArray.get(X);let Y=null;this.loadMatchingFeature(L,se.bucketIndex,se.sourceLayerIndex,se.featureIndex,f,d.layers,d.availableImages,r,s,o,(te,pe,ye)=>(Y||(Y=qn(te)),pe.queryIntersectsFeature(g,te,ye,Y,this.z,e.transform,p,e.pixelPosMatrix)))}return L}loadMatchingFeature(e,r,s,o,d,p,f,g,x,w,T){const k=this.bucketLayerIDs[r];if(p&&!function(G,X){for(let se=0;se<G.length;se++)if(X.indexOf(G[se])>=0)return!0;return!1}(p,k))return;const z=this.sourceLayerCoder.decode(s),L=this.vtLayers[z].feature(o);if(d.needGeometry){const G=Zn(L,!0);if(!d.filter(new Ut(this.tileID.overscaledZ),G,this.tileID.canonical))return}else if(!d.filter(new Ut(this.tileID.overscaledZ),L))return;const V=this.getId(L,z);for(let G=0;G<k.length;G++){const X=k[G];if(p&&p.indexOf(X)<0)continue;const se=g[X];if(!se)continue;let Y={};V&&w&&(Y=w.getState(se.sourceLayer||"_geojsonTileLayer",V));const te=It({},x[X]);te.paint=Bu(te.paint,se.paint,L,Y,f),te.layout=Bu(te.layout,se.layout,L,Y,f);const pe=!T||T(L,se,Y);if(!pe)continue;const ye=new Lu(L,this.z,this.x,this.y,V);ye.layer=te;let Re=e[X];Re===void 0&&(Re=e[X]=[]),Re.push({featureIndex:o,feature:ye,intersectionZ:pe})}}lookupSymbolFeatures(e,r,s,o,d,p,f,g){const x={};this.loadVTLayers();const w=_a(d);for(const T of e)this.loadMatchingFeature(x,s,o,T,w,p,f,g,r);return x}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function Bu(i,e,r,s,o){return Tt(i,(d,p)=>{const f=e instanceof Vs?e.get(p):null;return f&&f.evaluate?f.evaluate(r,s,o):f})}function Fu(i){let e=1/0,r=1/0,s=-1/0,o=-1/0;for(const d of i)e=Math.min(e,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),o=Math.max(o,d.y);return{minX:e,minY:r,maxX:s,maxY:o}}function sf(i,e){return e-i}function Ou(i,e,r,s,o){const d=[];for(let p=0;p<i.length;p++){const f=i[p];let g;for(let x=0;x<f.length-1;x++){let w=f[x],T=f[x+1];w.x<e&&T.x<e||(w.x<e?w=new re(e,w.y+(e-w.x)/(T.x-w.x)*(T.y-w.y))._round():T.x<e&&(T=new re(e,w.y+(e-w.x)/(T.x-w.x)*(T.y-w.y))._round()),w.y<r&&T.y<r||(w.y<r?w=new re(w.x+(r-w.y)/(T.y-w.y)*(T.x-w.x),r)._round():T.y<r&&(T=new re(w.x+(r-w.y)/(T.y-w.y)*(T.x-w.x),r)._round()),w.x>=s&&T.x>=s||(w.x>=s?w=new re(s,w.y+(s-w.x)/(T.x-w.x)*(T.y-w.y))._round():T.x>=s&&(T=new re(s,w.y+(s-w.x)/(T.x-w.x)*(T.y-w.y))._round()),w.y>=o&&T.y>=o||(w.y>=o?w=new re(w.x+(o-w.y)/(T.y-w.y)*(T.x-w.x),o)._round():T.y>=o&&(T=new re(w.x+(o-w.y)/(T.y-w.y)*(T.x-w.x),o)._round()),g&&w.equals(g[g.length-1])||(g=[w],d.push(g)),g.push(T)))))}}return d}Fe("FeatureIndex",Ru,{omit:["rawTileData","sourceLayerCoder"]});class _s extends re{constructor(e,r,s,o){super(e,r),this.angle=s,o!==void 0&&(this.segment=o)}clone(){return new _s(this.x,this.y,this.angle,this.segment)}}function Vu(i,e,r,s,o){if(e.segment===void 0||r===0)return!0;let d=e,p=e.segment+1,f=0;for(;f>-r/2;){if(p--,p<0)return!1;f-=i[p].dist(d),d=i[p]}f+=i[p].dist(i[p+1]),p++;const g=[];let x=0;for(;f<r/2;){const w=i[p],T=i[p+1];if(!T)return!1;let k=i[p-1].angleTo(w)-w.angleTo(T);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:f,angleDelta:k}),x+=k;f-g[0].distance>s;)x-=g.shift().angleDelta;if(x>o)return!1;p++,f+=w.dist(T)}return!0}function Uu(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Nu(i,e,r){return i?.6*e*r:0}function ju(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function af(i,e,r,s,o,d){const p=Nu(r,o,d),f=ju(r,s)*d;let g=0;const x=Uu(i)/2;for(let w=0;w<i.length-1;w++){const T=i[w],k=i[w+1],z=T.dist(k);if(g+z>x){const L=(x-g)/z,V=Ji.number(T.x,k.x,L),G=Ji.number(T.y,k.y,L),X=new _s(V,G,k.angleTo(T),w);return X._round(),!p||Vu(i,X,f,p,e)?X:void 0}g+=z}}function of(i,e,r,s,o,d,p,f,g){const x=Nu(s,d,p),w=ju(s,o),T=w*p,k=i[0].x===0||i[0].x===g||i[0].y===0||i[0].y===g;return e-T<e/4&&(e=T+e/4),qu(i,k?e/2*f%e:(w/2+2*d)*p*f%e,e,x,r,T,k,!1,g)}function qu(i,e,r,s,o,d,p,f,g){const x=d/2,w=Uu(i);let T=0,k=e-r,z=[];for(let L=0;L<i.length-1;L++){const V=i[L],G=i[L+1],X=V.dist(G),se=G.angleTo(V);for(;k+r<T+X;){k+=r;const Y=(k-T)/X,te=Ji.number(V.x,G.x,Y),pe=Ji.number(V.y,G.y,Y);if(te>=0&&te<g&&pe>=0&&pe<g&&k-x>=0&&k+x<=w){const ye=new _s(te,pe,se,L);ye._round(),s&&!Vu(i,ye,d,s,o)||z.push(ye)}}T+=X}return f||z.length||p||(z=qu(i,T/2,r,s,o,d,p,!0,g)),z}Fe("Anchor",_s);const ja=Tr;function Zu(i,e,r,s){const o=[],d=i.image,p=d.pixelRatio,f=d.paddedRect.w-2*ja,g=d.paddedRect.h-2*ja,x=i.right-i.left,w=i.bottom-i.top,T=d.stretchX||[[0,f]],k=d.stretchY||[[0,g]],z=(Ce,Ve)=>Ce+Ve[1]-Ve[0],L=T.reduce(z,0),V=k.reduce(z,0),G=f-L,X=g-V;let se=0,Y=L,te=0,pe=V,ye=0,Re=G,Ne=0,Le=X;if(d.content&&s){const Ce=d.content;se=nc(T,0,Ce[0]),te=nc(k,0,Ce[1]),Y=nc(T,Ce[0],Ce[2]),pe=nc(k,Ce[1],Ce[3]),ye=Ce[0]-se,Ne=Ce[1]-te,Re=Ce[2]-Ce[0]-Y,Le=Ce[3]-Ce[1]-pe}const Pe=(Ce,Ve,Ae,we)=>{const He=sc(Ce.stretch-se,Y,x,i.left),Ze=ac(Ce.fixed-ye,Re,Ce.stretch,L),dt=sc(Ve.stretch-te,pe,w,i.top),qt=ac(Ve.fixed-Ne,Le,Ve.stretch,V),Ht=sc(Ae.stretch-se,Y,x,i.left),Ai=ac(Ae.fixed-ye,Re,Ae.stretch,L),Fr=sc(we.stretch-te,pe,w,i.top),fr=ac(we.fixed-Ne,Le,we.stretch,V),vi=new re(He,dt),Oi=new re(Ht,dt),Zi=new re(Ht,Fr),mr=new re(He,Fr),gr=new re(Ze/p,qt/p),ki=new re(Ai/p,fr/p),Ei=e*Math.PI/180;if(Ei){const rr=Math.sin(Ei),Ir=Math.cos(Ei),Cr=[Ir,-rr,rr,Ir];vi._matMult(Cr),Oi._matMult(Cr),mr._matMult(Cr),Zi._matMult(Cr)}const ir=Ce.stretch+Ce.fixed,_r=Ve.stretch+Ve.fixed;return{tl:vi,tr:Oi,bl:mr,br:Zi,tex:{x:d.paddedRect.x+ja+ir,y:d.paddedRect.y+ja+_r,w:Ae.stretch+Ae.fixed-ir,h:we.stretch+we.fixed-_r},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gr,pixelOffsetBR:ki,minFontScaleX:Re/p/x,minFontScaleY:Le/p/w,isSDF:r}};if(s&&(d.stretchX||d.stretchY)){const Ce=Gu(T,G,L),Ve=Gu(k,X,V);for(let Ae=0;Ae<Ce.length-1;Ae++){const we=Ce[Ae],He=Ce[Ae+1];for(let Ze=0;Ze<Ve.length-1;Ze++)o.push(Pe(we,Ve[Ze],He,Ve[Ze+1]))}}else o.push(Pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:g+1}));return o}function nc(i,e,r){let s=0;for(const o of i)s+=Math.max(e,Math.min(r,o[1]))-Math.max(e,Math.min(r,o[0]));return s}function Gu(i,e,r){const s=[{fixed:-ja,stretch:0}];for(const[o,d]of i){const p=s[s.length-1];s.push({fixed:o-p.stretch,stretch:p.stretch}),s.push({fixed:o-p.stretch,stretch:p.stretch+(d-o)})}return s.push({fixed:e+ja,stretch:r}),s}function sc(i,e,r,s){return i/e*r+s}function ac(i,e,r,s){return i-e*r/s}class oc{constructor(e,r,s,o,d,p,f,g,x,w){if(this.boxStartIndex=e.length,x){let T=p.top,k=p.bottom;const z=p.collisionPadding;z&&(T-=z[1],k+=z[3]);let L=k-T;L>0&&(L=Math.max(10,L),this.circleDiameter=L)}else{let T=p.top*f-g[0],k=p.bottom*f+g[2],z=p.left*f-g[3],L=p.right*f+g[1];const V=p.collisionPadding;if(V&&(z-=V[0]*f,T-=V[1]*f,L+=V[2]*f,k+=V[3]*f),w){const G=new re(z,T),X=new re(L,T),se=new re(z,k),Y=new re(L,k),te=w*Math.PI/180;G._rotate(te),X._rotate(te),se._rotate(te),Y._rotate(te),z=Math.min(G.x,X.x,se.x,Y.x),L=Math.max(G.x,X.x,se.x,Y.x),T=Math.min(G.y,X.y,se.y,Y.y),k=Math.max(G.y,X.y,se.y,Y.y)}e.emplaceBack(r.x,r.y,z,T,L,k,s,o,d)}this.boxEndIndex=e.length}}class lf{constructor(e=[],r=cf){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,o=r[e];for(;e>0;){const d=e-1>>1,p=r[d];if(s(o,p)>=0)break;r[e]=p,e=d}r[e]=o}_down(e){const{data:r,compare:s}=this,o=this.length>>1,d=r[e];for(;e<o;){let p=1+(e<<1),f=r[p];const g=p+1;if(g<this.length&&s(r[g],f)<0&&(p=g,f=r[g]),s(f,d)>=0)break;r[e]=f,e=p}r[e]=d}}function cf(i,e){return i<e?-1:i>e?1:0}function hf(i,e=1,r=!1){let s=1/0,o=1/0,d=-1/0,p=-1/0;const f=i[0];for(let z=0;z<f.length;z++){const L=f[z];(!z||L.x<s)&&(s=L.x),(!z||L.y<o)&&(o=L.y),(!z||L.x>d)&&(d=L.x),(!z||L.y>p)&&(p=L.y)}const g=Math.min(d-s,p-o);let x=g/2;const w=new lf([],uf);if(g===0)return new re(s,o);for(let z=s;z<d;z+=g)for(let L=o;L<p;L+=g)w.push(new qa(z+x,L+x,x,i));let T=function(z){let L=0,V=0,G=0;const X=z[0];for(let se=0,Y=X.length,te=Y-1;se<Y;te=se++){const pe=X[se],ye=X[te],Re=pe.x*ye.y-ye.x*pe.y;V+=(pe.x+ye.x)*Re,G+=(pe.y+ye.y)*Re,L+=3*Re}return new qa(V/L,G/L,0,z)}(i),k=w.length;for(;w.length;){const z=w.pop();(z.d>T.d||!T.d)&&(T=z,r&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,k)),z.max-T.d<=e||(x=z.h/2,w.push(new qa(z.p.x-x,z.p.y-x,x,i)),w.push(new qa(z.p.x+x,z.p.y-x,x,i)),w.push(new qa(z.p.x-x,z.p.y+x,x,i)),w.push(new qa(z.p.x+x,z.p.y+x,x,i)),k+=4)}return r&&(console.log(`num probes: ${k}`),console.log(`best distance: ${T.d}`)),T.p}function uf(i,e){return e.max-i.max}function qa(i,e,r,s){this.p=new re(i,e),this.h=r,this.d=function(o,d){let p=!1,f=1/0;for(let g=0;g<d.length;g++){const x=d[g];for(let w=0,T=x.length,k=T-1;w<T;k=w++){const z=x[w],L=x[k];z.y>o.y!=L.y>o.y&&o.x<(L.x-z.x)*(o.y-z.y)/(L.y-z.y)+z.x&&(p=!p),f=Math.min(f,kh(o,z,L))}}return(p?1:-1)*Math.sqrt(f)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var qi;b.ap=void 0,(qi=b.ap||(b.ap={}))[qi.center=1]="center",qi[qi.left=2]="left",qi[qi.right=3]="right",qi[qi.top=4]="top",qi[qi.bottom=5]="bottom",qi[qi["top-left"]=6]="top-left",qi[qi["top-right"]=7]="top-right",qi[qi["bottom-left"]=8]="bottom-left",qi[qi["bottom-right"]=9]="bottom-right";const ys=7,ch=Number.POSITIVE_INFINITY;function Hu(i,e){return e[1]!==ch?function(r,s,o){let d=0,p=0;switch(s=Math.abs(s),o=Math.abs(o),r){case"top-right":case"top-left":case"top":p=o-ys;break;case"bottom-right":case"bottom-left":case"bottom":p=-o+ys}switch(r){case"top-right":case"bottom-right":case"right":d=-s;break;case"top-left":case"bottom-left":case"left":d=s}return[d,p]}(i,e[0],e[1]):function(r,s){let o=0,d=0;s<0&&(s=0);const p=s/Math.SQRT2;switch(r){case"top-right":case"top-left":d=p-ys;break;case"bottom-right":case"bottom-left":d=-p+ys;break;case"bottom":d=-s+ys;break;case"top":d=s-ys}switch(r){case"top-right":case"bottom-right":o=-p;break;case"top-left":case"bottom-left":o=p;break;case"left":o=s;break;case"right":o=-s}return[o,d]}(i,e[0])}function Wu(i,e,r){var s;const o=i.layout,d=(s=o.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(e,{},r);if(d){const f=d.values,g=[];for(let x=0;x<f.length;x+=2){const w=g[x]=f[x],T=f[x+1].map(k=>k*Ci);w.startsWith("top")?T[1]-=ys:w.startsWith("bottom")&&(T[1]+=ys),g[x+1]=T}return new Dr(g)}const p=o.get("text-variable-anchor");if(p){let f;f=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[o.get("text-radial-offset").evaluate(e,{},r)*Ci,ch]:o.get("text-offset").evaluate(e,{},r).map(x=>x*Ci);const g=[];for(const x of p)g.push(x,Hu(x,f));return new Dr(g)}return null}function hh(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function df(i,e,r,s,o,d,p,f,g,x,w){let T=d.textMaxSize.evaluate(e,{});T===void 0&&(T=p);const k=i.layers[0].layout,z=k.get("icon-offset").evaluate(e,{},w),L=Ku(r.horizontal),V=p/24,G=i.tilePixelRatio*V,X=i.tilePixelRatio*T/24,se=i.tilePixelRatio*f,Y=i.tilePixelRatio*k.get("symbol-spacing"),te=k.get("text-padding")*i.tilePixelRatio,pe=function(we,He,Ze,dt=1){const qt=we.get("icon-padding").evaluate(He,{},Ze),Ht=qt&&qt.values;return[Ht[0]*dt,Ht[1]*dt,Ht[2]*dt,Ht[3]*dt]}(k,e,w,i.tilePixelRatio),ye=k.get("text-max-angle")/180*Math.PI,Re=k.get("text-rotation-alignment")!=="viewport"&&k.get("symbol-placement")!=="point",Ne=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Le=k.get("symbol-placement"),Pe=Y/2,Ce=k.get("icon-text-fit");let Ve;s&&Ce!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Ve=yu(s,r.vertical,Ce,k.get("icon-text-fit-padding"),z,V)),L&&(s=yu(s,L,Ce,k.get("icon-text-fit-padding"),z,V)));const Ae=(we,He)=>{He.x<0||He.x>=ri||He.y<0||He.y>=ri||function(Ze,dt,qt,Ht,Ai,Fr,fr,vi,Oi,Zi,mr,gr,ki,Ei,ir,_r,rr,Ir,Cr,Mi,yt,nr,Gi,Pi,rn){const hn=Ze.addToLineVertexArray(dt,qt);let un,Hn,nn,Hr,Ar=0,Wn=0,$o=0,Qu=0,yh=-1,xh=-1;const Xn={};let ed=Dt("");if(Ze.allowVerticalPlacement&&Ht.vertical){const sr=vi.layout.get("text-rotate").evaluate(yt,{},Pi)+90;nn=new oc(Oi,dt,Zi,mr,gr,Ht.vertical,ki,Ei,ir,sr),fr&&(Hr=new oc(Oi,dt,Zi,mr,gr,fr,rr,Ir,ir,sr))}if(Ai){const sr=vi.layout.get("icon-rotate").evaluate(yt,{}),Wr=vi.layout.get("icon-text-fit")!=="none",Hs=Zu(Ai,sr,Gi,Wr),pn=fr?Zu(fr,sr,Gi,Wr):void 0;Hn=new oc(Oi,dt,Zi,mr,gr,Ai,rr,Ir,!1,sr),Ar=4*Hs.length;const Ws=Ze.iconSizeData;let wn=null;Ws.kind==="source"?(wn=[bn*vi.layout.get("icon-size").evaluate(yt,{})],wn[0]>ms&&Xt(`${Ze.layerIds[0]}: Value for "icon-size" is >= ${Xo}. Reduce your "icon-size".`)):Ws.kind==="composite"&&(wn=[bn*nr.compositeIconSizes[0].evaluate(yt,{},Pi),bn*nr.compositeIconSizes[1].evaluate(yt,{},Pi)],(wn[0]>ms||wn[1]>ms)&&Xt(`${Ze.layerIds[0]}: Value for "icon-size" is >= ${Xo}. Reduce your "icon-size".`)),Ze.addSymbols(Ze.icon,Hs,wn,Mi,Cr,yt,b.ah.none,dt,hn.lineStartIndex,hn.lineLength,-1,Pi),yh=Ze.icon.placedSymbolArray.length-1,pn&&(Wn=4*pn.length,Ze.addSymbols(Ze.icon,pn,wn,Mi,Cr,yt,b.ah.vertical,dt,hn.lineStartIndex,hn.lineLength,-1,Pi),xh=Ze.icon.placedSymbolArray.length-1)}const td=Object.keys(Ht.horizontal);for(const sr of td){const Wr=Ht.horizontal[sr];if(!un){ed=Dt(Wr.text);const pn=vi.layout.get("text-rotate").evaluate(yt,{},Pi);un=new oc(Oi,dt,Zi,mr,gr,Wr,ki,Ei,ir,pn)}const Hs=Wr.positionedLines.length===1;if($o+=Xu(Ze,dt,Wr,Fr,vi,ir,yt,_r,hn,Ht.vertical?b.ah.horizontal:b.ah.horizontalOnly,Hs?td:[sr],Xn,yh,nr,Pi),Hs)break}Ht.vertical&&(Qu+=Xu(Ze,dt,Ht.vertical,Fr,vi,ir,yt,_r,hn,b.ah.vertical,["vertical"],Xn,xh,nr,Pi));const mf=un?un.boxStartIndex:Ze.collisionBoxArray.length,gf=un?un.boxEndIndex:Ze.collisionBoxArray.length,_f=nn?nn.boxStartIndex:Ze.collisionBoxArray.length,yf=nn?nn.boxEndIndex:Ze.collisionBoxArray.length,xf=Hn?Hn.boxStartIndex:Ze.collisionBoxArray.length,vf=Hn?Hn.boxEndIndex:Ze.collisionBoxArray.length,bf=Hr?Hr.boxStartIndex:Ze.collisionBoxArray.length,wf=Hr?Hr.boxEndIndex:Ze.collisionBoxArray.length;let dn=-1;const cc=(sr,Wr)=>sr&&sr.circleDiameter?Math.max(sr.circleDiameter,Wr):Wr;dn=cc(un,dn),dn=cc(nn,dn),dn=cc(Hn,dn),dn=cc(Hr,dn);const id=dn>-1?1:0;id&&(dn*=rn/Ci),Ze.glyphOffsetArray.length>=Na.MAX_GLYPHS&&Xt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yt.sortKey!==void 0&&Ze.addToSortKeyRanges(Ze.symbolInstances.length,yt.sortKey);const Sf=Wu(vi,yt,Pi),[Tf,If]=function(sr,Wr){const Hs=sr.length,pn=Wr==null?void 0:Wr.values;if((pn==null?void 0:pn.length)>0)for(let Ws=0;Ws<pn.length;Ws+=2){const wn=pn[Ws+1];sr.emplaceBack(b.ap[pn[Ws]],wn[0],wn[1])}return[Hs,sr.length]}(Ze.textAnchorOffsets,Sf);Ze.symbolInstances.emplaceBack(dt.x,dt.y,Xn.right>=0?Xn.right:-1,Xn.center>=0?Xn.center:-1,Xn.left>=0?Xn.left:-1,Xn.vertical||-1,yh,xh,ed,mf,gf,_f,yf,xf,vf,bf,wf,Zi,$o,Qu,Ar,Wn,id,0,ki,dn,Tf,If)}(i,He,we,r,s,o,Ve,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,G,[te,te,te,te],Re,g,se,pe,Ne,z,e,d,x,w,p)};if(Le==="line")for(const we of Ou(e.geometry,0,0,ri,ri)){const He=of(we,Y,ye,r.vertical||L,s,24,X,i.overscaling,ri);for(const Ze of He)L&&pf(i,L.text,Pe,Ze)||Ae(we,Ze)}else if(Le==="line-center"){for(const we of e.geometry)if(we.length>1){const He=af(we,ye,r.vertical||L,s,24,X);He&&Ae(we,He)}}else if(e.type==="Polygon")for(const we of jc(e.geometry,0)){const He=hf(we,16);Ae(we[0],new _s(He.x,He.y,0))}else if(e.type==="LineString")for(const we of e.geometry)Ae(we,new _s(we[0].x,we[0].y,0));else if(e.type==="Point")for(const we of e.geometry)for(const He of we)Ae([He],new _s(He.x,He.y,0))}function Xu(i,e,r,s,o,d,p,f,g,x,w,T,k,z,L){const V=function(se,Y,te,pe,ye,Re,Ne,Le){const Pe=pe.layout.get("text-rotate").evaluate(Re,{})*Math.PI/180,Ce=[];for(const Ve of Y.positionedLines)for(const Ae of Ve.positionedGlyphs){if(!Ae.rect)continue;const we=Ae.rect||{};let He=uu+1,Ze=!0,dt=1,qt=0;const Ht=(ye||Le)&&Ae.vertical,Ai=Ae.metrics.advance*Ae.scale/2;if(Le&&Y.verticalizable&&(qt=Ve.lineOffset/2-(Ae.imageName?-(Ci-Ae.metrics.width*Ae.scale)/2:(Ae.scale-1)*Ci)),Ae.imageName){const Mi=Ne[Ae.imageName];Ze=Mi.sdf,dt=Mi.pixelRatio,He=Tr/dt}const Fr=ye?[Ae.x+Ai,Ae.y]:[0,0];let fr=ye?[0,0]:[Ae.x+Ai+te[0],Ae.y+te[1]-qt],vi=[0,0];Ht&&(vi=fr,fr=[0,0]);const Oi=Ae.metrics.isDoubleResolution?2:1,Zi=(Ae.metrics.left-He)*Ae.scale-Ai+fr[0],mr=(-Ae.metrics.top-He)*Ae.scale+fr[1],gr=Zi+we.w/Oi*Ae.scale/dt,ki=mr+we.h/Oi*Ae.scale/dt,Ei=new re(Zi,mr),ir=new re(gr,mr),_r=new re(Zi,ki),rr=new re(gr,ki);if(Ht){const Mi=new re(-Ai,Ai-Ho),yt=-Math.PI/2,nr=Ci/2-Ai,Gi=new re(5-Ho-nr,-(Ae.imageName?nr:0)),Pi=new re(...vi);Ei._rotateAround(yt,Mi)._add(Gi)._add(Pi),ir._rotateAround(yt,Mi)._add(Gi)._add(Pi),_r._rotateAround(yt,Mi)._add(Gi)._add(Pi),rr._rotateAround(yt,Mi)._add(Gi)._add(Pi)}if(Pe){const Mi=Math.sin(Pe),yt=Math.cos(Pe),nr=[yt,-Mi,Mi,yt];Ei._matMult(nr),ir._matMult(nr),_r._matMult(nr),rr._matMult(nr)}const Ir=new re(0,0),Cr=new re(0,0);Ce.push({tl:Ei,tr:ir,bl:_r,br:rr,tex:we,writingMode:Y.writingMode,glyphOffset:Fr,sectionIndex:Ae.sectionIndex,isSDF:Ze,pixelOffsetTL:Ir,pixelOffsetBR:Cr,minFontScaleX:0,minFontScaleY:0})}return Ce}(0,r,f,o,d,p,s,i.allowVerticalPlacement),G=i.textSizeData;let X=null;G.kind==="source"?(X=[bn*o.layout.get("text-size").evaluate(p,{})],X[0]>ms&&Xt(`${i.layerIds[0]}: Value for "text-size" is >= ${Xo}. Reduce your "text-size".`)):G.kind==="composite"&&(X=[bn*z.compositeTextSizes[0].evaluate(p,{},L),bn*z.compositeTextSizes[1].evaluate(p,{},L)],(X[0]>ms||X[1]>ms)&&Xt(`${i.layerIds[0]}: Value for "text-size" is >= ${Xo}. Reduce your "text-size".`)),i.addSymbols(i.text,V,X,f,d,p,x,e,g.lineStartIndex,g.lineLength,k,L);for(const se of w)T[se]=i.text.placedSymbolArray.length-1;return 4*V.length}function Ku(i){for(const e in i)return i[e];return null}function pf(i,e,r,s){const o=i.compareText;if(e in o){const d=o[e];for(let p=d.length-1;p>=0;p--)if(s.dist(d[p])<r)return!0}else o[e]=[];return o[e].push(s),!1}const Yu=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class uh{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const o=s>>4;if(o!==1)throw new Error(`Got v${o} data when expected v1.`);const d=Yu[15&s];if(!d)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[f]=new Uint32Array(e,4,1);return new uh(f,p,d,e)}constructor(e,r=64,s=Float64Array,o){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=Yu.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,f=e*this.IndexArrayType.BYTES_PER_ELEMENT,g=(8-f%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${s}.`);o&&o instanceof ArrayBuffer?(this.data=o,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+g,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+f+g),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+g,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=r,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return dh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,s,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:p,nodeSize:f}=this,g=[0,d.length-1,0],x=[];for(;g.length;){const w=g.pop()||0,T=g.pop()||0,k=g.pop()||0;if(T-k<=f){for(let G=k;G<=T;G++){const X=p[2*G],se=p[2*G+1];X>=e&&X<=s&&se>=r&&se<=o&&x.push(d[G])}continue}const z=k+T>>1,L=p[2*z],V=p[2*z+1];L>=e&&L<=s&&V>=r&&V<=o&&x.push(d[z]),(w===0?e<=L:r<=V)&&(g.push(k),g.push(z-1),g.push(1-w)),(w===0?s>=L:o>=V)&&(g.push(z+1),g.push(T),g.push(1-w))}return x}within(e,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:d,nodeSize:p}=this,f=[0,o.length-1,0],g=[],x=s*s;for(;f.length;){const w=f.pop()||0,T=f.pop()||0,k=f.pop()||0;if(T-k<=p){for(let G=k;G<=T;G++)$u(d[2*G],d[2*G+1],e,r)<=x&&g.push(o[G]);continue}const z=k+T>>1,L=d[2*z],V=d[2*z+1];$u(L,V,e,r)<=x&&g.push(o[z]),(w===0?e-s<=L:r-s<=V)&&(f.push(k),f.push(z-1),f.push(1-w)),(w===0?e+s>=L:r+s>=V)&&(f.push(z+1),f.push(T),f.push(1-w))}return g}}function dh(i,e,r,s,o,d){if(o-s<=r)return;const p=s+o>>1;Ju(i,e,p,s,o,d),dh(i,e,r,s,p-1,1-d),dh(i,e,r,p+1,o,1-d)}function Ju(i,e,r,s,o,d){for(;o>s;){if(o-s>600){const x=o-s+1,w=r-s+1,T=Math.log(x),k=.5*Math.exp(2*T/3),z=.5*Math.sqrt(T*k*(x-k)/x)*(w-x/2<0?-1:1);Ju(i,e,r,Math.max(s,Math.floor(r-w*k/x+z)),Math.min(o,Math.floor(r+(x-w)*k/x+z)),d)}const p=e[2*r+d];let f=s,g=o;for(Yo(i,e,s,r),e[2*o+d]>p&&Yo(i,e,s,o);f<g;){for(Yo(i,e,f,g),f++,g--;e[2*f+d]<p;)f++;for(;e[2*g+d]>p;)g--}e[2*s+d]===p?Yo(i,e,s,g):(g++,Yo(i,e,g,o)),g<=r&&(s=g+1),r<=g&&(o=g-1)}}function Yo(i,e,r,s){ph(i,r,s),ph(e,2*r,2*s),ph(e,2*r+1,2*s+1)}function ph(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}function $u(i,e,r,s){const o=i-r,d=e-s;return o*o+d*d}var fh;b.bc=void 0,(fh=b.bc||(b.bc={})).create="create",fh.load="load",fh.fullLoad="fullLoad";let lc=null,Jo=[];const mh=1e3/60,gh="loadTime",_h="fullLoadTime",ff={mark(i){performance.mark(i)},frame(i){const e=i;lc!=null&&Jo.push(e-lc),lc=e},clearMetrics(){lc=null,Jo=[],performance.clearMeasures(gh),performance.clearMeasures(_h);for(const i in b.bc)performance.clearMarks(b.bc[i])},getPerformanceMetrics(){performance.measure(gh,b.bc.create,b.bc.load),performance.measure(_h,b.bc.create,b.bc.fullLoad);const i=performance.getEntriesByName(gh)[0].duration,e=performance.getEntriesByName(_h)[0].duration,r=Jo.length,s=1/(Jo.reduce((d,p)=>d+p,0)/r/1e3),o=Jo.filter(d=>d>mh).reduce((d,p)=>d+(p-mh)/mh,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:o/(r+o)*100,totalFrames:r}}};b.$=Ke,b.A=Ra,b.B=function(i){if(ni==null){const e=i.navigator?i.navigator.userAgent:null;ni=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ni},b.C=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new nf(()=>this.process()),this.subscription=function(r,s,o,d){return r.addEventListener(s,o,!1),{unsubscribe:()=>{r.removeEventListener(s,o,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=pt(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}sendAsync(i,e){return new Promise((r,s)=>{const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[o]={resolve:r,reject:s},e&&e.signal.addEventListener("abort",()=>{delete this.resolveRejects[o];const f={id:o,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(f)},{once:!0});const d=[],p=Object.assign(Object.assign({},i),{id:o,sourceMapId:this.mapId,origin:location.origin,data:ls(i.data,d)});this.target.postMessage(p,{transfer:d})})}receive(i){const e=i.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const s=this.abortControllers[r];return delete this.abortControllers[r],void(s&&s.abort())}if(pt(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return h(this,void 0,void 0,function*(){if(e.type==="<response>"){const o=this.resolveRejects[i];return delete this.resolveRejects[i],o?void(e.error?o.reject(Fs(e.error)):o.resolve(Fs(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Fs(e.data),s=new AbortController;this.abortControllers[i]=s;try{const o=yield this.messageHandlers[e.type](e.sourceMapId,r,s);this.completeTask(i,null,o)}catch(o){this.completeTask(i,o)}})}completeTask(i,e,r){const s=[];delete this.abortControllers[i];const o={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?ls(e):null,data:ls(r,s)};this.target.postMessage(o,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},b.D=qe,b.E=An,b.F=function(){var i=new Ra(16);return Ra!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},b.G=Di,b.H=function(i,e,r){var s,o,d,p,f,g,x,w,T,k,z,L,V=r[0],G=r[1],X=r[2];return e===i?(i[12]=e[0]*V+e[4]*G+e[8]*X+e[12],i[13]=e[1]*V+e[5]*G+e[9]*X+e[13],i[14]=e[2]*V+e[6]*G+e[10]*X+e[14],i[15]=e[3]*V+e[7]*G+e[11]*X+e[15]):(o=e[1],d=e[2],p=e[3],f=e[4],g=e[5],x=e[6],w=e[7],T=e[8],k=e[9],z=e[10],L=e[11],i[0]=s=e[0],i[1]=o,i[2]=d,i[3]=p,i[4]=f,i[5]=g,i[6]=x,i[7]=w,i[8]=T,i[9]=k,i[10]=z,i[11]=L,i[12]=s*V+f*G+T*X+e[12],i[13]=o*V+g*G+k*X+e[13],i[14]=d*V+x*G+z*X+e[14],i[15]=p*V+w*G+L*X+e[15]),i},b.I=$c,b.J=function(i,e,r){var s=r[0],o=r[1],d=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*o,i[5]=e[5]*o,i[6]=e[6]*o,i[7]=e[7]*o,i[8]=e[8]*d,i[9]=e[9]*d,i[10]=e[10]*d,i[11]=e[11]*d,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},b.K=zh,b.L=function(i,e){const r={};for(let s=0;s<e.length;s++){const o=e[s];o in i&&(r[o]=i[o])}return r},b.M=gs,b.N=Au,b.O=ku,b.P=re,b.Q=Gr,b.R=Zr,b.S=Be,b.T=Bl,b.U=De,b.V=Xi,b.W=ri,b.X=oi,b.Y=rc,b.Z=class extends To{},b._=h,b.a=Ki,b.a$=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},b.a0=lh,b.a1=Te,b.a2=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(r=>{e.onloadstart=()=>{r(e)};for(const s of i){const o=window.document.createElement("source");Ur(s)||(e.crossOrigin="Anonymous"),o.src=s,e.appendChild(o)}})},b.a3=function(){return it++},b.a4=t,b.a5=Na,b.a6=_a,b.a7=Zn,b.a8=Ut,b.a9=Lu,b.aA=Wt,b.aB=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let r=[];try{if(!xt(i.version,e.version))return[{command:"setStyle",args:[e]}];xt(i.center,e.center)||r.push({command:"setCenter",args:[e.center]}),xt(i.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),xt(i.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),xt(i.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),xt(i.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),xt(i.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),xt(i.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),xt(i.light,e.light)||r.push({command:"setLight",args:[e.light]}),xt(i.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),xt(i.sky,e.sky)||r.push({command:"setSky",args:[e.sky]});const s={},o=[];(function(p,f,g,x){let w;for(w in f=f||{},p=p||{})Object.prototype.hasOwnProperty.call(p,w)&&(Object.prototype.hasOwnProperty.call(f,w)||Jn(w,g,x));for(w in f)Object.prototype.hasOwnProperty.call(f,w)&&(Object.prototype.hasOwnProperty.call(p,w)?xt(p[w],f[w])||(p[w].type==="geojson"&&f[w].type==="geojson"&&Qn(p,f,w)?Fi(g,{command:"setGeoJSONSourceData",args:[w,f[w].data]}):$n(w,f,g,x)):Yr(w,f,g))})(i.sources,e.sources,o,s);const d=[];i.layers&&i.layers.forEach(p=>{"source"in p&&s[p.source]?r.push({command:"removeLayer",args:[p.id]}):d.push(p)}),r=r.concat(o),function(p,f,g){f=f||[];const x=(p=p||[]).map(Ks),w=f.map(Ks),T=p.reduce(Mn,{}),k=f.reduce(Mn,{}),z=x.slice(),L=Object.create(null);let V,G,X,se,Y;for(let te=0,pe=0;te<x.length;te++)V=x[te],Object.prototype.hasOwnProperty.call(k,V)?pe++:(Fi(g,{command:"removeLayer",args:[V]}),z.splice(z.indexOf(V,pe),1));for(let te=0,pe=0;te<w.length;te++)V=w[w.length-1-te],z[z.length-1-te]!==V&&(Object.prototype.hasOwnProperty.call(T,V)?(Fi(g,{command:"removeLayer",args:[V]}),z.splice(z.lastIndexOf(V,z.length-pe),1)):pe++,se=z[z.length-te],Fi(g,{command:"addLayer",args:[k[V],se]}),z.splice(z.length-te,0,V),L[V]=!0);for(let te=0;te<w.length;te++)if(V=w[te],G=T[V],X=k[V],!L[V]&&!xt(G,X))if(xt(G.source,X.source)&&xt(G["source-layer"],X["source-layer"])&&xt(G.type,X.type)){for(Y in En(G.layout,X.layout,g,V,null,"setLayoutProperty"),En(G.paint,X.paint,g,V,null,"setPaintProperty"),xt(G.filter,X.filter)||Fi(g,{command:"setFilter",args:[V,X.filter]}),xt(G.minzoom,X.minzoom)&&xt(G.maxzoom,X.maxzoom)||Fi(g,{command:"setLayerZoomRange",args:[V,X.minzoom,X.maxzoom]}),G)Object.prototype.hasOwnProperty.call(G,Y)&&Y!=="layout"&&Y!=="paint"&&Y!=="filter"&&Y!=="metadata"&&Y!=="minzoom"&&Y!=="maxzoom"&&(Y.indexOf("paint.")===0?En(G[Y],X[Y],g,V,Y.slice(6),"setPaintProperty"):xt(G[Y],X[Y])||Fi(g,{command:"setLayerProperty",args:[V,Y,X[Y]]}));for(Y in X)Object.prototype.hasOwnProperty.call(X,Y)&&!Object.prototype.hasOwnProperty.call(G,Y)&&Y!=="layout"&&Y!=="paint"&&Y!=="filter"&&Y!=="metadata"&&Y!=="minzoom"&&Y!=="maxzoom"&&(Y.indexOf("paint.")===0?En(G[Y],X[Y],g,V,Y.slice(6),"setPaintProperty"):xt(G[Y],X[Y])||Fi(g,{command:"setLayerProperty",args:[V,Y,X[Y]]}))}else Fi(g,{command:"removeLayer",args:[V]}),se=z[z.lastIndexOf(V)+1],Fi(g,{command:"addLayer",args:[X,se]})}(d,e.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:"setStyle",args:[e]}]}return r},b.aC=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},b.aD=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(!i(e[s],r[s]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const s in e)if(!i(e[s],r[s]))return!1;return!0}return e===r},b.aE=Tt,b.aF=ar,b.aG=class extends ji{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},b.aH=Br,b.aI=class extends ji{constructor(i,e){super(i,e),this.current=ds}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},b.aJ=xn,b.aK=class extends ji{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},b.aL=class extends ji{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},b.aM=us,b.aN=function(i,e,r,s,o,d,p){var f=1/(e-r),g=1/(s-o),x=1/(d-p);return i[0]=-2*f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*x,i[11]=0,i[12]=(e+r)*f,i[13]=(o+s)*g,i[14]=(p+d)*x,i[15]=1,i},b.aO=Et,b.aP=Fd,b.aQ=class extends js{},b.aR=Pp,b.aS=class extends Un{},b.aT=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},b.aU=Fh,b.aV=D,b.aW=class extends Pa{},b.aX=be,b.aY=function(i,e){var r=i[0],s=i[1],o=i[2],d=i[3],p=i[4],f=i[5],g=i[6],x=i[7],w=i[8],T=i[9],k=i[10],z=i[11],L=i[12],V=i[13],G=i[14],X=i[15],se=e[0],Y=e[1],te=e[2],pe=e[3],ye=e[4],Re=e[5],Ne=e[6],Le=e[7],Pe=e[8],Ce=e[9],Ve=e[10],Ae=e[11],we=e[12],He=e[13],Ze=e[14],dt=e[15];return Math.abs(r-se)<=pr*Math.max(1,Math.abs(r),Math.abs(se))&&Math.abs(s-Y)<=pr*Math.max(1,Math.abs(s),Math.abs(Y))&&Math.abs(o-te)<=pr*Math.max(1,Math.abs(o),Math.abs(te))&&Math.abs(d-pe)<=pr*Math.max(1,Math.abs(d),Math.abs(pe))&&Math.abs(p-ye)<=pr*Math.max(1,Math.abs(p),Math.abs(ye))&&Math.abs(f-Re)<=pr*Math.max(1,Math.abs(f),Math.abs(Re))&&Math.abs(g-Ne)<=pr*Math.max(1,Math.abs(g),Math.abs(Ne))&&Math.abs(x-Le)<=pr*Math.max(1,Math.abs(x),Math.abs(Le))&&Math.abs(w-Pe)<=pr*Math.max(1,Math.abs(w),Math.abs(Pe))&&Math.abs(T-Ce)<=pr*Math.max(1,Math.abs(T),Math.abs(Ce))&&Math.abs(k-Ve)<=pr*Math.max(1,Math.abs(k),Math.abs(Ve))&&Math.abs(z-Ae)<=pr*Math.max(1,Math.abs(z),Math.abs(Ae))&&Math.abs(L-we)<=pr*Math.max(1,Math.abs(L),Math.abs(we))&&Math.abs(V-He)<=pr*Math.max(1,Math.abs(V),Math.abs(He))&&Math.abs(G-Ze)<=pr*Math.max(1,Math.abs(G),Math.abs(Ze))&&Math.abs(X-dt)<=pr*Math.max(1,Math.abs(X),Math.abs(dt))},b.aZ=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},b.a_=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},b.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,o,d)=>{const p=o||d;return e[s]=!p||p.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},b.ab=function(i,e){const r=[];for(const s in i)s in e||r.push(s);return r},b.ac=Ot,b.ad=function(i,e,r){var s=Math.sin(r),o=Math.cos(r),d=e[0],p=e[1],f=e[2],g=e[3],x=e[4],w=e[5],T=e[6],k=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*o+x*s,i[1]=p*o+w*s,i[2]=f*o+T*s,i[3]=g*o+k*s,i[4]=x*o-d*s,i[5]=w*o-p*s,i[6]=T*o-f*s,i[7]=k*o-g*s,i},b.ae=function(i){var e=new Ra(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},b.af=Hl,b.ag=function(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:o,minZoom:d,maxZoom:p}=i,f=o?Ot(Ui.interpolationFactor(o,e,d,p),0,1):0;i.kind==="camera"?s=Ji.number(i.minSize,i.maxSize,f):r=f}return{uSizeT:r,uSize:s}},b.ai=function(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:o}){return i.kind==="source"?s/bn:i.kind==="composite"?Ji.number(s/bn,o/bn,r):e},b.aj=ih,b.ak=function(i,e,r,s){const o=e.y-i.y,d=e.x-i.x,p=s.y-r.y,f=s.x-r.x,g=p*d-f*o;if(g===0)return null;const x=(f*(i.y-r.y)-p*(i.x-r.x))/g;return new re(i.x+x*d,i.y+x*o)},b.al=Ou,b.am=Ro,b.an=Rc,b.ao=Ci,b.aq=th,b.ar=function(i,e){var r=e[0],s=e[1],o=e[2],d=e[3],p=e[4],f=e[5],g=e[6],x=e[7],w=e[8],T=e[9],k=e[10],z=e[11],L=e[12],V=e[13],G=e[14],X=e[15],se=r*f-s*p,Y=r*g-o*p,te=r*x-d*p,pe=s*g-o*f,ye=s*x-d*f,Re=o*x-d*g,Ne=w*V-T*L,Le=w*G-k*L,Pe=w*X-z*L,Ce=T*G-k*V,Ve=T*X-z*V,Ae=k*X-z*G,we=se*Ae-Y*Ve+te*Ce+pe*Pe-ye*Le+Re*Ne;return we?(i[0]=(f*Ae-g*Ve+x*Ce)*(we=1/we),i[1]=(o*Ve-s*Ae-d*Ce)*we,i[2]=(V*Re-G*ye+X*pe)*we,i[3]=(k*ye-T*Re-z*pe)*we,i[4]=(g*Pe-p*Ae-x*Le)*we,i[5]=(r*Ae-o*Pe+d*Le)*we,i[6]=(G*te-L*Re-X*Y)*we,i[7]=(w*Re-k*te+z*Y)*we,i[8]=(p*Ve-f*Pe+x*Ne)*we,i[9]=(s*Pe-r*Ve-d*Ne)*we,i[10]=(L*ye-V*te+X*se)*we,i[11]=(T*te-w*ye-z*se)*we,i[12]=(f*Le-p*Ce-g*Ne)*we,i[13]=(r*Ce-s*Le+o*Ne)*we,i[14]=(V*Y-L*pe-G*se)*we,i[15]=(w*pe-T*Y+k*se)*we,i):null},b.as=hh,b.at=eh,b.au=uh,b.av=function(){const i={},e=de.$version;for(const r in de.$root){const s=de.$root[r];if(s.required){let o=null;o=r==="version"?e:s.type==="array"?[]:{},o!=null&&(i[r]=o)}}return i},b.aw=Sa,b.ax=et,b.ay=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=vs(i[r],e[i[r].ref]));return i},b.az=function(i){if(i.type==="custom")return new rf(i);switch(i.type){case"background":return new Qp(i);case"circle":return new Od(i);case"fill":return new np(i);case"fill-extrusion":return new xp(i);case"heatmap":return new Ud(i);case"hillshade":return new jd(i);case"line":return new Ap(i);case"raster":return new tf(i);case"symbol":return new ic(i)}},b.b=Kt,b.b0=mi,b.b1=Pu,b.b2=Eu,b.b3=function(i,e,r,s,o){var d,p=1/Math.tan(e/2);return i[0]=p/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,o!=null&&o!==1/0?(i[10]=(o+s)*(d=1/(s-o)),i[14]=2*o*s*d):(i[10]=-1,i[14]=-2*s),i},b.b4=function(i,e,r){var s=Math.sin(r),o=Math.cos(r),d=e[4],p=e[5],f=e[6],g=e[7],x=e[8],w=e[9],T=e[10],k=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=d*o+x*s,i[5]=p*o+w*s,i[6]=f*o+T*s,i[7]=g*o+k*s,i[8]=x*o-d*s,i[9]=w*o-p*s,i[10]=T*o-f*s,i[11]=k*o-g*s,i},b.b5=ht,b.b6=gt,b.b7=function(i){return i*Math.PI/180},b.b8=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},b.b9=class extends ka{},b.ba=ah,b.bb=ff,b.bd=Ie,b.be=function(i,e){Ki.REGISTERED_PROTOCOLS[i]=e},b.bf=function(i){delete Ki.REGISTERED_PROTOCOLS[i]},b.bg=function(i,e){const r={};for(let o=0;o<i.length;o++){const d=e&&e[i[o].id]||Mc(i[o]);e&&(e[i[o].id]=d);let p=r[d];p||(p=r[d]=[]),p.push(i[o])}const s=[];for(const o in r)s.push(r[o]);return s},b.bh=Fe,b.bi=Du,b.bj=Ru,b.bk=pu,b.bl=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=ri/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,s=e._unevaluatedLayout._values,o={layoutIconSize:s["icon-size"].possiblyEvaluate(new Ut(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new Ut(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new Ut(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:x,maxZoom:w}=i.bucket.textSizeData;o.compositeTextSizes=[s["text-size"].possiblyEvaluate(new Ut(x),i.canonical),s["text-size"].possiblyEvaluate(new Ut(w),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:x,maxZoom:w}=i.bucket.iconSizeData;o.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new Ut(x),i.canonical),s["icon-size"].possiblyEvaluate(new Ut(w),i.canonical)]}const d=r.get("text-line-height")*Ci,p=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",f=r.get("text-keep-upright"),g=r.get("text-size");for(const x of i.bucket.features){const w=r.get("text-font").evaluate(x,{},i.canonical).join(","),T=g.evaluate(x,{},i.canonical),k=o.layoutTextSize.evaluate(x,{},i.canonical),z=o.layoutIconSize.evaluate(x,{},i.canonical),L={horizontal:{},vertical:void 0},V=x.text;let G,X=[0,0];if(V){const te=V.toString(),pe=r.get("text-letter-spacing").evaluate(x,{},i.canonical)*Ci,ye=Dl(te)?pe:0,Re=r.get("text-anchor").evaluate(x,{},i.canonical),Ne=Wu(e,x,i.canonical);if(!Ne){const Ae=r.get("text-radial-offset").evaluate(x,{},i.canonical);X=Ae?Hu(Re,[Ae*Ci,ch]):r.get("text-offset").evaluate(x,{},i.canonical).map(we=>we*Ci)}let Le=p?"center":r.get("text-justify").evaluate(x,{},i.canonical);const Pe=r.get("symbol-placement"),Ce=Pe==="point"?r.get("text-max-width").evaluate(x,{},i.canonical)*Ci:0,Ve=()=>{i.bucket.allowVerticalPlacement&&Ta(te)&&(L.vertical=Ql(V,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ce,d,Re,"left",ye,X,b.ah.vertical,!0,Pe,k,T))};if(!p&&Ne){const Ae=new Set;if(Le==="auto")for(let He=0;He<Ne.values.length;He+=2)Ae.add(hh(Ne.values[He]));else Ae.add(Le);let we=!1;for(const He of Ae)if(!L.horizontal[He])if(we)L.horizontal[He]=L.horizontal[0];else{const Ze=Ql(V,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ce,d,"center",He,ye,X,b.ah.horizontal,!1,Pe,k,T);Ze&&(L.horizontal[He]=Ze,we=Ze.positionedLines.length===1)}Ve()}else{Le==="auto"&&(Le=hh(Re));const Ae=Ql(V,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ce,d,Re,Le,ye,X,b.ah.horizontal,!1,Pe,k,T);Ae&&(L.horizontal[Le]=Ae),Ve(),Ta(te)&&p&&f&&(L.vertical=Ql(V,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ce,d,Re,Le,ye,X,b.ah.vertical,!1,Pe,k,T))}}let se=!1;if(x.icon&&x.icon.name){const te=i.imageMap[x.icon.name];te&&(G=Xp(i.imagePositions[x.icon.name],r.get("icon-offset").evaluate(x,{},i.canonical),r.get("icon-anchor").evaluate(x,{},i.canonical)),se=!!te.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=se:i.bucket.sdfIcons!==se&&Xt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(te.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const Y=Ku(L.horizontal)||L.vertical;i.bucket.iconsInText=!!Y&&Y.iconsInText,(Y||G)&&df(i.bucket,x,L,G,i.imageMap,o,k,z,X,se,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},b.bm=Xc,b.bn=Gc,b.bo=Wc,b.bp=ps,b.bq=Yc,b.br=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},b.bs=function(i,e,r,s,o){return h(this,void 0,void 0,function*(){if(De())try{return yield Xi(i,e,r,s,o)}catch{}return function(d,p,f,g,x){const w=d.width,T=d.height;Ft&&Pt||(Ft=new OffscreenCanvas(w,T),Pt=Ft.getContext("2d",{willReadFrequently:!0})),Ft.width=w,Ft.height=T,Pt.drawImage(d,0,0,w,T);const k=Pt.getImageData(p,f,g,x);return Pt.clearRect(0,0,w,T),k.data}(i,e,r,s,o)})},b.bt=zu,b.bu=le,b.bv=he,b.bw=nu,b.bx=Rn,b.by=function(i){return i.message===gi},b.bz=Vn,b.c=si,b.d=i=>h(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),b.e=It,b.f=i=>new Promise((e,r)=>{const s=new Image;s.onload=()=>{e(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=Pr})},s.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(o):Pr}),b.g=lr,b.h=(i,e)=>kt(It(i,{type:"json"}),e),b.i=pt,b.j=Jt,b.k=zr,b.l=(i,e)=>kt(It(i,{type:"arrayBuffer"}),e),b.m=kt,b.n=function(i){return new Yc(i).readFields(jp,[])},b.o=Oo,b.p=du,b.q=Qi,b.r=_o,b.s=Ur,b.t=zl,b.u=ze,b.v=de,b.w=Xt,b.x=Rs,b.y=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},b.z=Ji}),F("worker",["./shared"],function(b){class h{constructor(A){this.keyCache={},A&&this.replace(A)}replace(A){this._layerConfigs={},this._layers={},this.update(A,[])}update(A,P){for(const j of A){this._layerConfigs[j.id]=j;const Q=this._layers[j.id]=b.az(j);Q._featureFilter=b.a6(Q.filter),this.keyCache[j.id]&&delete this.keyCache[j.id]}for(const j of P)delete this.keyCache[j],delete this._layerConfigs[j],delete this._layers[j];this.familiesBySource={};const B=b.bg(Object.values(this._layerConfigs),this.keyCache);for(const j of B){const Q=j.map(me=>this._layers[me.id]),ee=Q[0];if(ee.visibility==="none")continue;const ne=ee.source||"";let J=this.familiesBySource[ne];J||(J=this.familiesBySource[ne]={});const ae=ee.sourceLayer||"_geojsonTileLayer";let xe=J[ae];xe||(xe=J[ae]=[]),xe.push(Q)}}}class le{constructor(A){const P={},B=[];for(const ne in A){const J=A[ne],ae=P[ne]={};for(const xe in J){const me=J[+xe];if(!me||me.bitmap.width===0||me.bitmap.height===0)continue;const ge={x:0,y:0,w:me.bitmap.width+2,h:me.bitmap.height+2};B.push(ge),ae[xe]={rect:ge,metrics:me.metrics}}}const{w:j,h:Q}=b.p(B),ee=new b.o({width:j||1,height:Q||1});for(const ne in A){const J=A[ne];for(const ae in J){const xe=J[+ae];if(!xe||xe.bitmap.width===0||xe.bitmap.height===0)continue;const me=P[ne][ae].rect;b.o.copy(xe.bitmap,ee,{x:0,y:0},{x:me.x+1,y:me.y+1},xe.bitmap)}}this.image=ee,this.positions=P}}b.bh("GlyphAtlas",le);class he{constructor(A){this.tileID=new b.Q(A.tileID.overscaledZ,A.tileID.wrap,A.tileID.canonical.z,A.tileID.canonical.x,A.tileID.canonical.y),this.uid=A.uid,this.zoom=A.zoom,this.pixelRatio=A.pixelRatio,this.tileSize=A.tileSize,this.source=A.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=A.showCollisionBoxes,this.collectResourceTiming=!!A.collectResourceTiming,this.returnDependencies=!!A.returnDependencies,this.promoteId=A.promoteId,this.inFlightDependencies=[]}parse(A,P,B,j){return b._(this,void 0,void 0,function*(){this.status="parsing",this.data=A,this.collisionBoxArray=new b.a4;const Q=new b.bi(Object.keys(A.layers).sort()),ee=new b.bj(this.tileID,this.promoteId);ee.bucketLayerIDs=[];const ne={},J={featureIndex:ee,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:B},ae=P.familiesBySource[this.source];for(const ot in ae){const $t=A.layers[ot];if(!$t)continue;$t.version===1&&b.w(`Vector tile source "${this.source}" layer "${ot}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const wi=Q.encode(ot),Yi=[];for(let cr=0;cr<$t.length;cr++){const Li=$t.feature(cr),Qr=ee.getId(Li,ot);Yi.push({feature:Li,id:Qr,index:cr,sourceLayerIndex:wi})}for(const cr of ae[ot]){const Li=cr[0];Li.source!==this.source&&b.w(`layer.source = ${Li.source} does not equal this.source = ${this.source}`),Li.minzoom&&this.zoom<Math.floor(Li.minzoom)||Li.maxzoom&&this.zoom>=Li.maxzoom||Li.visibility!=="none"&&(fe(cr,this.zoom,B),(ne[Li.id]=Li.createBucket({index:ee.bucketLayerIDs.length,layers:cr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wi,sourceID:this.source})).populate(Yi,J,this.tileID.canonical),ee.bucketLayerIDs.push(cr.map(Qr=>Qr.id)))}}const xe=b.aE(J.glyphDependencies,ot=>Object.keys(ot).map(Number));this.inFlightDependencies.forEach(ot=>ot==null?void 0:ot.abort()),this.inFlightDependencies=[];let me=Promise.resolve({});if(Object.keys(xe).length){const ot=new AbortController;this.inFlightDependencies.push(ot),me=j.sendAsync({type:"getGlyphs",data:{stacks:xe,source:this.source,tileID:this.tileID,type:"glyphs"}},ot)}const ge=Object.keys(J.iconDependencies);let Ge=Promise.resolve({});if(ge.length){const ot=new AbortController;this.inFlightDependencies.push(ot),Ge=j.sendAsync({type:"getImages",data:{icons:ge,source:this.source,tileID:this.tileID,type:"icons"}},ot)}const We=Object.keys(J.patternDependencies);let nt=Promise.resolve({});if(We.length){const ot=new AbortController;this.inFlightDependencies.push(ot),nt=j.sendAsync({type:"getImages",data:{icons:We,source:this.source,tileID:this.tileID,type:"patterns"}},ot)}const[tt,vt,zt]=yield Promise.all([me,Ge,nt]),Gt=new le(tt),yi=new b.bk(vt,zt);for(const ot in ne){const $t=ne[ot];$t instanceof b.a5?(fe($t.layers,this.zoom,B),b.bl({bucket:$t,glyphMap:tt,glyphPositions:Gt.positions,imageMap:vt,imagePositions:yi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):$t.hasPattern&&($t instanceof b.bm||$t instanceof b.bn||$t instanceof b.bo)&&(fe($t.layers,this.zoom,B),$t.addFeatures(J,this.tileID.canonical,yi.patternPositions))}return this.status="done",{buckets:Object.values(ne).filter(ot=>!ot.isEmpty()),featureIndex:ee,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gt.image,imageAtlas:yi,glyphMap:this.returnDependencies?tt:null,iconMap:this.returnDependencies?vt:null,glyphPositions:this.returnDependencies?Gt.positions:null}})}}function fe(H,A,P){const B=new b.a8(A);for(const j of H)j.recalculate(B,P)}class re{constructor(A,P,B){this.actor=A,this.layerIndex=P,this.availableImages=B,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(A,P){return b._(this,void 0,void 0,function*(){const B=yield b.l(A.request,P);try{return{vectorTile:new b.bp.VectorTile(new b.bq(B.data)),rawData:B.data,cacheControl:B.cacheControl,expires:B.expires}}catch(j){const Q=new Uint8Array(B.data);let ee=`Unable to parse the tile at ${A.request.url}, `;throw ee+=Q[0]===31&&Q[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${j.messge}`,new Error(ee)}})}loadTile(A){return b._(this,void 0,void 0,function*(){const P=A.uid,B=!!(A&&A.request&&A.request.collectResourceTiming)&&new b.br(A.request),j=new he(A);this.loading[P]=j;const Q=new AbortController;j.abort=Q;try{const ee=yield this.loadVectorTile(A,Q);if(delete this.loading[P],!ee)return null;const ne=ee.rawData,J={};ee.expires&&(J.expires=ee.expires),ee.cacheControl&&(J.cacheControl=ee.cacheControl);const ae={};if(B){const me=B.finish();me&&(ae.resourceTiming=JSON.parse(JSON.stringify(me)))}j.vectorTile=ee.vectorTile;const xe=j.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[P]=j,this.fetching[P]={rawTileData:ne,cacheControl:J,resourceTiming:ae};try{const me=yield xe;return b.e({rawTileData:ne.slice(0)},me,J,ae)}finally{delete this.fetching[P]}}catch(ee){throw delete this.loading[P],j.status="done",this.loaded[P]=j,ee}})}reloadTile(A){return b._(this,void 0,void 0,function*(){const P=A.uid;if(!this.loaded||!this.loaded[P])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const B=this.loaded[P];if(B.showCollisionBoxes=A.showCollisionBoxes,B.status==="parsing"){const j=yield B.parse(B.vectorTile,this.layerIndex,this.availableImages,this.actor);let Q;if(this.fetching[P]){const{rawTileData:ee,cacheControl:ne,resourceTiming:J}=this.fetching[P];delete this.fetching[P],Q=b.e({rawTileData:ee.slice(0)},j,ne,J)}else Q=j;return Q}if(B.status==="done"&&B.vectorTile)return B.parse(B.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(A){return b._(this,void 0,void 0,function*(){const P=this.loading,B=A.uid;P&&P[B]&&P[B].abort&&(P[B].abort.abort(),delete P[B])})}removeTile(A){return b._(this,void 0,void 0,function*(){this.loaded&&this.loaded[A.uid]&&delete this.loaded[A.uid]})}}class K{constructor(){this.loaded={}}loadTile(A){return b._(this,void 0,void 0,function*(){const{uid:P,encoding:B,rawImageData:j,redFactor:Q,greenFactor:ee,blueFactor:ne,baseShift:J}=A,ae=j.width+2,xe=j.height+2,me=b.b(j)?new b.R({width:ae,height:xe},yield b.bs(j,-1,-1,ae,xe)):j,ge=new b.bt(P,me,B,Q,ee,ne,J);return this.loaded=this.loaded||{},this.loaded[P]=ge,ge})}removeTile(A){const P=this.loaded,B=A.uid;P&&P[B]&&delete P[B]}}function je(H,A){if(H.length!==0){Qe(H[0],A);for(var P=1;P<H.length;P++)Qe(H[P],!A)}}function Qe(H,A){for(var P=0,B=0,j=0,Q=H.length,ee=Q-1;j<Q;ee=j++){var ne=(H[j][0]-H[ee][0])*(H[ee][1]+H[j][1]),J=P+ne;B+=Math.abs(P)>=Math.abs(ne)?P-J+ne:ne-J+P,P=J}P+B>=0!=!!A&&H.reverse()}var Ye=b.bu(function H(A,P){var B,j=A&&A.type;if(j==="FeatureCollection")for(B=0;B<A.features.length;B++)H(A.features[B],P);else if(j==="GeometryCollection")for(B=0;B<A.geometries.length;B++)H(A.geometries[B],P);else if(j==="Feature")H(A.geometry,P);else if(j==="Polygon")je(A.coordinates,P);else if(j==="MultiPolygon")for(B=0;B<A.coordinates.length;B++)je(A.coordinates[B],P);return A});const _t=b.bp.VectorTileFeature.prototype.toGeoJSON;var Be={exports:{}},De=b.bv,ht=b.bp.VectorTileFeature,gt=Ot;function Ot(H,A){this.options=A||{},this.features=H,this.length=H.length}function mi(H,A){this.id=typeof H.id=="number"?H.id:void 0,this.type=H.type,this.rawGeometry=H.type===1?[H.geometry]:H.geometry,this.properties=H.tags,this.extent=A||4096}Ot.prototype.feature=function(H){return new mi(this.features[H],this.options.extent)},mi.prototype.loadGeometry=function(){var H=this.rawGeometry;this.geometry=[];for(var A=0;A<H.length;A++){for(var P=H[A],B=[],j=0;j<P.length;j++)B.push(new De(P[j][0],P[j][1]));this.geometry.push(B)}return this.geometry},mi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var H=this.geometry,A=1/0,P=-1/0,B=1/0,j=-1/0,Q=0;Q<H.length;Q++)for(var ee=H[Q],ne=0;ne<ee.length;ne++){var J=ee[ne];A=Math.min(A,J.x),P=Math.max(P,J.x),B=Math.min(B,J.y),j=Math.max(j,J.y)}return[A,B,P,j]},mi.prototype.toGeoJSON=ht.prototype.toGeoJSON;var It=b.bw,it=gt;function Tt(H){var A=new It;return function(P,B){for(var j in P.layers)B.writeMessage(3,ar,P.layers[j])}(H,A),A.finish()}function ar(H,A){var P;A.writeVarintField(15,H.version||1),A.writeStringField(1,H.name||""),A.writeVarintField(5,H.extent||4096);var B={keys:[],values:[],keycache:{},valuecache:{}};for(P=0;P<H.length;P++)B.feature=H.feature(P),A.writeMessage(2,Wt,B);var j=B.keys;for(P=0;P<j.length;P++)A.writeStringField(3,j[P]);var Q=B.values;for(P=0;P<Q.length;P++)A.writeMessage(4,pt,Q[P])}function Wt(H,A){var P=H.feature;P.id!==void 0&&A.writeVarintField(1,P.id),A.writeMessage(2,Ct,H),A.writeVarintField(3,P.type),A.writeMessage(4,or,P)}function Ct(H,A){var P=H.feature,B=H.keys,j=H.values,Q=H.keycache,ee=H.valuecache;for(var ne in P.properties){var J=P.properties[ne],ae=Q[ne];if(J!==null){ae===void 0&&(B.push(ne),Q[ne]=ae=B.length-1),A.writeVarint(ae);var xe=typeof J;xe!=="string"&&xe!=="boolean"&&xe!=="number"&&(J=JSON.stringify(J));var me=xe+":"+J,ge=ee[me];ge===void 0&&(j.push(J),ee[me]=ge=j.length-1),A.writeVarint(ge)}}}function Xt(H,A){return(A<<3)+(7&H)}function zi(H){return H<<1^H>>31}function or(H,A){for(var P=H.loadGeometry(),B=H.type,j=0,Q=0,ee=P.length,ne=0;ne<ee;ne++){var J=P[ne],ae=1;B===1&&(ae=J.length),A.writeVarint(Xt(1,ae));for(var xe=B===3?J.length-1:J.length,me=0;me<xe;me++){me===1&&B!==1&&A.writeVarint(Xt(2,xe-1));var ge=J[me].x-j,Ge=J[me].y-Q;A.writeVarint(zi(ge)),A.writeVarint(zi(Ge)),j+=ge,Q+=Ge}B===3&&A.writeVarint(Xt(7,1))}}function pt(H,A){var P=typeof H;P==="string"?A.writeStringField(1,H):P==="boolean"?A.writeBooleanField(7,H):P==="number"&&(H%1!=0?A.writeDoubleField(3,H):H<0?A.writeSVarintField(6,H):A.writeVarintField(5,H))}Be.exports=Tt,Be.exports.fromVectorTileJs=Tt,Be.exports.fromGeojsonVt=function(H,A){A=A||{};var P={};for(var B in H)P[B]=new it(H[B].features,A),P[B].name=B,P[B].version=A.version,P[B].extent=A.extent;return Tt({layers:P})},Be.exports.GeoJSONWrapper=it;var ni=b.bu(Be.exports);const Kt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:H=>H},Pr=Math.fround||(Xi=new Float32Array(1),H=>(Xi[0]=+H,Xi[0]));var Xi;const Ft=3,Pt=5,gi=6;class si{constructor(A){this.options=Object.assign(Object.create(Kt),A),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(A){const{log:P,minZoom:B,maxZoom:j}=this.options;P&&console.time("total time");const Q=`prepare ${A.length} points`;P&&console.time(Q),this.points=A;const ee=[];for(let J=0;J<A.length;J++){const ae=A[J];if(!ae.geometry)continue;const[xe,me]=ae.geometry.coordinates,ge=Pr(Di(xe)),Ge=Pr(Ie(me));ee.push(ge,Ge,1/0,J,-1,1),this.options.reduce&&ee.push(0)}let ne=this.trees[j+1]=this._createTree(ee);P&&console.timeEnd(Q);for(let J=j;J>=B;J--){const ae=+Date.now();ne=this.trees[J]=this._createTree(this._cluster(ne,J)),P&&console.log("z%d: %d clusters in %dms",J,ne.numItems,+Date.now()-ae)}return P&&console.timeEnd("total time"),this}getClusters(A,P){let B=((A[0]+180)%360+360)%360-180;const j=Math.max(-90,Math.min(90,A[1]));let Q=A[2]===180?180:((A[2]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,A[3]));if(A[2]-A[0]>=360)B=-180,Q=180;else if(B>Q){const me=this.getClusters([B,j,180,ee],P),ge=this.getClusters([-180,j,Q,ee],P);return me.concat(ge)}const ne=this.trees[this._limitZoom(P)],J=ne.range(Di(B),Ie(ee),Di(Q),Ie(j)),ae=ne.data,xe=[];for(const me of J){const ge=this.stride*me;xe.push(ae[ge+Pt]>1?Ki(ae,ge,this.clusterProps):this.points[ae[ge+Ft]])}return xe}getChildren(A){const P=this._getOriginId(A),B=this._getOriginZoom(A),j="No cluster with the specified id.",Q=this.trees[B];if(!Q)throw new Error(j);const ee=Q.data;if(P*this.stride>=ee.length)throw new Error(j);const ne=this.options.radius/(this.options.extent*Math.pow(2,B-1)),J=Q.within(ee[P*this.stride],ee[P*this.stride+1],ne),ae=[];for(const xe of J){const me=xe*this.stride;ee[me+4]===A&&ae.push(ee[me+Pt]>1?Ki(ee,me,this.clusterProps):this.points[ee[me+Ft]])}if(ae.length===0)throw new Error(j);return ae}getLeaves(A,P,B){const j=[];return this._appendLeaves(j,A,P=P||10,B=B||0,0),j}getTile(A,P,B){const j=this.trees[this._limitZoom(A)],Q=Math.pow(2,A),{extent:ee,radius:ne}=this.options,J=ne/ee,ae=(B-J)/Q,xe=(B+1+J)/Q,me={features:[]};return this._addTileFeatures(j.range((P-J)/Q,ae,(P+1+J)/Q,xe),j.data,P,B,Q,me),P===0&&this._addTileFeatures(j.range(1-J/Q,ae,1,xe),j.data,Q,B,Q,me),P===Q-1&&this._addTileFeatures(j.range(0,ae,J/Q,xe),j.data,-1,B,Q,me),me.features.length?me:null}getClusterExpansionZoom(A){let P=this._getOriginZoom(A)-1;for(;P<=this.options.maxZoom;){const B=this.getChildren(A);if(P++,B.length!==1)break;A=B[0].properties.cluster_id}return P}_appendLeaves(A,P,B,j,Q){const ee=this.getChildren(P);for(const ne of ee){const J=ne.properties;if(J&&J.cluster?Q+J.point_count<=j?Q+=J.point_count:Q=this._appendLeaves(A,J.cluster_id,B,j,Q):Q<j?Q++:A.push(ne),A.length===B)break}return Q}_createTree(A){const P=new b.au(A.length/this.stride|0,this.options.nodeSize,Float32Array);for(let B=0;B<A.length;B+=this.stride)P.add(A[B],A[B+1]);return P.finish(),P.data=A,P}_addTileFeatures(A,P,B,j,Q,ee){for(const ne of A){const J=ne*this.stride,ae=P[J+Pt]>1;let xe,me,ge;if(ae)xe=lr(P,J,this.clusterProps),me=P[J],ge=P[J+1];else{const nt=this.points[P[J+Ft]];xe=nt.properties;const[tt,vt]=nt.geometry.coordinates;me=Di(tt),ge=Ie(vt)}const Ge={type:1,geometry:[[Math.round(this.options.extent*(me*Q-B)),Math.round(this.options.extent*(ge*Q-j))]],tags:xe};let We;We=ae||this.options.generateId?P[J+Ft]:this.points[P[J+Ft]].id,We!==void 0&&(Ge.id=We),ee.features.push(Ge)}}_limitZoom(A){return Math.max(this.options.minZoom,Math.min(Math.floor(+A),this.options.maxZoom+1))}_cluster(A,P){const{radius:B,extent:j,reduce:Q,minPoints:ee}=this.options,ne=B/(j*Math.pow(2,P)),J=A.data,ae=[],xe=this.stride;for(let me=0;me<J.length;me+=xe){if(J[me+2]<=P)continue;J[me+2]=P;const ge=J[me],Ge=J[me+1],We=A.within(J[me],J[me+1],ne),nt=J[me+Pt];let tt=nt;for(const vt of We){const zt=vt*xe;J[zt+2]>P&&(tt+=J[zt+Pt])}if(tt>nt&&tt>=ee){let vt,zt=ge*nt,Gt=Ge*nt,yi=-1;const ot=((me/xe|0)<<5)+(P+1)+this.points.length;for(const $t of We){const wi=$t*xe;if(J[wi+2]<=P)continue;J[wi+2]=P;const Yi=J[wi+Pt];zt+=J[wi]*Yi,Gt+=J[wi+1]*Yi,J[wi+4]=ot,Q&&(vt||(vt=this._map(J,me,!0),yi=this.clusterProps.length,this.clusterProps.push(vt)),Q(vt,this._map(J,wi)))}J[me+4]=ot,ae.push(zt/tt,Gt/tt,1/0,ot,-1,tt),Q&&ae.push(yi)}else{for(let vt=0;vt<xe;vt++)ae.push(J[me+vt]);if(tt>1)for(const vt of We){const zt=vt*xe;if(!(J[zt+2]<=P)){J[zt+2]=P;for(let Gt=0;Gt<xe;Gt++)ae.push(J[zt+Gt])}}}}return ae}_getOriginId(A){return A-this.points.length>>5}_getOriginZoom(A){return(A-this.points.length)%32}_map(A,P,B){if(A[P+Pt]>1){const ee=this.clusterProps[A[P+gi]];return B?Object.assign({},ee):ee}const j=this.points[A[P+Ft]].properties,Q=this.options.map(j);return B&&Q===j?Object.assign({},Q):Q}}function Ki(H,A,P){return{type:"Feature",id:H[A+Ft],properties:lr(H,A,P),geometry:{type:"Point",coordinates:[(B=H[A],360*(B-.5)),et(H[A+1])]}};var B}function lr(H,A,P){const B=H[A+Pt],j=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B,Q=H[A+gi],ee=Q===-1?{}:Object.assign({},P[Q]);return Object.assign(ee,{cluster:!0,cluster_id:H[A+Ft],point_count:B,point_count_abbreviated:j})}function Di(H){return H/360+.5}function Ie(H){const A=Math.sin(H*Math.PI/180),P=.5-.25*Math.log((1+A)/(1-A))/Math.PI;return P<0?0:P>1?1:P}function et(H){const A=(180-360*H)*Math.PI/180;return 360*Math.atan(Math.exp(A))/Math.PI-90}function kt(H,A,P,B){for(var j,Q=B,ee=P-A>>1,ne=P-A,J=H[A],ae=H[A+1],xe=H[P],me=H[P+1],ge=A+3;ge<P;ge+=3){var Ge=Ur(H[ge],H[ge+1],J,ae,xe,me);if(Ge>Q)j=ge,Q=Ge;else if(Ge===Q){var We=Math.abs(ge-ee);We<ne&&(j=ge,ne=We)}}Q>B&&(j-A>3&&kt(H,A,j,B),H[j+2]=Q,P-j>3&&kt(H,j,P,B))}function Ur(H,A,P,B,j,Q){var ee=j-P,ne=Q-B;if(ee!==0||ne!==0){var J=((H-P)*ee+(A-B)*ne)/(ee*ee+ne*ne);J>1?(P=j,B=Q):J>0&&(P+=ee*J,B+=ne*J)}return(ee=H-P)*ee+(ne=A-B)*ne}function Kr(H,A,P,B){var j={id:H===void 0?null:H,type:A,geometry:P,tags:B,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Q){var ee=Q.geometry,ne=Q.type;if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")ke(Q,ee);else if(ne==="Polygon"||ne==="MultiLineString")for(var J=0;J<ee.length;J++)ke(Q,ee[J]);else if(ne==="MultiPolygon")for(J=0;J<ee.length;J++)for(var ae=0;ae<ee[J].length;ae++)ke(Q,ee[J][ae])}(j),j}function ke(H,A){for(var P=0;P<A.length;P+=3)H.minX=Math.min(H.minX,A[P]),H.minY=Math.min(H.minY,A[P+1]),H.maxX=Math.max(H.maxX,A[P]),H.maxY=Math.max(H.maxY,A[P+1])}function zr(H,A,P,B){if(A.geometry){var j=A.geometry.coordinates,Q=A.geometry.type,ee=Math.pow(P.tolerance/((1<<P.maxZoom)*P.extent),2),ne=[],J=A.id;if(P.promoteId?J=A.properties[P.promoteId]:P.generateId&&(J=B||0),Q==="Point")Jt(j,ne);else if(Q==="MultiPoint")for(var ae=0;ae<j.length;ae++)Jt(j[ae],ne);else if(Q==="LineString")An(j,ne,ee,!1);else if(Q==="MultiLineString"){if(P.lineMetrics){for(ae=0;ae<j.length;ae++)An(j[ae],ne=[],ee,!1),H.push(Kr(J,"LineString",ne,A.properties));return}de(j,ne,ee,!1)}else if(Q==="Polygon")de(j,ne,ee,!0);else{if(Q!=="MultiPolygon"){if(Q==="GeometryCollection"){for(ae=0;ae<A.geometry.geometries.length;ae++)zr(H,{id:J,geometry:A.geometry.geometries[ae],properties:A.properties},P,B);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ae=0;ae<j.length;ae++){var xe=[];de(j[ae],xe,ee,!0),ne.push(xe)}}H.push(Kr(J,Q,ne,A.properties))}}function Jt(H,A){A.push(kn(H[0])),A.push(vs(H[1])),A.push(0)}function An(H,A,P,B){for(var j,Q,ee=0,ne=0;ne<H.length;ne++){var J=kn(H[ne][0]),ae=vs(H[ne][1]);A.push(J),A.push(ae),A.push(0),ne>0&&(ee+=B?(j*ae-J*Q)/2:Math.sqrt(Math.pow(J-j,2)+Math.pow(ae-Q,2))),j=J,Q=ae}var xe=A.length-3;A[2]=1,kt(A,0,xe,P),A[xe+2]=1,A.size=Math.abs(ee),A.start=0,A.end=A.size}function de(H,A,P,B){for(var j=0;j<H.length;j++){var Q=[];An(H[j],Q,P,B),A.push(Q)}}function kn(H){return H/360+.5}function vs(H){var A=Math.sin(H*Math.PI/180),P=.5-.25*Math.log((1+A)/(1-A))/Math.PI;return P<0?0:P>1?1:P}function xt(H,A,P,B,j,Q,ee,ne){if(B/=A,Q>=(P/=A)&&ee<B)return H;if(ee<P||Q>=B)return null;for(var J=[],ae=0;ae<H.length;ae++){var xe=H[ae],me=xe.geometry,ge=xe.type,Ge=j===0?xe.minX:xe.minY,We=j===0?xe.maxX:xe.maxY;if(Ge>=P&&We<B)J.push(xe);else if(!(We<P||Ge>=B)){var nt=[];if(ge==="Point"||ge==="MultiPoint")Fi(me,nt,P,B,j);else if(ge==="LineString")Yr(me,nt,P,B,j,!1,ne.lineMetrics);else if(ge==="MultiLineString")$n(me,nt,P,B,j,!1);else if(ge==="Polygon")$n(me,nt,P,B,j,!0);else if(ge==="MultiPolygon")for(var tt=0;tt<me.length;tt++){var vt=[];$n(me[tt],vt,P,B,j,!0),vt.length&&nt.push(vt)}if(nt.length){if(ne.lineMetrics&&ge==="LineString"){for(tt=0;tt<nt.length;tt++)J.push(Kr(xe.id,ge,nt[tt],xe.tags));continue}ge!=="LineString"&&ge!=="MultiLineString"||(nt.length===1?(ge="LineString",nt=nt[0]):ge="MultiLineString"),ge!=="Point"&&ge!=="MultiPoint"||(ge=nt.length===3?"Point":"MultiPoint"),J.push(Kr(xe.id,ge,nt,xe.tags))}}}return J.length?J:null}function Fi(H,A,P,B,j){for(var Q=0;Q<H.length;Q+=3){var ee=H[Q+j];ee>=P&&ee<=B&&(A.push(H[Q]),A.push(H[Q+1]),A.push(H[Q+2]))}}function Yr(H,A,P,B,j,Q,ee){for(var ne,J,ae=Jn(H),xe=j===0?En:Ks,me=H.start,ge=0;ge<H.length-3;ge+=3){var Ge=H[ge],We=H[ge+1],nt=H[ge+2],tt=H[ge+3],vt=H[ge+4],zt=j===0?Ge:We,Gt=j===0?tt:vt,yi=!1;ee&&(ne=Math.sqrt(Math.pow(Ge-tt,2)+Math.pow(We-vt,2))),zt<P?Gt>P&&(J=xe(ae,Ge,We,tt,vt,P),ee&&(ae.start=me+ne*J)):zt>B?Gt<B&&(J=xe(ae,Ge,We,tt,vt,B),ee&&(ae.start=me+ne*J)):Qn(ae,Ge,We,nt),Gt<P&&zt>=P&&(J=xe(ae,Ge,We,tt,vt,P),yi=!0),Gt>B&&zt<=B&&(J=xe(ae,Ge,We,tt,vt,B),yi=!0),!Q&&yi&&(ee&&(ae.end=me+ne*J),A.push(ae),ae=Jn(H)),ee&&(me+=ne)}var ot=H.length-3;Ge=H[ot],We=H[ot+1],nt=H[ot+2],(zt=j===0?Ge:We)>=P&&zt<=B&&Qn(ae,Ge,We,nt),ot=ae.length-3,Q&&ot>=3&&(ae[ot]!==ae[0]||ae[ot+1]!==ae[1])&&Qn(ae,ae[0],ae[1],ae[2]),ae.length&&A.push(ae)}function Jn(H){var A=[];return A.size=H.size,A.start=H.start,A.end=H.end,A}function $n(H,A,P,B,j,Q){for(var ee=0;ee<H.length;ee++)Yr(H[ee],A,P,B,j,Q,!1)}function Qn(H,A,P,B){H.push(A),H.push(P),H.push(B)}function En(H,A,P,B,j,Q){var ee=(Q-A)/(B-A);return H.push(Q),H.push(P+(j-P)*ee),H.push(1),ee}function Ks(H,A,P,B,j,Q){var ee=(Q-P)/(j-P);return H.push(A+(B-A)*ee),H.push(Q),H.push(1),ee}function Mn(H,A){for(var P=[],B=0;B<H.length;B++){var j,Q=H[B],ee=Q.type;if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")j=Te(Q.geometry,A);else if(ee==="MultiLineString"||ee==="Polygon"){j=[];for(var ne=0;ne<Q.geometry.length;ne++)j.push(Te(Q.geometry[ne],A))}else if(ee==="MultiPolygon")for(j=[],ne=0;ne<Q.geometry.length;ne++){for(var J=[],ae=0;ae<Q.geometry[ne].length;ae++)J.push(Te(Q.geometry[ne][ae],A));j.push(J)}P.push(Kr(Q.id,ee,j,Q.tags))}return P}function Te(H,A){var P=[];P.size=H.size,H.start!==void 0&&(P.start=H.start,P.end=H.end);for(var B=0;B<H.length;B+=3)P.push(H[B]+A,H[B+1],H[B+2]);return P}function Jr(H,A){if(H.transformed)return H;var P,B,j,Q=1<<H.z,ee=H.x,ne=H.y;for(P=0;P<H.features.length;P++){var J=H.features[P],ae=J.geometry,xe=J.type;if(J.geometry=[],xe===1)for(B=0;B<ae.length;B+=2)J.geometry.push(vr(ae[B],ae[B+1],A,Q,ee,ne));else for(B=0;B<ae.length;B++){var me=[];for(j=0;j<ae[B].length;j+=2)me.push(vr(ae[B][j],ae[B][j+1],A,Q,ee,ne));J.geometry.push(me)}}return H.transformed=!0,H}function vr(H,A,P,B,j,Q){return[Math.round(P*(H*B-j)),Math.round(P*(A*B-Q))]}function bs(H,A,P,B,j){for(var Q=A===j.maxZoom?0:j.tolerance/((1<<A)*j.extent),ee={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:P,y:B,z:A,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ne=0;ne<H.length;ne++){ee.numFeatures++,Vi(ee,H[ne],Q,j);var J=H[ne].minX,ae=H[ne].minY,xe=H[ne].maxX,me=H[ne].maxY;J<ee.minX&&(ee.minX=J),ae<ee.minY&&(ee.minY=ae),xe>ee.maxX&&(ee.maxX=xe),me>ee.maxY&&(ee.maxY=me)}return ee}function Vi(H,A,P,B){var j=A.geometry,Q=A.type,ee=[];if(Q==="Point"||Q==="MultiPoint")for(var ne=0;ne<j.length;ne+=3)ee.push(j[ne]),ee.push(j[ne+1]),H.numPoints++,H.numSimplified++;else if(Q==="LineString")Ee(ee,j,H,P,!1,!1);else if(Q==="MultiLineString"||Q==="Polygon")for(ne=0;ne<j.length;ne++)Ee(ee,j[ne],H,P,Q==="Polygon",ne===0);else if(Q==="MultiPolygon")for(var J=0;J<j.length;J++){var ae=j[J];for(ne=0;ne<ae.length;ne++)Ee(ee,ae[ne],H,P,!0,ne===0)}if(ee.length){var xe=A.tags||null;if(Q==="LineString"&&B.lineMetrics){for(var me in xe={},A.tags)xe[me]=A.tags[me];xe.mapbox_clip_start=j.start/j.size,xe.mapbox_clip_end=j.end/j.size}var ge={geometry:ee,type:Q==="Polygon"||Q==="MultiPolygon"?3:Q==="LineString"||Q==="MultiLineString"?2:1,tags:xe};A.id!==null&&(ge.id=A.id),H.features.push(ge)}}function Ee(H,A,P,B,j,Q){var ee=B*B;if(B>0&&A.size<(j?ee:B))P.numPoints+=A.length/3;else{for(var ne=[],J=0;J<A.length;J+=3)(B===0||A[J+2]>ee)&&(P.numSimplified++,ne.push(A[J]),ne.push(A[J+1])),P.numPoints++;j&&function(ae,xe){for(var me=0,ge=0,Ge=ae.length,We=Ge-2;ge<Ge;We=ge,ge+=2)me+=(ae[ge]-ae[We])*(ae[ge+1]+ae[We+1]);if(me>0===xe)for(ge=0,Ge=ae.length;ge<Ge/2;ge+=2){var nt=ae[ge],tt=ae[ge+1];ae[ge]=ae[Ge-2-ge],ae[ge+1]=ae[Ge-1-ge],ae[Ge-2-ge]=nt,ae[Ge-1-ge]=tt}}(ne,Q),H.push(ne)}}function ut(H,A){var P=(A=this.options=function(j,Q){for(var ee in Q)j[ee]=Q[ee];return j}(Object.create(this.options),A)).debug;if(P&&console.time("preprocess data"),A.maxZoom<0||A.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(A.promoteId&&A.generateId)throw new Error("promoteId and generateId cannot be used together.");var B=function(j,Q){var ee=[];if(j.type==="FeatureCollection")for(var ne=0;ne<j.features.length;ne++)zr(ee,j.features[ne],Q,ne);else zr(ee,j.type==="Feature"?j:{geometry:j},Q);return ee}(H,A);this.tiles={},this.tileCoords=[],P&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",A.indexMaxZoom,A.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),B=function(j,Q){var ee=Q.buffer/Q.extent,ne=j,J=xt(j,1,-1-ee,ee,0,-1,2,Q),ae=xt(j,1,1-ee,2+ee,0,-1,2,Q);return(J||ae)&&(ne=xt(j,1,-ee,1+ee,0,-1,2,Q)||[],J&&(ne=Mn(J,1).concat(ne)),ae&&(ne=ne.concat(Mn(ae,-1)))),ne}(B,A),B.length&&this.splitTile(B,0,0,0),P&&(B.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function at(H,A,P){return 32*((1<<H)*P+A)+H}function _i(H,A){return A?H.properties[A]:H.id}function $r(H,A){if(H==null)return!0;if(H.type==="Feature")return _i(H,A)!=null;if(H.type==="FeatureCollection"){const P=new Set;for(const B of H.features){const j=_i(B,A);if(j==null||P.has(j))return!1;P.add(j)}return!0}return!1}function rt(H,A){const P=new Map;if(H!=null)if(H.type==="Feature")P.set(_i(H,A),H);else for(const B of H.features)P.set(_i(B,A),B);return P}ut.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ut.prototype.splitTile=function(H,A,P,B,j,Q,ee){for(var ne=[H,A,P,B],J=this.options,ae=J.debug;ne.length;){B=ne.pop(),P=ne.pop(),A=ne.pop(),H=ne.pop();var xe=1<<A,me=at(A,P,B),ge=this.tiles[me];if(!ge&&(ae>1&&console.time("creation"),ge=this.tiles[me]=bs(H,A,P,B,J),this.tileCoords.push({z:A,x:P,y:B}),ae)){ae>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",A,P,B,ge.numFeatures,ge.numPoints,ge.numSimplified),console.timeEnd("creation"));var Ge="z"+A;this.stats[Ge]=(this.stats[Ge]||0)+1,this.total++}if(ge.source=H,j){if(A===J.maxZoom||A===j)continue;var We=1<<j-A;if(P!==Math.floor(Q/We)||B!==Math.floor(ee/We))continue}else if(A===J.indexMaxZoom||ge.numPoints<=J.indexMaxPoints)continue;if(ge.source=null,H.length!==0){ae>1&&console.time("clipping");var nt,tt,vt,zt,Gt,yi,ot=.5*J.buffer/J.extent,$t=.5-ot,wi=.5+ot,Yi=1+ot;nt=tt=vt=zt=null,Gt=xt(H,xe,P-ot,P+wi,0,ge.minX,ge.maxX,J),yi=xt(H,xe,P+$t,P+Yi,0,ge.minX,ge.maxX,J),H=null,Gt&&(nt=xt(Gt,xe,B-ot,B+wi,1,ge.minY,ge.maxY,J),tt=xt(Gt,xe,B+$t,B+Yi,1,ge.minY,ge.maxY,J),Gt=null),yi&&(vt=xt(yi,xe,B-ot,B+wi,1,ge.minY,ge.maxY,J),zt=xt(yi,xe,B+$t,B+Yi,1,ge.minY,ge.maxY,J),yi=null),ae>1&&console.timeEnd("clipping"),ne.push(nt||[],A+1,2*P,2*B),ne.push(tt||[],A+1,2*P,2*B+1),ne.push(vt||[],A+1,2*P+1,2*B),ne.push(zt||[],A+1,2*P+1,2*B+1)}}},ut.prototype.getTile=function(H,A,P){var B=this.options,j=B.extent,Q=B.debug;if(H<0||H>24)return null;var ee=1<<H,ne=at(H,A=(A%ee+ee)%ee,P);if(this.tiles[ne])return Jr(this.tiles[ne],j);Q>1&&console.log("drilling down to z%d-%d-%d",H,A,P);for(var J,ae=H,xe=A,me=P;!J&&ae>0;)ae--,xe=Math.floor(xe/2),me=Math.floor(me/2),J=this.tiles[at(ae,xe,me)];return J&&J.source?(Q>1&&console.log("found parent tile z%d-%d-%d",ae,xe,me),Q>1&&console.time("drilling down"),this.splitTile(J.source,ae,xe,me,H,A,P),Q>1&&console.timeEnd("drilling down"),this.tiles[ne]?Jr(this.tiles[ne],j):null):null};class Pn extends re{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(A,P){return b._(this,void 0,void 0,function*(){const B=A.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const j=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!j)return null;const Q=new class{constructor(ne){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=b.W,this.length=ne.length,this._features=ne}feature(ne){return new class{constructor(J){this._feature=J,this.extent=b.W,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const ae of this._feature.geometry)J.push([new b.P(ae[0],ae[1])]);return J}{const J=[];for(const ae of this._feature.geometry){const xe=[];for(const me of ae)xe.push(new b.P(me[0],me[1]));J.push(xe)}return J}}toGeoJSON(J,ae,xe){return _t.call(this,J,ae,xe)}}(this._features[ne])}}(j.features);let ee=ni(Q);return ee.byteOffset===0&&ee.byteLength===ee.buffer.byteLength||(ee=new Uint8Array(ee)),{vectorTile:Q,rawData:ee.buffer}})}loadData(A){var P;return b._(this,void 0,void 0,function*(){(P=this._pendingRequest)===null||P===void 0||P.abort();const B=!!(A&&A.request&&A.request.collectResourceTiming)&&new b.br(A.request);this._pendingRequest=new AbortController;try{let j=yield this.loadGeoJSON(A,this._pendingRequest);if(delete this._pendingRequest,typeof j!="object")throw new Error(`Input data given to '${A.source}' is not a valid GeoJSON object.`);if(Ye(j,!0),A.filter){const ee=b.bx(A.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ee.result==="error")throw new Error(ee.value.map(J=>`${J.key}: ${J.message}`).join(", "));j={type:"FeatureCollection",features:j.features.filter(J=>ee.value.evaluate({zoom:0},J))}}this._geoJSONIndex=A.cluster?new si(function({superclusterOptions:ee,clusterProperties:ne}){if(!ne||!ee)return ee;const J={},ae={},xe={accumulated:null,zoom:0},me={properties:null},ge=Object.keys(ne);for(const Ge of ge){const[We,nt]=ne[Ge],tt=b.bx(nt),vt=b.bx(typeof We=="string"?[We,["accumulated"],["get",Ge]]:We);J[Ge]=tt.value,ae[Ge]=vt.value}return ee.map=Ge=>{me.properties=Ge;const We={};for(const nt of ge)We[nt]=J[nt].evaluate(xe,me);return We},ee.reduce=(Ge,We)=>{me.properties=We;for(const nt of ge)xe.accumulated=Ge[nt],Ge[nt]=ae[nt].evaluate(xe,me)},ee}(A)).load(j.features):function(ee,ne){return new ut(ee,ne)}(j,A.geojsonVtOptions),this.loaded={};const Q={};if(B){const ee=B.finish();ee&&(Q.resourceTiming={},Q.resourceTiming[A.source]=JSON.parse(JSON.stringify(ee)))}return Q}catch(j){if(delete this._pendingRequest,b.by(j))return{abandoned:!0};throw j}})}reloadTile(A){const P=this.loaded;return P&&P[A.uid]?super.reloadTile(A):this.loadTile(A)}loadGeoJSON(A,P){return b._(this,void 0,void 0,function*(){const{promoteId:B}=A;if(A.request){const j=yield b.h(A.request,P);return this._dataUpdateable=$r(j.data,B)?rt(j.data,B):void 0,j.data}if(typeof A.data=="string")try{const j=JSON.parse(A.data);return this._dataUpdateable=$r(j,B)?rt(j,B):void 0,j}catch{throw new Error(`Input data given to '${A.source}' is not a valid GeoJSON object.`)}if(!A.dataDiff)throw new Error(`Input data given to '${A.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${A.source}`);return function(j,Q,ee){var ne,J,ae,xe;if(Q.removeAll&&j.clear(),Q.remove)for(const me of Q.remove)j.delete(me);if(Q.add)for(const me of Q.add){const ge=_i(me,ee);ge!=null&&j.set(ge,me)}if(Q.update)for(const me of Q.update){let ge=j.get(me.id);if(ge==null)continue;const Ge=!me.removeAllProperties&&(((ne=me.removeProperties)===null||ne===void 0?void 0:ne.length)>0||((J=me.addOrUpdateProperties)===null||J===void 0?void 0:J.length)>0);if((me.newGeometry||me.removeAllProperties||Ge)&&(ge=Object.assign({},ge),j.set(me.id,ge),Ge&&(ge.properties=Object.assign({},ge.properties))),me.newGeometry&&(ge.geometry=me.newGeometry),me.removeAllProperties)ge.properties={};else if(((ae=me.removeProperties)===null||ae===void 0?void 0:ae.length)>0)for(const We of me.removeProperties)Object.prototype.hasOwnProperty.call(ge.properties,We)&&delete ge.properties[We];if(((xe=me.addOrUpdateProperties)===null||xe===void 0?void 0:xe.length)>0)for(const{key:We,value:nt}of me.addOrUpdateProperties)ge.properties[We]=nt}}(this._dataUpdateable,A.dataDiff,B),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(A){return b._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(A){return this._geoJSONIndex.getClusterExpansionZoom(A.clusterId)}getClusterChildren(A){return this._geoJSONIndex.getChildren(A.clusterId)}getClusterLeaves(A){return this._geoJSONIndex.getLeaves(A.clusterId,A.limit,A.offset)}}class bi{constructor(A){this.self=A,this.actor=new b.C(A),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(P,B)=>{if(this.externalWorkerSourceTypes[P])throw new Error(`Worker source with name "${P}" already registered.`);this.externalWorkerSourceTypes[P]=B},this.self.addProtocol=b.be,this.self.removeProtocol=b.bf,this.self.registerRTLTextPlugin=P=>{if(b.bz.isParsed())throw new Error("RTL text plugin already registered.");b.bz.setMethods(P)},this.actor.registerMessageHandler("loadDEMTile",(P,B)=>this._getDEMWorkerSource(P,B.source).loadTile(B)),this.actor.registerMessageHandler("removeDEMTile",(P,B)=>b._(this,void 0,void 0,function*(){this._getDEMWorkerSource(P,B.source).removeTile(B)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(P,B)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(P,B.type,B.source).getClusterExpansionZoom(B)})),this.actor.registerMessageHandler("getClusterChildren",(P,B)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(P,B.type,B.source).getClusterChildren(B)})),this.actor.registerMessageHandler("getClusterLeaves",(P,B)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(P,B.type,B.source).getClusterLeaves(B)})),this.actor.registerMessageHandler("loadData",(P,B)=>this._getWorkerSource(P,B.type,B.source).loadData(B)),this.actor.registerMessageHandler("loadTile",(P,B)=>this._getWorkerSource(P,B.type,B.source).loadTile(B)),this.actor.registerMessageHandler("reloadTile",(P,B)=>this._getWorkerSource(P,B.type,B.source).reloadTile(B)),this.actor.registerMessageHandler("abortTile",(P,B)=>this._getWorkerSource(P,B.type,B.source).abortTile(B)),this.actor.registerMessageHandler("removeTile",(P,B)=>this._getWorkerSource(P,B.type,B.source).removeTile(B)),this.actor.registerMessageHandler("removeSource",(P,B)=>b._(this,void 0,void 0,function*(){if(!this.workerSources[P]||!this.workerSources[P][B.type]||!this.workerSources[P][B.type][B.source])return;const j=this.workerSources[P][B.type][B.source];delete this.workerSources[P][B.type][B.source],j.removeSource!==void 0&&j.removeSource(B)})),this.actor.registerMessageHandler("removeMap",P=>b._(this,void 0,void 0,function*(){delete this.layerIndexes[P],delete this.availableImages[P],delete this.workerSources[P],delete this.demWorkerSources[P]})),this.actor.registerMessageHandler("setReferrer",(P,B)=>b._(this,void 0,void 0,function*(){this.referrer=B})),this.actor.registerMessageHandler("syncRTLPluginState",(P,B)=>this._syncRTLPluginState(P,B)),this.actor.registerMessageHandler("importScript",(P,B)=>b._(this,void 0,void 0,function*(){this.self.importScripts(B)})),this.actor.registerMessageHandler("setImages",(P,B)=>this._setImages(P,B)),this.actor.registerMessageHandler("updateLayers",(P,B)=>b._(this,void 0,void 0,function*(){this._getLayerIndex(P).update(B.layers,B.removedIds)})),this.actor.registerMessageHandler("setLayers",(P,B)=>b._(this,void 0,void 0,function*(){this._getLayerIndex(P).replace(B)}))}_setImages(A,P){return b._(this,void 0,void 0,function*(){this.availableImages[A]=P;for(const B in this.workerSources[A]){const j=this.workerSources[A][B];for(const Q in j)j[Q].availableImages=P}})}_syncRTLPluginState(A,P){return b._(this,void 0,void 0,function*(){b.bz.setState(P);const B=b.bz.getPluginURL();if(P.pluginStatus==="loaded"&&!b.bz.isParsed()&&B!=null){this.self.importScripts(B);const j=b.bz.isParsed();if(j)return j;throw new Error(`RTL Text Plugin failed to import scripts from ${B}`)}return!1})}_getAvailableImages(A){let P=this.availableImages[A];return P||(P=[]),P}_getLayerIndex(A){let P=this.layerIndexes[A];return P||(P=this.layerIndexes[A]=new h),P}_getWorkerSource(A,P,B){if(this.workerSources[A]||(this.workerSources[A]={}),this.workerSources[A][P]||(this.workerSources[A][P]={}),!this.workerSources[A][P][B]){const j={sendAsync:(Q,ee)=>(Q.targetMapId=A,this.actor.sendAsync(Q,ee))};switch(P){case"vector":this.workerSources[A][P][B]=new re(j,this._getLayerIndex(A),this._getAvailableImages(A));break;case"geojson":this.workerSources[A][P][B]=new Pn(j,this._getLayerIndex(A),this._getAvailableImages(A));break;default:this.workerSources[A][P][B]=new this.externalWorkerSourceTypes[P](j,this._getLayerIndex(A),this._getAvailableImages(A))}}return this.workerSources[A][P][B]}_getDEMWorkerSource(A,P){return this.demWorkerSources[A]||(this.demWorkerSources[A]={}),this.demWorkerSources[A][P]||(this.demWorkerSources[A][P]=new K),this.demWorkerSources[A][P]}}return b.i(self)&&(self.worker=new bi(self)),bi}),F("index",["exports","./shared"],function(b,h){var le="4.1.0";let he,fe;const re={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:c=>new Promise((t,n)=>{const a=requestAnimationFrame(t);c.signal.addEventListener("abort",()=>{cancelAnimationFrame(a),n(h.c())})}),getImageData(c,t=0){return this.getImageCanvasContext(c).getImageData(-t,-t,c.width+2*t,c.height+2*t)},getImageCanvasContext(c){const t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=c.width,t.height=c.height,n.drawImage(c,0,0,c.width,c.height),n},resolveURL:c=>(he||(he=document.createElement("a")),he.href=c,he.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(fe==null&&(fe=matchMedia("(prefers-reduced-motion: reduce)")),fe.matches)}};class K{static testProp(t){if(!K.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in K.docStyle)return t[n];return t[0]}static create(t,n,a){const l=window.document.createElement(t);return n!==void 0&&(l.className=n),a&&a.appendChild(l),l}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){K.docStyle&&K.selectProp&&(K.userSelect=K.docStyle[K.selectProp],K.docStyle[K.selectProp]="none")}static enableDrag(){K.docStyle&&K.selectProp&&(K.docStyle[K.selectProp]=K.userSelect)}static setTransform(t,n){t.style[K.transformProp]=n}static addEventListener(t,n,a,l={}){t.addEventListener(n,a,"passive"in l?l:l.capture)}static removeEventListener(t,n,a,l={}){t.removeEventListener(n,a,"passive"in l?l:l.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",K.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",K.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",K.suppressClickInternal,!0)},0)}static getScale(t){const n=t.getBoundingClientRect();return{x:n.width/t.offsetWidth||1,y:n.height/t.offsetHeight||1,boundingClientRect:n}}static getPoint(t,n,a){const l=n.boundingClientRect;return new h.P((a.clientX-l.left)/n.x-t.clientLeft,(a.clientY-l.top)/n.y-t.clientTop)}static mousePos(t,n){const a=K.getScale(t);return K.getPoint(t,a,n)}static touchPos(t,n){const a=[],l=K.getScale(t);for(let u=0;u<n.length;u++)a.push(K.getPoint(t,l,n[u]));return a}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}K.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,K.selectProp=K.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),K.transformProp=K.testProp(["transform","WebkitTransform"]);const je={supported:!1,testSupport:function(c){!_t&&Ye&&(Be?De(c):Qe=c)}};let Qe,Ye,_t=!1,Be=!1;function De(c){const t=c.createTexture();c.bindTexture(c.TEXTURE_2D,t);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Ye),c.isContextLost())return;je.supported=!0}catch{}c.deleteTexture(t),_t=!0}var ht,gt;typeof document<"u"&&(Ye=document.createElement("img"),Ye.onload=function(){Qe&&De(Qe),Qe=null,Be=!0},Ye.onerror=function(){_t=!0,Qe=null},Ye.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(c){let t,n,a,l;c.resetRequestQueue=()=>{t=[],n=0,a=0,l={}},c.addThrottleControl=y=>{const v=a++;return l[v]=y,v},c.removeThrottleControl=y=>{delete l[y],m()},c.getImage=(y,v,S=!0)=>new Promise((I,D)=>{je.supported&&(y.headers||(y.headers={}),y.headers.accept="image/webp,*/*"),h.e(y,{type:"image"}),t.push({abortController:v,requestParameters:y,supportImageRefresh:S,state:"queued",onError:q=>{D(q)},onSuccess:q=>{I(q)}}),m()});const u=y=>h._(this,void 0,void 0,function*(){y.state="running";const{requestParameters:v,supportImageRefresh:S,onError:I,onSuccess:D,abortController:q}=y,N=S===!1&&!h.i(self)&&!h.g(v.url)&&(!v.headers||Object.keys(v.headers).reduce(($,oe)=>$&&oe==="accept",!0));n++;const Z=N?_(v,q):h.m(v,q);try{const $=yield Z;delete y.abortController,y.state="completed",$.data instanceof HTMLImageElement||h.b($.data)?D($):$.data&&D({data:yield(U=$.data,typeof createImageBitmap=="function"?h.d(U):h.f(U)),cacheControl:$.cacheControl,expires:$.expires})}catch($){delete y.abortController,I($)}finally{n--,m()}var U}),m=()=>{const y=(()=>{for(const v of Object.keys(l))if(l[v]())return!0;return!1})()?h.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let v=n;v<y&&t.length>0;v++){const S=t.shift();S.abortController.signal.aborted?v--:u(S)}},_=(y,v)=>new Promise((S,I)=>{const D=new Image,q=y.url,N=y.credentials;N&&N==="include"?D.crossOrigin="use-credentials":(N&&N==="same-origin"||!h.s(q))&&(D.crossOrigin="anonymous"),v.signal.addEventListener("abort",()=>{D.src="",I(h.c())}),D.fetchPriority="high",D.onload=()=>{D.onerror=D.onload=null,S({data:D})},D.onerror=()=>{D.onerror=D.onload=null,v.signal.aborted||I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},D.src=q})}(ht||(ht={})),ht.resetRequestQueue(),function(c){c.Glyphs="Glyphs",c.Image="Image",c.Source="Source",c.SpriteImage="SpriteImage",c.SpriteJSON="SpriteJSON",c.Style="Style",c.Tile="Tile",c.Unknown="Unknown"}(gt||(gt={}));class Ot{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,a){const l=function(u){const m=u.match(mi);if(!m)throw new Error(`Unable to parse URL "${u}"`);return{protocol:m[1],authority:m[2],path:m[3]||"/",params:m[4]?m[4].split("&"):[]}}(t);return l.path+=`${n}${a}`,function(u){const m=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${m}`}(l)}setTransformRequest(t){this._transformRequestFn=t}}const mi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function It(c){var t=new h.A(3);return t[0]=c[0],t[1]=c[1],t[2]=c[2],t}var it,Tt=function(c,t,n){return c[0]=t[0]-n[0],c[1]=t[1]-n[1],c[2]=t[2]-n[2],c};it=new h.A(3),h.A!=Float32Array&&(it[0]=0,it[1]=0,it[2]=0);var ar=function(c){var t=c[0],n=c[1];return t*t+n*n};function Wt(c){const t=[];if(typeof c=="string")t.push({id:"default",url:c});else if(c&&c.length>0){const n=[];for(const{id:a,url:l}of c){const u=`${a}${l}`;n.indexOf(u)===-1&&(n.push(u),t.push({id:a,url:l}))}}return t}(function(){var c=new h.A(2);h.A!=Float32Array&&(c[0]=0,c[1]=0)})();class Ct{constructor(t,n,a,l){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(n,l)}update(t,n,a){const{width:l,height:u}=t,m=!(this.size&&this.size[0]===l&&this.size[1]===u||a),{context:_}=this,{gl:y}=_;if(this.useMipmap=!!(n&&n.useMipmap),y.bindTexture(y.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!n||n.premultiply!==!1)),m)this.size=[l,u],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||h.b(t)?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,t):y.texImage2D(y.TEXTURE_2D,0,this.format,l,u,0,this.format,y.UNSIGNED_BYTE,t.data);else{const{x:v,y:S}=a||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||h.b(t)?y.texSubImage2D(y.TEXTURE_2D,0,v,S,y.RGBA,y.UNSIGNED_BYTE,t):y.texSubImage2D(y.TEXTURE_2D,0,v,S,l,u,y.RGBA,y.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&y.generateMipmap(y.TEXTURE_2D)}bind(t,n,a){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),a!==u.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=u.LINEAR),t!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,t),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,a||t),this.filter=t),n!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Xt(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class zi extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,promiseResolve:a}of this.requestors)a(this._getImagesForIds(n));this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const a=n.spriteData;n.data=new h.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let a=!0;const l=n.data||n.spriteData;return this._validateStretch(n.stretchX,l&&l.width)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "stretchX" value`))),a=!1),this._validateStretch(n.stretchY,l&&l.height)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "stretchY" value`))),a=!1),this._validateContent(n.content,n)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "content" value`))),a=!1),a}_validateStretch(t,n){if(!t)return!0;let a=0;for(const l of t){if(l[0]<a||l[1]<l[0]||n<l[1])return!1;a=l[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const a=n.spriteData,l=a&&a.width||n.data.width,u=a&&a.height||n.data.height;return!(t[0]<0||l<t[0]||t[1]<0||u<t[1]||t[2]<0||l<t[2]||t[3]<0||u<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,a=!0){const l=this.getImage(t);if(a&&(l.data.width!==n.data.width||l.data.height!==n.data.height))throw new Error(`size mismatch between old image (${l.data.width}x${l.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=l.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((n,a)=>{let l=!0;if(!this.isLoaded())for(const u of t)this.images[u]||(l=!1);this.isLoaded()||l?n(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:n})})}_getImagesForIds(t){const n={};for(const a of t){let l=this.getImage(a);l||(this.fire(new h.k("styleimagemissing",{id:a})),l=this.getImage(a)),l?n[a]={data:l.data.clone(),pixelRatio:l.pixelRatio,sdf:l.sdf,version:l.version,stretchX:l.stretchX,stretchY:l.stretchY,content:l.content,hasRenderCallback:!!(l.userImage&&l.userImage.render)}:h.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],a=this.getImage(t);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const l={w:a.data.width+2,h:a.data.height+2,x:0,y:0},u=new h.I(l,a);this.patterns[t]={bin:l,position:u}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ct(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const u in this.patterns)t.push(this.patterns[u].bin);const{w:n,h:a}=h.p(t),l=this.atlasImage;l.resize({width:n||1,height:a||1});for(const u in this.patterns){const{bin:m}=this.patterns[u],_=m.x+1,y=m.y+1,v=this.getImage(u).data,S=v.width,I=v.height;h.R.copy(v,l,{x:0,y:0},{x:_,y},{width:S,height:I}),h.R.copy(v,l,{x:0,y:I-1},{x:_,y:y-1},{width:S,height:1}),h.R.copy(v,l,{x:0,y:0},{x:_,y:y+I},{width:S,height:1}),h.R.copy(v,l,{x:S-1,y:0},{x:_-1,y},{width:1,height:I}),h.R.copy(v,l,{x:0,y:0},{x:_+S,y},{width:1,height:I})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const a=this.getImage(n);a||h.w(`Image with ID: "${n}" was not found`),Xt(a)&&this.updateImage(n,a)}}}const or=1e20;function pt(c,t,n,a,l,u,m,_,y){for(let v=t;v<t+a;v++)ni(c,n*u+v,u,l,m,_,y);for(let v=n;v<n+l;v++)ni(c,v*u+t,1,a,m,_,y)}function ni(c,t,n,a,l,u,m){u[0]=0,m[0]=-or,m[1]=or,l[0]=c[t];for(let _=1,y=0,v=0;_<a;_++){l[_]=c[t+_*n];const S=_*_;do{const I=u[y];v=(l[_]-l[I]+S-I*I)/(_-I)/2}while(v<=m[y]&&--y>-1);y++,u[y]=_,m[y]=v,m[y+1]=or}for(let _=0,y=0;_<a;_++){for(;m[y+1]<_;)y++;const v=u[y],S=_-v;c[t+_*n]=l[v]+S*S}}class Kt{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return h._(this,void 0,void 0,function*(){const n=[];for(const u in t)for(const m of t[u])n.push(this._getAndCacheGlyphsPromise(u,m));const a=yield Promise.all(n),l={};for(const{stack:u,id:m,glyph:_}of a)l[u]||(l[u]={}),l[u][m]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics};return l})}_getAndCacheGlyphsPromise(t,n){return h._(this,void 0,void 0,function*(){let a=this.entries[t];a||(a=this.entries[t]={glyphs:{},requests:{},ranges:{}});let l=a.glyphs[n];if(l!==void 0)return{stack:t,id:n,glyph:l};if(l=this._tinySDF(a,t,n),l)return a.glyphs[n]=l,{stack:t,id:n,glyph:l};const u=Math.floor(n/256);if(256*u>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[u])return{stack:t,id:n,glyph:l};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[u]){const _=Kt.loadGlyphRange(t,u,this.url,this.requestManager);a.requests[u]=_}const m=yield a.requests[u];for(const _ in m)this._doesCharSupportLocalGlyph(+_)||(a.glyphs[+_]=m[+_]);return a.ranges[u]=!0,{stack:t,id:n,glyph:m[n]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(h.u["CJK Unified Ideographs"](t)||h.u["Hangul Syllables"](t)||h.u.Hiragana(t)||h.u.Katakana(t))}_tinySDF(t,n,a){const l=this.localIdeographFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let u=t.tinySDF;if(!u){let _="400";/bold/i.test(n)?_="900":/medium/i.test(n)?_="500":/light/i.test(n)&&(_="200"),u=t.tinySDF=new Kt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:_})}const m=u.draw(String.fromCharCode(a));return{id:a,bitmap:new h.o({width:m.width||60,height:m.height||60},m.data),metrics:{width:m.glyphWidth/2||24,height:m.glyphHeight/2||24,left:m.glyphLeft/2+.5||0,top:m.glyphTop/2-27.5||-8,advance:m.glyphAdvance/2||24,isDoubleResolution:!0}}}}Kt.loadGlyphRange=function(c,t,n,a){return h._(this,void 0,void 0,function*(){const l=256*t,u=l+255,m=a.transformRequest(n.replace("{fontstack}",c).replace("{range}",`${l}-${u}`),gt.Glyphs),_=yield h.l(m,new AbortController);if(!_||!_.data)throw new Error(`Could not load glyph range. range: ${t}, ${l}-${u}`);const y={};for(const v of h.n(_.data))y[v.id]=v;return y})},Kt.TinySDF=class{constructor({fontSize:c=24,buffer:t=3,radius:n=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:u="normal",fontStyle:m="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=n;const _=this.size=c+4*t,y=this._createCanvas(_),v=this.ctx=y.getContext("2d",{willReadFrequently:!0});v.font=`${m} ${u} ${c}px ${l}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(c){const t=document.createElement("canvas");return t.width=t.height=c,t}draw(c){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:u}=this.ctx.measureText(c),m=Math.ceil(n),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-l))),y=Math.min(this.size-this.buffer,m+Math.ceil(a)),v=_+2*this.buffer,S=y+2*this.buffer,I=Math.max(v*S,0),D=new Uint8ClampedArray(I),q={data:D,width:v,height:S,glyphWidth:_,glyphHeight:y,glyphTop:m,glyphLeft:0,glyphAdvance:t};if(_===0||y===0)return q;const{ctx:N,buffer:Z,gridInner:U,gridOuter:$}=this;N.clearRect(Z,Z,_,y),N.fillText(c,Z,Z+m);const oe=N.getImageData(Z,Z,_,y);$.fill(or,0,I),U.fill(0,0,I);for(let W=0;W<y;W++)for(let ie=0;ie<_;ie++){const ue=oe.data[4*(W*_+ie)+3]/255;if(ue===0)continue;const ce=(W+Z)*v+ie+Z;if(ue===1)$[ce]=0,U[ce]=or;else{const _e=.5-ue;$[ce]=_e>0?_e*_e:0,U[ce]=_e<0?_e*_e:0}}pt($,0,0,v,S,v,this.f,this.v,this.z),pt(U,Z,Z,_,y,v,this.f,this.v,this.z);for(let W=0;W<I;W++){const ie=Math.sqrt($[W])-Math.sqrt(U[W]);D[W]=Math.round(255-255*(ie/this.radius+this.cutoff))}return q}};class Pr{constructor(){this.specification=h.v.light.position}possiblyEvaluate(t,n){return h.y(t.expression.evaluate(n))}interpolate(t,n,a){return{x:h.z.number(t.x,n.x,a),y:h.z.number(t.y,n.y,a),z:h.z.number(t.z,n.z,a)}}}let Xi;class Ft extends h.E{constructor(t){super(),Xi=Xi||new h.q({anchor:new h.D(h.v.light.anchor),position:new Pr,color:new h.D(h.v.light.color),intensity:new h.D(h.v.light.intensity)}),this._transitionable=new h.T(Xi),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(h.r,t,n))for(const a in t){const l=t[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,a){return(!a||a.validate!==!1)&&h.t(this,t.call(h.x,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:h.v}))}}class Pt{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const a=t.join(",")+String(n);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(t,n)),this.dashEntry[a]}getDashRanges(t,n,a){const l=[];let u=t.length%2==1?-t[t.length-1]*a:0,m=t[0]*a,_=!0;l.push({left:u,right:m,isDash:_,zeroLength:t[0]===0});let y=t[0];for(let v=1;v<t.length;v++){_=!_;const S=t[v];u=y*a,y+=S,m=y*a,l.push({left:u,right:m,isDash:_,zeroLength:S===0})}return l}addRoundDash(t,n,a){const l=n/2;for(let u=-a;u<=a;u++){const m=this.width*(this.nextRow+a+u);let _=0,y=t[_];for(let v=0;v<this.width;v++){v/y.right>1&&(y=t[++_]);const S=Math.abs(v-y.left),I=Math.abs(v-y.right),D=Math.min(S,I);let q;const N=u/a*(l+1);if(y.isDash){const Z=l-Math.abs(N);q=Math.sqrt(D*D+Z*Z)}else q=l-Math.sqrt(D*D+N*N);this.data[m+v]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(t){for(let _=t.length-1;_>=0;--_){const y=t[_],v=t[_+1];y.zeroLength?t.splice(_,1):v&&v.isDash===y.isDash&&(v.left=y.left,t.splice(_,1))}const n=t[0],a=t[t.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const l=this.width*this.nextRow;let u=0,m=t[u];for(let _=0;_<this.width;_++){_/m.right>1&&(m=t[++u]);const y=Math.abs(_-m.left),v=Math.abs(_-m.right),S=Math.min(y,v);this.data[l+_]=Math.max(0,Math.min(255,(m.isDash?S:-S)+128))}}addDash(t,n){const a=n?7:0,l=2*a+1;if(this.nextRow+l>this.height)return h.w("LineAtlas out of space"),null;let u=0;for(let _=0;_<t.length;_++)u+=t[_];if(u!==0){const _=this.width/u,y=this.getDashRanges(t,this.width,_);n?this.addRoundDash(y,_,a):this.addRegularDash(y)}const m={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:u};return this.nextRow+=l,this.dirty=!0,m}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const gi="maplibre_preloaded_worker_pool";class si{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<si.workerCount;)this.workers.push(new Worker(h.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[gi]}numActive(){return Object.keys(this.active).length}}const Ki=Math.floor(re.hardwareConcurrency/2);let lr,Di;function Ie(){return lr||(lr=new si),lr}si.workerCount=h.B(globalThis)?Math.max(Math.min(Ki,3),1):1;class et{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n;const a=this.workerPool.acquire(n);for(let l=0;l<a.length;l++){const u=new h.C(a[l],n);u.name=`Worker ${l}`,this.actors.push(u)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n){const a=[];for(const l of this.actors)a.push(l.sendAsync({type:t,data:n}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,n){for(const a of this.actors)a.registerMessageHandler(t,n)}}function kt(){return Di||(Di=new et(Ie(),h.G),Di.registerMessageHandler("getResource",(c,t,n)=>h.m(t,n))),Di}function Ur(c,t){const n=h.F();return h.H(n,n,[1,1,0]),h.J(n,n,[.5*c.width,.5*c.height,1]),h.K(n,n,c.calculatePosMatrix(t.toUnwrapped()))}function Kr(c,t,n,a,l,u){const m=function(I,D,q){if(I)for(const N of I){const Z=D[N];if(Z&&Z.source===q&&Z.type==="fill-extrusion")return!0}else for(const N in D){const Z=D[N];if(Z.source===q&&Z.type==="fill-extrusion")return!0}return!1}(l&&l.layers,t,c.id),_=u.maxPitchScaleFactor(),y=c.tilesIn(a,_,m);y.sort(ke);const v=[];for(const I of y)v.push({wrappedTileID:I.tileID.wrapped().key,queryResults:I.tile.queryRenderedFeatures(t,n,c._state,I.queryGeometry,I.cameraQueryGeometry,I.scale,l,u,_,Ur(c.transform,I.tileID))});const S=function(I){const D={},q={};for(const N of I){const Z=N.queryResults,U=N.wrappedTileID,$=q[U]=q[U]||{};for(const oe in Z){const W=Z[oe],ie=$[oe]=$[oe]||{},ue=D[oe]=D[oe]||[];for(const ce of W)ie[ce.featureIndex]||(ie[ce.featureIndex]=!0,ue.push(ce))}}return D}(v);for(const I in S)S[I].forEach(D=>{const q=D.feature,N=c.getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=N});return S}function ke(c,t){const n=c.tileID,a=t.tileID;return n.overscaledZ-a.overscaledZ||n.canonical.y-a.canonical.y||n.wrap-a.wrap||n.canonical.x-a.canonical.x}function zr(c,t,n){return h._(this,void 0,void 0,function*(){let a=c;if(c.url?a=(yield h.h(t.transformRequest(c.url,gt.Source),n)).data:yield re.frameAsync(n),!a)return null;const l=h.L(h.e(a,c),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(l.vectorLayerIds=a.vector_layers.map(u=>u.id)),l})}class Jt{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof h.M?new h.M(t.lng,t.lat):h.M.convert(t),this}setSouthWest(t){return this._sw=t instanceof h.M?new h.M(t.lng,t.lat):h.M.convert(t),this}extend(t){const n=this._sw,a=this._ne;let l,u;if(t instanceof h.M)l=t,u=t;else{if(!(t instanceof Jt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Jt.convert(t)):this.extend(h.M.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(h.M.convert(t)):this;if(l=t._sw,u=t._ne,!l||!u)return this}return n||a?(n.lng=Math.min(l.lng,n.lng),n.lat=Math.min(l.lat,n.lat),a.lng=Math.max(u.lng,a.lng),a.lat=Math.max(u.lat,a.lat)):(this._sw=new h.M(l.lng,l.lat),this._ne=new h.M(u.lng,u.lat)),this}getCenter(){return new h.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.M(this.getWest(),this.getNorth())}getSouthEast(){return new h.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:a}=h.M.convert(t);let l=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(t){return t instanceof Jt?t:t&&new Jt(t)}static fromLngLat(t,n=0){const a=360*n/40075017,l=a/Math.cos(Math.PI/180*t.lat);return new Jt(new h.M(t.lng-l,t.lat-a),new h.M(t.lng+l,t.lat+a))}}class An{constructor(t,n,a){this.bounds=Jt.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=a||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),a=Math.floor(h.N(this.bounds.getWest())*n),l=Math.floor(h.O(this.bounds.getNorth())*n),u=Math.ceil(h.N(this.bounds.getEast())*n),m=Math.ceil(h.O(this.bounds.getSouth())*n);return t.x>=a&&t.x<u&&t.y>=l&&t.y<m}}class de extends h.E{constructor(t,n,a,l){if(super(),this.id=t,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.L(n,["url","scheme","tileSize","promoteId"])),this._options=h.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(l)}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield zr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(h.e(this,t),t.bounds&&(this.tileBounds=new An(t.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new h.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(t){return h._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(n,gt.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request.collectResourceTiming=this._collectResourceTiming;let l="reloadTile";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((u,m)=>{t.reloadPromise={resolve:u,reject:m}})}else t.actor=this.dispatcher.getActor(),l="loadTile";t.abortController=new AbortController;try{const u=yield t.actor.sendAsync({type:l,data:a},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,u)}catch(u){if(delete t.abortController,t.aborted)return;if(u&&u.status!==404)throw u;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,n){if(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),t.reloadPromise){const a=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(a.resolve).catch(a.reject)}}abortTile(t){return h._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"abortTile",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return h._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"removeTile",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class kn extends h.E{constructor(t,n,a,l){super(),this.id=t,this.dispatcher=a,this.setEventedParent(l),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},n),h.e(this,h.L(n,["url","scheme","tileSize"]))}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield zr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(h.e(this,t),t.bounds&&(this.tileBounds=new An(t.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new h.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return h.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return h._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const a=yield ht.getImage(this.map._requestManager.transformRequest(n,gt.Tile),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&a.cacheControl&&a.expires&&t.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const l=this.map.painter.context,u=l.gl,m=a.data;t.texture=this.map.painter.getTileTexture(m.width),t.texture?t.texture.update(m,{useMipmap:!0}):(t.texture=new Ct(l,m,u.RGBA,{useMipmap:!0}),t.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST),l.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax)),t.state="loaded"}}catch(a){if(delete t.abortController,t.aborted)t.state="unloaded";else if(a)throw t.state="errored",a}})}abortTile(t){return h._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return h._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class vs extends kn{constructor(t,n,a,l){super(t,n,a,l),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t){return h._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(n,gt.Tile);t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const l=yield ht.getImage(a,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){const u=l.data;this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const m=h.b(u)&&h.S()?u:yield this.readImageNow(u),_={type:this.type,uid:t.uid,source:this.id,rawImageData:m,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const y=yield t.actor.sendAsync({type:"loadDEMTile",data:_});t.dem=y,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}})}readImageNow(t){return h._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&h.U()){const n=t.width+2,a=t.height+2;try{return new h.R({width:n,height:a},yield h.V(t,-1,-1,n,a))}catch{}}return re.getImageData(t,1)})}_getNeighboringTiles(t){const n=t.canonical,a=Math.pow(2,n.z),l=(n.x-1+a)%a,u=n.x===0?t.wrap-1:t.wrap,m=(n.x+1+a)%a,_=n.x+1===a?t.wrap+1:t.wrap,y={};return y[new h.Q(t.overscaledZ,u,n.z,l,n.y).key]={backfilled:!1},y[new h.Q(t.overscaledZ,_,n.z,m,n.y).key]={backfilled:!1},n.y>0&&(y[new h.Q(t.overscaledZ,u,n.z,l,n.y-1).key]={backfilled:!1},y[new h.Q(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},y[new h.Q(t.overscaledZ,_,n.z,m,n.y-1).key]={backfilled:!1}),n.y+1<a&&(y[new h.Q(t.overscaledZ,u,n.z,l,n.y+1).key]={backfilled:!1},y[new h.Q(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},y[new h.Q(t.overscaledZ,_,n.z,m,n.y+1).key]={backfilled:!1}),y}unloadTile(t){return h._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class xt extends h.E{constructor(t,n,a,l){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(l),this._data=n.data,this._options=h.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const u=h.W/this.tileSize;this.workerOptions=h.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*u,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*u,extent:h.W,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:h.W,radius:(n.clusterRadius||50)*u,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return h._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,n,a){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:t,limit:n,offset:a}})}_updateWorkerData(t){return h._(this,void 0,void 0,function*(){const n=h.e({type:this.type},this.workerOptions);t?n.dataDiff=t:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(re.resolveURL(this._data),gt.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new h.k("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"loadData",data:n});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new h.k("dataabort",{dataType:"source"}));let l=null;a.resourceTiming&&a.resourceTiming[this.id]&&(l=a.resourceTiming[this.id].slice(0));const u={dataType:"source"};this._collectResourceTiming&&l&&l.length>0&&h.e(u,{resourceTiming:l}),this.fire(new h.k("data",Object.assign(Object.assign({},u),{sourceDataType:"metadata"}))),this.fire(new h.k("data",Object.assign(Object.assign({},u),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new h.k("dataabort",{dataType:"source"}));this.fire(new h.j(a))}})}loaded(){return this._pendingLoads===0}loadTile(t){return h._(this,void 0,void 0,function*(){const n=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const a={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const l=yield this.actor.sendAsync({type:n,data:a},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(l,this.map.painter,n==="reloadTile")})}abortTile(t){return h._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return h._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Fi=h.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Yr extends h.E{constructor(t,n,a,l){super(),this.id=t,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(l),this.options=n}load(t){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield ht.getImage(this.map._requestManager.transformRequest(this.url,gt.Image),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,t&&(this.coordinates=t),this._finishLoading())}catch(n){this._request=null,this.fire(new h.j(n))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(h.Y.fromLngLat);this.tileID=function(l){let u=1/0,m=1/0,_=-1/0,y=-1/0;for(const D of l)u=Math.min(u,D.x),m=Math.min(m,D.y),_=Math.max(_,D.x),y=Math.max(y,D.y);const v=Math.max(_-u,y-m),S=Math.max(0,Math.floor(-Math.log(v)/Math.LN2)),I=Math.pow(2,S);return new h.a0(S,Math.floor((u+_)/2*I),Math.floor((m+y)/2*I))}(n),this.minzoom=this.maxzoom=this.tileID.z;const a=n.map(l=>this.tileID.getTilePoint(l)._round());return this._boundsArray=new h.Z,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,h.W,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,h.W),this._boundsArray.emplaceBack(a[2].x,a[2].y,h.W,h.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Fi.members)),this.boundsSegments||(this.boundsSegments=h.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ct(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const u=this.tiles[l];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture,a=!0)}a&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return h._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Jn extends Yr{constructor(t,n,a,l){super(t,n,a,l),this.roundZoom=!0,this.type="video",this.options=n}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,gt.Source).url);try{const n=yield h.a2(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new h.j(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new h.j(new h.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Fi.members)),this.boundsSegments||(this.boundsSegments=h.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new Ct(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const u=this.tiles[l];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture,a=!0)}a&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class $n extends Yr{constructor(t,n,a,l){super(t,n,a,l),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(u=>!Array.isArray(u)||u.length!==2||u.some(m=>typeof m!="number"))||this.fire(new h.j(new h.a1(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.j(new h.a1(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new h.j(new h.a1(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new h.j(new h.a1(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.j(new h.a1(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return h._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,a=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Fi.members)),this.boundsSegments||(this.boundsSegments=h.$.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ct(n,this.canvas,a.RGBA,{premultiply:!0});let l=!1;for(const u in this.tiles){const m=this.tiles[u];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Qn={},En=c=>{switch(c){case"geojson":return xt;case"image":return Yr;case"raster":return kn;case"raster-dem":return vs;case"vector":return de;case"video":return Jn;case"canvas":return $n}return Qn[c]};class Ks extends h.E{constructor(){super(...arguments),this.pluginStatus="unavailable",this.pluginURL=null,this.dispatcher=kt(),this.queue=[]}_sendPluginStateToWorker(){return h._(this,void 0,void 0,function*(){yield this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}),this.fire(new h.k("pluginStateChange",{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}))})}getRTLTextPluginStatus(){return this.pluginStatus}clearRTLTextPlugin(){this.pluginStatus="unavailable",this.pluginURL=null}setRTLTextPlugin(t,n=!1){return h._(this,void 0,void 0,function*(){if(this.pluginStatus==="deferred"||this.pluginStatus==="loading"||this.pluginStatus==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");this.pluginURL=re.resolveURL(t),this.pluginStatus="deferred",yield this._sendPluginStateToWorker(),n||(yield this._downloadRTLTextPlugin())})}_downloadRTLTextPlugin(){return h._(this,void 0,void 0,function*(){if(this.pluginStatus!=="deferred"||!this.pluginURL)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");try{this.pluginStatus="loading",yield this._sendPluginStateToWorker(),yield h.l({url:this.pluginURL},new AbortController),this.pluginStatus="loaded"}catch{this.pluginStatus="error"}yield this._sendPluginStateToWorker()})}lazyLoadRTLTextPlugin(){return h._(this,void 0,void 0,function*(){this.pluginStatus==="deferred"&&(yield this._downloadRTLTextPlugin())})}}let Mn=null;function Te(){return Mn||(Mn=new Ks),Mn}class Jr{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=h.a3(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(l,u){const m={};if(!u)return m;for(const _ of l){const y=_.layerIds.map(v=>u.getLayer(v)).filter(Boolean);if(y.length!==0){_.layers=y,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(v=>y.filter(S=>S.id===v)[0]));for(const v of y)m[v.id]=_}}return m}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const u=this.buckets[l];if(u instanceof h.a5){if(this.hasSymbolBuckets=!0,!a)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const u=this.buckets[l];if(u instanceof h.a5&&u.hasRTLText){this.hasRTLText=!0,Te().lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const l in this.buckets){const u=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(l).queryRadius(u))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new h.a4}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const l=this.buckets[a];l.uploadPending()&&l.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ct(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ct(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,a,l,u,m,_,y,v,S){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:l,cameraQueryGeometry:u,scale:m,tileSize:this.tileSize,pixelPosMatrix:S,transform:y,params:_,queryPadding:this.queryPadding*v},t,n,a):{}}querySourceFeatures(t,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const l=a.loadVTLayers(),u=n&&n.sourceLayer?n.sourceLayer:"",m=l._geojsonTileLayer||l[u];if(!m)return;const _=h.a6(n&&n.filter),{z:y,x:v,y:S}=this.tileID.canonical,I={z:y,x:v,y:S};for(let D=0;D<m.length;D++){const q=m.feature(D);if(_.needGeometry){const U=h.a7(q,!0);if(!_.filter(new h.a8(this.tileID.overscaledZ),U,this.tileID.canonical))continue}else if(!_.filter(new h.a8(this.tileID.overscaledZ),q))continue;const N=a.getId(q,u),Z=new h.a9(q,y,v,S,N);Z.tile=I,t.push(Z)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const a=h.aa(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let l=!1;if(this.expirationTime>a)l=!1;else if(n)if(this.expirationTime<n)l=!0;else{const u=this.expirationTime-n;u?this.expirationTime=a+Math.max(u,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const l in this.buckets){if(!n.style.hasLayer(l))continue;const u=this.buckets[l],m=u.layers[0].sourceLayer||"_geojsonTileLayer",_=a[m],y=t[m];if(!_||!y||Object.keys(y).length===0)continue;u.update(y,_,this.imageAtlas&&this.imageAtlas.patternPositions||{});const v=n&&n.style&&n.style.getLayer(l);v&&(this.queryPadding=Math.max(this.queryPadding,v.queryRadius(u)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<re.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=re.now()+t}setDependencies(t,n){const a={};for(const l of n)a[l]=!0;this.dependencies[t]=a}hasDependency(t,n){for(const a of t){const l=this.dependencies[a];if(l){for(const u of n)if(l[u])return!0}}return!1}}class vr{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,a){const l=t.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const u={value:n,timeout:void 0};if(a!==void 0&&(u.timeout=setTimeout(()=>{this.remove(t,u)},a)),this.data[l].push(u),this.order.push(l),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const a=t.wrapped().key,l=n===void 0?0:this.data[a].indexOf(n),u=this.data[a][l];return this.data[a].splice(l,1),u.timeout&&clearTimeout(u.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(u.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const a in this.data)for(const l of this.data[a])t(l.value)||n.push(l);for(const a of n)this.remove(a.value.tileID,a)}}class bs{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,a){const l=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][l]=this.stateChanges[t][l]||{},h.e(this.stateChanges[t][l],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(const u in this.state[t])u!==l&&(this.deletedStates[t][u]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][l]===null){this.deletedStates[t][l]={};for(const u in this.state[t][l])a[u]||(this.deletedStates[t][l][u]=null)}else for(const u in a)this.deletedStates[t]&&this.deletedStates[t][l]&&this.deletedStates[t][l][u]===null&&delete this.deletedStates[t][l][u]}removeFeatureState(t,n,a){if(this.deletedStates[t]===null)return;const l=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&n!==void 0)this.deletedStates[t][l]!==null&&(this.deletedStates[t][l]=this.deletedStates[t][l]||{},this.deletedStates[t][l][a]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][l])for(a in this.deletedStates[t][l]={},this.stateChanges[t][l])this.deletedStates[t][l][a]=null;else this.deletedStates[t][l]=null;else this.deletedStates[t]=null}getState(t,n){const a=String(n),l=h.e({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const u=this.deletedStates[t][n];if(u===null)return{};for(const m in u)delete l[m]}return l}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const a={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const u={};for(const m in this.stateChanges[l])this.state[l][m]||(this.state[l][m]={}),h.e(this.state[l][m],this.stateChanges[l][m]),u[m]=this.state[l][m];a[l]=u}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const u={};if(this.deletedStates[l]===null)for(const m in this.state[l])u[m]={},this.state[l][m]={};else for(const m in this.deletedStates[l]){if(this.deletedStates[l][m]===null)this.state[l][m]={};else for(const _ of Object.keys(this.deletedStates[l][m]))delete this.state[l][m][_];u[m]=this.state[l][m]}a[l]=a[l]||{},h.e(a[l],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const l in t)t[l].setFeatureState(a,n)}}class Vi extends h.E{constructor(t,n,a){super(),this.id=t,this.dispatcher=a,this.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((l,u,m,_)=>{const y=new(En(u.type))(l,u,m,_);if(y.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${y.id}`);return y})(t,n,a,this),this._tiles={},this._cache=new vr(0,l=>this._unloadTile(l)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new bs,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n,a){return h._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,n,a)}catch(l){t.state="errored",l.status!==404?this._source.fire(new h.j(l,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new h.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Ee).map(t=>t.key)}getRenderableIds(t){const n=[];for(const a in this._tiles)this._isIdRenderable(a,t)&&n.push(this._tiles[a]);return t?n.sort((a,l)=>{const u=a.tileID,m=l.tileID,_=new h.P(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),y=new h.P(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-m.overscaledZ||y.y-_.y||y.x-_.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(Ee).map(a=>a.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){return h._(this,void 0,void 0,function*(){const a=this._tiles[t];a&&(a.state!=="loading"&&(a.state=n),yield this._loadTile(a,t,n))})}_tileLoaded(t,n,a){t.timeAdded=re.now(),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new h.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let l=0;l<n.length;l++){const u=n[l];if(t.neighboringTiles&&t.neighboringTiles[u]){const m=this.getTileByID(u);a(t,m),a(m,t)}}function a(l,u){l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0;let m=u.tileID.canonical.x-l.tileID.canonical.x;const _=u.tileID.canonical.y-l.tileID.canonical.y,y=Math.pow(2,l.tileID.canonical.z),v=u.tileID.key;m===0&&_===0||Math.abs(_)>1||(Math.abs(m)>1&&(Math.abs(m+y)===1?m+=y:Math.abs(m-y)===1&&(m-=y)),u.dem&&l.dem&&(l.dem.backfillBorder(u.dem,m,_),l.neighboringTiles&&l.neighboringTiles[v]&&(l.neighboringTiles[v].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,a,l){for(const u in this._tiles){let m=this._tiles[u];if(l[u]||!m.hasData()||m.tileID.overscaledZ<=n||m.tileID.overscaledZ>a)continue;let _=m.tileID;for(;m&&m.tileID.overscaledZ>n+1;){const v=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[v.key],m&&m.hasData()&&(_=v)}let y=_;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),t[y.key]){l[_.key]=_;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=t.overscaledZ-1;a>=n;a--){const l=t.scaledTo(a),u=this._getLoadedTile(l);if(u)return u}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,a=Math.ceil(t.height/this._source.tileSize)+1,l=Math.floor(n*a*(this._maxTileCacheZoomLevels===null?h.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),u=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,l):l;this._cache.setMaxSize(u)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const a={};for(const l in this._tiles){const u=this._tiles[l];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+n),a[u.tileID.key]=u}this._tiles=a;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(l,this._tiles[l])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let a;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new h.Q(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y)):(a=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(a=a.filter(S=>this._source.hasTile(S)))):a=[];const l=t.coveringZoomLevel(this._source),u=Math.max(l-Vi.maxOverzooming,this._source.minzoom),m=Math.max(l+Vi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const S={};for(const I of a)if(I.canonical.z>this._source.minzoom){const D=I.scaledTo(I.canonical.z-1);S[D.key]=D;const q=I.scaledTo(Math.max(this._source.minzoom,Math.min(I.canonical.z,5)));S[q.key]=q}a=a.concat(Object.values(S))}const _=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,_&&this.fire(new h.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const y=this._updateRetainedTiles(a,l);if(ut(this._source.type)){const S={},I={},D=Object.keys(y),q=re.now();for(const N of D){const Z=y[N],U=this._tiles[N];if(!U||U.fadeEndTime!==0&&U.fadeEndTime<=q)continue;const $=this.findLoadedParent(Z,u);$&&(this._addTile($.tileID),S[$.tileID.key]=$.tileID),I[N]=Z}this._retainLoadedChildren(I,l,m,y);for(const N in S)y[N]||(this._coveredTiles[N]=!0,y[N]=S[N]);if(n){const N={},Z={};for(const U of a)this._tiles[U.key].hasData()?N[U.key]=U:Z[U.key]=U;for(const U in Z){const $=Z[U].children(this._source.maxzoom);this._tiles[$[0].key]&&this._tiles[$[1].key]&&this._tiles[$[2].key]&&this._tiles[$[3].key]&&(N[$[0].key]=y[$[0].key]=$[0],N[$[1].key]=y[$[1].key]=$[1],N[$[2].key]=y[$[2].key]=$[2],N[$[3].key]=y[$[3].key]=$[3],delete Z[U])}for(const U in Z){const $=this.findLoadedParent(Z[U],this._source.minzoom);if($){N[$.tileID.key]=y[$.tileID.key]=$.tileID;for(const oe in N)N[oe].isChildOf($.tileID)&&delete N[oe]}}for(const U in this._tiles)N[U]||(this._coveredTiles[U]=!0)}}for(const S in y)this._tiles[S].clearFadeHold();const v=h.ab(this._tiles,y);for(const S of v){const I=this._tiles[S];I.hasSymbolBuckets&&!I.holdingForFade()?I.setHoldDuration(this.map._fadeDuration):I.hasSymbolBuckets&&!I.symbolFadeFinished()||this._removeTile(S)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const a={},l={},u=Math.max(n-Vi.maxOverzooming,this._source.minzoom),m=Math.max(n+Vi.maxUnderzooming,this._source.minzoom),_={};for(const y of t){const v=this._addTile(y);a[y.key]=y,v.hasData()||n<this._source.maxzoom&&(_[y.key]=y)}this._retainLoadedChildren(_,n,m,a);for(const y of t){let v=this._tiles[y.key];if(v.hasData())continue;if(n+1>this._source.maxzoom){const I=y.children(this._source.maxzoom)[0],D=this.getTile(I);if(D&&D.hasData()){a[I.key]=I;continue}}else{const I=y.children(this._source.maxzoom);if(a[I[0].key]&&a[I[1].key]&&a[I[2].key]&&a[I[3].key])continue}let S=v.wasRequested();for(let I=y.overscaledZ-1;I>=u;--I){const D=y.scaledTo(I);if(l[D.key])break;if(l[D.key]=!0,v=this.getTile(D),!v&&S&&(v=this._addTile(D)),v){const q=v.hasData();if((S||q)&&(a[D.key]=D),S=v.wasRequested(),q)break}}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let a,l=this._tiles[t].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}n.push(l.key);const u=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(u),a)break;l=u}for(const u of n)this._loadedParentTiles[u]=a}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const a=n;return n||(n=new Jr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,t.key,n.state)),n.uses++,this._tiles[t.key]=n,a||this._source.fire(new h.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=n.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,a){const l=[],u=this.transform;if(!u)return l;const m=a?u.getCameraQueryGeometry(t):t,_=t.map(N=>u.pointCoordinate(N,this.terrain)),y=m.map(N=>u.pointCoordinate(N,this.terrain)),v=this.getIds();let S=1/0,I=1/0,D=-1/0,q=-1/0;for(const N of y)S=Math.min(S,N.x),I=Math.min(I,N.y),D=Math.max(D,N.x),q=Math.max(q,N.y);for(let N=0;N<v.length;N++){const Z=this._tiles[v[N]];if(Z.holdingForFade())continue;const U=Z.tileID,$=Math.pow(2,u.zoom-Z.tileID.overscaledZ),oe=n*Z.queryPadding*h.W/Z.tileSize/$,W=[U.getTilePoint(new h.Y(S,I)),U.getTilePoint(new h.Y(D,q))];if(W[0].x-oe<h.W&&W[0].y-oe<h.W&&W[1].x+oe>=0&&W[1].y+oe>=0){const ie=_.map(ce=>U.getTilePoint(ce)),ue=y.map(ce=>U.getTilePoint(ce));l.push({tile:Z,tileID:U,queryGeometry:ie,cameraQueryGeometry:ue,scale:$})}}return l}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(const a of n)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(ut(this._source.type)){const t=re.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=t)return!0}return!1}setFeatureState(t,n,a){this._state.updateState(t=t||"_geojsonTileLayer",n,a)}removeFeatureState(t,n,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,a)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,a){const l=this._tiles[t];l&&l.setDependencies(n,a)}reloadTilesForDependencies(t,n){for(const a in this._tiles)this._tiles[a].hasDependency(t,n)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(t,n))}}function Ee(c,t){const n=Math.abs(2*c.wrap)-+(c.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return c.overscaledZ-t.overscaledZ||a-n||t.canonical.y-c.canonical.y||t.canonical.x-c.canonical.x}function ut(c){return c==="raster"||c==="image"||c==="video"}Vi.maxOverzooming=10,Vi.maxUnderzooming=3;class at{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=h.ac(t,0,1);let n=1,a=this._distances[n];const l=t*this.paddedLength+this.padding;for(;a<l&&n<this._distances.length;)a=this._distances[++n];const u=n-1,m=this._distances[u],_=a-m,y=_>0?(l-m)/_:0;return this.points[u].mult(1-y).add(this.points[n].mult(y))}}function _i(c,t){let n=!0;return c==="always"||c!=="never"&&t!=="never"||(n=!1),n}class $r{constructor(t,n,a){const l=this.boxCells=[],u=this.circleCells=[];this.xCellCount=Math.ceil(t/a),this.yCellCount=Math.ceil(n/a);for(let m=0;m<this.xCellCount*this.yCellCount;m++)l.push([]),u.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,a,l,u){this._forEachCell(n,a,l,u,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(u)}insertCircle(t,n,a,l){this._forEachCell(n-l,a-l,n+l,a+l,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(a),this.circles.push(l)}_insertBoxCell(t,n,a,l,u,m){this.boxCells[u].push(m)}_insertCircleCell(t,n,a,l,u,m){this.circleCells[u].push(m)}_query(t,n,a,l,u,m,_){if(a<0||t>this.width||l<0||n>this.height)return[];const y=[];if(t<=0&&n<=0&&this.width<=a&&this.height<=l){if(u)return[{key:null,x1:t,y1:n,x2:a,y2:l}];for(let v=0;v<this.boxKeys.length;v++)y.push({key:this.boxKeys[v],x1:this.bboxes[4*v],y1:this.bboxes[4*v+1],x2:this.bboxes[4*v+2],y2:this.bboxes[4*v+3]});for(let v=0;v<this.circleKeys.length;v++){const S=this.circles[3*v],I=this.circles[3*v+1],D=this.circles[3*v+2];y.push({key:this.circleKeys[v],x1:S-D,y1:I-D,x2:S+D,y2:I+D})}}else this._forEachCell(t,n,a,l,this._queryCell,y,{hitTest:u,overlapMode:m,seenUids:{box:{},circle:{}}},_);return y}query(t,n,a,l){return this._query(t,n,a,l,!1,null)}hitTest(t,n,a,l,u,m){return this._query(t,n,a,l,!0,u,m).length>0}hitTestCircle(t,n,a,l,u){const m=t-a,_=t+a,y=n-a,v=n+a;if(_<0||m>this.width||v<0||y>this.height)return!1;const S=[];return this._forEachCell(m,y,_,v,this._queryCellCircle,S,{hitTest:!0,overlapMode:l,circle:{x:t,y:n,radius:a},seenUids:{box:{},circle:{}}},u),S.length>0}_queryCell(t,n,a,l,u,m,_,y){const{seenUids:v,hitTest:S,overlapMode:I}=_,D=this.boxCells[u];if(D!==null){const N=this.bboxes;for(const Z of D)if(!v.box[Z]){v.box[Z]=!0;const U=4*Z,$=this.boxKeys[Z];if(t<=N[U+2]&&n<=N[U+3]&&a>=N[U+0]&&l>=N[U+1]&&(!y||y($))&&(!S||!_i(I,$.overlapMode))&&(m.push({key:$,x1:N[U],y1:N[U+1],x2:N[U+2],y2:N[U+3]}),S))return!0}}const q=this.circleCells[u];if(q!==null){const N=this.circles;for(const Z of q)if(!v.circle[Z]){v.circle[Z]=!0;const U=3*Z,$=this.circleKeys[Z];if(this._circleAndRectCollide(N[U],N[U+1],N[U+2],t,n,a,l)&&(!y||y($))&&(!S||!_i(I,$.overlapMode))){const oe=N[U],W=N[U+1],ie=N[U+2];if(m.push({key:$,x1:oe-ie,y1:W-ie,x2:oe+ie,y2:W+ie}),S)return!0}}}return!1}_queryCellCircle(t,n,a,l,u,m,_,y){const{circle:v,seenUids:S,overlapMode:I}=_,D=this.boxCells[u];if(D!==null){const N=this.bboxes;for(const Z of D)if(!S.box[Z]){S.box[Z]=!0;const U=4*Z,$=this.boxKeys[Z];if(this._circleAndRectCollide(v.x,v.y,v.radius,N[U+0],N[U+1],N[U+2],N[U+3])&&(!y||y($))&&!_i(I,$.overlapMode))return m.push(!0),!0}}const q=this.circleCells[u];if(q!==null){const N=this.circles;for(const Z of q)if(!S.circle[Z]){S.circle[Z]=!0;const U=3*Z,$=this.circleKeys[Z];if(this._circlesCollide(N[U],N[U+1],N[U+2],v.x,v.y,v.radius)&&(!y||y($))&&!_i(I,$.overlapMode))return m.push(!0),!0}}}_forEachCell(t,n,a,l,u,m,_,y){const v=this._convertToXCellCoord(t),S=this._convertToYCellCoord(n),I=this._convertToXCellCoord(a),D=this._convertToYCellCoord(l);for(let q=v;q<=I;q++)for(let N=S;N<=D;N++)if(u.call(this,t,n,a,l,this.xCellCount*N+q,m,_,y))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,a,l,u,m){const _=l-t,y=u-n,v=a+m;return v*v>_*_+y*y}_circleAndRectCollide(t,n,a,l,u,m,_){const y=(m-l)/2,v=Math.abs(t-(l+y));if(v>y+a)return!1;const S=(_-u)/2,I=Math.abs(n-(u+S));if(I>S+a)return!1;if(v<=y||I<=S)return!0;const D=v-y,q=I-S;return D*D+q*q<=a*a}}function rt(c,t,n,a,l){const u=h.F();return t?(h.J(u,u,[1/l,1/l,1]),n||h.ad(u,u,a.angle)):h.K(u,a.labelPlaneMatrix,c),u}function Pn(c,t,n,a,l){if(t){const u=h.ae(c);return h.J(u,u,[l,l,1]),n||h.ad(u,u,-a.angle),u}return a.glCoordMatrix}function bi(c,t,n){let a;n?(a=[c.x,c.y,n(c.x,c.y),1],h.af(a,a,t)):(a=[c.x,c.y,0,1],Ge(a,a,t));const l=a[3];return{point:new h.P(a[0]/l,a[1]/l),signedDistanceFromCamera:l}}function H(c,t){return .5+c/t*.5}function A(c,t){const n=c[0]/c[3],a=c[1]/c[3];return n>=-t[0]&&n<=t[0]&&a>=-t[1]&&a<=t[1]}function P(c,t,n,a,l,u,m,_,y,v){const S=a?c.textSizeData:c.iconSizeData,I=h.ag(S,n.transform.zoom),D=[256/n.width*2+1,256/n.height*2+1],q=a?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;q.clear();const N=c.lineVertexArray,Z=a?c.text.placedSymbolArray:c.icon.placedSymbolArray,U=n.transform.width/n.transform.height;let $=!1;for(let oe=0;oe<Z.length;oe++){const W=Z.get(oe);if(W.hidden||W.writingMode===h.ah.vertical&&!$){ge(W.numGlyphs,q);continue}let ie;if($=!1,v?(ie=[W.anchorX,W.anchorY,v(W.anchorX,W.anchorY),1],h.af(ie,ie,t)):(ie=[W.anchorX,W.anchorY,0,1],Ge(ie,ie,t)),!A(ie,D)){ge(W.numGlyphs,q);continue}const ue=H(n.transform.cameraToCenterDistance,ie[3]),ce=h.ai(S,I,W),_e=m?ce/ue:ce*ue,be=new h.P(W.anchorX,W.anchorY),ve=bi(be,l,v).point,Se={projections:{},offsets:{}},Oe=Q(W,_e,!1,_,t,l,u,c.glyphOffsetArray,N,q,ve,be,Se,U,y,v);$=Oe.useVertical,(Oe.notEnoughRoom||$||Oe.needsFlipping&&Q(W,_e,!0,_,t,l,u,c.glyphOffsetArray,N,q,ve,be,Se,U,y,v).notEnoughRoom)&&ge(W.numGlyphs,q)}a?c.text.dynamicLayoutVertexBuffer.updateData(q):c.icon.dynamicLayoutVertexBuffer.updateData(q)}function B(c,t,n,a,l,u,m,_,y,v,S,I,D){const q=_.glyphStartIndex+_.numGlyphs,N=_.lineStartIndex,Z=_.lineStartIndex+_.lineLength,U=t.getoffsetX(_.glyphStartIndex),$=t.getoffsetX(q-1),oe=xe(c*U,n,a,l,u,m,_.segment,N,Z,y,v,S,I,D);if(!oe)return null;const W=xe(c*$,n,a,l,u,m,_.segment,N,Z,y,v,S,I,D);return W?{first:oe,last:W}:null}function j(c,t,n,a){return c===h.ah.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*a?{useVertical:!0}:(c===h.ah.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function Q(c,t,n,a,l,u,m,_,y,v,S,I,D,q,N,Z){const U=t/24,$=c.lineOffsetX*U,oe=c.lineOffsetY*U;let W;if(c.numGlyphs>1){const ie=c.glyphStartIndex+c.numGlyphs,ue=c.lineStartIndex,ce=c.lineStartIndex+c.lineLength,_e=B(U,_,$,oe,n,S,I,c,y,u,D,N,Z);if(!_e)return{notEnoughRoom:!0};const be=bi(_e.first.point,m,Z).point,ve=bi(_e.last.point,m,Z).point;if(a&&!n){const Se=j(c.writingMode,be,ve,q);if(Se)return Se}W=[_e.first];for(let Se=c.glyphStartIndex+1;Se<ie-1;Se++)W.push(xe(U*_.getoffsetX(Se),$,oe,n,S,I,c.segment,ue,ce,y,u,D,N,Z));W.push(_e.last)}else{if(a&&!n){const ue=bi(I,l,Z).point,ce=c.lineStartIndex+c.segment+1,_e=new h.P(y.getx(ce),y.gety(ce)),be=bi(_e,l,Z),ve=be.signedDistanceFromCamera>0?be.point:ee(I,_e,ue,1,l,Z),Se=j(c.writingMode,ue,ve,q);if(Se)return Se}const ie=xe(U*_.getoffsetX(c.glyphStartIndex),$,oe,n,S,I,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,y,u,D,N,Z);if(!ie)return{notEnoughRoom:!0};W=[ie]}for(const ie of W)h.aj(v,ie.point,ie.angle);return{}}function ee(c,t,n,a,l,u){const m=bi(c.add(c.sub(t)._unit()),l,u).point,_=n.sub(m);return n.add(_._mult(a/_.mag()))}function ne(c,t){const{projectionCache:n,lineVertexArray:a,labelPlaneMatrix:l,tileAnchorPoint:u,distanceFromAnchor:m,getElevation:_,previousVertex:y,direction:v,absOffsetX:S}=t;if(n.projections[c])return n.projections[c];const I=new h.P(a.getx(c),a.gety(c)),D=bi(I,l,_);if(D.signedDistanceFromCamera>0)return n.projections[c]=D.point,D.point;const q=c-v;return ee(m===0?u:new h.P(a.getx(q),a.gety(q)),I,y,S-m+1,l,_)}function J(c,t,n){return c._unit()._perp()._mult(t*n)}function ae(c,t,n,a,l,u,m,_){const{projectionCache:y,direction:v}=_;if(y.offsets[c])return y.offsets[c];const S=n.add(t);if(c+v<a||c+v>=l)return y.offsets[c]=S,S;const I=ne(c+v,_),D=J(I.sub(n),m,v),q=n.add(D),N=I.add(D);return y.offsets[c]=h.ak(u,S,q,N)||S,y.offsets[c]}function xe(c,t,n,a,l,u,m,_,y,v,S,I,D,q){const N=a?c-t:c+t;let Z=N>0?1:-1,U=0;a&&(Z*=-1,U=Math.PI),Z<0&&(U+=Math.PI);let $,oe,W=Z>0?_+m:_+m+1,ie=l,ue=l,ce=0,_e=0;const be=Math.abs(N),ve=[];let Se;for(;ce+_e<=be;){if(W+=Z,W<_||W>=y)return null;ce+=_e,ue=ie,oe=$;const Me={projectionCache:I,lineVertexArray:v,labelPlaneMatrix:S,tileAnchorPoint:u,distanceFromAnchor:ce,getElevation:q,previousVertex:ue,direction:Z,absOffsetX:be};if(ie=ne(W,Me),n===0)ve.push(ue),Se=ie.sub(ue);else{let Xe;const Ue=ie.sub(ue);Xe=Ue.mag()===0?J(ne(W+Z,Me).sub(ie),n,Z):J(Ue,n,Z),oe||(oe=ue.add(Xe)),$=ae(W,Xe,ie,_,y,oe,n,Me),ve.push(oe),Se=$.sub(oe)}_e=Se.mag()}const Oe=Se._mult((be-ce)/_e)._add(oe||ue),Ke=U+Math.atan2(ie.y-ue.y,ie.x-ue.x);return ve.push(Oe),{point:Oe,angle:D?Ke:0,path:ve}}const me=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ge(c,t){for(let n=0;n<c;n++){const a=t.length;t.resize(a+4),t.float32.set(me,3*a)}}function Ge(c,t,n){const a=t[0],l=t[1];return c[0]=n[0]*a+n[4]*l+n[12],c[1]=n[1]*a+n[5]*l+n[13],c[3]=n[3]*a+n[7]*l+n[15],c}const We=100;class nt{constructor(t,n=new $r(t.width+200,t.height+200,25),a=new $r(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=a,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+We,this.screenBottomBoundary=t.height+We,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,a,l,u,m){const _=this.projectAndGetPerspectiveRatio(l,t.anchorPointX,t.anchorPointY,m),y=a*_.perspectiveRatio,v=t.x1*y+_.point.x,S=t.y1*y+_.point.y,I=t.x2*y+_.point.x,D=t.y2*y+_.point.y;return!this.isInsideGrid(v,S,I,D)||n!=="always"&&this.grid.hitTest(v,S,I,D,n,u)||_.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[v,S,I,D],offscreen:this.isOffscreen(v,S,I,D)}}placeCollisionCircles(t,n,a,l,u,m,_,y,v,S,I,D,q,N){const Z=[],U=new h.P(n.anchorX,n.anchorY),$=bi(U,m,N),oe=H(this.transform.cameraToCenterDistance,$.signedDistanceFromCamera),W=(S?u/oe:u*oe)/h.ao,ie=bi(U,_,N).point,ue=B(W,l,n.lineOffsetX*W,n.lineOffsetY*W,!1,ie,U,n,a,_,{projections:{},offsets:{}},!1,N);let ce=!1,_e=!1,be=!0;if(ue){const ve=.5*D*oe+q,Se=new h.P(-100,-100),Oe=new h.P(this.screenRightBoundary,this.screenBottomBoundary),Ke=new at,Me=ue.first,Xe=ue.last;let Ue=[];for(let lt=Me.path.length-1;lt>=1;lt--)Ue.push(Me.path[lt]);for(let lt=1;lt<Xe.path.length;lt++)Ue.push(Xe.path[lt]);const Nt=2.5*ve;if(y){const lt=Ue.map(mt=>bi(mt,y,N));Ue=lt.some(mt=>mt.signedDistanceFromCamera<=0)?[]:lt.map(mt=>mt.point)}let ft=[];if(Ue.length>0){const lt=Ue[0].clone(),mt=Ue[0].clone();for(let li=1;li<Ue.length;li++)lt.x=Math.min(lt.x,Ue[li].x),lt.y=Math.min(lt.y,Ue[li].y),mt.x=Math.max(mt.x,Ue[li].x),mt.y=Math.max(mt.y,Ue[li].y);ft=lt.x>=Se.x&&mt.x<=Oe.x&&lt.y>=Se.y&&mt.y<=Oe.y?[Ue]:mt.x<Se.x||lt.x>Oe.x||mt.y<Se.y||lt.y>Oe.y?[]:h.al([Ue],Se.x,Se.y,Oe.x,Oe.y)}for(const lt of ft){Ke.reset(lt,.25*ve);let mt=0;mt=Ke.length<=.5*ve?1:Math.ceil(Ke.paddedLength/Nt)+1;for(let li=0;li<mt;li++){const Dt=li/Math.max(mt-1,1),er=Ke.lerp(Dt),Ri=er.x+We,ti=er.y+We;Z.push(Ri,ti,ve,0);const Ni=Ri-ve,ji=ti-ve,Br=Ri+ve,xn=ti+ve;if(be=be&&this.isOffscreen(Ni,ji,Br,xn),_e=_e||this.isInsideGrid(Ni,ji,Br,xn),t!=="always"&&this.grid.hitTestCircle(Ri,ti,ve,t,I)&&(ce=!0,!v))return{circles:[],offscreen:!1,collisionDetected:ce}}}}return{circles:!v&&ce||!_e||oe<this.perspectiveRatioCutoff?[]:Z,offscreen:be,collisionDetected:ce}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let a=1/0,l=1/0,u=-1/0,m=-1/0;for(const S of t){const I=new h.P(S.x+We,S.y+We);a=Math.min(a,I.x),l=Math.min(l,I.y),u=Math.max(u,I.x),m=Math.max(m,I.y),n.push(I)}const _=this.grid.query(a,l,u,m).concat(this.ignoredGrid.query(a,l,u,m)),y={},v={};for(const S of _){const I=S.key;if(y[I.bucketInstanceId]===void 0&&(y[I.bucketInstanceId]={}),y[I.bucketInstanceId][I.featureIndex])continue;const D=[new h.P(S.x1,S.y1),new h.P(S.x2,S.y1),new h.P(S.x2,S.y2),new h.P(S.x1,S.y2)];h.am(n,D)&&(y[I.bucketInstanceId][I.featureIndex]=!0,v[I.bucketInstanceId]===void 0&&(v[I.bucketInstanceId]=[]),v[I.bucketInstanceId].push(I.featureIndex))}return v}insertCollisionBox(t,n,a,l,u,m){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:l,featureIndex:u,collisionGroupID:m,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,a,l,u,m){const _=a?this.ignoredGrid:this.grid,y={bucketInstanceId:l,featureIndex:u,collisionGroupID:m,overlapMode:n};for(let v=0;v<t.length;v+=4)_.insertCircle(y,t[v],t[v+1],t[v+2])}projectAndGetPerspectiveRatio(t,n,a,l){let u;return l?(u=[n,a,l(n,a),1],h.af(u,u,t)):(u=[n,a,0,1],Ge(u,u,t)),{point:new h.P((u[0]/u[3]+1)/2*this.transform.width+We,(-u[1]/u[3]+1)/2*this.transform.height+We),perspectiveRatio:.5+this.transform.cameraToCenterDistance/u[3]*.5}}isOffscreen(t,n,a,l){return a<We||t>=this.screenRightBoundary||l<We||n>this.screenBottomBoundary}isInsideGrid(t,n,a,l){return a>=0&&t<this.gridRightBoundary&&l>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=h.an([]);return h.H(t,t,[-100,-100,0]),t}}function tt(c,t,n){return t*(h.W/(c.tileSize*Math.pow(2,n-c.tileID.overscaledZ)))}class vt{constructor(t,n,a,l){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):l&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class zt{constructor(t,n,a,l,u){this.text=new vt(t?t.text:null,n,a,u),this.icon=new vt(t?t.icon:null,n,l,u)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Gt{constructor(t,n,a){this.text=t,this.icon=n,this.skipFade=a}}class yi{constructor(){this.invProjMatrix=h.F(),this.viewportMatrix=h.F(),this.circles=[]}}class ot{constructor(t,n,a,l,u){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=a,this.bucketIndex=l,this.tileID=u}}class $t{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:a=>a.collisionGroupID===n}}return this.collisionGroups[t]}}function wi(c,t,n,a,l){const{horizontalAlign:u,verticalAlign:m}=h.at(c);return new h.P(-(u-.5)*t+a[0]*l,-(m-.5)*n+a[1]*l)}function Yi(c,t,n,a,l,u){const{x1:m,x2:_,y1:y,y2:v,anchorPointX:S,anchorPointY:I}=c,D=new h.P(t,n);return a&&D._rotate(l?u:-u),{x1:m+D.x,y1:y+D.y,x2:_+D.x,y2:v+D.y,anchorPointX:S,anchorPointY:I}}class cr{constructor(t,n,a,l,u){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new nt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new $t(l),this.collisionCircleArrays={},this.prevPlacement=u,u&&(u.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,a,l){const u=a.getBucket(n),m=a.latestFeatureIndex;if(!u||!m||n.id!==u.layerIds[0])return;const _=a.collisionBoxArray,y=u.layers[0].layout,v=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),S=a.tileSize/h.W,I=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),D=y.get("text-pitch-alignment")==="map",q=y.get("text-rotation-alignment")==="map",N=tt(a,1,this.transform.zoom),Z=rt(I,D,q,this.transform,N);let U=null;if(D){const oe=Pn(I,D,q,this.transform,N);U=h.K([],this.transform.labelPlaneMatrix,oe)}this.retainedQueryData[u.bucketInstanceId]=new ot(u.bucketInstanceId,m,u.sourceLayerIndex,u.index,a.tileID);const $={bucket:u,layout:y,posMatrix:I,textLabelPlaneMatrix:Z,labelToScreenMatrix:U,scale:v,textPixelRatio:S,holdingForFade:a.holdingForFade(),collisionBoxArray:_,partiallyEvaluatedTextSize:h.ag(u.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(u.sourceID)};if(l)for(const oe of u.sortKeyRanges){const{sortKey:W,symbolInstanceStart:ie,symbolInstanceEnd:ue}=oe;t.push({sortKey:W,symbolInstanceStart:ie,symbolInstanceEnd:ue,parameters:$})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:u.symbolInstances.length,parameters:$})}attemptAnchorPlacement(t,n,a,l,u,m,_,y,v,S,I,D,q,N,Z,U){const $=h.ap[t.textAnchor],oe=[t.textOffset0,t.textOffset1],W=wi($,a,l,oe,u),ie=this.collisionIndex.placeCollisionBox(Yi(n,W.x,W.y,m,_,this.transform.angle),I,y,v,S.predicate,U);if((!Z||this.collisionIndex.placeCollisionBox(Yi(Z,W.x,W.y,m,_,this.transform.angle),I,y,v,S.predicate,U).box.length!==0)&&ie.box.length>0){let ue;if(this.prevPlacement&&this.prevPlacement.variableOffsets[D.crossTileID]&&this.prevPlacement.placements[D.crossTileID]&&this.prevPlacement.placements[D.crossTileID].text&&(ue=this.prevPlacement.variableOffsets[D.crossTileID].anchor),D.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[D.crossTileID]={textOffset:oe,width:a,height:l,anchor:$,textBoxScale:u,prevAnchor:ue},this.markUsedJustification(q,$,D,N),q.allowVerticalPlacement&&(this.markUsedOrientation(q,N,D),this.placedOrientations[D.crossTileID]=N),{shift:W,placedGlyphBoxes:ie}}}placeLayerBucketPart(t,n,a){const{bucket:l,layout:u,posMatrix:m,textLabelPlaneMatrix:_,labelToScreenMatrix:y,textPixelRatio:v,holdingForFade:S,collisionBoxArray:I,partiallyEvaluatedTextSize:D,collisionGroup:q}=t.parameters,N=u.get("text-optional"),Z=u.get("icon-optional"),U=h.aq(u,"text-overlap","text-allow-overlap"),$=U==="always",oe=h.aq(u,"icon-overlap","icon-allow-overlap"),W=oe==="always",ie=u.get("text-rotation-alignment")==="map",ue=u.get("text-pitch-alignment")==="map",ce=u.get("icon-text-fit")!=="none",_e=u.get("symbol-z-order")==="viewport-y",be=$&&(W||!l.hasIconData()||Z),ve=W&&($||!l.hasTextData()||N);!l.collisionArrays&&I&&l.deserializeCollisionBoxes(I);const Se=this.retainedQueryData[l.bucketInstanceId].tileID,Oe=this.terrain?(Me,Xe)=>this.terrain.getElevation(Se,Me,Xe):null,Ke=(Me,Xe)=>{var Ue,Nt;if(n[Me.crossTileID])return;if(S)return void(this.placements[Me.crossTileID]=new Gt(!1,!1,!1));let ft=!1,lt=!1,mt=!0,li=null,Dt={box:null,offscreen:null},er={box:null,offscreen:null},Ri=null,ti=null,Ni=null,ji=0,Br=0,xn=0;Xe.textFeatureIndex?ji=Xe.textFeatureIndex:Me.useRuntimeCollisionCircles&&(ji=Me.featureIndex),Xe.verticalTextFeatureIndex&&(Br=Xe.verticalTextFeatureIndex);const us=Xe.textBox;if(us){const Si=jt=>{let Ti=h.ah.horizontal;if(l.allowVerticalPlacement&&!jt&&this.prevPlacement){const Bi=this.prevPlacement.placedOrientations[Me.crossTileID];Bi&&(this.placedOrientations[Me.crossTileID]=Bi,Ti=Bi,this.markUsedOrientation(l,Ti,Me))}return Ti},ci=(jt,Ti)=>{if(l.allowVerticalPlacement&&Me.numVerticalGlyphVertices>0&&Xe.verticalTextBox){for(const Bi of l.writingModes)if(Bi===h.ah.vertical?(Dt=Ti(),er=Dt):Dt=jt(),Dt&&Dt.box&&Dt.box.length)break}else Dt=jt()},ii=Me.textAnchorOffsetStartIndex,tr=Me.textAnchorOffsetEndIndex;if(tr===ii){const jt=(Ti,Bi)=>{const Ii=this.collisionIndex.placeCollisionBox(Ti,U,v,m,q.predicate,Oe);return Ii&&Ii.box&&Ii.box.length&&(this.markUsedOrientation(l,Bi,Me),this.placedOrientations[Me.crossTileID]=Bi),Ii};ci(()=>jt(us,h.ah.horizontal),()=>{const Ti=Xe.verticalTextBox;return l.allowVerticalPlacement&&Me.numVerticalGlyphVertices>0&&Ti?jt(Ti,h.ah.vertical):{box:null,offscreen:null}}),Si(Dt&&Dt.box&&Dt.box.length)}else{let jt=h.ap[(Nt=(Ue=this.prevPlacement)===null||Ue===void 0?void 0:Ue.variableOffsets[Me.crossTileID])===null||Nt===void 0?void 0:Nt.anchor];const Ti=(Ii,Ul,ri)=>{const Lo=Ii.x2-Ii.x1,Nl=Ii.y2-Ii.y1,qn=Me.textBoxScale,Zn=ce&&oe==="never"?Ul:null;let cn={box:[],offscreen:!1},za=U==="never"?1:2,Ro="never";jt&&za++;for(let jl=0;jl<za;jl++){for(let Da=ii;Da<tr;Da++){const ql=l.textAnchorOffsets.get(Da);if(jt&&ql.textAnchor!==jt)continue;const Zs=this.attemptAnchorPlacement(ql,Ii,Lo,Nl,qn,ie,ue,v,m,q,Ro,Me,l,ri,Zn,Oe);if(Zs&&(cn=Zs.placedGlyphBoxes,cn&&cn.box&&cn.box.length))return ft=!0,li=Zs.shift,cn}jt?jt=null:Ro=U}return cn};ci(()=>Ti(us,Xe.iconBox,h.ah.horizontal),()=>{const Ii=Xe.verticalTextBox;return l.allowVerticalPlacement&&!(Dt&&Dt.box&&Dt.box.length)&&Me.numVerticalGlyphVertices>0&&Ii?Ti(Ii,Xe.verticalIconBox,h.ah.vertical):{box:null,offscreen:null}}),Dt&&(ft=Dt.box,mt=Dt.offscreen);const Bi=Si(Dt&&Dt.box);if(!ft&&this.prevPlacement){const Ii=this.prevPlacement.variableOffsets[Me.crossTileID];Ii&&(this.variableOffsets[Me.crossTileID]=Ii,this.markUsedJustification(l,Ii.anchor,Me,Bi))}}}if(Ri=Dt,ft=Ri&&Ri.box&&Ri.box.length>0,mt=Ri&&Ri.offscreen,Me.useRuntimeCollisionCircles){const Si=l.text.placedSymbolArray.get(Me.centerJustifiedTextSymbolIndex),ci=h.ai(l.textSizeData,D,Si),ii=u.get("text-padding");ti=this.collisionIndex.placeCollisionCircles(U,Si,l.lineVertexArray,l.glyphOffsetArray,ci,m,_,y,a,ue,q.predicate,Me.collisionCircleDiameter,ii,Oe),ti.circles.length&&ti.collisionDetected&&!a&&h.w("Collisions detected, but collision boxes are not shown"),ft=$||ti.circles.length>0&&!ti.collisionDetected,mt=mt&&ti.offscreen}if(Xe.iconFeatureIndex&&(xn=Xe.iconFeatureIndex),Xe.iconBox){const Si=ci=>{const ii=ce&&li?Yi(ci,li.x,li.y,ie,ue,this.transform.angle):ci;return this.collisionIndex.placeCollisionBox(ii,oe,v,m,q.predicate,Oe)};er&&er.box&&er.box.length&&Xe.verticalIconBox?(Ni=Si(Xe.verticalIconBox),lt=Ni.box.length>0):(Ni=Si(Xe.iconBox),lt=Ni.box.length>0),mt=mt&&Ni.offscreen}const ds=N||Me.numHorizontalGlyphVertices===0&&Me.numVerticalGlyphVertices===0,vn=Z||Me.numIconVertices===0;if(ds||vn?vn?ds||(lt=lt&&ft):ft=lt&&ft:lt=ft=lt&&ft,ft&&Ri&&Ri.box&&this.collisionIndex.insertCollisionBox(Ri.box,U,u.get("text-ignore-placement"),l.bucketInstanceId,er&&er.box&&Br?Br:ji,q.ID),lt&&Ni&&this.collisionIndex.insertCollisionBox(Ni.box,oe,u.get("icon-ignore-placement"),l.bucketInstanceId,xn,q.ID),ti&&(ft&&this.collisionIndex.insertCollisionCircles(ti.circles,U,u.get("text-ignore-placement"),l.bucketInstanceId,ji,q.ID),a)){const Si=l.bucketInstanceId;let ci=this.collisionCircleArrays[Si];ci===void 0&&(ci=this.collisionCircleArrays[Si]=new yi);for(let ii=0;ii<ti.circles.length;ii+=4)ci.circles.push(ti.circles[ii+0]),ci.circles.push(ti.circles[ii+1]),ci.circles.push(ti.circles[ii+2]),ci.circles.push(ti.collisionDetected?1:0)}if(Me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(l.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Me.crossTileID]=new Gt(ft||be,lt||ve,mt||l.justReloaded),n[Me.crossTileID]=!0};if(_e){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Me=l.getSortedSymbolIndexes(this.transform.angle);for(let Xe=Me.length-1;Xe>=0;--Xe){const Ue=Me[Xe];Ke(l.symbolInstances.get(Ue),l.collisionArrays[Ue])}}else for(let Me=t.symbolInstanceStart;Me<t.symbolInstanceEnd;Me++)Ke(l.symbolInstances.get(Me),l.collisionArrays[Me]);if(a&&l.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[l.bucketInstanceId];h.ar(Me.invProjMatrix,m),Me.viewportMatrix=this.collisionIndex.getViewportMatrix()}l.justReloaded=!1}markUsedJustification(t,n,a,l){let u;u=l===h.ah.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[h.as(n)];const m=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const _ of m)_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=u>=0&&_!==u?0:a.crossTileID)}markUsedOrientation(t,n,a){const l=n===h.ah.horizontal||n===h.ah.horizontalOnly?n:0,u=n===h.ah.vertical?n:0,m=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const _ of m)t.text.placedSymbolArray.get(_).placedOrientation=l;a.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=u)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let a=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const l=n?n.symbolFadeChange(t):1,u=n?n.opacities:{},m=n?n.variableOffsets:{},_=n?n.placedOrientations:{};for(const y in this.placements){const v=this.placements[y],S=u[y];S?(this.opacities[y]=new zt(S,l,v.text,v.icon),a=a||v.text!==S.text.placed||v.icon!==S.icon.placed):(this.opacities[y]=new zt(null,l,v.text,v.icon,v.skipFade),a=a||v.text||v.icon)}for(const y in u){const v=u[y];if(!this.opacities[y]){const S=new zt(v,l,!1,!1);S.isHidden()||(this.opacities[y]=S,a=a||v.text.placed||v.icon.placed)}}for(const y in m)this.variableOffsets[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.variableOffsets[y]=m[y]);for(const y in _)this.placedOrientations[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.placedOrientations[y]=_[y]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const a={};for(const l of n){const u=l.getBucket(t);u&&l.latestFeatureIndex&&t.id===u.layerIds[0]&&this.updateBucketOpacities(u,a,l.collisionBoxArray)}}updateBucketOpacities(t,n,a){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const l=t.layers[0],u=l.layout,m=new zt(null,0,!1,!1,!0),_=u.get("text-allow-overlap"),y=u.get("icon-allow-overlap"),v=l._unevaluatedLayout.hasValue("text-variable-anchor")||l._unevaluatedLayout.hasValue("text-variable-anchor-offset"),S=u.get("text-rotation-alignment")==="map",I=u.get("text-pitch-alignment")==="map",D=u.get("icon-text-fit")!=="none",q=new zt(null,0,_&&(y||!t.hasIconData()||u.get("icon-optional")),y&&(_||!t.hasTextData()||u.get("text-optional")),!0);!t.collisionArrays&&a&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(a);const N=(Z,U,$)=>{for(let oe=0;oe<U/4;oe++)Z.opacityVertexArray.emplaceBack($);Z.hasVisibleVertices=Z.hasVisibleVertices||$!==ws};for(let Z=0;Z<t.symbolInstances.length;Z++){const U=t.symbolInstances.get(Z),{numHorizontalGlyphVertices:$,numVerticalGlyphVertices:oe,crossTileID:W}=U;let ie=this.opacities[W];n[W]?ie=m:ie||(ie=q,this.opacities[W]=ie),n[W]=!0;const ue=U.numIconVertices>0,ce=this.placedOrientations[U.crossTileID],_e=ce===h.ah.vertical,be=ce===h.ah.horizontal||ce===h.ah.horizontalOnly;if($>0||oe>0){const ve=hr(ie.text);N(t.text,$,_e?ws:ve),N(t.text,oe,be?ws:ve);const Se=ie.text.isHidden();[U.rightJustifiedTextSymbolIndex,U.centerJustifiedTextSymbolIndex,U.leftJustifiedTextSymbolIndex].forEach(Me=>{Me>=0&&(t.text.placedSymbolArray.get(Me).hidden=Se||_e?1:0)}),U.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(U.verticalPlacedTextSymbolIndex).hidden=Se||be?1:0);const Oe=this.variableOffsets[U.crossTileID];Oe&&this.markUsedJustification(t,Oe.anchor,U,ce);const Ke=this.placedOrientations[U.crossTileID];Ke&&(this.markUsedJustification(t,"left",U,Ke),this.markUsedOrientation(t,Ke,U))}if(ue){const ve=hr(ie.icon),Se=!(D&&U.verticalPlacedIconSymbolIndex&&_e);U.placedIconSymbolIndex>=0&&(N(t.icon,U.numIconVertices,Se?ve:ws),t.icon.placedSymbolArray.get(U.placedIconSymbolIndex).hidden=ie.icon.isHidden()),U.verticalPlacedIconSymbolIndex>=0&&(N(t.icon,U.numVerticalIconVertices,Se?ws:ve),t.icon.placedSymbolArray.get(U.verticalPlacedIconSymbolIndex).hidden=ie.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ve=t.collisionArrays[Z];if(ve){let Se=new h.P(0,0);if(ve.textBox||ve.verticalTextBox){let Ke=!0;if(v){const Me=this.variableOffsets[W];Me?(Se=wi(Me.anchor,Me.width,Me.height,Me.textOffset,Me.textBoxScale),S&&Se._rotate(I?this.transform.angle:-this.transform.angle)):Ke=!1}ve.textBox&&Li(t.textCollisionBox.collisionVertexArray,ie.text.placed,!Ke||_e,Se.x,Se.y),ve.verticalTextBox&&Li(t.textCollisionBox.collisionVertexArray,ie.text.placed,!Ke||be,Se.x,Se.y)}const Oe=!!(!be&&ve.verticalIconBox);ve.iconBox&&Li(t.iconCollisionBox.collisionVertexArray,ie.icon.placed,Oe,D?Se.x:0,D?Se.y:0),ve.verticalIconBox&&Li(t.iconCollisionBox.collisionVertexArray,ie.icon.placed,!Oe,D?Se.x:0,D?Se.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Z=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Z.invProjMatrix,t.placementViewportMatrix=Z.viewportMatrix,t.collisionCircleArray=Z.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const a=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*a>t}setStale(){this.stale=!0}}function Li(c,t,n,a,l){c.emplaceBack(t?1:0,n?1:0,a||0,l||0),c.emplaceBack(t?1:0,n?1:0,a||0,l||0),c.emplaceBack(t?1:0,n?1:0,a||0,l||0),c.emplaceBack(t?1:0,n?1:0,a||0,l||0)}const Qr=Math.pow(2,25),nl=Math.pow(2,24),mc=Math.pow(2,17),Et=Math.pow(2,16),Ja=Math.pow(2,9),$a=Math.pow(2,8),br=Math.pow(2,1);function hr(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,n=Math.floor(127*c.opacity);return n*Qr+t*nl+n*mc+t*Et+n*Ja+t*$a+n*br+t}const ws=0;class Dr{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,a,l,u){const m=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(m,l,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,u())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,m.sort((_,y)=>_.sortKey-y.sortKey));this._currentPartIndex<m.length;)if(n.placeLayerBucketPart(m[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,u())return!0;return!1}}class Lr{constructor(t,n,a,l,u,m,_,y){this.placement=new cr(t,n,m,_,y),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=l,this._showCollisionBoxes=u,this._done=!1}isDone(){return this._done}continuePlacement(t,n,a){const l=re.now(),u=()=>!this._forceFullPlacement&&re.now()-l>2;for(;this._currentPlacementIndex>=0;){const m=n[t[this._currentPlacementIndex]],_=this.placement.collisionIndex.transform.zoom;if(m.type==="symbol"&&(!m.minzoom||m.minzoom<=_)&&(!m.maxzoom||m.maxzoom>_)){if(this._inProgressLayer||(this._inProgressLayer=new Dr(m)),this._inProgressLayer.continuePlacement(a[m.source],this.placement,this._showCollisionBoxes,m,u))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const es=512/h.W/2;class Ys{constructor(t,n,a){this.tileID=t,this.bucketInstanceId=a,this._symbolsByKey={};const l=new Map;for(let u=0;u<n.length;u++){const m=n.get(u),_=m.key,y=l.get(_);y?y.push(m):l.set(_,[m])}for(const[u,m]of l){const _={positions:m.map(y=>({x:Math.floor(y.anchorX*es),y:Math.floor(y.anchorY*es)})),crossTileIDs:m.map(y=>y.crossTileID)};if(_.positions.length>128){const y=new h.au(_.positions.length,16,Uint16Array);for(const{x:v,y:S}of _.positions)y.add(v,S);y.finish(),delete _.positions,_.index=y}this._symbolsByKey[u]=_}}getScaledCoordinates(t,n){const{x:a,y:l,z:u}=this.tileID.canonical,{x:m,y:_,z:y}=n.canonical,v=es/Math.pow(2,y-u),S=(_*h.W+t.anchorY)*v,I=l*h.W*es;return{x:Math.floor((m*h.W+t.anchorX)*v-a*h.W*es),y:Math.floor(S-I)}}findMatches(t,n,a){const l=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let u=0;u<t.length;u++){const m=t.get(u);if(m.crossTileID)continue;const _=this._symbolsByKey[m.key];if(!_)continue;const y=this.getScaledCoordinates(m,n);if(_.index){const v=_.index.range(y.x-l,y.y-l,y.x+l,y.y+l).sort();for(const S of v){const I=_.crossTileIDs[S];if(!a[I]){a[I]=!0,m.crossTileID=I;break}}}else if(_.positions)for(let v=0;v<_.positions.length;v++){const S=_.positions[v],I=_.crossTileIDs[v];if(Math.abs(S.x-y.x)<=l&&Math.abs(S.y-y.y)<=l&&!a[I]){a[I]=!0,m.crossTileID=I;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class xi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ss{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const a in this.indexes){const l=this.indexes[a],u={};for(const m in l){const _=l[m];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+n),u[_.tileID.key]=_}this.indexes[a]=u}this.lng=t}addBucket(t,n,a){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let u=0;u<n.symbolInstances.length;u++)n.symbolInstances.get(u).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const l=this.usedCrossTileIDs[t.overscaledZ];for(const u in this.indexes){const m=this.indexes[u];if(Number(u)>t.overscaledZ)for(const _ in m){const y=m[_];y.tileID.isChildOf(t)&&y.findMatches(n.symbolInstances,t,l)}else{const _=m[t.scaledTo(Number(u)).key];_&&_.findMatches(n.symbolInstances,t,l)}}for(let u=0;u<n.symbolInstances.length;u++){const m=n.symbolInstances.get(u);m.crossTileID||(m.crossTileID=a.generate(),l[m.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ys(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const a of n.getCrossTileIDsLists())for(const l of a)delete this.usedCrossTileIDs[t][l]}removeStaleBuckets(t){let n=!1;for(const a in this.indexes){const l=this.indexes[a];for(const u in l)t[l[u].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,l[u]),delete l[u],n=!0)}return n}}class fn{constructor(){this.layerIndexes={},this.crossTileIDs=new xi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,a){let l=this.layerIndexes[t.id];l===void 0&&(l=this.layerIndexes[t.id]=new Ss);let u=!1;const m={};l.handleWrapJump(a);for(const _ of n){const y=_.getBucket(t);y&&t.id===y.layerIds[0]&&(y.bucketInstanceId||(y.bucketInstanceId=++this.maxBucketInstanceId),l.addBucket(_.tileID,y,this.crossTileIDs)&&(u=!0),m[y.bucketInstanceId]=!0)}return l.removeStaleBuckets(m)&&(u=!0),u}pruneUnusedLayers(t){const n={};t.forEach(a=>{n[a]=!0});for(const a in this.layerIndexes)n[a]||delete this.layerIndexes[a]}}const Yt=(c,t)=>h.t(c,t&&t.filter(n=>n.identifier!=="source.canvas")),Js=h.av();class wr extends h.E{constructor(t,n={}){super(),this._rtlTextPluginStateChange=()=>{for(const a in this.sourceCaches){const l=this.sourceCaches[a].getSource().type;l!=="vector"&&l!=="geojson"||this.sourceCaches[a].reload()}},this.map=t,this.dispatcher=new et(Ie(),t._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(a,l)=>this.getGlyphs(a,l)),this.dispatcher.registerMessageHandler("getImages",(a,l)=>this.getImages(a,l)),this.imageManager=new zi,this.imageManager.setEventedParent(this),this.glyphManager=new Kt(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Pt(256,512),this.crossTileSymbolIndex=new fn,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",h.ax()),Te().on("pluginStateChange",this._rtlTextPluginStateChange),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const l=this.sourceCaches[a.sourceId];if(!l)return;const u=l.getSource();if(u&&u.vectorLayerIds)for(const m in this._layers){const _=this._layers[m];_.source===u.id&&this._validateLayer(_)}})}loadURL(t,n={},a){this.fire(new h.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const l=this.map._requestManager.transformRequest(t,gt.Style);this._loadStyleRequest=new AbortController,h.h(l,this._loadStyleRequest).then(u=>{this._loadStyleRequest=null,this._load(u.data,n,a)}).catch(u=>{this._loadStyleRequest=null,u&&this.fire(new h.j(u))})}loadJSON(t,n={},a){this.fire(new h.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,re.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(t,n,a)}).catch(()=>{})}loadEmpty(){this.fire(new h.k("dataloading",{dataType:"style"})),this._load(Js,{validate:!1})}_load(t,n,a){var l;const u=n.transformStyle?n.transformStyle(a,t):t;if(!n.validate||!Yt(this,h.x(u))){this._loaded=!0,this.stylesheet=u;for(const m in u.sources)this.addSource(m,u.sources[m],{validate:!1});u.sprite?this._loadSprite(u.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(u.glyphs),this._createLayers(),this.light=new Ft(this.stylesheet.light),this.map.setTerrain((l=this.stylesheet.terrain)!==null&&l!==void 0?l:null),this.fire(new h.k("data",{dataType:"style"})),this.fire(new h.k("style.load"))}}_createLayers(){const t=h.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of t){const a=h.az(n);a.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=a}}_loadSprite(t,n=!1,a=void 0){let l;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(u,m,_,y){return h._(this,void 0,void 0,function*(){const v=Wt(u),S=_>1?"@2x":"",I={},D={};for(const{id:q,url:N}of v){const Z=m.transformRequest(m.normalizeSpriteURL(N,S,".json"),gt.SpriteJSON);I[q]=h.h(Z,y);const U=m.transformRequest(m.normalizeSpriteURL(N,S,".png"),gt.SpriteImage);D[q]=ht.getImage(U,y)}return yield Promise.all([...Object.values(I),...Object.values(D)]),function(q,N){return h._(this,void 0,void 0,function*(){const Z={};for(const U in q){Z[U]={};const $=re.getImageCanvasContext((yield N[U]).data),oe=(yield q[U]).data;for(const W in oe){const{width:ie,height:ue,x:ce,y:_e,sdf:be,pixelRatio:ve,stretchX:Se,stretchY:Oe,content:Ke}=oe[W];Z[U][W]={data:null,pixelRatio:ve,sdf:be,stretchX:Se,stretchY:Oe,content:Ke,spriteData:{width:ie,height:ue,x:ce,y:_e,context:$}}}}return Z})}(I,D)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(u=>{if(this._spriteRequest=null,u)for(const m in u){this._spritesImagesIds[m]=[];const _=this._spritesImagesIds[m]?this._spritesImagesIds[m].filter(y=>!(y in u)):[];for(const y of _)this.imageManager.removeImage(y),this._changedImages[y]=!0;for(const y in u[m]){const v=m==="default"?y:`${m}:${y}`;this._spritesImagesIds[m].push(v),v in this.imageManager.images?this.imageManager.updateImage(v,u[m][y],!1):this.imageManager.addImage(v,u[m][y]),n&&(this._changedImages[v]=!0)}}}).catch(u=>{this._spriteRequest=null,l=u,this.fire(new h.j(l))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.k("data",{dataType:"style"})),a&&a(l)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const a=t.sourceLayer;if(!a)return;const l=n.getSource();(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(a)===-1)&&this.fire(new h.j(new Error(`Source layer "${a}" does not exist on source "${l.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const n=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n);const a=[];for(const l of t)n[l]&&a.push(n[l]);return a}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const a of n){const l=this._layers[a];l.type!=="custom"&&(t[a]=l.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const l=Object.keys(this._updatedLayers),u=Object.keys(this._removedLayers);(l.length||u.length)&&this._updateWorkerLayers(l,u);for(const m in this._updatedSources){const _=this._updatedSources[m];if(_==="reload")this._reloadSource(m);else{if(_!=="clear")throw new Error(`Invalid action ${_}`);this._clearSource(m)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const m in this._updatedPaintProps)this._layers[m].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const a={};for(const l in this.sourceCaches){const u=this.sourceCaches[l];a[l]=u.used,u.used=!1}for(const l of this._order){const u=this._layers[l];u.recalculate(t,this._availableImages),!u.isHidden(t.zoom)&&u.source&&(this.sourceCaches[u.source].used=!0)}for(const l in a){const u=this.sourceCaches[l];a[l]!==u.used&&u.fire(new h.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:l}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new h.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){var a;this._checkLoaded();const l=this.serialize();if(t=n.transformStyle?n.transformStyle(l,t):t,((a=n.validate)===null||a===void 0||a)&&Yt(this,h.x(t)))return!1;(t=h.aA(t)).layers=h.ay(t.layers);const u=h.aB(l,t),m=this._getOperationsToPerform(u);if(m.unimplemented.length>0)throw new Error(`Unimplemented: ${m.unimplemented.join(", ")}.`);if(m.operations.length===0)return!1;for(const _ of m.operations)_();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const n=[],a=[];for(const l of t)switch(l.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,l.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,l.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,l.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,l.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,l.args));break;case"addSource":n.push(()=>this.addSource.apply(this,l.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,l.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,l.args));break;case"setLight":n.push(()=>this.setLight.apply(this,l.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,l.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,l.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,l.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,l.args));break;case"setTransition":n.push(()=>{});break;default:a.push(l.command)}return{operations:n,unimplemented:a}}addImage(t,n){if(this.getImage(t))return this.fire(new h.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new h.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,a={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(h.x.source,`sources.${t}`,n,null,a))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const l=this.sourceCaches[t]=new Vi(t,n,this.dispatcher);l.style=this,l.setEventedParent(this,()=>({isSourceLoaded:l.loaded(),source:l.serialize(),sourceId:t})),l.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===t)return this.fire(new h.j(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new h.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const a=this.sourceCaches[t].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,a={}){this._checkLoaded();const l=t.id;if(this.getLayer(l))return void this.fire(new h.j(new Error(`Layer "${l}" already exists on this map.`)));let u;if(t.type==="custom"){if(Yt(this,h.aC(t)))return;u=h.az(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(l,t.source),t=h.aA(t),t=h.e(t,{source:l})),this._validate(h.x.layer,`layers.${l}`,t,{arrayIndex:-1},a))return;u=h.az(t),this._validateLayer(u),u.setEventedParent(this,{layer:{id:l}})}const m=n?this._order.indexOf(n):this._order.length;if(n&&m===-1)this.fire(new h.j(new Error(`Cannot add layer "${l}" before non-existing layer "${n}".`)));else{if(this._order.splice(m,0,l),this._layerOrderChanged=!0,this._layers[l]=u,this._removedLayers[l]&&u.source&&u.type!=="custom"){const _=this._removedLayers[l];delete this._removedLayers[l],_.type!==u.type?this._updatedSources[u.source]="clear":(this._updatedSources[u.source]="reload",this.sourceCaches[u.source].pause())}this._updateLayer(u),u.onAdd&&u.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new h.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const a=this._order.indexOf(t);this._order.splice(a,1);const l=n?this._order.indexOf(n):this._order.length;n&&l===-1?this.fire(new h.j(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(l,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new h.j(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const a=this._order.indexOf(t);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,a){this._checkLoaded();const l=this.getLayer(t);l?l.minzoom===n&&l.maxzoom===a||(n!=null&&(l.minzoom=n),a!=null&&(l.maxzoom=a),this._updateLayer(l)):this.fire(new h.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,a={}){this._checkLoaded();const l=this.getLayer(t);if(l){if(!h.aD(l.filter,n))return n==null?(l.filter=void 0,void this._updateLayer(l)):void(this._validate(h.x.filter,`layers.${l.id}.filter`,n,null,a)||(l.filter=h.aA(n),this._updateLayer(l)))}else this.fire(new h.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return h.aA(this.getLayer(t).filter)}setLayoutProperty(t,n,a,l={}){this._checkLoaded();const u=this.getLayer(t);u?h.aD(u.getLayoutProperty(n),a)||(u.setLayoutProperty(n,a,l),this._updateLayer(u)):this.fire(new h.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const a=this.getLayer(t);if(a)return a.getLayoutProperty(n);this.fire(new h.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,a,l={}){this._checkLoaded();const u=this.getLayer(t);u?h.aD(u.getPaintProperty(n),a)||(u.setPaintProperty(n,a,l)&&this._updateLayer(u),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new h.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const a=t.source,l=t.sourceLayer,u=this.sourceCaches[a];if(u===void 0)return void this.fire(new h.j(new Error(`The source '${a}' does not exist in the map's style.`)));const m=u.getSource().type;m==="geojson"&&l?this.fire(new h.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):m!=="vector"||l?(t.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),u.setFeatureState(l,t.id,n)):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const a=t.source,l=this.sourceCaches[a];if(l===void 0)return void this.fire(new h.j(new Error(`The source '${a}' does not exist in the map's style.`)));const u=l.getSource().type,m=u==="vector"?t.sourceLayer:void 0;u!=="vector"||m?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new h.j(new Error("A feature id is required to remove its specific state property."))):l.removeFeatureState(m,t.id,n):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,a=t.sourceLayer,l=this.sourceCaches[n];if(l!==void 0)return l.getSource().type!=="vector"||a?(t.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),l.getFeatureState(a,t.id)):void this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=h.aE(this.sourceCaches,u=>u.serialize()),n=this._serializeByIds(this._order),a=this.map.getTerrain()||void 0,l=this.stylesheet;return h.aF({version:l.version,name:l.name,metadata:l.metadata,light:l.light,center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,sprite:l.sprite,glyphs:l.glyphs,transition:l.transition,sources:t,layers:n,terrain:a},u=>u!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=m=>this._layers[m].type==="fill-extrusion",a={},l=[];for(let m=this._order.length-1;m>=0;m--){const _=this._order[m];if(n(_)){a[_]=m;for(const y of t){const v=y[_];if(v)for(const S of v)l.push(S)}}}l.sort((m,_)=>_.intersectionZ-m.intersectionZ);const u=[];for(let m=this._order.length-1;m>=0;m--){const _=this._order[m];if(n(_))for(let y=l.length-1;y>=0;y--){const v=l[y].feature;if(a[v.layer.id]<m)break;u.push(v),l.pop()}else for(const y of t){const v=y[_];if(v)for(const S of v)u.push(S.feature)}}return u}queryRenderedFeatures(t,n,a){n&&n.filter&&this._validate(h.x.filter,"queryRenderedFeatures.filter",n.filter,null,n);const l={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new h.j(new Error("parameters.layers must be an Array."))),[];for(const _ of n.layers){const y=this._layers[_];if(!y)return this.fire(new h.j(new Error(`The layer '${_}' does not exist in the map's style and cannot be queried for features.`))),[];l[y.source]=!0}}const u=[];n.availableImages=this._availableImages;const m=this._serializedAllLayers();for(const _ in this.sourceCaches)n.layers&&!l[_]||u.push(Kr(this.sourceCaches[_],this._layers,m,t,n,a));return this.placement&&u.push(function(_,y,v,S,I,D,q){const N={},Z=D.queryRenderedSymbols(S),U=[];for(const $ of Object.keys(Z).map(Number))U.push(q[$]);U.sort(ke);for(const $ of U){const oe=$.featureIndex.lookupSymbolFeatures(Z[$.bucketInstanceId],y,$.bucketIndex,$.sourceLayerIndex,I.filter,I.layers,I.availableImages,_);for(const W in oe){const ie=N[W]=N[W]||[],ue=oe[W];ue.sort((ce,_e)=>{const be=$.featureSortOrder;if(be){const ve=be.indexOf(ce.featureIndex);return be.indexOf(_e.featureIndex)-ve}return _e.featureIndex-ce.featureIndex});for(const ce of ue)ie.push(ce)}}for(const $ in N)N[$].forEach(oe=>{const W=oe.feature,ie=v[_[$].source].getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=ie});return N}(this._layers,m,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(u)}querySourceFeatures(t,n){n&&n.filter&&this._validate(h.x.filter,"querySourceFeatures.filter",n.filter,null,n);const a=this.sourceCaches[t];return a?function(l,u){const m=l.getRenderableIds().map(v=>l.getTileByID(v)),_=[],y={};for(let v=0;v<m.length;v++){const S=m[v],I=S.tileID.canonical.key;y[I]||(y[I]=!0,S.querySourceFeatures(_,u))}return _}(a,n):[]}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const a=this.light.getLight();let l=!1;for(const m in t)if(!h.aD(t[m],a[m])){l=!0;break}if(!l)return;const u={now:re.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(u)}_validate(t,n,a,l,u={}){return(!u||u.validate!==!1)&&Yt(this,t.call(h.x,h.e({key:n,style:this.serialize(),value:a,styleSpec:h.v},l)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Te().off("pluginStateChange",this._rtlTextPluginStateChange);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const a=this.sourceCaches[n];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,a,l,u=!1){let m=!1,_=!1;const y={};for(const v of this._order){const S=this._layers[v];if(S.type!=="symbol")continue;if(!y[S.source]){const D=this.sourceCaches[S.source];y[S.source]=D.getRenderableIds(!0).map(q=>D.getTileByID(q)).sort((q,N)=>N.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(N.tileID)?-1:1))}const I=this.crossTileSymbolIndex.addLayer(S,y[S.source],t.center.lng);m=m||I}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((u=u||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(re.now(),t.zoom))&&(this.pauseablePlacement=new Lr(t,this.map.terrain,this._order,u,n,a,l,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(re.now()),_=!0),m&&this.pauseablePlacement.placement.setStale()),_||m)for(const v of this._order){const S=this._layers[v];S.type==="symbol"&&this.placement.updateLayerOpacities(S,y[S.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(re.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n){return h._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const l=this.sourceCaches[n.source];return l&&l.setDependencies(n.tileID.key,n.type,n.icons),a})}getGlyphs(t,n){return h._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(n.stacks),l=this.sourceCaches[n.source];return l&&l.setDependencies(n.tileID.key,n.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(h.x.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n,a={},l){this._checkLoaded();const u=[{id:t,url:n}],m=[...Wt(this.stylesheet.sprite),...u];this._validate(h.x.sprite,"sprite",m,null,a)||(this.stylesheet.sprite=m,this._loadSprite(u,!0,l))}removeSprite(t){this._checkLoaded();const n=Wt(this.stylesheet.sprite);if(n.find(a=>a.id===t)){if(this._spritesImagesIds[t])for(const a of this._spritesImagesIds[t])this.imageManager.removeImage(a),this._changedImages[a]=!0;n.splice(n.findIndex(a=>a.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}else this.fire(new h.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Wt(this.stylesheet.sprite)}setSprite(t,n={},a){this._checkLoaded(),t&&this._validate(h.x.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,a):(this._unloadSprite(),a&&a(null)))}}var $s=h.X([{name:"a_pos",type:"Int16",components:2}]),en="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ts={prelude:Mt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Mt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Mt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Mt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Mt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Mt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Mt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Mt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Mt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Mt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Mt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Mt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Mt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Mt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Mt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Mt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Mt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Mt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Mt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Mt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Mt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Mt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",en),terrainDepth:Mt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",en),terrainCoords:Mt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",en)};function Mt(c,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=t.match(/attribute ([\w]+) ([\w]+)/g),l=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),u=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=u?u.concat(l):l,_={};return{fragmentSource:c=c.replace(n,(y,v,S,I,D)=>(_[D]=!0,v==="define"?`
#ifndef HAS_UNIFORM_u_${D}
varying ${S} ${I} ${D};
#else
uniform ${S} ${I} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${S} ${I} ${D} = u_${D};
#endif
`)),vertexSource:t=t.replace(n,(y,v,S,I,D)=>{const q=I==="float"?"vec2":"vec4",N=D.match(/color/)?"color":q;return _[D]?v==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${S} ${q} a_${D};
varying ${S} ${I} ${D};
#else
uniform ${S} ${I} u_${D};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${S} ${I} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${N}(a_${D}, u_${D}_t);
#else
    ${S} ${I} ${D} = u_${D};
#endif
`:v==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${S} ${q} a_${D};
#else
uniform ${S} ${I} u_${D};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${S} ${I} ${D} = a_${D};
#else
    ${S} ${I} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${S} ${I} ${D} = unpack_mix_${N}(a_${D}, u_${D}_t);
#else
    ${S} ${I} ${D} = u_${D};
#endif
`}),staticAttributes:a,staticUniforms:m}}class Qs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,a,l,u,m,_,y,v){this.context=t;let S=this.boundPaintVertexBuffers.length!==l.length;for(let I=0;!S&&I<l.length;I++)this.boundPaintVertexBuffers[I]!==l[I]&&(S=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==a||S||this.boundIndexBuffer!==u||this.boundVertexOffset!==m||this.boundDynamicVertexBuffer!==_||this.boundDynamicVertexBuffer2!==y||this.boundDynamicVertexBuffer3!==v?this.freshBind(n,a,l,u,m,_,y,v):(t.bindVertexArray.set(this.vao),_&&_.bind(),u&&u.dynamicDraw&&u.bind(),y&&y.bind(),v&&v.bind())}freshBind(t,n,a,l,u,m,_,y){const v=t.numAttributes,S=this.context,I=S.gl;this.vao&&this.destroy(),this.vao=S.createVertexArray(),S.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=l,this.boundVertexOffset=u,this.boundDynamicVertexBuffer=m,this.boundDynamicVertexBuffer2=_,this.boundDynamicVertexBuffer3=y,n.enableAttributes(I,t);for(const D of a)D.enableAttributes(I,t);m&&m.enableAttributes(I,t),_&&_.enableAttributes(I,t),y&&y.enableAttributes(I,t),n.bind(),n.setVertexAttribPointers(I,t,u);for(const D of a)D.bind(),D.setVertexAttribPointers(I,t,u);m&&(m.bind(),m.setVertexAttribPointers(I,t,u)),l&&l.bind(),_&&(_.bind(),_.setVertexAttribPointers(I,t,u)),y&&(y.bind(),y.setVertexAttribPointers(I,t,u)),S.currentNumAttributes=v}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ts(c){const t=[];for(let n=0;n<c.length;n++){if(c[n]===null)continue;const a=c[n].split(" ");t.push(a.pop())}return t}class mn{constructor(t,n,a,l,u,m){const _=t.gl;this.program=_.createProgram();const y=ts(n.staticAttributes),v=a?a.getBinderAttributes():[],S=y.concat(v),I=Ts.prelude.staticUniforms?ts(Ts.prelude.staticUniforms):[],D=n.staticUniforms?ts(n.staticUniforms):[],q=a?a.getBinderUniforms():[],N=I.concat(D).concat(q),Z=[];for(const ce of N)Z.indexOf(ce)<0&&Z.push(ce);const U=a?a.defines():[];u&&U.push("#define OVERDRAW_INSPECTOR;"),m&&U.push("#define TERRAIN3D;");const $=U.concat(Ts.prelude.fragmentSource,n.fragmentSource).join(`
`),oe=U.concat(Ts.prelude.vertexSource,n.vertexSource).join(`
`),W=_.createShader(_.FRAGMENT_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(W,$),_.compileShader(W),!_.getShaderParameter(W,_.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${_.getShaderInfoLog(W)}`);_.attachShader(this.program,W);const ie=_.createShader(_.VERTEX_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(ie,oe),_.compileShader(ie),!_.getShaderParameter(ie,_.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${_.getShaderInfoLog(ie)}`);_.attachShader(this.program,ie),this.attributes={};const ue={};this.numAttributes=S.length;for(let ce=0;ce<this.numAttributes;ce++)S[ce]&&(_.bindAttribLocation(this.program,ce,S[ce]),this.attributes[S[ce]]=ce);if(_.linkProgram(this.program),!_.getProgramParameter(this.program,_.LINK_STATUS))throw new Error(`Program failed to link: ${_.getProgramInfoLog(this.program)}`);_.deleteShader(ie),_.deleteShader(W);for(let ce=0;ce<Z.length;ce++){const _e=Z[ce];if(_e&&!ue[_e]){const be=_.getUniformLocation(this.program,_e);be&&(ue[_e]=be)}}this.fixedUniforms=l(t,ue),this.terrainUniforms=((ce,_e)=>({u_depth:new h.aG(ce,_e.u_depth),u_terrain:new h.aG(ce,_e.u_terrain),u_terrain_dim:new h.aH(ce,_e.u_terrain_dim),u_terrain_matrix:new h.aI(ce,_e.u_terrain_matrix),u_terrain_unpack:new h.aJ(ce,_e.u_terrain_unpack),u_terrain_exaggeration:new h.aH(ce,_e.u_terrain_exaggeration)}))(t,ue),this.binderUniforms=a?a.getUniforms(t,ue):[]}draw(t,n,a,l,u,m,_,y,v,S,I,D,q,N,Z,U,$,oe){const W=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(a),t.setStencilMode(l),t.setColorMode(u),t.setCullFace(m),y){t.activeTexture.set(W.TEXTURE2),W.bindTexture(W.TEXTURE_2D,y.depthTexture),t.activeTexture.set(W.TEXTURE3),W.bindTexture(W.TEXTURE_2D,y.texture);for(const ue in this.terrainUniforms)this.terrainUniforms[ue].set(y[ue])}for(const ue in this.fixedUniforms)this.fixedUniforms[ue].set(_[ue]);Z&&Z.setUniforms(t,this.binderUniforms,q,{zoom:N});let ie=0;switch(n){case W.LINES:ie=2;break;case W.TRIANGLES:ie=3;break;case W.LINE_STRIP:ie=1}for(const ue of D.get()){const ce=ue.vaos||(ue.vaos={});(ce[v]||(ce[v]=new Qs)).bind(t,this,S,Z?Z.getPaintVertexBuffers():[],I,ue.vertexOffset,U,$,oe),W.drawElements(n,ue.primitiveLength*ie,W.UNSIGNED_SHORT,ue.primitiveOffset*ie*2)}}}function ea(c,t,n){const a=1/tt(n,1,t.transform.tileZoom),l=Math.pow(2,n.tileID.overscaledZ),u=n.tileSize*Math.pow(2,t.transform.tileZoom)/l,m=u*(n.tileID.canonical.x+n.tileID.wrap*l),_=u*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[a,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[m>>16,_>>16],u_pixel_coord_lower:[65535&m,65535&_]}}const Is=(c,t,n,a)=>{const l=t.style.light,u=l.properties.get("position"),m=[u.x,u.y,u.z],_=function(){var v=new h.A(9);return h.A!=Float32Array&&(v[1]=0,v[2]=0,v[3]=0,v[5]=0,v[6]=0,v[7]=0),v[0]=1,v[4]=1,v[8]=1,v}();l.properties.get("anchor")==="viewport"&&function(v,S){var I=Math.sin(S),D=Math.cos(S);v[0]=D,v[1]=I,v[2]=0,v[3]=-I,v[4]=D,v[5]=0,v[6]=0,v[7]=0,v[8]=1}(_,-t.transform.angle),function(v,S,I){var D=S[0],q=S[1],N=S[2];v[0]=D*I[0]+q*I[3]+N*I[6],v[1]=D*I[1]+q*I[4]+N*I[7],v[2]=D*I[2]+q*I[5]+N*I[8]}(m,m,_);const y=l.properties.get("color");return{u_matrix:c,u_lightpos:m,u_lightintensity:l.properties.get("intensity"),u_lightcolor:[y.r,y.g,y.b],u_vertical_gradient:+n,u_opacity:a}},gc=(c,t,n,a,l,u,m)=>h.e(Is(c,t,n,a),ea(u,t,m),{u_height_factor:-Math.pow(2,l.overscaledZ)/m.tileSize/8}),sl=c=>({u_matrix:c}),ta=(c,t,n,a)=>h.e(sl(c),ea(n,t,a)),_c=(c,t)=>({u_matrix:c,u_world:t}),al=(c,t,n,a,l)=>h.e(ta(c,t,n,a),{u_world:l}),yc=(c,t,n,a)=>{const l=c.transform;let u,m;if(a.paint.get("circle-pitch-alignment")==="map"){const _=tt(n,1,l.zoom);u=!0,m=[_,_]}else u=!1,m=l.pixelsToGLUnits;return{u_camera_to_center_distance:l.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(t.posMatrix,n,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+u,u_device_pixel_ratio:c.pixelRatio,u_extrude_scale:m}},ol=(c,t,n)=>{const a=tt(n,1,t.zoom),l=Math.pow(2,t.zoom-n.tileID.overscaledZ),u=n.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:a,u_extrude_scale:[t.pixelsToGLUnits[0]/(a*l),t.pixelsToGLUnits[1]/(a*l)],u_overscale_factor:u}},ll=(c,t,n=1)=>({u_matrix:c,u_color:t,u_overlay:0,u_overlay_scale:n}),ia=c=>({u_matrix:c}),cl=(c,t,n,a)=>({u_matrix:c,u_extrude_scale:tt(t,1,n),u_intensity:a});function hl(c,t){const n=Math.pow(2,t.canonical.z),a=t.canonical.y;return[new h.Y(0,a/n).toLngLat().lat,new h.Y(0,(a+1)/n).toLngLat().lat]}const ra=(c,t,n,a)=>{const l=c.transform;return{u_matrix:Cs(c,t,n,a),u_ratio:1/tt(t,1,l.zoom),u_device_pixel_ratio:c.pixelRatio,u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]]}},ul=(c,t,n,a,l)=>h.e(ra(c,t,n,l),{u_image:0,u_image_height:a}),zn=(c,t,n,a,l)=>{const u=c.transform,m=Sr(t,u);return{u_matrix:Cs(c,t,n,l),u_texsize:t.imageAtlasTexture.size,u_ratio:1/tt(t,1,u.zoom),u_device_pixel_ratio:c.pixelRatio,u_image:0,u_scale:[m,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},na=(c,t,n,a,l,u)=>{const m=c.lineAtlas,_=Sr(t,c.transform),y=n.layout.get("line-cap")==="round",v=m.getDash(a.from,y),S=m.getDash(a.to,y),I=v.width*l.fromScale,D=S.width*l.toScale;return h.e(ra(c,t,n,u),{u_patternscale_a:[_/I,-v.height/2],u_patternscale_b:[_/D,-S.height/2],u_sdfgamma:m.width/(256*Math.min(I,D)*c.pixelRatio)/2,u_image:0,u_tex_y_a:v.y,u_tex_y_b:S.y,u_mix:l.t})};function Sr(c,t){return 1/tt(c,1,t.tileZoom)}function Cs(c,t,n,a){return c.translatePosMatrix(a?a.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const sa=(c,t,n,a,l)=>{return{u_matrix:c,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(m=l.paint.get("raster-saturation"),m>0?1-1/(1.001-m):-m),u_contrast_factor:(u=l.paint.get("raster-contrast"),u>0?1/(1-u):1+u),u_spin_weights:As(l.paint.get("raster-hue-rotate"))};var u,m};function As(c){c*=Math.PI/180;const t=Math.sin(c),n=Math.cos(c);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const ks=(c,t,n,a,l,u,m,_,y,v)=>{const S=l.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:S.cameraToCenterDistance,u_pitch:S.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:S.width/S.height,u_fade_change:l.options.fadeDuration?l.symbolFadeChange:1,u_matrix:u,u_label_plane_matrix:m,u_coord_matrix:_,u_is_text:+y,u_pitch_with_map:+a,u_texsize:v,u_texture:0}},Es=(c,t,n,a,l,u,m,_,y,v,S)=>{const I=l.transform;return h.e(ks(c,t,n,a,l,u,m,_,y,v),{u_gamma_scale:a?Math.cos(I._pitch)*I.cameraToCenterDistance:1,u_device_pixel_ratio:l.pixelRatio,u_is_halo:+S})},Ms=(c,t,n,a,l,u,m,_,y,v)=>h.e(Es(c,t,n,a,l,u,m,_,!0,y,!0),{u_texsize_icon:v,u_texture_icon:1}),xc=(c,t,n)=>({u_matrix:c,u_opacity:t,u_color:n}),vc=(c,t,n,a,l,u)=>h.e(function(m,_,y,v){const S=y.imageManager.getPattern(m.from.toString()),I=y.imageManager.getPattern(m.to.toString()),{width:D,height:q}=y.imageManager.getPixelSize(),N=Math.pow(2,v.tileID.overscaledZ),Z=v.tileSize*Math.pow(2,y.transform.tileZoom)/N,U=Z*(v.tileID.canonical.x+v.tileID.wrap*N),$=Z*v.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:S.tl,u_pattern_br_a:S.br,u_pattern_tl_b:I.tl,u_pattern_br_b:I.br,u_texsize:[D,q],u_mix:_.t,u_pattern_size_a:S.displaySize,u_pattern_size_b:I.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/tt(v,1,y.transform.tileZoom),u_pixel_coord_upper:[U>>16,$>>16],u_pixel_coord_lower:[65535&U,65535&$]}}(a,u,n,l),{u_matrix:c,u_opacity:t}),dl={fillExtrusion:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_lightpos:new h.aK(c,t.u_lightpos),u_lightintensity:new h.aH(c,t.u_lightintensity),u_lightcolor:new h.aK(c,t.u_lightcolor),u_vertical_gradient:new h.aH(c,t.u_vertical_gradient),u_opacity:new h.aH(c,t.u_opacity)}),fillExtrusionPattern:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_lightpos:new h.aK(c,t.u_lightpos),u_lightintensity:new h.aH(c,t.u_lightintensity),u_lightcolor:new h.aK(c,t.u_lightcolor),u_vertical_gradient:new h.aH(c,t.u_vertical_gradient),u_height_factor:new h.aH(c,t.u_height_factor),u_image:new h.aG(c,t.u_image),u_texsize:new h.aL(c,t.u_texsize),u_pixel_coord_upper:new h.aL(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(c,t.u_pixel_coord_lower),u_scale:new h.aK(c,t.u_scale),u_fade:new h.aH(c,t.u_fade),u_opacity:new h.aH(c,t.u_opacity)}),fill:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix)}),fillPattern:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_image:new h.aG(c,t.u_image),u_texsize:new h.aL(c,t.u_texsize),u_pixel_coord_upper:new h.aL(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(c,t.u_pixel_coord_lower),u_scale:new h.aK(c,t.u_scale),u_fade:new h.aH(c,t.u_fade)}),fillOutline:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_world:new h.aL(c,t.u_world)}),fillOutlinePattern:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_world:new h.aL(c,t.u_world),u_image:new h.aG(c,t.u_image),u_texsize:new h.aL(c,t.u_texsize),u_pixel_coord_upper:new h.aL(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(c,t.u_pixel_coord_lower),u_scale:new h.aK(c,t.u_scale),u_fade:new h.aH(c,t.u_fade)}),circle:(c,t)=>({u_camera_to_center_distance:new h.aH(c,t.u_camera_to_center_distance),u_scale_with_map:new h.aG(c,t.u_scale_with_map),u_pitch_with_map:new h.aG(c,t.u_pitch_with_map),u_extrude_scale:new h.aL(c,t.u_extrude_scale),u_device_pixel_ratio:new h.aH(c,t.u_device_pixel_ratio),u_matrix:new h.aI(c,t.u_matrix)}),collisionBox:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_camera_to_center_distance:new h.aH(c,t.u_camera_to_center_distance),u_pixels_to_tile_units:new h.aH(c,t.u_pixels_to_tile_units),u_extrude_scale:new h.aL(c,t.u_extrude_scale),u_overscale_factor:new h.aH(c,t.u_overscale_factor)}),collisionCircle:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_inv_matrix:new h.aI(c,t.u_inv_matrix),u_camera_to_center_distance:new h.aH(c,t.u_camera_to_center_distance),u_viewport_size:new h.aL(c,t.u_viewport_size)}),debug:(c,t)=>({u_color:new h.aM(c,t.u_color),u_matrix:new h.aI(c,t.u_matrix),u_overlay:new h.aG(c,t.u_overlay),u_overlay_scale:new h.aH(c,t.u_overlay_scale)}),clippingMask:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix)}),heatmap:(c,t)=>({u_extrude_scale:new h.aH(c,t.u_extrude_scale),u_intensity:new h.aH(c,t.u_intensity),u_matrix:new h.aI(c,t.u_matrix)}),heatmapTexture:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_world:new h.aL(c,t.u_world),u_image:new h.aG(c,t.u_image),u_color_ramp:new h.aG(c,t.u_color_ramp),u_opacity:new h.aH(c,t.u_opacity)}),hillshade:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_image:new h.aG(c,t.u_image),u_latrange:new h.aL(c,t.u_latrange),u_light:new h.aL(c,t.u_light),u_shadow:new h.aM(c,t.u_shadow),u_highlight:new h.aM(c,t.u_highlight),u_accent:new h.aM(c,t.u_accent)}),hillshadePrepare:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_image:new h.aG(c,t.u_image),u_dimension:new h.aL(c,t.u_dimension),u_zoom:new h.aH(c,t.u_zoom),u_unpack:new h.aJ(c,t.u_unpack)}),line:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_ratio:new h.aH(c,t.u_ratio),u_device_pixel_ratio:new h.aH(c,t.u_device_pixel_ratio),u_units_to_pixels:new h.aL(c,t.u_units_to_pixels)}),lineGradient:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_ratio:new h.aH(c,t.u_ratio),u_device_pixel_ratio:new h.aH(c,t.u_device_pixel_ratio),u_units_to_pixels:new h.aL(c,t.u_units_to_pixels),u_image:new h.aG(c,t.u_image),u_image_height:new h.aH(c,t.u_image_height)}),linePattern:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_texsize:new h.aL(c,t.u_texsize),u_ratio:new h.aH(c,t.u_ratio),u_device_pixel_ratio:new h.aH(c,t.u_device_pixel_ratio),u_image:new h.aG(c,t.u_image),u_units_to_pixels:new h.aL(c,t.u_units_to_pixels),u_scale:new h.aK(c,t.u_scale),u_fade:new h.aH(c,t.u_fade)}),lineSDF:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_ratio:new h.aH(c,t.u_ratio),u_device_pixel_ratio:new h.aH(c,t.u_device_pixel_ratio),u_units_to_pixels:new h.aL(c,t.u_units_to_pixels),u_patternscale_a:new h.aL(c,t.u_patternscale_a),u_patternscale_b:new h.aL(c,t.u_patternscale_b),u_sdfgamma:new h.aH(c,t.u_sdfgamma),u_image:new h.aG(c,t.u_image),u_tex_y_a:new h.aH(c,t.u_tex_y_a),u_tex_y_b:new h.aH(c,t.u_tex_y_b),u_mix:new h.aH(c,t.u_mix)}),raster:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_tl_parent:new h.aL(c,t.u_tl_parent),u_scale_parent:new h.aH(c,t.u_scale_parent),u_buffer_scale:new h.aH(c,t.u_buffer_scale),u_fade_t:new h.aH(c,t.u_fade_t),u_opacity:new h.aH(c,t.u_opacity),u_image0:new h.aG(c,t.u_image0),u_image1:new h.aG(c,t.u_image1),u_brightness_low:new h.aH(c,t.u_brightness_low),u_brightness_high:new h.aH(c,t.u_brightness_high),u_saturation_factor:new h.aH(c,t.u_saturation_factor),u_contrast_factor:new h.aH(c,t.u_contrast_factor),u_spin_weights:new h.aK(c,t.u_spin_weights)}),symbolIcon:(c,t)=>({u_is_size_zoom_constant:new h.aG(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aG(c,t.u_is_size_feature_constant),u_size_t:new h.aH(c,t.u_size_t),u_size:new h.aH(c,t.u_size),u_camera_to_center_distance:new h.aH(c,t.u_camera_to_center_distance),u_pitch:new h.aH(c,t.u_pitch),u_rotate_symbol:new h.aG(c,t.u_rotate_symbol),u_aspect_ratio:new h.aH(c,t.u_aspect_ratio),u_fade_change:new h.aH(c,t.u_fade_change),u_matrix:new h.aI(c,t.u_matrix),u_label_plane_matrix:new h.aI(c,t.u_label_plane_matrix),u_coord_matrix:new h.aI(c,t.u_coord_matrix),u_is_text:new h.aG(c,t.u_is_text),u_pitch_with_map:new h.aG(c,t.u_pitch_with_map),u_texsize:new h.aL(c,t.u_texsize),u_texture:new h.aG(c,t.u_texture)}),symbolSDF:(c,t)=>({u_is_size_zoom_constant:new h.aG(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aG(c,t.u_is_size_feature_constant),u_size_t:new h.aH(c,t.u_size_t),u_size:new h.aH(c,t.u_size),u_camera_to_center_distance:new h.aH(c,t.u_camera_to_center_distance),u_pitch:new h.aH(c,t.u_pitch),u_rotate_symbol:new h.aG(c,t.u_rotate_symbol),u_aspect_ratio:new h.aH(c,t.u_aspect_ratio),u_fade_change:new h.aH(c,t.u_fade_change),u_matrix:new h.aI(c,t.u_matrix),u_label_plane_matrix:new h.aI(c,t.u_label_plane_matrix),u_coord_matrix:new h.aI(c,t.u_coord_matrix),u_is_text:new h.aG(c,t.u_is_text),u_pitch_with_map:new h.aG(c,t.u_pitch_with_map),u_texsize:new h.aL(c,t.u_texsize),u_texture:new h.aG(c,t.u_texture),u_gamma_scale:new h.aH(c,t.u_gamma_scale),u_device_pixel_ratio:new h.aH(c,t.u_device_pixel_ratio),u_is_halo:new h.aG(c,t.u_is_halo)}),symbolTextAndIcon:(c,t)=>({u_is_size_zoom_constant:new h.aG(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aG(c,t.u_is_size_feature_constant),u_size_t:new h.aH(c,t.u_size_t),u_size:new h.aH(c,t.u_size),u_camera_to_center_distance:new h.aH(c,t.u_camera_to_center_distance),u_pitch:new h.aH(c,t.u_pitch),u_rotate_symbol:new h.aG(c,t.u_rotate_symbol),u_aspect_ratio:new h.aH(c,t.u_aspect_ratio),u_fade_change:new h.aH(c,t.u_fade_change),u_matrix:new h.aI(c,t.u_matrix),u_label_plane_matrix:new h.aI(c,t.u_label_plane_matrix),u_coord_matrix:new h.aI(c,t.u_coord_matrix),u_is_text:new h.aG(c,t.u_is_text),u_pitch_with_map:new h.aG(c,t.u_pitch_with_map),u_texsize:new h.aL(c,t.u_texsize),u_texsize_icon:new h.aL(c,t.u_texsize_icon),u_texture:new h.aG(c,t.u_texture),u_texture_icon:new h.aG(c,t.u_texture_icon),u_gamma_scale:new h.aH(c,t.u_gamma_scale),u_device_pixel_ratio:new h.aH(c,t.u_device_pixel_ratio),u_is_halo:new h.aG(c,t.u_is_halo)}),background:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_opacity:new h.aH(c,t.u_opacity),u_color:new h.aM(c,t.u_color)}),backgroundPattern:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_opacity:new h.aH(c,t.u_opacity),u_image:new h.aG(c,t.u_image),u_pattern_tl_a:new h.aL(c,t.u_pattern_tl_a),u_pattern_br_a:new h.aL(c,t.u_pattern_br_a),u_pattern_tl_b:new h.aL(c,t.u_pattern_tl_b),u_pattern_br_b:new h.aL(c,t.u_pattern_br_b),u_texsize:new h.aL(c,t.u_texsize),u_mix:new h.aH(c,t.u_mix),u_pattern_size_a:new h.aL(c,t.u_pattern_size_a),u_pattern_size_b:new h.aL(c,t.u_pattern_size_b),u_scale_a:new h.aH(c,t.u_scale_a),u_scale_b:new h.aH(c,t.u_scale_b),u_pixel_coord_upper:new h.aL(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(c,t.u_pixel_coord_lower),u_tile_units_to_pixels:new h.aH(c,t.u_tile_units_to_pixels)}),terrain:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_texture:new h.aG(c,t.u_texture),u_ele_delta:new h.aH(c,t.u_ele_delta)}),terrainDepth:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_ele_delta:new h.aH(c,t.u_ele_delta)}),terrainCoords:(c,t)=>({u_matrix:new h.aI(c,t.u_matrix),u_texture:new h.aG(c,t.u_texture),u_terrain_coords_id:new h.aH(c,t.u_terrain_coords_id),u_ele_delta:new h.aH(c,t.u_ele_delta)})};class bc{constructor(t,n,a){this.context=t;const l=t.gl;this.buffer=l.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?l.DYNAMIC_DRAW:l.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Dn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class aa{constructor(t,n,a,l){this.length=n.length,this.attributes=a,this.itemSize=n.bytesPerElement,this.dynamicDraw=l,this.context=t;const u=t.gl;this.buffer=u.createBuffer(),t.bindVertexBuffer.set(this.buffer),u.bufferData(u.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let a=0;a<this.attributes.length;a++){const l=n.attributes[this.attributes[a].name];l!==void 0&&t.enableVertexAttribArray(l)}}setVertexAttribPointers(t,n,a){for(let l=0;l<this.attributes.length;l++){const u=this.attributes[l],m=n.attributes[u.name];m!==void 0&&t.vertexAttribPointer(m,u.components,t[Dn[u.type]],!1,this.itemSize,u.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ji=new WeakMap;function Ui(c){var t;if(Ji.has(c))return Ji.get(c);{const n=(t=c.getParameter(c.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Ji.set(c,n),n}}class St{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class oa extends St{getDefault(){return h.aO.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class la extends St{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Qa extends St{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class eo extends St{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ca extends St{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class to extends St{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class io extends St{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ha extends St{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class pl extends St{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class fl extends St{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class is extends St{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class wc extends St{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Sc extends St{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Tc extends St{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ic extends St{getDefault(){return h.aO.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Cc extends St{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ac extends St{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class ro extends St{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ua extends St{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class no extends St{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class so extends St{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class rs extends St{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ml extends St{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class gl extends St{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ao extends St{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ln extends St{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class _l extends St{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ns extends St{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const a=this.gl;Ui(a)?a.bindVertexArray(t):(n=a.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class ss extends St{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class yl extends St{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class oo extends St{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class wt extends St{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class da extends wt{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class kc extends wt{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class xl extends wt{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ps{constructor(t,n,a,l,u){this.context=t,this.width=n,this.height=a;const m=t.gl,_=this.framebuffer=m.createFramebuffer();if(this.colorAttachment=new da(t,_),l)this.depthAttachment=u?new xl(t,_):new kc(t,_);else if(u)throw new Error("Stencil cannot be set without depth");if(m.checkFramebufferStatus(m.FRAMEBUFFER)!==m.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}t.deleteFramebuffer(this.framebuffer)}}class ai{constructor(t,n,a){this.blendFunction=t,this.blendColor=n,this.mask=a}}ai.Replace=[1,0],ai.disabled=new ai(ai.Replace,h.aO.transparent,[!1,!1,!1,!1]),ai.unblended=new ai(ai.Replace,h.aO.transparent,[!0,!0,!0,!0]),ai.alphaBlended=new ai([1,771],h.aO.transparent,[!0,!0,!0,!0]);class Ec{constructor(t){var n,a;if(this.gl=t,this.clearColor=new oa(this),this.clearDepth=new la(this),this.clearStencil=new Qa(this),this.colorMask=new eo(this),this.depthMask=new ca(this),this.stencilMask=new to(this),this.stencilFunc=new io(this),this.stencilOp=new ha(this),this.stencilTest=new pl(this),this.depthRange=new fl(this),this.depthTest=new is(this),this.depthFunc=new wc(this),this.blend=new Sc(this),this.blendFunc=new Tc(this),this.blendColor=new Ic(this),this.blendEquation=new Cc(this),this.cullFace=new Ac(this),this.cullFaceSide=new ro(this),this.frontFace=new ua(this),this.program=new no(this),this.activeTexture=new so(this),this.viewport=new rs(this),this.bindFramebuffer=new ml(this),this.bindRenderbuffer=new gl(this),this.bindTexture=new ao(this),this.bindVertexBuffer=new Ln(this),this.bindElementBuffer=new _l(this),this.bindVertexArray=new ns(this),this.pixelStoreUnpack=new ss(this),this.pixelStoreUnpackPremultiplyAlpha=new yl(this),this.pixelStoreUnpackFlipY=new oo(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Ui(t)){this.HALF_FLOAT=t.HALF_FLOAT;const l=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:l==null?void 0:l.RGBA16F_EXT,this.RGB16F=(a=t.RGB16F)!==null&&a!==void 0?a:l==null?void 0:l.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const l=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=l==null?void 0:l.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new bc(this,t,n)}createVertexBuffer(t,n,a){return new aa(this,t,n,a)}createRenderbuffer(t,n,a){const l=this.gl,u=l.createRenderbuffer();return this.bindRenderbuffer.set(u),l.renderbufferStorage(l.RENDERBUFFER,t,n,a),this.bindRenderbuffer.set(null),u}createFramebuffer(t,n,a,l){return new Ps(this,t,n,a,l)}clear({color:t,depth:n,stencil:a}){const l=this.gl;let u=0;t&&(u|=l.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(u|=l.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),a!==void 0&&(u|=l.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),l.clear(u)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){h.aD(t.blendFunction,ai.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Ui(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return Ui(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class bt{constructor(t,n,a){this.func=t,this.mask=n,this.range=a}}bt.ReadOnly=!1,bt.ReadWrite=!0,bt.disabled=new bt(519,bt.ReadOnly,[0,1]);const lo=7680;class Vt{constructor(t,n,a,l,u,m){this.test=t,this.ref=n,this.mask=a,this.fail=l,this.depthFail=u,this.pass=m}}Vt.disabled=new Vt({func:519,mask:0},0,0,lo,lo,lo);class Bt{constructor(t,n,a){this.enable=t,this.mode=n,this.frontFace=a}}let Rn;function pa(c,t,n,a,l,u,m){const _=c.context,y=_.gl,v=c.useProgram("collisionBox"),S=[];let I=0,D=0;for(let W=0;W<a.length;W++){const ie=a[W],ue=t.getTile(ie),ce=ue.getBucket(n);if(!ce)continue;let _e=ie.posMatrix;l[0]===0&&l[1]===0||(_e=c.translatePosMatrix(ie.posMatrix,ue,l,u));const be=m?ce.textCollisionBox:ce.iconCollisionBox,ve=ce.collisionCircleArray;if(ve.length>0){const Se=h.F(),Oe=_e;h.aP(Se,ce.placementInvProjMatrix,c.transform.glCoordMatrix),h.aP(Se,Se,ce.placementViewportMatrix),S.push({circleArray:ve,circleOffset:D,transform:Oe,invTransform:Se,coord:ie}),I+=ve.length/4,D=I}be&&v.draw(_,y.LINES,bt.disabled,Vt.disabled,c.colorModeForRenderPass(),Bt.disabled,ol(_e,c.transform,ue),c.style.map.terrain&&c.style.map.terrain.getTerrainData(ie),n.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,null,c.transform.zoom,null,null,be.collisionVertexBuffer)}if(!m||!S.length)return;const q=c.useProgram("collisionCircle"),N=new h.aQ;N.resize(4*I),N._trim();let Z=0;for(const W of S)for(let ie=0;ie<W.circleArray.length/4;ie++){const ue=4*ie,ce=W.circleArray[ue+0],_e=W.circleArray[ue+1],be=W.circleArray[ue+2],ve=W.circleArray[ue+3];N.emplace(Z++,ce,_e,be,ve,0),N.emplace(Z++,ce,_e,be,ve,1),N.emplace(Z++,ce,_e,be,ve,2),N.emplace(Z++,ce,_e,be,ve,3)}(!Rn||Rn.length<2*I)&&(Rn=function(W){const ie=2*W,ue=new h.aS;ue.resize(ie),ue._trim();for(let ce=0;ce<ie;ce++){const _e=6*ce;ue.uint16[_e+0]=4*ce+0,ue.uint16[_e+1]=4*ce+1,ue.uint16[_e+2]=4*ce+2,ue.uint16[_e+3]=4*ce+2,ue.uint16[_e+4]=4*ce+3,ue.uint16[_e+5]=4*ce+0}return ue}(I));const U=_.createIndexBuffer(Rn,!0),$=_.createVertexBuffer(N,h.aR.members,!0);for(const W of S){const ie={u_matrix:W.transform,u_inv_matrix:W.invTransform,u_camera_to_center_distance:(oe=c.transform).cameraToCenterDistance,u_viewport_size:[oe.width,oe.height]};q.draw(_,y.TRIANGLES,bt.disabled,Vt.disabled,c.colorModeForRenderPass(),Bt.disabled,ie,c.style.map.terrain&&c.style.map.terrain.getTerrainData(W.coord),n.id,$,U,h.$.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,c.transform.zoom,null,null,null)}var oe;$.destroy(),U.destroy()}Bt.disabled=new Bt(!1,1029,2305),Bt.backCCW=new Bt(!0,1029,2305);const co=h.an(new Float32Array(16));function vl(c,t,n,a,l,u){const{horizontalAlign:m,verticalAlign:_}=h.at(c);return new h.P((-(m-.5)*t/l+a[0])*u,(-(_-.5)*n/l+a[1])*u)}function fa(c,t,n,a,l,u,m,_,y,v,S){const I=c.text.placedSymbolArray,D=c.text.dynamicLayoutVertexArray,q=c.icon.dynamicLayoutVertexArray,N={};D.clear();for(let Z=0;Z<I.length;Z++){const U=I.get(Z),$=U.hidden||!U.crossTileID||c.allowVerticalPlacement&&!U.placedOrientation?null:a[U.crossTileID];if($){const oe=new h.P(U.anchorX,U.anchorY),W=bi(oe,n?m:u,S),ie=H(l.cameraToCenterDistance,W.signedDistanceFromCamera);let ue=h.ai(c.textSizeData,y,U)*ie/h.ao;n&&(ue*=c.tilePixelRatio/_);const{width:ce,height:_e,anchor:be,textOffset:ve,textBoxScale:Se}=$,Oe=vl(be,ce,_e,ve,Se,ue),Ke=n?bi(oe.add(Oe),u,S).point:W.point.add(t?Oe.rotate(-l.angle):Oe),Me=c.allowVerticalPlacement&&U.placedOrientation===h.ah.vertical?Math.PI/2:0;for(let Xe=0;Xe<U.numGlyphs;Xe++)h.aj(D,Ke,Me);v&&U.associatedIconIndex>=0&&(N[U.associatedIconIndex]={shiftedAnchor:Ke,angle:Me})}else ge(U.numGlyphs,D)}if(v){q.clear();const Z=c.icon.placedSymbolArray;for(let U=0;U<Z.length;U++){const $=Z.get(U);if($.hidden)ge($.numGlyphs,q);else{const oe=N[U];if(oe)for(let W=0;W<$.numGlyphs;W++)h.aj(q,oe.shiftedAnchor,oe.angle);else ge($.numGlyphs,q)}}c.icon.dynamicLayoutVertexBuffer.updateData(q)}c.text.dynamicLayoutVertexBuffer.updateData(D)}function ma(c,t,n){return n.iconsInText&&t?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function ga(c,t,n,a,l,u,m,_,y,v,S,I){const D=c.context,q=D.gl,N=c.transform,Z=_==="map",U=y==="map",$=_!=="viewport"&&n.layout.get("symbol-placement")!=="point",oe=Z&&!U&&!$,W=!n.layout.get("symbol-sort-key").isConstant();let ie=!1;const ue=c.depthModeForSublayer(0,bt.ReadOnly),ce=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),_e=[];for(const be of a){const ve=t.getTile(be),Se=ve.getBucket(n);if(!Se)continue;const Oe=l?Se.text:Se.icon;if(!Oe||!Oe.segments.get().length||!Oe.hasVisibleVertices)continue;const Ke=Oe.programConfigurations.get(n.id),Me=l||Se.sdfIcons,Xe=l?Se.textSizeData:Se.iconSizeData,Ue=U||N.pitch!==0,Nt=c.useProgram(ma(Me,l,Se),Ke),ft=h.ag(Xe,N.zoom),lt=c.style.map.terrain&&c.style.map.terrain.getTerrainData(be);let mt,li,Dt,er,Ri=[0,0],ti=null;if(l)li=ve.glyphAtlasTexture,Dt=q.LINEAR,mt=ve.glyphAtlasTexture.size,Se.iconsInText&&(Ri=ve.imageAtlasTexture.size,ti=ve.imageAtlasTexture,er=Ue||c.options.rotating||c.options.zooming||Xe.kind==="composite"||Xe.kind==="camera"?q.LINEAR:q.NEAREST);else{const jt=n.layout.get("icon-size").constantOr(0)!==1||Se.iconsNeedLinear;li=ve.imageAtlasTexture,Dt=Me||c.options.rotating||c.options.zooming||jt||Ue?q.LINEAR:q.NEAREST,mt=ve.imageAtlasTexture.size}const Ni=tt(ve,1,c.transform.zoom),ji=rt(be.posMatrix,U,Z,c.transform,Ni),Br=Pn(be.posMatrix,U,Z,c.transform,Ni),xn=ce&&Se.hasTextData(),us=n.layout.get("icon-text-fit")!=="none"&&xn&&Se.hasIconData();if($){const jt=c.style.map.terrain?(Bi,Ii)=>c.style.map.terrain.getElevation(be,Bi,Ii):null,Ti=n.layout.get("text-rotation-alignment")==="map";P(Se,be.posMatrix,c,l,ji,Br,U,v,Ti,jt)}const ds=c.translatePosMatrix(be.posMatrix,ve,u,m),vn=$||l&&ce||us?co:ji,Si=c.translatePosMatrix(Br,ve,u,m,!0),ci=Me&&n.paint.get(l?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ii;ii=Me?Se.iconsInText?Ms(Xe.kind,ft,oe,U,c,ds,vn,Si,mt,Ri):Es(Xe.kind,ft,oe,U,c,ds,vn,Si,l,mt,!0):ks(Xe.kind,ft,oe,U,c,ds,vn,Si,l,mt);const tr={program:Nt,buffers:Oe,uniformValues:ii,atlasTexture:li,atlasTextureIcon:ti,atlasInterpolation:Dt,atlasInterpolationIcon:er,isSDF:Me,hasHalo:ci};if(W&&Se.canOverlap){ie=!0;const jt=Oe.segments.get();for(const Ti of jt)_e.push({segments:new h.$([Ti]),sortKey:Ti.sortKey,state:tr,terrainData:lt})}else _e.push({segments:Oe.segments,sortKey:0,state:tr,terrainData:lt})}ie&&_e.sort((be,ve)=>be.sortKey-ve.sortKey);for(const be of _e){const ve=be.state;if(D.activeTexture.set(q.TEXTURE0),ve.atlasTexture.bind(ve.atlasInterpolation,q.CLAMP_TO_EDGE),ve.atlasTextureIcon&&(D.activeTexture.set(q.TEXTURE1),ve.atlasTextureIcon&&ve.atlasTextureIcon.bind(ve.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),ve.isSDF){const Se=ve.uniformValues;ve.hasHalo&&(Se.u_is_halo=1,bl(ve.buffers,be.segments,n,c,ve.program,ue,S,I,Se,be.terrainData)),Se.u_is_halo=0}bl(ve.buffers,be.segments,n,c,ve.program,ue,S,I,ve.uniformValues,be.terrainData)}}function bl(c,t,n,a,l,u,m,_,y,v){const S=a.context;l.draw(S,S.gl.TRIANGLES,u,m,_,Bt.disabled,y,v,n.id,c.layoutVertexBuffer,c.indexBuffer,t,n.paint,a.transform.zoom,c.programConfigurations.get(n.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function _a(c,t,n,a,l){if(!n||!a||!a.imageAtlas)return;const u=a.imageAtlas.patternPositions;let m=u[n.to.toString()],_=u[n.from.toString()];if(!m&&_&&(m=_),!_&&m&&(_=m),!m||!_){const y=l.getPaintProperty(t);m=u[y],_=u[y]}m&&_&&c.setConstantPatternPositions(m,_)}function wl(c,t,n,a,l,u,m){const _=c.context.gl,y="fill-pattern",v=n.paint.get(y),S=v&&v.constantOr(1),I=n.getCrossfadeParameters();let D,q,N,Z,U;m?(q=S&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=_.LINES):(q=S?"fillPattern":"fill",D=_.TRIANGLES);const $=v.constantOr(null);for(const oe of a){const W=t.getTile(oe);if(S&&!W.patternsLoaded())continue;const ie=W.getBucket(n);if(!ie)continue;const ue=ie.programConfigurations.get(n.id),ce=c.useProgram(q,ue),_e=c.style.map.terrain&&c.style.map.terrain.getTerrainData(oe);S&&(c.context.activeTexture.set(_.TEXTURE0),W.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),ue.updatePaintBuffers(I)),_a(ue,y,$,W,n);const be=_e?oe:null,ve=c.translatePosMatrix(be?be.posMatrix:oe.posMatrix,W,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(m){Z=ie.indexBuffer2,U=ie.segments2;const Se=[_.drawingBufferWidth,_.drawingBufferHeight];N=q==="fillOutlinePattern"&&S?al(ve,c,I,W,Se):_c(ve,Se)}else Z=ie.indexBuffer,U=ie.segments,N=S?ta(ve,c,I,W):sl(ve);ce.draw(c.context,D,l,c.stencilModeForClipping(oe),u,Bt.disabled,N,_e,n.id,ie.layoutVertexBuffer,Z,U,n.paint,c.transform.zoom,ue)}}function ya(c,t,n,a,l,u,m){const _=c.context,y=_.gl,v="fill-extrusion-pattern",S=n.paint.get(v),I=S.constantOr(1),D=n.getCrossfadeParameters(),q=n.paint.get("fill-extrusion-opacity"),N=S.constantOr(null);for(const Z of a){const U=t.getTile(Z),$=U.getBucket(n);if(!$)continue;const oe=c.style.map.terrain&&c.style.map.terrain.getTerrainData(Z),W=$.programConfigurations.get(n.id),ie=c.useProgram(I?"fillExtrusionPattern":"fillExtrusion",W);I&&(c.context.activeTexture.set(y.TEXTURE0),U.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),W.updatePaintBuffers(D)),_a(W,v,N,U,n);const ue=c.translatePosMatrix(Z.posMatrix,U,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),ce=n.paint.get("fill-extrusion-vertical-gradient"),_e=I?gc(ue,c,ce,q,Z,D,U):Is(ue,c,ce,q);ie.draw(_,_.gl.TRIANGLES,l,u,m,Bt.backCCW,_e,oe,n.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,n.paint,c.transform.zoom,W,c.style.map.terrain&&$.centroidVertexBuffer)}}function xa(c,t,n,a,l,u,m){const _=c.context,y=_.gl,v=n.fbo;if(!v)return;const S=c.useProgram("hillshade"),I=c.style.map.terrain&&c.style.map.terrain.getTerrainData(t);_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,v.colorAttachment.get()),S.draw(_,y.TRIANGLES,l,u,m,Bt.disabled,((D,q,N,Z)=>{const U=N.paint.get("hillshade-shadow-color"),$=N.paint.get("hillshade-highlight-color"),oe=N.paint.get("hillshade-accent-color");let W=N.paint.get("hillshade-illumination-direction")*(Math.PI/180);N.paint.get("hillshade-illumination-anchor")==="viewport"&&(W-=D.transform.angle);const ie=!D.options.moving;return{u_matrix:Z?Z.posMatrix:D.transform.calculatePosMatrix(q.tileID.toUnwrapped(),ie),u_image:0,u_latrange:hl(0,q.tileID),u_light:[N.paint.get("hillshade-exaggeration"),W],u_shadow:U,u_highlight:$,u_accent:oe}})(c,n,a,I?t:null),I,a.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}function ho(c,t,n,a,l,u){const m=c.context,_=m.gl,y=t.dem;if(y&&y.data){const v=y.dim,S=y.stride,I=y.getPixels();if(m.activeTexture.set(_.TEXTURE1),m.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(S),t.demTexture){const q=t.demTexture;q.update(I,{premultiply:!1}),q.bind(_.NEAREST,_.CLAMP_TO_EDGE)}else t.demTexture=new Ct(m,I,_.RGBA,{premultiply:!1}),t.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);m.activeTexture.set(_.TEXTURE0);let D=t.fbo;if(!D){const q=new Ct(m,{width:v,height:v,data:null},_.RGBA);q.bind(_.LINEAR,_.CLAMP_TO_EDGE),D=t.fbo=m.createFramebuffer(v,v,!0,!1),D.colorAttachment.set(q.texture)}m.bindFramebuffer.set(D.framebuffer),m.viewport.set([0,0,v,v]),c.useProgram("hillshadePrepare").draw(m,_.TRIANGLES,a,l,u,Bt.disabled,((q,N)=>{const Z=N.stride,U=h.F();return h.aN(U,0,h.W,-h.W,0,0,1),h.H(U,U,[0,-h.W,0]),{u_matrix:U,u_image:1,u_dimension:[Z,Z],u_zoom:q.overscaledZ,u_unpack:N.getUnpackVector()}})(t.tileID,y),null,n.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Sl(c,t,n,a,l,u){const m=a.paint.get("raster-fade-duration");if(!u&&m>0){const _=re.now(),y=(_-c.timeAdded)/m,v=t?(_-t.timeAdded)/m:-1,S=n.getSource(),I=l.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),D=!t||Math.abs(t.tileID.overscaledZ-I)>Math.abs(c.tileID.overscaledZ-I),q=D&&c.refreshedUponExpiration?1:h.ac(D?y:1-v,0,1);return c.refreshedUponExpiration&&y>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}const Tl=new h.aO(1,0,0,1),va=new h.aO(0,1,0,1),uo=new h.aO(0,0,1,1),Mc=new h.aO(1,0,1,1),Il=new h.aO(0,1,1,1);function Qt(c,t,n,a){$i(c,0,t+n/2,c.transform.width,n,a)}function gn(c,t,n,a){$i(c,t-n/2,0,n,c.transform.height,a)}function $i(c,t,n,a,l,u){const m=c.context,_=m.gl;_.enable(_.SCISSOR_TEST),_.scissor(t*c.pixelRatio,n*c.pixelRatio,a*c.pixelRatio,l*c.pixelRatio),m.clear({color:u}),_.disable(_.SCISSOR_TEST)}function po(c,t,n){const a=c.context,l=a.gl,u=n.posMatrix,m=c.useProgram("debug"),_=bt.disabled,y=Vt.disabled,v=c.colorModeForRenderPass(),S="$debug",I=c.style.map.terrain&&c.style.map.terrain.getTerrainData(n);a.activeTexture.set(l.TEXTURE0);const D=t.getTileByID(n.key).latestRawTileData,q=Math.floor((D&&D.byteLength||0)/1024),N=t.getTile(n).tileSize,Z=512/Math.min(N,512)*(n.overscaledZ/c.transform.zoom)*.5;let U=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(U+=` => ${n.overscaledZ}`),function($,oe){$.initDebugOverlayCanvas();const W=$.debugOverlayCanvas,ie=$.context.gl,ue=$.debugOverlayCanvas.getContext("2d");ue.clearRect(0,0,W.width,W.height),ue.shadowColor="white",ue.shadowBlur=2,ue.lineWidth=1.5,ue.strokeStyle="white",ue.textBaseline="top",ue.font="bold 36px Open Sans, sans-serif",ue.fillText(oe,5,5),ue.strokeText(oe,5,5),$.debugOverlayTexture.update(W),$.debugOverlayTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE)}(c,`${U} ${q}kB`),m.draw(a,l.TRIANGLES,_,y,ai.alphaBlended,Bt.disabled,ll(u,h.aO.transparent,Z),null,S,c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments),m.draw(a,l.LINE_STRIP,_,y,v,Bt.disabled,ll(u,h.aO.red),I,S,c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments)}function ba(c,t,n){const a=c.context,l=a.gl,u=c.colorModeForRenderPass(),m=new bt(l.LEQUAL,bt.ReadWrite,c.depthRangeFor3D),_=c.useProgram("terrain"),y=t.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,c.width,c.height]);for(const v of n){const S=c.renderToTexture.getTexture(v),I=t.getTerrainData(v.tileID);a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,S.texture);const D={u_matrix:c.transform.calculatePosMatrix(v.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(c.transform.zoom)};_.draw(a,l.TRIANGLES,m,Vt.disabled,u,Bt.backCCW,D,I,"terrain",y.vertexBuffer,y.indexBuffer,y.segments)}}class Cl{constructor(t,n){this.context=new Ec(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.F(),renderTime:0},this.setup(),this.numSublayers=Vi.maxUnderzooming+Vi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new fn}resize(t,n,a){if(this.width=Math.floor(t*a),this.height=Math.floor(n*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const l of this.style._order)this.style._layers[l].resize()}setup(){const t=this.context,n=new h.aV;n.emplaceBack(0,0),n.emplaceBack(h.W,0),n.emplaceBack(0,h.W),n.emplaceBack(h.W,h.W),this.tileExtentBuffer=t.createVertexBuffer(n,$s.members),this.tileExtentSegments=h.$.simpleSegment(0,0,4,2);const a=new h.aV;a.emplaceBack(0,0),a.emplaceBack(h.W,0),a.emplaceBack(0,h.W),a.emplaceBack(h.W,h.W),this.debugBuffer=t.createVertexBuffer(a,$s.members),this.debugSegments=h.$.simpleSegment(0,0,4,5);const l=new h.Z;l.emplaceBack(0,0,0,0),l.emplaceBack(h.W,0,h.W,0),l.emplaceBack(0,h.W,0,h.W),l.emplaceBack(h.W,h.W,h.W,h.W),this.rasterBoundsBuffer=t.createVertexBuffer(l,Fi.members),this.rasterBoundsSegments=h.$.simpleSegment(0,0,4,2);const u=new h.aV;u.emplaceBack(0,0),u.emplaceBack(1,0),u.emplaceBack(0,1),u.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(u,$s.members),this.viewportSegments=h.$.simpleSegment(0,0,4,2);const m=new h.aW;m.emplaceBack(0),m.emplaceBack(1),m.emplaceBack(3),m.emplaceBack(2),m.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(m);const _=new h.aX;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(_);const y=this.context.gl;this.stencilClearMode=new Vt({func:y.ALWAYS,mask:0},0,255,y.ZERO,y.ZERO,y.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=h.F();h.aN(a,0,this.width,this.height,0,0,1),h.J(a,a,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,bt.disabled,this.stencilClearMode,ai.disabled,Bt.disabled,ia(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const a=this.context,l=a.gl;this.nextStencilID+n.length>256&&this.clearStencil(),a.setColorMode(ai.disabled),a.setDepthMode(bt.disabled);const u=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const m of n){const _=this._tileClippingMaskIDs[m.key]=this.nextStencilID++,y=this.style.map.terrain&&this.style.map.terrain.getTerrainData(m);u.draw(a,l.TRIANGLES,bt.disabled,new Vt({func:l.ALWAYS,mask:0},_,255,l.KEEP,l.KEEP,l.REPLACE),ai.disabled,Bt.disabled,ia(m.posMatrix),y,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Vt({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Vt({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,a=t.sort((m,_)=>_.overscaledZ-m.overscaledZ),l=a[a.length-1].overscaledZ,u=a[0].overscaledZ-l+1;if(u>1){this.currentStencilSource=void 0,this.nextStencilID+u>256&&this.clearStencil();const m={};for(let _=0;_<u;_++)m[_+l]=new Vt({func:n.GEQUAL,mask:255},_+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=u,[m,a]}return[{[l]:Vt.disabled},a]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ai([t.CONSTANT_COLOR,t.ONE],new h.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ai.unblended:ai.alphaBlended}depthModeForSublayer(t,n,a){if(!this.opaquePassEnabledForLayer())return bt.disabled;const l=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new bt(a||this.context.gl.LEQUAL,n,[l,l])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(re.now()),this.imageManager.beginFrame();const a=this.style._order,l=this.style.sourceCaches,u={},m={},_={};for(const y in l){const v=l[y];v.used&&v.prepare(this.context),u[y]=v.getVisibleCoordinates(),m[y]=u[y].slice().reverse(),_[y]=v.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let y=0;y<a.length;y++)if(this.style._layers[a[y]].is3D()){this.opaquePassCutoff=y;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const y=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!h.aY(this.terrainFacilitator.matrix,this.transform.projMatrix)||y.length)&&(h.aZ(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(v,S){const I=v.context,D=I.gl,q=ai.unblended,N=new bt(D.LEQUAL,bt.ReadWrite,[0,1]),Z=S.getTerrainMesh(),U=S.sourceCache.getRenderableTiles(),$=v.useProgram("terrainDepth");I.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),I.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),I.clear({color:h.aO.transparent,depth:1});for(const oe of U){const W=S.getTerrainData(oe.tileID),ie={u_matrix:v.transform.calculatePosMatrix(oe.tileID.toUnwrapped()),u_ele_delta:S.getMeshFrameDelta(v.transform.zoom)};$.draw(I,D.TRIANGLES,N,Vt.disabled,q,Bt.backCCW,ie,W,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}I.bindFramebuffer.set(null),I.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain),function(v,S){const I=v.context,D=I.gl,q=ai.unblended,N=new bt(D.LEQUAL,bt.ReadWrite,[0,1]),Z=S.getTerrainMesh(),U=S.getCoordsTexture(),$=S.sourceCache.getRenderableTiles(),oe=v.useProgram("terrainCoords");I.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),I.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),I.clear({color:h.aO.transparent,depth:1}),S.coordsIndex=[];for(const W of $){const ie=S.getTerrainData(W.tileID);I.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,U.texture);const ue={u_matrix:v.transform.calculatePosMatrix(W.tileID.toUnwrapped()),u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(v.transform.zoom)};oe.draw(I,D.TRIANGLES,N,Vt.disabled,q,Bt.backCCW,ue,ie,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments),S.coordsIndex.push(W.tileID.key)}I.bindFramebuffer.set(null),I.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const y of a){const v=this.style._layers[y];if(!v.hasOffscreenPass()||v.isHidden(this.transform.zoom))continue;const S=m[v.source];(v.type==="custom"||S.length)&&this.renderLayer(this,l[v.source],v,S)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?h.aO.black:h.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const y=this.style._layers[a[this.currentLayer]],v=l[y.source],S=u[y.source];this._renderTileClippingMasks(y,S),this.renderLayer(this,v,y,S)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const y=this.style._layers[a[this.currentLayer]],v=l[y.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(y))continue;const S=(y.type==="symbol"?_:m)[y.source];this._renderTileClippingMasks(y,u[y.source]),this.renderLayer(this,v,y,S)}if(this.options.showTileBoundaries){const y=function(v,S){let I=null;const D=Object.values(v._layers).flatMap(U=>U.source&&!U.isHidden(S)?[v.sourceCaches[U.source]]:[]),q=D.filter(U=>U.getSource().type==="vector"),N=D.filter(U=>U.getSource().type!=="vector"),Z=U=>{(!I||I.getSource().maxzoom<U.getSource().maxzoom)&&(I=U)};return q.forEach(U=>Z(U)),I||N.forEach(U=>Z(U)),I}(this.style,this.transform.zoom);y&&function(v,S,I){for(let D=0;D<I.length;D++)po(v,S,I[D])}(this,y,y.getVisibleCoordinates())}this.options.showPadding&&function(y){const v=y.transform.padding;Qt(y,y.transform.height-(v.top||0),3,Tl),Qt(y,v.bottom||0,3,va),gn(y,v.left||0,3,uo),gn(y,y.transform.width-(v.right||0),3,Mc);const S=y.transform.centerPoint;(function(I,D,q,N){$i(I,D-1,q-10,2,20,N),$i(I,D-10,q-1,20,2,N)})(y,S.x,y.transform.height-S.y,Il)}(this),this.context.setDefault()}renderLayer(t,n,a,l){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(l||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(u,m,_,y,v){if(u.renderPass!=="translucent")return;const S=Vt.disabled,I=u.colorModeForRenderPass();(_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(D,q,N,Z,U,$,oe){const W=q.transform,ie=U==="map",ue=$==="map";for(const ce of D){const _e=Z.getTile(ce),be=_e.getBucket(N);if(!be||!be.text||!be.text.segments.get().length)continue;const ve=h.ag(be.textSizeData,W.zoom),Se=tt(_e,1,q.transform.zoom),Oe=rt(ce.posMatrix,ue,ie,q.transform,Se),Ke=N.layout.get("icon-text-fit")!=="none"&&be.hasIconData();if(ve){const Me=Math.pow(2,W.zoom-_e.tileID.overscaledZ);fa(be,ie,ue,oe,W,Oe,ce.posMatrix,Me,ve,Ke,q.style.map.terrain?(Xe,Ue)=>q.style.map.terrain.getElevation(ce,Xe,Ue):null)}}}(y,u,_,m,_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),v),_.paint.get("icon-opacity").constantOr(1)!==0&&ga(u,m,_,y,!1,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),_.layout.get("icon-rotation-alignment"),_.layout.get("icon-pitch-alignment"),_.layout.get("icon-keep-upright"),S,I),_.paint.get("text-opacity").constantOr(1)!==0&&ga(u,m,_,y,!0,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.layout.get("text-keep-upright"),S,I),m.map.showCollisionBoxes&&(pa(u,m,_,y,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),!0),pa(u,m,_,y,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),!1))})(t,n,a,l,this.style.placement.variableOffsets);break;case"circle":(function(u,m,_,y){if(u.renderPass!=="translucent")return;const v=_.paint.get("circle-opacity"),S=_.paint.get("circle-stroke-width"),I=_.paint.get("circle-stroke-opacity"),D=!_.layout.get("circle-sort-key").isConstant();if(v.constantOr(1)===0&&(S.constantOr(1)===0||I.constantOr(1)===0))return;const q=u.context,N=q.gl,Z=u.depthModeForSublayer(0,bt.ReadOnly),U=Vt.disabled,$=u.colorModeForRenderPass(),oe=[];for(let W=0;W<y.length;W++){const ie=y[W],ue=m.getTile(ie),ce=ue.getBucket(_);if(!ce)continue;const _e=ce.programConfigurations.get(_.id),be=u.useProgram("circle",_e),ve=ce.layoutVertexBuffer,Se=ce.indexBuffer,Oe=u.style.map.terrain&&u.style.map.terrain.getTerrainData(ie),Ke={programConfiguration:_e,program:be,layoutVertexBuffer:ve,indexBuffer:Se,uniformValues:yc(u,ie,ue,_),terrainData:Oe};if(D){const Me=ce.segments.get();for(const Xe of Me)oe.push({segments:new h.$([Xe]),sortKey:Xe.sortKey,state:Ke})}else oe.push({segments:ce.segments,sortKey:0,state:Ke})}D&&oe.sort((W,ie)=>W.sortKey-ie.sortKey);for(const W of oe){const{programConfiguration:ie,program:ue,layoutVertexBuffer:ce,indexBuffer:_e,uniformValues:be,terrainData:ve}=W.state;ue.draw(q,N.TRIANGLES,Z,U,$,Bt.disabled,be,ve,_.id,ce,_e,W.segments,_.paint,u.transform.zoom,ie)}})(t,n,a,l);break;case"heatmap":(function(u,m,_,y){if(_.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const v=u.context,S=v.gl,I=Vt.disabled,D=new ai([S.ONE,S.ONE],h.aO.transparent,[!0,!0,!0,!0]);(function(q,N,Z){const U=q.gl;q.activeTexture.set(U.TEXTURE1),q.viewport.set([0,0,N.width/4,N.height/4]);let $=Z.heatmapFbo;if($)U.bindTexture(U.TEXTURE_2D,$.colorAttachment.get()),q.bindFramebuffer.set($.framebuffer);else{const oe=U.createTexture();U.bindTexture(U.TEXTURE_2D,oe),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),$=Z.heatmapFbo=q.createFramebuffer(N.width/4,N.height/4,!1,!1),function(W,ie,ue,ce){var _e,be;const ve=W.gl,Se=(_e=W.HALF_FLOAT)!==null&&_e!==void 0?_e:ve.UNSIGNED_BYTE,Oe=(be=W.RGBA16F)!==null&&be!==void 0?be:ve.RGBA;ve.texImage2D(ve.TEXTURE_2D,0,Oe,ie.width/4,ie.height/4,0,ve.RGBA,Se,null),ce.colorAttachment.set(ue)}(q,N,oe,$)}})(v,u,_),v.clear({color:h.aO.transparent});for(let q=0;q<y.length;q++){const N=y[q];if(m.hasRenderableParent(N))continue;const Z=m.getTile(N),U=Z.getBucket(_);if(!U)continue;const $=U.programConfigurations.get(_.id),oe=u.useProgram("heatmap",$),{zoom:W}=u.transform;oe.draw(v,S.TRIANGLES,bt.disabled,I,D,Bt.disabled,cl(N.posMatrix,Z,W,_.paint.get("heatmap-intensity")),null,_.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,_.paint,u.transform.zoom,$)}v.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(v,S){const I=v.context,D=I.gl,q=S.heatmapFbo;if(!q)return;I.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,q.colorAttachment.get()),I.activeTexture.set(D.TEXTURE1);let N=S.colorRampTexture;N||(N=S.colorRampTexture=new Ct(I,S.colorRamp,D.RGBA)),N.bind(D.LINEAR,D.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(I,D.TRIANGLES,bt.disabled,Vt.disabled,v.colorModeForRenderPass(),Bt.disabled,((Z,U,$,oe)=>{const W=h.F();h.aN(W,0,Z.width,Z.height,0,0,1);const ie=Z.context.gl;return{u_matrix:W,u_world:[ie.drawingBufferWidth,ie.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}})(v,S),null,S.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,S.paint,v.transform.zoom)}(u,_))})(t,n,a,l);break;case"line":(function(u,m,_,y){if(u.renderPass!=="translucent")return;const v=_.paint.get("line-opacity"),S=_.paint.get("line-width");if(v.constantOr(1)===0||S.constantOr(1)===0)return;const I=u.depthModeForSublayer(0,bt.ReadOnly),D=u.colorModeForRenderPass(),q=_.paint.get("line-dasharray"),N=_.paint.get("line-pattern"),Z=N.constantOr(1),U=_.paint.get("line-gradient"),$=_.getCrossfadeParameters(),oe=Z?"linePattern":q?"lineSDF":U?"lineGradient":"line",W=u.context,ie=W.gl;let ue=!0;for(const ce of y){const _e=m.getTile(ce);if(Z&&!_e.patternsLoaded())continue;const be=_e.getBucket(_);if(!be)continue;const ve=be.programConfigurations.get(_.id),Se=u.context.program.get(),Oe=u.useProgram(oe,ve),Ke=ue||Oe.program!==Se,Me=u.style.map.terrain&&u.style.map.terrain.getTerrainData(ce),Xe=N.constantOr(null);if(Xe&&_e.imageAtlas){const ft=_e.imageAtlas,lt=ft.patternPositions[Xe.to.toString()],mt=ft.patternPositions[Xe.from.toString()];lt&&mt&&ve.setConstantPatternPositions(lt,mt)}const Ue=Me?ce:null,Nt=Z?zn(u,_e,_,$,Ue):q?na(u,_e,_,q,$,Ue):U?ul(u,_e,_,be.lineClipsArray.length,Ue):ra(u,_e,_,Ue);if(Z)W.activeTexture.set(ie.TEXTURE0),_e.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),ve.updatePaintBuffers($);else if(q&&(Ke||u.lineAtlas.dirty))W.activeTexture.set(ie.TEXTURE0),u.lineAtlas.bind(W);else if(U){const ft=be.gradients[_.id];let lt=ft.texture;if(_.gradientVersion!==ft.version){let mt=256;if(_.stepInterpolant){const li=m.getSource().maxzoom,Dt=ce.canonical.z===li?Math.ceil(1<<u.transform.maxZoom-ce.canonical.z):1;mt=h.ac(h.aT(be.maxLineLength/h.W*1024*Dt),256,W.maxTextureSize)}ft.gradient=h.aU({expression:_.gradientExpression(),evaluationKey:"lineProgress",resolution:mt,image:ft.gradient||void 0,clips:be.lineClipsArray}),ft.texture?ft.texture.update(ft.gradient):ft.texture=new Ct(W,ft.gradient,ie.RGBA),ft.version=_.gradientVersion,lt=ft.texture}W.activeTexture.set(ie.TEXTURE0),lt.bind(_.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}Oe.draw(W,ie.TRIANGLES,I,u.stencilModeForClipping(ce),D,Bt.disabled,Nt,Me,_.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,_.paint,u.transform.zoom,ve,be.layoutVertexBuffer2),ue=!1}})(t,n,a,l);break;case"fill":(function(u,m,_,y){const v=_.paint.get("fill-color"),S=_.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const I=u.colorModeForRenderPass(),D=_.paint.get("fill-pattern"),q=u.opaquePassEnabledForLayer()&&!D.constantOr(1)&&v.constantOr(h.aO.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===q){const N=u.depthModeForSublayer(1,u.renderPass==="opaque"?bt.ReadWrite:bt.ReadOnly);wl(u,m,_,y,N,I,!1)}if(u.renderPass==="translucent"&&_.paint.get("fill-antialias")){const N=u.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,bt.ReadOnly);wl(u,m,_,y,N,I,!0)}})(t,n,a,l);break;case"fill-extrusion":(function(u,m,_,y){const v=_.paint.get("fill-extrusion-opacity");if(v!==0&&u.renderPass==="translucent"){const S=new bt(u.context.gl.LEQUAL,bt.ReadWrite,u.depthRangeFor3D);if(v!==1||_.paint.get("fill-extrusion-pattern").constantOr(1))ya(u,m,_,y,S,Vt.disabled,ai.disabled),ya(u,m,_,y,S,u.stencilModeFor3D(),u.colorModeForRenderPass());else{const I=u.colorModeForRenderPass();ya(u,m,_,y,S,Vt.disabled,I)}}})(t,n,a,l);break;case"hillshade":(function(u,m,_,y){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent")return;const v=u.context,S=u.depthModeForSublayer(0,bt.ReadOnly),I=u.colorModeForRenderPass(),[D,q]=u.renderPass==="translucent"?u.stencilConfigForOverlap(y):[{},y];for(const N of q){const Z=m.getTile(N);Z.needsHillshadePrepare!==void 0&&Z.needsHillshadePrepare&&u.renderPass==="offscreen"?ho(u,Z,_,S,Vt.disabled,I):u.renderPass==="translucent"&&xa(u,N,Z,_,S,D[N.overscaledZ],I)}v.viewport.set([0,0,u.width,u.height])})(t,n,a,l);break;case"raster":(function(u,m,_,y){if(u.renderPass!=="translucent"||_.paint.get("raster-opacity")===0||!y.length)return;const v=u.context,S=v.gl,I=m.getSource(),D=u.useProgram("raster"),q=u.colorModeForRenderPass(),[N,Z]=I instanceof Yr?[{},y]:u.stencilConfigForOverlap(y),U=Z[Z.length-1].overscaledZ,$=!u.options.moving;for(const oe of Z){const W=u.depthModeForSublayer(oe.overscaledZ-U,_.paint.get("raster-opacity")===1?bt.ReadWrite:bt.ReadOnly,S.LESS),ie=m.getTile(oe);ie.registerFadeDuration(_.paint.get("raster-fade-duration"));const ue=m.findLoadedParent(oe,0),ce=Sl(ie,ue,m,_,u.transform,u.style.map.terrain);let _e,be;const ve=_.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;v.activeTexture.set(S.TEXTURE0),ie.texture.bind(ve,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),v.activeTexture.set(S.TEXTURE1),ue?(ue.texture.bind(ve,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),_e=Math.pow(2,ue.tileID.overscaledZ-ie.tileID.overscaledZ),be=[ie.tileID.canonical.x*_e%1,ie.tileID.canonical.y*_e%1]):ie.texture.bind(ve,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST);const Se=u.style.map.terrain&&u.style.map.terrain.getTerrainData(oe),Oe=Se?oe:null,Ke=Oe?Oe.posMatrix:u.transform.calculatePosMatrix(oe.toUnwrapped(),$),Me=sa(Ke,be||[0,0],_e||1,ce,_);I instanceof Yr?D.draw(v,S.TRIANGLES,W,Vt.disabled,q,Bt.disabled,Me,Se,_.id,I.boundsBuffer,u.quadTriangleIndexBuffer,I.boundsSegments):D.draw(v,S.TRIANGLES,W,N[oe.overscaledZ],q,Bt.disabled,Me,Se,_.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}})(t,n,a,l);break;case"background":(function(u,m,_,y){const v=_.paint.get("background-color"),S=_.paint.get("background-opacity");if(S===0)return;const I=u.context,D=I.gl,q=u.transform,N=q.tileSize,Z=_.paint.get("background-pattern");if(u.isPatternMissing(Z))return;const U=!Z&&v.a===1&&S===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==U)return;const $=Vt.disabled,oe=u.depthModeForSublayer(0,U==="opaque"?bt.ReadWrite:bt.ReadOnly),W=u.colorModeForRenderPass(),ie=u.useProgram(Z?"backgroundPattern":"background"),ue=y||q.coveringTiles({tileSize:N,terrain:u.style.map.terrain});Z&&(I.activeTexture.set(D.TEXTURE0),u.imageManager.bind(u.context));const ce=_.getCrossfadeParameters();for(const _e of ue){const be=y?_e.posMatrix:u.transform.calculatePosMatrix(_e.toUnwrapped()),ve=Z?vc(be,S,u,Z,{tileID:_e,tileSize:N},ce):xc(be,S,v),Se=u.style.map.terrain&&u.style.map.terrain.getTerrainData(_e);ie.draw(I,D.TRIANGLES,oe,$,W,Bt.disabled,ve,Se,_.id,u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}})(t,0,a,l);break;case"custom":(function(u,m,_){const y=u.context,v=_.implementation;if(u.renderPass==="offscreen"){const S=v.prerender;S&&(u.setCustomLayerDefaults(),y.setColorMode(u.colorModeForRenderPass()),S.call(v,y.gl,u.transform.customLayerMatrix()),y.setDirty(),u.setBaseState())}else if(u.renderPass==="translucent"){u.setCustomLayerDefaults(),y.setColorMode(u.colorModeForRenderPass()),y.setStencilMode(Vt.disabled);const S=v.renderingMode==="3d"?new bt(u.context.gl.LEQUAL,bt.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,bt.ReadOnly);y.setDepthMode(S),v.render(y.gl,u.transform.customLayerMatrix()),y.setDirty(),u.setBaseState(),y.bindFramebuffer.set(null)}})(t,0,a)}}translatePosMatrix(t,n,a,l,u){if(!a[0]&&!a[1])return t;const m=u?l==="map"?this.transform.angle:0:l==="viewport"?-this.transform.angle:0;if(m){const v=Math.sin(m),S=Math.cos(m);a=[a[0]*S-a[1]*v,a[0]*v+a[1]*S]}const _=[u?a[0]:tt(n,a[0],this.transform.zoom),u?a[1]:tt(n,a[1],this.transform.zoom),0],y=new Float32Array(16);return h.H(y,t,_),y}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),a=this.imageManager.getPattern(t.to.toString());return!n||!a}useProgram(t,n){this.cache=this.cache||{};const a=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new mn(this.context,Ts[t],n,dl[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ct(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}class _n{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,a){const l=Math.pow(2,a),u=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_=>{const y=1/(_=h.af([],_,t))[3]/n*l;return h.a_(_,_,[y,y,1/_[3],y])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_=>{const y=function(D,q){var N=q[0],Z=q[1],U=q[2],$=N*N+Z*Z+U*U;return $>0&&($=1/Math.sqrt($)),D[0]=q[0]*$,D[1]=q[1]*$,D[2]=q[2]*$,D}([],function(D,q,N){var Z=q[0],U=q[1],$=q[2],oe=N[0],W=N[1],ie=N[2];return D[0]=U*ie-$*W,D[1]=$*oe-Z*ie,D[2]=Z*W-U*oe,D}([],Tt([],u[_[0]],u[_[1]]),Tt([],u[_[2]],u[_[1]]))),v=-((S=y)[0]*(I=u[_[1]])[0]+S[1]*I[1]+S[2]*I[2]);var S,I;return y.concat(v)});return new _n(u,m)}}class yn{constructor(t,n){this.min=t,this.max=n,this.center=function(a,l,u){return a[0]=.5*l[0],a[1]=.5*l[1],a[2]=.5*l[2],a}([],function(a,l,u){return a[0]=l[0]+u[0],a[1]=l[1]+u[1],a[2]=l[2]+u[2],a}([],this.min,this.max))}quadrant(t){const n=[t%2==0,t<2],a=It(this.min),l=It(this.max);for(let u=0;u<n.length;u++)a[u]=n[u]?this.min[u]:this.center[u],l[u]=n[u]?this.center[u]:this.max[u];return l[2]=this.max[2],new yn(a,l)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let l=0;l<t.planes.length;l++){const u=t.planes[l];let m=0;for(let _=0;_<n.length;_++)h.a$(u,n[_])>=0&&m++;if(m===0)return 0;m!==n.length&&(a=!1)}if(a)return 2;for(let l=0;l<3;l++){let u=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let _=0;_<t.points.length;_++){const y=t.points[_][l]-this.min[l];u=Math.min(u,y),m=Math.max(m,y)}if(m<0||u>this.max[l]-this.min[l])return 0}return 1}}class as{constructor(t=0,n=0,a=0,l=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(a)||a<0||isNaN(l)||l<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=a,this.right=l}interpolate(t,n,a){return n.top!=null&&t.top!=null&&(this.top=h.z.number(t.top,n.top,a)),n.bottom!=null&&t.bottom!=null&&(this.bottom=h.z.number(t.bottom,n.bottom,a)),n.left!=null&&t.left!=null&&(this.left=h.z.number(t.left,n.left,a)),n.right!=null&&t.right!=null&&(this.right=h.z.number(t.right,n.right,a)),this}getCenter(t,n){const a=h.ac((this.left+t-this.right)/2,0,t),l=h.ac((this.top+n-this.bottom)/2,0,n);return new h.P(a,l)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new as(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class wa{constructor(t,n,a,l,u){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=u===void 0||!!u,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=a??0,this._maxPitch=l??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new as,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new wa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-h.b0(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var a=new h.A(4);return h.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,l,u){var m=l[0],_=l[1],y=l[2],v=l[3],S=Math.sin(u),I=Math.cos(u);a[0]=m*I+y*S,a[1]=_*I+v*S,a[2]=m*-S+y*I,a[3]=_*-S+v*I}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=h.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,a){this._unmodified=!1,this._edgeInsets.interpolate(t,n,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new h.b1(0,t)];if(this._renderWorldCopies){const a=this.pointCoordinate(new h.P(0,0)),l=this.pointCoordinate(new h.P(this.width,0)),u=this.pointCoordinate(new h.P(this.width,this.height)),m=this.pointCoordinate(new h.P(0,this.height)),_=Math.floor(Math.min(a.x,l.x,u.x,m.x)),y=Math.floor(Math.max(a.x,l.x,u.x,m.x)),v=1;for(let S=_-v;S<=y+v;S++)S!==0&&n.push(new h.b1(S,t))}return n}coveringTiles(t){var n,a;let l=this.coveringZoomLevel(t);const u=l;if(t.minzoom!==void 0&&l<t.minzoom)return[];t.maxzoom!==void 0&&l>t.maxzoom&&(l=t.maxzoom);const m=this.pointCoordinate(this.getCameraPoint()),_=h.Y.fromLngLat(this.center),y=Math.pow(2,l),v=[y*m.x,y*m.y,0],S=[y*_.x,y*_.y,0],I=_n.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l);let D=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(D=l);const q=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,N=W=>({aabb:new yn([W*y,0,0],[(W+1)*y,y,0]),zoom:0,x:0,y:0,wrap:W,fullyVisible:!1}),Z=[],U=[],$=l,oe=t.reparseOverscaled?u:l;if(this._renderWorldCopies)for(let W=1;W<=3;W++)Z.push(N(-W)),Z.push(N(W));for(Z.push(N(0));Z.length>0;){const W=Z.pop(),ie=W.x,ue=W.y;let ce=W.fullyVisible;if(!ce){const Oe=W.aabb.intersects(I);if(Oe===0)continue;ce=Oe===2}const _e=t.terrain?v:S,be=W.aabb.distanceX(_e),ve=W.aabb.distanceY(_e),Se=Math.max(Math.abs(be),Math.abs(ve));if(W.zoom===$||Se>q+(1<<$-W.zoom)-2&&W.zoom>=D){const Oe=$-W.zoom,Ke=v[0]-.5-(ie<<Oe),Me=v[1]-.5-(ue<<Oe);U.push({tileID:new h.Q(W.zoom===$?oe:W.zoom,W.wrap,W.zoom,ie,ue),distanceSq:ar([S[0]-.5-ie,S[1]-.5-ue]),tileDistanceToCamera:Math.sqrt(Ke*Ke+Me*Me)})}else for(let Oe=0;Oe<4;Oe++){const Ke=(ie<<1)+Oe%2,Me=(ue<<1)+(Oe>>1),Xe=W.zoom+1;let Ue=W.aabb.quadrant(Oe);if(t.terrain){const Nt=new h.Q(Xe,W.wrap,Xe,Ke,Me),ft=t.terrain.getMinMaxElevation(Nt),lt=(n=ft.minElevation)!==null&&n!==void 0?n:this.elevation,mt=(a=ft.maxElevation)!==null&&a!==void 0?a:this.elevation;Ue=new yn([Ue.min[0],Ue.min[1],lt],[Ue.max[0],Ue.max[1],mt])}Z.push({aabb:Ue,zoom:Xe,x:Ke,y:Me,wrap:W.wrap,fullyVisible:ce})}}return U.sort((W,ie)=>W.distanceSq-ie.distanceSq).map(W=>W.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=h.ac(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new h.P(h.N(t.lng)*this.worldSize,h.O(n)*this.worldSize)}unproject(t){return new h.Y(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.pointLocation(this.centerPoint,t),a=t.getElevationForLngLatZoom(n,this.tileZoom);if(!(this.elevation-a))return;const l=this.getCameraPosition(),u=h.Y.fromLngLat(l.lngLat,l.altitude),m=h.Y.fromLngLat(n,a),_=u.x-m.x,y=u.y-m.y,v=u.z-m.z,S=Math.sqrt(_*_+y*y+v*v),I=this.scaleZoom(this.cameraToCenterDistance/S/this.tileSize);this._elevation=a,this._center=n,this.zoom=I}setLocationAtPoint(t,n){const a=this.pointCoordinate(n),l=this.pointCoordinate(this.centerPoint),u=this.locationCoordinate(t),m=new h.Y(u.x-(a.x-l.x),u.y-(a.y-l.y));this.center=this.coordinateLocation(m),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),n.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return h.Y.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const D=n.pointCoordinate(t);if(D!=null)return D}const a=[t.x,t.y,0,1],l=[t.x,t.y,1,1];h.af(a,a,this.pixelMatrixInverse),h.af(l,l,this.pixelMatrixInverse);const u=a[3],m=l[3],_=a[1]/u,y=l[1]/m,v=a[2]/u,S=l[2]/m,I=v===S?0:(0-v)/(S-v);return new h.Y(h.z.number(a[0]/u,l[0]/m,I)/this.worldSize,h.z.number(_,y,I)/this.worldSize)}coordinatePoint(t,n=0,a=this.pixelMatrix){const l=[t.x*this.worldSize,t.y*this.worldSize,n,1];return h.af(l,l,a),new h.P(l[0]/l[3],l[1]/l[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Jt().extend(this.pointLocation(new h.P(0,t))).extend(this.pointLocation(new h.P(this.width,t))).extend(this.pointLocation(new h.P(this.width,this.height))).extend(this.pointLocation(new h.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Jt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const a=t.key,l=n?this._alignedPosMatrixCache:this._posMatrixCache;if(l[a])return l[a];const u=t.canonical,m=this.worldSize/this.zoomScale(u.z),_=u.x+Math.pow(2,u.z)*t.wrap,y=h.an(new Float64Array(16));return h.H(y,y,[_*m,u.y*m,0]),h.J(y,y,[m/h.W,m/h.W,1]),h.K(y,n?this.alignedProjMatrix:this.projMatrix,y),l[a]=new Float32Array(y),l[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;let t=this.lngRange;if(!this._renderWorldCopies&&t===null){const N=179.9999999999;t=[-N,N]}this._constraining=!0;let n,a,l,u,m=-90,_=90,y=-180,v=180;const S=this.size,I=this._unmodified;if(this.latRange){const N=this.latRange;m=h.O(N[1])*this.worldSize,_=h.O(N[0])*this.worldSize,n=_-m<S.y?S.y/(_-m):0}t&&(y=h.b0(h.N(t[0])*this.worldSize,0,this.worldSize),v=h.b0(h.N(t[1])*this.worldSize,0,this.worldSize),v<y&&(v+=this.worldSize),a=v-y<S.x?S.x/(v-y):0);const D=this.point,q=Math.max(a||0,n||0);if(q)return this.center=this.unproject(new h.P(a?(v+y)/2:D.x,n?(_+m)/2:D.y)),this.zoom+=this.scaleZoom(q),this._unmodified=I,void(this._constraining=!1);if(this.latRange){const N=D.y,Z=S.y/2;N-Z<m&&(u=m+Z),N+Z>_&&(u=_-Z)}if(t){const N=(y+v)/2;let Z=D.x;this._renderWorldCopies&&(Z=h.b0(D.x,N-this.worldSize/2,N+this.worldSize/2));const U=S.x/2;Z-U<y&&(l=y+U),Z+U>v&&(l=v-U)}l===void 0&&u===void 0||(this.center=this.unproject(new h.P(l!==void 0?l:D.x,u!==void 0?u:D.y)).wrap()),this._unmodified=I,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=h.b2(1,this.center.lat)*this.worldSize;let l=h.an(new Float64Array(16));h.J(l,l,[this.width/2,-this.height/2,1]),h.H(l,l,[1,-1,0]),this.labelPlaneMatrix=l,l=h.an(new Float64Array(16)),h.J(l,l,[1,-1,1]),h.H(l,l,[-1,-1,0]),h.J(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l;const u=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),m=Math.min(this.elevation,this.minElevationForCurrentTile),_=u-m*this._pixelPerMeter/Math.cos(this._pitch),y=m<0?_:u,v=Math.PI/2+this._pitch,S=this._fov*(.5+t.y/this.height),I=Math.sin(S)*y/Math.sin(h.ac(Math.PI-v-S,.01,Math.PI-.01)),D=this.getHorizon(),q=2*Math.atan(D/this.cameraToCenterDistance)*(.5+t.y/(2*D)),N=Math.sin(q)*y/Math.sin(h.ac(Math.PI-v-q,.01,Math.PI-.01)),Z=Math.min(I,N),U=1.01*(Math.cos(Math.PI/2-this._pitch)*Z+y),$=this.height/50;l=new Float64Array(16),h.b3(l,this._fov,this.width/this.height,$,U),l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,h.J(l,l,[1,-1,1]),h.H(l,l,[0,0,-this.cameraToCenterDistance]),h.b4(l,l,this._pitch),h.ad(l,l,this.angle),h.H(l,l,[-n,-a,0]),this.mercatorMatrix=h.J([],l,[this.worldSize,this.worldSize,this.worldSize]),h.J(l,l,[1,1,this._pixelPerMeter]),this.pixelMatrix=h.K(new Float64Array(16),this.labelPlaneMatrix,l),h.H(l,l,[0,0,-this.elevation]),this.projMatrix=l,this.invProjMatrix=h.ar([],l),this.pixelMatrix3D=h.K(new Float64Array(16),this.labelPlaneMatrix,l);const oe=this.width%2/2,W=this.height%2/2,ie=Math.cos(this.angle),ue=Math.sin(this.angle),ce=n-Math.round(n)+ie*oe+ue*W,_e=a-Math.round(a)+ie*W+ue*oe,be=new Float64Array(l);if(h.H(be,be,[ce>.5?ce-1:ce,_e>.5?_e-1:_e,0]),this.alignedProjMatrix=be,l=h.ar(new Float64Array(16),this.pixelMatrix),!l)throw new Error("failed to invert matrix");this.pixelMatrixInverse=l,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new h.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return h.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let a=n.x,l=n.y,u=n.x,m=n.y;for(const _ of t)a=Math.min(a,_.x),l=Math.min(l,_.y),u=Math.max(u,_.x),m=Math.max(m,_.y);return[new h.P(a,l),new h.P(u,l),new h.P(u,m),new h.P(a,m),new h.P(a,l)]}}lngLatToCameraDepth(t,n){const a=this.locationCoordinate(t),l=[a.x*this.worldSize,a.y*this.worldSize,n,1];return h.af(l,l,this.projMatrix),l[2]/l[3]}}function fo(c,t){let n,a=!1,l=null,u=null;const m=()=>{l=null,a&&(c.apply(u,n),l=setTimeout(m,t),a=!1)};return(..._)=>(a=!0,u=this,n=_,l||m(),l)}class mo{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(l=>l.split("=")).forEach(l=>{l[0]===this._hashName&&(a=l)}),(a&&a[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:a,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}},this._updateHash=fo(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,l=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,l),m=Math.round(n.lng*u)/u,_=Math.round(n.lat*u)/u,y=this._map.getBearing(),v=this._map.getPitch();let S="";if(S+=t?`/${m}/${_}/${a}`:`${a}/${_}/${m}`,(y||v)&&(S+="/"+Math.round(10*y)/10),v&&(S+=`/${Math.round(v)}`),this._hashName){const I=this._hashName;let D=!1;const q=window.location.hash.slice(1).split("&").map(N=>{const Z=N.split("=")[0];return Z===I?(D=!0,`${Z}=${S}`):N}).filter(N=>N);return D||q.push(`${I}=${S}`),`#${q.join("&")}`}return`#${S}`}}const zs={linearity:.3,easing:h.b5(0,0,.3,1)},Al=h.e({deceleration:2500,maxSpeed:1400},zs),Bn=h.e({deceleration:20,maxSpeed:1400},zs),kl=h.e({deceleration:1e3,maxSpeed:360},zs),El=h.e({deceleration:1e3,maxSpeed:90},zs);class Ml{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:re.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=re.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:u}of this._inertiaBuffer)n.zoom+=u.zoomDelta||0,n.bearing+=u.bearingDelta||0,n.pitch+=u.pitchDelta||0,u.panDelta&&n.pan._add(u.panDelta),u.around&&(n.around=u.around),u.pinchAround&&(n.pinchAround=u.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,l={};if(n.pan.mag()){const u=Ls(n.pan.mag(),a,h.e({},Al,t||{}));l.offset=n.pan.mult(u.amount/n.pan.mag()),l.center=this._map.transform.center,Ds(l,u)}if(n.zoom){const u=Ls(n.zoom,a,Bn);l.zoom=this._map.transform.zoom+u.amount,Ds(l,u)}if(n.bearing){const u=Ls(n.bearing,a,kl);l.bearing=this._map.transform.bearing+h.ac(u.amount,-179,179),Ds(l,u)}if(n.pitch){const u=Ls(n.pitch,a,El);l.pitch=this._map.transform.pitch+u.amount,Ds(l,u)}if(l.zoom||l.bearing){const u=n.pinchAround===void 0?n.around:n.pinchAround;l.around=u?this._map.unproject(u):this._map.getCenter()}return this.clear(),h.e(l,{noMoveStart:!0})}}function Ds(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function Ls(c,t,n){const{maxSpeed:a,linearity:l,deceleration:u}=n,m=h.ac(c*l/(t/1e3),-a,a),_=Math.abs(m)/(u*l);return{easing:n.easing,duration:1e3*_,amount:m*(_/2)}}class ur extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a,l={}){const u=K.mousePos(n.getCanvas(),a),m=n.unproject(u);super(t,h.e({point:u,lngLat:m,originalEvent:a},l)),this._defaultPrevented=!1,this.target=n}}class os extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a){const l=t==="touchend"?a.changedTouches:a.touches,u=K.touchPos(n.getCanvasContainer(),l),m=u.map(y=>n.unproject(y)),_=u.reduce((y,v,S,I)=>y.add(v.div(I.length)),new h.P(0,0));super(t,{points:u,point:_,lngLats:m,lngLat:n.unproject(_),originalEvent:a}),this._defaultPrevented=!1}}class Fn extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a){super(t,{originalEvent:a}),this._defaultPrevented=!1}}class Pl{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Fn(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new ur(t.type,this._map,t))}mouseup(t){this._map.fire(new ur(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new ur(t.type,this._map,t))}dblclick(t){return this._firePreventable(new ur(t.type,this._map,t))}mouseover(t){this._map.fire(new ur(t.type,this._map,t))}mouseout(t){this._map.fire(new ur(t.type,this._map,t))}touchstart(t){return this._firePreventable(new os(t.type,this._map,t))}touchmove(t){this._map.fire(new os(t.type,this._map,t))}touchend(t){this._map.fire(new os(t.type,this._map,t))}touchcancel(t){this._map.fire(new os(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new ur(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ur("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new ur(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dr{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(h.P.convert(t),this._map.terrain)}}class go{constructor(t,n){this._map=t,this._tr=new dr(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(K.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const a=n;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const l=this._startPos;this._lastPos=a,this._box||(this._box=K.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const u=Math.min(l.x,a.x),m=Math.max(l.x,a.x),_=Math.min(l.y,a.y),y=Math.max(l.y,a.y);K.setTransform(this._box,`translate(${u}px,${_}px)`),this._box.style.width=m-u+"px",this._box.style.height=y-_+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const a=this._startPos,l=n;if(this.reset(),K.suppressClick(),a.x!==l.x||a.y!==l.y)return this._map.fire(new h.k("boxzoomend",{originalEvent:t})),{cameraAnimation:u=>u.fitScreenCoordinates(a,l,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(K.remove(this._box),this._box=null),K.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new h.k(t,{originalEvent:n}))}}function Rr(c,t){if(c.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${c.length}, points ${t.length}`);const n={};for(let a=0;a<c.length;a++)n[c[a].identifier]=t[a];return n}class Rs{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),a.length===this.numTouches&&(this.centroid=function(l){const u=new h.P(0,0);for(const m of l)u._add(m);return u.div(l.length)}(n),this.touches=Rr(a,n)))}touchmove(t,n,a){if(this.aborted||!this.centroid)return;const l=Rr(a,n);for(const u in this.touches){const m=l[u];(!m||m.dist(this.touches[u])>30)&&(this.aborted=!0)}}touchend(t,n,a){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const l=!this.aborted&&this.centroid;if(this.reset(),l)return l}}}class _o{constructor(t){this.singleTap=new Rs(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,a){this.singleTap.touchstart(t,n,a)}touchmove(t,n,a){this.singleTap.touchmove(t,n,a)}touchend(t,n,a){const l=this.singleTap.touchend(t,n,a);if(l){const u=t.timeStamp-this.lastTime<500,m=!this.lastTap||this.lastTap.dist(l)<30;if(u&&m||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=l,this.count===this.numTaps)return this.reset(),l}}}class Pc{constructor(t){this._tr=new dr(t),this._zoomIn=new _o({numTouches:1,numTaps:2}),this._zoomOut=new _o({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,a){this._zoomIn.touchstart(t,n,a),this._zoomOut.touchstart(t,n,a)}touchmove(t,n,a){this._zoomIn.touchmove(t,n,a),this._zoomOut.touchmove(t,n,a)}touchend(t,n,a){const l=this._zoomIn.touchend(t,n,a),u=this._zoomOut.touchend(t,n,a),m=this._tr;return l?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:m.zoom+1,around:m.unproject(l)},{originalEvent:t})}):u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:m.zoom-1,around:m.unproject(u)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bs{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const l=n.length?n[0]:n;return!this._moved&&l.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=l,this._move(a,l))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&K.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const zl={0:1,2:2};class On{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=K.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(n,a){const l=zl[a];return n.buttons===void 0||(n.buttons&l)!==l}(t,this._eventButton)}isValidEndEvent(t){return K.mouseButton(t)===this._eventButton}}class on{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Fe=c=>{c.mousedown=c.dragStart,c.mousemoveWindow=c.dragMove,c.mouseup=c.dragEnd,c.contextmenu=function(t){t.preventDefault()}},yo=({enable:c,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>{const a=new On({checkCorrectEvent:l=>K.mouseButton(l)===0&&l.ctrlKey||K.mouseButton(l)===2});return new Bs({clickTolerance:t,move:(l,u)=>({bearingDelta:(u.x-l.x)*n}),moveStateManager:a,enable:c,assignEvents:Fe})},ls=({enable:c,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>{const a=new On({checkCorrectEvent:l=>K.mouseButton(l)===0&&l.ctrlKey||K.mouseButton(l)===2});return new Bs({clickTolerance:t,move:(l,u)=>({pitchDelta:(u.y-l.y)*n}),moveStateManager:a,enable:c,assignEvents:Fe})};class Fs{constructor(t,n){this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,n,a){return this._calculateTransform(t,n,a)}touchmove(t,n,a){if(this._active&&!(a.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,n,a)}touchend(t,n,a){this._calculateTransform(t,n,a),this._active&&a.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,a){a.length>0&&(this._active=!0);const l=Rr(a,n),u=new h.P(0,0),m=new h.P(0,0);let _=0;for(const v in l){const S=l[v],I=this._touches[v];I&&(u._add(S),m._add(S.sub(I)),_++,l[v]=S)}if(this._touches=l,_<this.minTouchs()||!m.mag())return;const y=m.div(_);return this._sum._add(y),this._sum.mag()<this._clickTolerance?void 0:{around:u.div(_),panDelta:y}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,a){if(!this._firstTwoTouches)return;t.preventDefault();const[l,u]=this._firstTwoTouches,m=ze(a,n,l),_=ze(a,n,u);if(!m||!_)return;const y=this._aroundCenter?null:m.add(_).div(2);return this._move([m,_],y,t)}touchend(t,n,a){if(!this._firstTwoTouches)return;const[l,u]=this._firstTwoTouches,m=ze(a,n,l),_=ze(a,n,u);m&&_||(this._active&&K.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ze(c,t,n){for(let a=0;a<c.length;a++)if(c[a].identifier===n)return t[a]}function Ta(c,t){return Math.log(c/t)/Math.LN2}class Dl extends Sa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const a=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Ta(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ta(this._distance,a),pinchAround:n}}}function Ll(c,t){return 180*c.angleWith(t)/Math.PI}class Ia extends Sa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n,a){const l=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ll(this._vector,l),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,a=Ll(t,this._startVector);return Math.abs(a)<n}}function Ca(c){return Math.abs(c.y)>Math.abs(c.x)}class xo extends Sa{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,a){super.touchstart(t,n,a),this._currentTouchCount=a.length}_start(t){this._lastPoints=t,Ca(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const l=t[0].sub(this._lastPoints[0]),u=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(l,u,a.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(l.y+u.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,a){if(this._valid!==void 0)return this._valid;const l=t.mag()>=2,u=n.mag()>=2;if(!l&&!u)return;if(!l||!u)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const m=t.y>0==n.y>0;return Ca(t)&&Ca(n)&&m}}const zc={panStep:100,bearingStep:15,pitchStep:10};class Rl{constructor(t){this._tr=new dr(t);const n=zc;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,a=0,l=0,u=0,m=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),u=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),u=1);break;case 38:t.shiftKey?l=1:(t.preventDefault(),m=-1);break;case 40:t.shiftKey?l=-1:(t.preventDefault(),m=1);break;default:return}return this._rotationDisabled&&(a=0,l=0),{cameraAnimation:_=>{const y=this._tr;_.easeTo({duration:300,easeId:"keyboardHandler",easing:Vn,zoom:n?Math.round(y.zoom)+n*(t.shiftKey?2:1):y.zoom,bearing:y.bearing+a*this._bearingStep,pitch:y.pitch+l*this._pitchStep,offset:[-u*this._panStep,-m*this._panStep],center:y.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Vn(c){return c*(2-c)}const Ut=4.000244140625;class Os{constructor(t,n){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=t,this._tr=new dr(t),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const a=re.now(),l=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,n!==0&&n%Ut==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":l>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(l*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=K.mousePos(this._map.getCanvas(),t),a=this._tr;this._around=n.y>a.transform.height/2-a.transform.getHorizon()?h.M.convert(this._aroundCenter?a.center:a.unproject(n)):h.M.convert(a.center),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const _=this._type==="wheel"&&Math.abs(this._delta)>Ut?this._wheelZoomRate:this._defaultZoomRate;let y=2/(1+Math.exp(-Math.abs(this._delta*_)));this._delta<0&&y!==0&&(y=1/y);const v=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(v*y))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,a=this._startZoom,l=this._easing;let u,m=!1;if(this._type==="wheel"&&a&&l){const _=Math.min((re.now()-this._lastWheelEventTime)/200,1),y=l(_);u=h.z.number(a,n,y),_<1?this._frameId||(this._frameId=!0):m=!0}else u=n,m=!0;return this._active=!0,m&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!m,zoomDelta:u-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=h.b6;if(this._prevEase){const a=this._prevEase,l=(re.now()-a.start)/a.duration,u=a.easing(l+.01)-a.easing(l),m=.27/Math.sqrt(u*u+1e-4)*.01,_=Math.sqrt(.0729-m*m);n=h.b5(m,_,.25,1)}return this._prevEase={start:re.now(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Aa{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Bl{constructor(t){this._tr=new dr(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fl{constructor(){this._tap=new _o({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,a){if(!this._swipePoint)if(this._tapTime){const l=n[0],u=t.timeStamp-this._tapTime<500,m=this._tapPoint.dist(l)<30;u&&m?a.length>0&&(this._swipePoint=l,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(t,n,a)}touchmove(t,n,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const l=n[0],u=l.y-this._swipePoint.y;return this._swipePoint=l,t.preventDefault(),this._active=!0,{zoomDelta:u/128}}}else this._tap.touchmove(t,n,a)}touchend(t,n,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const l=this._tap.touchend(t,n,a);l&&(this._tapTime=t.timeStamp,this._tapPoint=l)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vo{constructor(t,n,a){this._el=t,this._mousePan=n,this._touchPan=a}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ol{constructor(t,n,a){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class jr{constructor(t,n,a,l){this._el=t,this._touchZoom=n,this._touchRotate=a,this._tapDragZoom=l,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Vs{constructor(t,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=K.create("div","maplibregl-cooperative-gesture-screen",t);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),l=document.createElement("div");l.className="maplibregl-desktop-message",l.textContent=n,this._container.appendChild(l);const u=document.createElement("div");u.className="maplibregl-mobile-message",u.textContent=a,this._container.appendChild(u),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(K.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(t.touches.length===1)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){this._enabled&&t&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const qe=c=>c.zoom||c.drag||c.pitch||c.rotate;class Je extends h.k{}function cs(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class bo{constructor(t,n){this.handleWindowEvent=l=>{this.handleEvent(l,`${l.type}Window`)},this.handleEvent=(l,u)=>{if(l.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const m=l.type==="renderFrame"?void 0:l,_={needsRenderFrame:!1},y={},v={},S=l.touches,I=S?this._getMapTouches(S):void 0,D=I?K.touchPos(this._map.getCanvas(),I):K.mousePos(this._map.getCanvas(),l);for(const{handlerName:Z,handler:U,allowed:$}of this._handlers){if(!U.isEnabled())continue;let oe;this._blockedByActive(v,$,Z)?U.reset():U[u||l.type]&&(oe=U[u||l.type](l,D,I),this.mergeHandlerResult(_,y,oe,Z,m),oe&&oe.needsRenderFrame&&this._triggerRenderFrame()),(oe||U.isActive())&&(v[Z]=U)}const q={};for(const Z in this._previousActiveHandlers)v[Z]||(q[Z]=m);this._previousActiveHandlers=v,(Object.keys(q).length||cs(_))&&(this._changes.push([_,y,q]),this._triggerRenderFrame()),(Object.keys(v).length||cs(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=_;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ml(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[l,u,m]of this._listeners)K.addEventListener(l,u,l===document?this.handleWindowEvent:this.handleEvent,m)}destroy(){for(const[t,n,a]of this._listeners)K.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(t){const n=this._map,a=n.getCanvasContainer();this._add("mapEvent",new Pl(n,t));const l=n.boxZoom=new go(n,t);this._add("boxZoom",l),t.interactive&&t.boxZoom&&l.enable();const u=n.cooperativeGestures=new Vs(n,t.cooperativeGestures);this._add("cooperativeGestures",u),t.cooperativeGestures&&u.enable();const m=new Pc(n),_=new Bl(n);n.doubleClickZoom=new Aa(_,m),this._add("tapZoom",m),this._add("clickZoom",_),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const y=new Fl;this._add("tapDragZoom",y);const v=n.touchPitch=new xo(n);this._add("touchPitch",v),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const S=yo(t),I=ls(t);n.dragRotate=new Ol(t,S,I),this._add("mouseRotate",S,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const D=(({enable:oe,clickTolerance:W})=>{const ie=new On({checkCorrectEvent:ue=>K.mouseButton(ue)===0&&!ue.ctrlKey});return new Bs({clickTolerance:W,move:(ue,ce)=>({around:ce,panDelta:ce.sub(ue)}),activateOnStart:!0,moveStateManager:ie,enable:oe,assignEvents:Fe})})(t),q=new Fs(t,n);n.dragPan=new vo(a,D,q),this._add("mousePan",D),this._add("touchPan",q,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const N=new Ia,Z=new Dl;n.touchZoomRotate=new jr(a,Z,N,y),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate);const U=n.scrollZoom=new Os(n,()=>this._triggerRenderFrame());this._add("scrollZoom",U,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const $=n.keyboard=new Rl(n);this._add("keyboard",$),t.interactive&&t.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Nr(n))}_add(t,n,a){this._handlers.push({handlerName:t,handler:n,allowed:a}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qe(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,a){for(const l in t)if(l!==a&&(!n||n.indexOf(l)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const a of t)this._el.contains(a.target)&&n.push(a);return n}mergeHandlerResult(t,n,a,l,u){if(!a)return;h.e(t,a);const m={handlerName:l,originalEvent:a.originalEvent||u};a.zoomDelta!==void 0&&(n.zoom=m),a.panDelta!==void 0&&(n.drag=m),a.pitchDelta!==void 0&&(n.pitch=m),a.bearingDelta!==void 0&&(n.rotate=m)}_applyChanges(){const t={},n={},a={};for(const[l,u,m]of this._changes)l.panDelta&&(t.panDelta=(t.panDelta||new h.P(0,0))._add(l.panDelta)),l.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+l.zoomDelta),l.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+l.bearingDelta),l.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+l.pitchDelta),l.around!==void 0&&(t.around=l.around),l.pinchAround!==void 0&&(t.pinchAround=l.pinchAround),l.noInertia&&(t.noInertia=l.noInertia),h.e(n,u),h.e(a,m);this._updateMapTransform(t,n,a),this._changes=[]}_updateMapTransform(t,n,a){const l=this._map,u=l._getTransformForUpdate(),m=l.terrain;if(!(cs(t)||m&&this._terrainMovement))return this._fireEvents(n,a,!0);let{panDelta:_,zoomDelta:y,bearingDelta:v,pitchDelta:S,around:I,pinchAround:D}=t;D!==void 0&&(I=D),l._stop(!0),I=I||l.transform.centerPoint;const q=u.pointLocation(_?I.sub(_):I);v&&(u.bearing+=v),S&&(u.pitch+=S),y&&(u.zoom+=y),m?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?u.center=u.pointLocation(u.centerPoint.sub(_)):u.setLocationAtPoint(q,I):(this._terrainMovement=!0,this._map._elevationFreeze=!0,u.setLocationAtPoint(q,I),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,u.recalculateZoom(l.terrain)})):u.setLocationAtPoint(q,I),l._applyUpdatedTransform(u),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,a,!0)}_fireEvents(t,n,a){const l=qe(this._eventsInProgress),u=qe(t),m={};for(const S in t){const{originalEvent:I}=t[S];this._eventsInProgress[S]||(m[`${S}start`]=I),this._eventsInProgress[S]=t[S]}!l&&u&&this._fireEvent("movestart",u.originalEvent);for(const S in m)this._fireEvent(S,m[S]);u&&this._fireEvent("move",u.originalEvent);for(const S in t){const{originalEvent:I}=t[S];this._fireEvent(S,I)}const _={};let y;for(const S in this._eventsInProgress){const{handlerName:I,originalEvent:D}=this._eventsInProgress[S];this._handlersById[I].isActive()||(delete this._eventsInProgress[S],y=n[I]||D,_[`${S}end`]=y)}for(const S in _)this._fireEvent(S,_[S]);const v=qe(this._eventsInProgress);if(a&&(l||u)&&!v){this._updatingCamera=!0;const S=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),I=D=>D!==0&&-this._bearingSnap<D&&D<this._bearingSnap;!S||!S.essential&&re.prefersReducedMotion?(this._map.fire(new h.k("moveend",{originalEvent:y})),I(this._map.getBearing())&&this._map.resetNorth()):(I(S.bearing||this._map.getBearing())&&(S.bearing=0),S.freezeElevation=!0,this._map.easeTo(S,{originalEvent:y})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new h.k(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Je("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class wo extends h.E{constructor(t,n){super(),this._renderFrameCallback=()=>{const a=Math.min((re.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new h.M(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,a){return t=h.P.convert(t).mult(-1),this.panTo(this.transform.center,h.e({offset:t},n),a)}panTo(t,n,a){return this.easeTo(h.e({center:t},n),a)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,a){return this.easeTo(h.e({zoom:t},n),a)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,a){return this.easeTo(h.e({bearing:t},n),a)}resetNorth(t,n){return this.rotateTo(0,h.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(h.e({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=Jt.convert(t);const a=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),a,n)}_cameraForBoxAndBearing(t,n,a,l){const u={top:0,bottom:0,right:0,left:0};if(typeof(l=h.e({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const Oe=l.padding;l.padding={top:Oe,bottom:Oe,right:Oe,left:Oe}}l.padding=h.e(u,l.padding);const m=this.transform,_=m.padding,y=new Jt(t,n),v=m.project(y.getNorthWest()),S=m.project(y.getNorthEast()),I=m.project(y.getSouthEast()),D=m.project(y.getSouthWest()),q=h.b7(-a),N=v.rotate(q),Z=S.rotate(q),U=I.rotate(q),$=D.rotate(q),oe=new h.P(Math.max(N.x,Z.x,$.x,U.x),Math.max(N.y,Z.y,$.y,U.y)),W=new h.P(Math.min(N.x,Z.x,$.x,U.x),Math.min(N.y,Z.y,$.y,U.y)),ie=oe.sub(W),ue=(m.width-(_.left+_.right+l.padding.left+l.padding.right))/ie.x,ce=(m.height-(_.top+_.bottom+l.padding.top+l.padding.bottom))/ie.y;if(ce<0||ue<0)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const _e=Math.min(m.scaleZoom(m.scale*Math.min(ue,ce)),l.maxZoom),be=h.P.convert(l.offset),ve=new h.P((l.padding.left-l.padding.right)/2,(l.padding.top-l.padding.bottom)/2).rotate(h.b7(a)),Se=be.add(ve).mult(m.scale/m.zoomScale(_e));return{center:m.unproject(v.add(I).div(2).sub(Se)),zoom:_e,bearing:a}}fitBounds(t,n,a){return this._fitInternal(this.cameraForBounds(t,n),n,a)}fitScreenCoordinates(t,n,a,l,u){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(h.P.convert(t)),this.transform.pointLocation(h.P.convert(n)),a,l),l,u)}_fitInternal(t,n,a){return t?(delete(n=h.e(t,n)).padding,n.linear?this.easeTo(n,a):this.flyTo(n,a)):this}jumpTo(t,n){this.stop();const a=this._getTransformForUpdate();let l=!1,u=!1,m=!1;return"zoom"in t&&a.zoom!==+t.zoom&&(l=!0,a.zoom=+t.zoom),t.center!==void 0&&(a.center=h.M.convert(t.center)),"bearing"in t&&a.bearing!==+t.bearing&&(u=!0,a.bearing=+t.bearing),"pitch"in t&&a.pitch!==+t.pitch&&(m=!0,a.pitch=+t.pitch),t.padding==null||a.isPaddingEqual(t.padding)||(a.padding=t.padding),this._applyUpdatedTransform(a),this.fire(new h.k("movestart",n)).fire(new h.k("move",n)),l&&this.fire(new h.k("zoomstart",n)).fire(new h.k("zoom",n)).fire(new h.k("zoomend",n)),u&&this.fire(new h.k("rotatestart",n)).fire(new h.k("rotate",n)).fire(new h.k("rotateend",n)),m&&this.fire(new h.k("pitchstart",n)).fire(new h.k("pitch",n)).fire(new h.k("pitchend",n)),this.fire(new h.k("moveend",n))}calculateCameraOptionsFromTo(t,n,a,l=0){const u=h.Y.fromLngLat(t,n),m=h.Y.fromLngLat(a,l),_=m.x-u.x,y=m.y-u.y,v=m.z-u.z,S=Math.hypot(_,y,v);if(S===0)throw new Error("Can't calculate camera options with same From and To");const I=Math.hypot(_,y),D=this.transform.scaleZoom(this.transform.cameraToCenterDistance/S/this.transform.tileSize),q=180*Math.atan2(_,-y)/Math.PI;let N=180*Math.acos(I/S)/Math.PI;return N=v<0?90-N:90+N,{center:m.toLngLat(),zoom:D,pitch:N,bearing:q}}easeTo(t,n){this._stop(!1,t.easeId),((t=h.e({offset:[0,0],duration:500,easing:h.b6},t)).animate===!1||!t.essential&&re.prefersReducedMotion)&&(t.duration=0);const a=this._getTransformForUpdate(),l=this.getZoom(),u=this.getBearing(),m=this.getPitch(),_=this.getPadding(),y="zoom"in t?+t.zoom:l,v="bearing"in t?this._normalizeBearing(t.bearing,u):u,S="pitch"in t?+t.pitch:m,I="padding"in t?t.padding:a.padding,D=h.P.convert(t.offset);let q=a.centerPoint.add(D);const N=a.pointLocation(q),Z=h.M.convert(t.center||N);this._normalizeCenter(Z);const U=a.project(N),$=a.project(Z).sub(U),oe=a.zoomScale(y-l);let W,ie;t.around&&(W=h.M.convert(t.around),ie=a.locationPoint(W));const ue={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||y!==l,this._rotating=this._rotating||u!==v,this._pitching=this._pitching||S!==m,this._padding=!a.isPaddingEqual(I),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,ue),this.terrain&&this._prepareElevation(Z),this._ease(ce=>{if(this._zooming&&(a.zoom=h.z.number(l,y,ce)),this._rotating&&(a.bearing=h.z.number(u,v,ce)),this._pitching&&(a.pitch=h.z.number(m,S,ce)),this._padding&&(a.interpolatePadding(_,I,ce),q=a.centerPoint.add(D)),this.terrain&&!t.freezeElevation&&this._updateElevation(ce),W)a.setLocationAtPoint(W,ie);else{const _e=a.zoomScale(a.zoom-l),be=y>l?Math.min(2,oe):Math.max(.5,oe),ve=Math.pow(be,1-ce),Se=a.unproject(U.add($.mult(ce*ve)).mult(_e));a.setLocationAtPoint(a.renderWorldCopies?Se.wrap():Se,q)}this._applyUpdatedTransform(a),this._fireMoveEvents(n)},ce=>{this.terrain&&this._finalizeElevation(),this._afterEase(n,ce)},t),this}_prepareEase(t,n,a={}){this._moving=!0,n||a.moving||this.fire(new h.k("movestart",t)),this._zooming&&!a.zooming&&this.fire(new h.k("zoomstart",t)),this._rotating&&!a.rotating&&this.fire(new h.k("rotatestart",t)),this._pitching&&!a.pitching&&this.fire(new h.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(a-(n-(a*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.elevation=h.z.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const n=t.clone(),{center:a,zoom:l,pitch:u,bearing:m,elevation:_}=this.transformCameraUpdate(n);a&&(n.center=a),l!==void 0&&(n.zoom=l),u!==void 0&&(n.pitch=u),m!==void 0&&(n.bearing=m),_!==void 0&&(n.elevation=_),this.transform.apply(n)}_fireMoveEvents(t){this.fire(new h.k("move",t)),this._zooming&&this.fire(new h.k("zoom",t)),this._rotating&&this.fire(new h.k("rotate",t)),this._pitching&&this.fire(new h.k("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const a=this._zooming,l=this._rotating,u=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new h.k("zoomend",t)),l&&this.fire(new h.k("rotateend",t)),u&&this.fire(new h.k("pitchend",t)),this.fire(new h.k("moveend",t))}flyTo(t,n){if(!t.essential&&re.prefersReducedMotion){const Ue=h.L(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ue,n)}this.stop(),t=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.b6},t);const a=this._getTransformForUpdate(),l=this.getZoom(),u=this.getBearing(),m=this.getPitch(),_=this.getPadding(),y="zoom"in t?h.ac(+t.zoom,a.minZoom,a.maxZoom):l,v="bearing"in t?this._normalizeBearing(t.bearing,u):u,S="pitch"in t?+t.pitch:m,I="padding"in t?t.padding:a.padding,D=a.zoomScale(y-l),q=h.P.convert(t.offset);let N=a.centerPoint.add(q);const Z=a.pointLocation(N),U=h.M.convert(t.center||Z);this._normalizeCenter(U);const $=a.project(Z),oe=a.project(U).sub($);let W=t.curve;const ie=Math.max(a.width,a.height),ue=ie/D,ce=oe.mag();if("minZoom"in t){const Ue=h.ac(Math.min(t.minZoom,l,y),a.minZoom,a.maxZoom),Nt=ie/a.zoomScale(Ue-l);W=Math.sqrt(Nt/ce*2)}const _e=W*W;function be(Ue){const Nt=(ue*ue-ie*ie+(Ue?-1:1)*_e*_e*ce*ce)/(2*(Ue?ue:ie)*_e*ce);return Math.log(Math.sqrt(Nt*Nt+1)-Nt)}function ve(Ue){return(Math.exp(Ue)-Math.exp(-Ue))/2}function Se(Ue){return(Math.exp(Ue)+Math.exp(-Ue))/2}const Oe=be(!1);let Ke=function(Ue){return Se(Oe)/Se(Oe+W*Ue)},Me=function(Ue){return ie*((Se(Oe)*(ve(Nt=Oe+W*Ue)/Se(Nt))-ve(Oe))/_e)/ce;var Nt},Xe=(be(!0)-Oe)/W;if(Math.abs(ce)<1e-6||!isFinite(Xe)){if(Math.abs(ie-ue)<1e-6)return this.easeTo(t,n);const Ue=ue<ie?-1:1;Xe=Math.abs(Math.log(ue/ie))/W,Me=function(){return 0},Ke=function(Nt){return Math.exp(Ue*W*Nt)}}return t.duration="duration"in t?+t.duration:1e3*Xe/("screenSpeed"in t?+t.screenSpeed/W:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=u!==v,this._pitching=S!==m,this._padding=!a.isPaddingEqual(I),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(U),this._ease(Ue=>{const Nt=Ue*Xe,ft=1/Ke(Nt);a.zoom=Ue===1?y:l+a.scaleZoom(ft),this._rotating&&(a.bearing=h.z.number(u,v,Ue)),this._pitching&&(a.pitch=h.z.number(m,S,Ue)),this._padding&&(a.interpolatePadding(_,I,Ue),N=a.centerPoint.add(q)),this.terrain&&!t.freezeElevation&&this._updateElevation(Ue);const lt=Ue===1?U:a.unproject($.add(oe.mult(Me(Nt))).mult(ft));a.setLocationAtPoint(a.renderWorldCopies?lt.wrap():lt,N),this._applyUpdatedTransform(a),this._fireMoveEvents(n)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const a=this._onEaseEnd;delete this._onEaseEnd,a.call(this,n)}if(!t){const a=this.handlers;a&&a.stop(!1)}return this}_ease(t,n,a){a.animate===!1||a.duration===0?(t(1),n()):(this._easeStart=re.now(),this._easeOptions=a,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=h.b0(t,-180,180);const a=Math.abs(t-n);return Math.abs(t-360-n)<a&&(t-=360),Math.abs(t+360-n)<a&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const a=t.lng-n.center.lng;t.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(h.M.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Qi={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class So{constructor(t=Qi){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=K.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=K.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=K.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){K.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const a=this._map._getUIString(`AttributionControl.${n}`);t.title=a,t.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(l=>typeof l!="string"?"":l)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const l=this._map.style.stylesheet;this.styleOwner=l.owner,this.styleId=l.id}const n=this._map.style.sourceCaches;for(const l in n){const u=n[l];if(u.used||u.usedForTerrain){const m=u.getSource();m.attribution&&t.indexOf(m.attribution)<0&&t.push(m.attribution)}}t=t.filter(l=>String(l).trim()),t.sort((l,u)=>l.length-u.length),t=t.filter((l,u)=>{for(let m=u+1;m<t.length;m++)if(t[m].indexOf(l)>=0)return!1;return!0});const a=t.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class qr{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=K.create("div","maplibregl-ctrl");const n=K.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){K.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Dc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,a=n?this._queue.concat(n):this._queue;for(const l of a)if(l.id===t)return void(l.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const a of n)if(!a.cancelled&&(a.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Us=h.X([{name:"a_pos3d",type:"Int16",components:3}]);class ei extends h.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];const a={};for(const l of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))a[l.key]=!0,this._renderableTilesKeys.push(l.key),this._tiles[l.key]||(l.posMatrix=new Float64Array(16),h.aN(l.posMatrix,0,h.W,0,h.W,0,1),this._tiles[l.key]=new Jr(l,this.tileSize));for(const l in this._tiles)a[l]||delete this._tiles[l]}freeRtt(t){for(const n in this._tiles){const a=this._tiles[n];(!t||a.tileID.equals(t)||a.tileID.isChildOf(t)||t.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const a of this._renderableTilesKeys){const l=this._tiles[a].tileID;if(l.canonical.equals(t.canonical)){const u=t.clone();u.posMatrix=new Float64Array(16),h.aN(u.posMatrix,0,h.W,0,h.W,0,1),n[a]=u}else if(l.canonical.isChildOf(t.canonical)){const u=t.clone();u.posMatrix=new Float64Array(16);const m=l.canonical.z-t.canonical.z,_=l.canonical.x-(l.canonical.x>>m<<m),y=l.canonical.y-(l.canonical.y>>m<<m),v=h.W>>m;h.aN(u.posMatrix,0,v,0,v,0,1),h.H(u.posMatrix,u.posMatrix,[-_*v,-y*v,0]),n[a]=u}else if(t.canonical.isChildOf(l.canonical)){const u=t.clone();u.posMatrix=new Float64Array(16);const m=t.canonical.z-l.canonical.z,_=t.canonical.x-(t.canonical.x>>m<<m),y=t.canonical.y-(t.canonical.y>>m<<m),v=h.W>>m;h.aN(u.posMatrix,0,h.W,0,h.W,0,1),h.H(u.posMatrix,u.posMatrix,[_*v,y*v,0]),h.J(u.posMatrix,u.posMatrix,[1/2**m,1/2**m,0]),n[a]=u}}return n}getSourceTile(t,n){const a=this.sourceCache._source;let l=t.overscaledZ-this.deltaZoom;if(l>a.maxzoom&&(l=a.maxzoom),l<a.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(l).key);let u=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!u||!u.dem)&&n)for(;l>=a.minzoom&&(!u||!u.dem);)u=this.sourceCache.getTileByID(t.scaledTo(l--).key);return u}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=t)}}class oi{constructor(t,n,a){this.painter=t,this.sourceCache=new ei(n),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,a,l=h.W){var u;if(!(n>=0&&n<l&&a>=0&&a<l))return 0;const m=this.getTerrainData(t),_=(u=m.tile)===null||u===void 0?void 0:u.dem;if(!_)return 0;const y=function(N,Z,U){var $=Z[0],oe=Z[1];return N[0]=U[0]*$+U[4]*oe+U[12],N[1]=U[1]*$+U[5]*oe+U[13],N}([],[n/l*h.W,a/l*h.W],m.u_terrain_matrix),v=[y[0]*_.dim,y[1]*_.dim],S=Math.floor(v[0]),I=Math.floor(v[1]),D=v[0]-S,q=v[1]-I;return _.get(S,I)*(1-D)*(1-q)+_.get(S+1,I)*D*(1-q)+_.get(S,I+1)*(1-D)*q+_.get(S+1,I+1)*D*q}getElevationForLngLatZoom(t,n){const{tileID:a,mercatorX:l,mercatorY:u}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(a,l%h.W,u%h.W,h.W)}getElevation(t,n,a,l=h.W){return this.getDEMElevation(t,n,a,l)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const l=this.painter.context,u=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ct(l,u,l.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ct(l,new h.R({width:1,height:1}),l.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.an([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const l=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new Ct(l,n.dem.getPixels(),l.gl.RGBA,{premultiply:!1}),n.demTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const a=n&&n+n.tileID.key+t.key;if(a&&!this._demMatrixCache[a]){const l=this.sourceCache.sourceCache._source.maxzoom;let u=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=l?u=t.canonical.z-l:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const m=t.canonical.x-(t.canonical.x>>u<<u),_=t.canonical.y-(t.canonical.y>>u<<u),y=h.b8(new Float64Array(16),[1/(h.W<<u),1/(h.W<<u),0]);h.H(y,y,[m*h.W,_*h.W,0]),this._demMatrixCache[t.key]={matrix:y,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,a=n.width/devicePixelRatio,l=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===l||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ct(n.context,{width:a,height:l,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ct(n.context,{width:a,height:l,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(a,l,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,a,l))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let u=0,m=0;u<this._coordsTextureSize;u++)for(let _=0;_<this._coordsTextureSize;_++,m+=4)n[m+0]=255&_,n[m+1]=255&u,n[m+2]=_>>8<<4|u>>8,n[m+3]=0;const a=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),l=new Ct(t,a,t.gl.RGBA,{premultiply:!1});return l.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=l,l}pointCoordinate(t){const n=new Uint8Array(4),a=this.painter.context,l=a.gl;a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),l.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,l.RGBA,l.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null);const u=n[0]+(n[2]>>4<<8),m=n[1]+((15&n[2])<<8),_=this.coordsIndex[255-n[3]],y=_&&this.sourceCache.getTileByID(_);if(!y)return null;const v=this._coordsTextureSize,S=(1<<y.tileID.canonical.z)*v;return new h.Y((y.tileID.canonical.x*v+u)/S+y.tileID.wrap,(y.tileID.canonical.y*v+m)/S,this.getElevation(y.tileID,u,m,v))}depthAtPoint(t){const n=new Uint8Array(4),a=this.painter.context,l=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),l.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,l.RGBA,l.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,n=new h.b9,a=new h.aX,l=this.meshSize,u=h.W/l,m=l*l;for(let I=0;I<=l;I++)for(let D=0;D<=l;D++)n.emplaceBack(D*u,I*u,0);for(let I=0;I<m;I+=l+1)for(let D=0;D<l;D++)a.emplaceBack(D+I,l+D+I+1,l+D+I+2),a.emplaceBack(D+I,l+D+I+2,D+I+1);const _=n.length,y=_+2*(l+1);for(const I of[0,1])for(let D=0;D<=l;D++)for(const q of[0,1])n.emplaceBack(D*u,I*h.W,q);for(let I=0;I<2*l;I+=2)a.emplaceBack(y+I,y+I+1,y+I+3),a.emplaceBack(y+I,y+I+3,y+I+2),a.emplaceBack(_+I,_+I+3,_+I+1),a.emplaceBack(_+I,_+I+2,_+I+3);const v=n.length,S=v+2*(l+1);for(const I of[0,1])for(let D=0;D<=l;D++)for(const q of[0,1])n.emplaceBack(I*h.W,D*u,q);for(let I=0;I<2*l;I+=2)a.emplaceBack(v+I,v+I+1,v+I+3),a.emplaceBack(v+I,v+I+3,v+I+2),a.emplaceBack(S+I,S+I+3,S+I+1),a.emplaceBack(S+I,S+I+2,S+I+3);return this._mesh={indexBuffer:t.createIndexBuffer(a),vertexBuffer:t.createVertexBuffer(n,Us.members),segments:h.$.simpleSegment(0,0,n.length,a.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*h.ba/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,n){var a;const{tileID:l}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(a=this.getMinMaxElevation(l).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,a={minElevation:null,maxElevation:null};return n&&n.dem&&(a.minElevation=n.dem.min*this.exaggeration,a.maxElevation=n.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(t,n){const a=h.Y.fromLngLat(t.wrap()),l=(1<<n)*h.W,u=a.x*l,m=a.y*l,_=Math.floor(u/h.W),y=Math.floor(m/h.W);return{tileID:new h.Q(n,0,n,_,y),mercatorX:u,mercatorY:m}}}class Vl{constructor(t,n,a){this._context=t,this._size=n,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new Ct(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(a.texture),{id:t,fbo:n,texture:a,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>t.id!==n),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const tn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ka{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new Vl(t.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(a=>!t._layers[a].isHidden(n)),this._coordsDescendingInv={};for(const a in t.sourceCaches){this._coordsDescendingInv[a]={};const l=t.sourceCaches[a].getVisibleCoordinates();for(const u of l){const m=this.terrain.sourceCache.getTerrainCoords(u);for(const _ in m)this._coordsDescendingInv[a][_]||(this._coordsDescendingInv[a][_]=[]),this._coordsDescendingInv[a][_].push(m[_])}}this._coordsDescendingInvStr={};for(const a of t._order){const l=t._layers[a],u=l.source;if(tn[l.type]&&!this._coordsDescendingInvStr[u]){this._coordsDescendingInvStr[u]={};for(const m in this._coordsDescendingInv[u])this._coordsDescendingInvStr[u][m]=this._coordsDescendingInv[u][m].map(_=>_.key).sort().join()}}for(const a of this._renderableTiles)for(const l in this._coordsDescendingInvStr){const u=this._coordsDescendingInvStr[l][a.tileID.key];u&&u!==a.rttCoords[l]&&(a.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const n=t.type,a=this.painter,l=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(tn[n]&&(this._prevType&&tn[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(t.id),!l))return!0;if(tn[this._prevType]||tn[n]&&l){this._prevType=n;const u=this._stacks.length-1,m=this._stacks[u]||[];for(const _ of this._renderableTiles){if(this.pool.isFull()&&(ba(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(_),_.rtt[u]){const v=this.pool.getObjectForId(_.rtt[u].id);if(v.stamp===_.rtt[u].stamp){this.pool.useObject(v);continue}}const y=this.pool.getOrCreateFreeObject();this.pool.useObject(y),this.pool.stampObject(y),_.rtt[u]={id:y.id,stamp:y.stamp},a.context.bindFramebuffer.set(y.fbo.framebuffer),a.context.clear({color:h.aO.transparent,stencil:0}),a.currentStencilSource=void 0;for(let v=0;v<m.length;v++){const S=a.style._layers[m[v]],I=S.source?this._coordsDescendingInv[S.source][_.tileID.key]:[_.tileID];a.context.viewport.set([0,0,y.fbo.width,y.fbo.height]),a._renderTileClippingMasks(S,I),a.renderLayer(a,a.style.sourceCaches[S.source],S,I),S.source&&(_.rttCoords[S.source]=this._coordsDescendingInvStr[S.source][_.tileID.key])}}return ba(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),tn[n]}return!1}}const To={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Io=le,Co={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Qi,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},hs=c=>{c.touchstart=c.dragStart,c.touchmoveWindow=c.dragMove,c.touchend=c.dragEnd},Ao={showCompass:!0,showZoom:!0,visualizePitch:!1};class ko{constructor(t,n,a=!1){this.mousedown=m=>{this.startMouse(h.e({},m,{ctrlKey:!0,preventDefault:()=>m.preventDefault()}),K.mousePos(this.element,m)),K.addEventListener(window,"mousemove",this.mousemove),K.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=m=>{this.moveMouse(m,K.mousePos(this.element,m))},this.mouseup=m=>{this.mouseRotate.dragEnd(m),this.mousePitch&&this.mousePitch.dragEnd(m),this.offTemp()},this.touchstart=m=>{m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=K.touchPos(this.element,m.targetTouches)[0],this.startTouch(m,this._startPos),K.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.addEventListener(window,"touchend",this.touchend))},this.touchmove=m=>{m.targetTouches.length!==1?this.reset():(this._lastPos=K.touchPos(this.element,m.targetTouches)[0],this.moveTouch(m,this._lastPos))},this.touchend=m=>{m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const l=t.dragRotate._mouseRotate.getClickTolerance(),u=t.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=yo({clickTolerance:l,enable:!0}),this.touchRotate=(({enable:m,clickTolerance:_,bearingDegreesPerPixelMoved:y=.8})=>{const v=new on;return new Bs({clickTolerance:_,move:(S,I)=>({bearingDelta:(I.x-S.x)*y}),moveStateManager:v,enable:m,assignEvents:hs})})({clickTolerance:l,enable:!0}),this.map=t,a&&(this.mousePitch=ls({clickTolerance:u,enable:!0}),this.touchPitch=(({enable:m,clickTolerance:_,pitchDegreesPerPixelMoved:y=-.5})=>{const v=new on;return new Bs({clickTolerance:_,move:(S,I)=>({pitchDelta:(I.y-S.y)*y}),moveStateManager:v,enable:m,assignEvents:hs})})({clickTolerance:u,enable:!0})),K.addEventListener(n,"mousedown",this.mousedown),K.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),K.addEventListener(n,"touchcancel",this.reset)}startMouse(t,n){this.mouseRotate.dragStart(t,n),this.mousePitch&&this.mousePitch.dragStart(t,n),K.disableDrag()}startTouch(t,n){this.touchRotate.dragStart(t,n),this.touchPitch&&this.touchPitch.dragStart(t,n),K.disableDrag()}moveMouse(t,n){const a=this.map,{bearingDelta:l}=this.mouseRotate.dragMove(t,n)||{};if(l&&a.setBearing(a.getBearing()+l),this.mousePitch){const{pitchDelta:u}=this.mousePitch.dragMove(t,n)||{};u&&a.setPitch(a.getPitch()+u)}}moveTouch(t,n){const a=this.map,{bearingDelta:l}=this.touchRotate.dragMove(t,n)||{};if(l&&a.setBearing(a.getBearing()+l),this.touchPitch){const{pitchDelta:u}=this.touchPitch.dragMove(t,n)||{};u&&a.setPitch(a.getPitch()+u)}}off(){const t=this.element;K.removeEventListener(t,"mousedown",this.mousedown),K.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),K.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.removeEventListener(window,"touchend",this.touchend),K.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){K.enableDrag(),K.removeEventListener(window,"mousemove",this.mousemove),K.removeEventListener(window,"mouseup",this.mouseup),K.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.removeEventListener(window,"touchend",this.touchend)}}let ln;function Ea(c,t,n){const a=new h.M(c.lng,c.lat);if(c=new h.M(c.lng,c.lat),t){const l=new h.M(c.lng-360,c.lat),u=new h.M(c.lng+360,c.lat),m=n.locationPoint(c).distSqr(t);n.locationPoint(l).distSqr(t)<m?c=l:n.locationPoint(u).distSqr(t)<m&&(c=u)}for(;Math.abs(c.lng-n.center.lng)>180;){const l=n.locationPoint(c);if(l.x>=0&&l.y>=0&&l.x<=n.width&&l.y<=n.height)break;c.lng>n.center.lng?c.lng-=360:c.lng+=360}return c.lng!==a.lng&&n.locationPoint(c).y>n.height/2-n.getHorizon()?c:a}const Ns={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ma(c,t,n){const a=c.classList;for(const l in Ns)a.remove(`maplibregl-${n}-anchor-${l}`);a.add(`maplibregl-${n}-anchor-${t}`)}class js extends h.E{constructor(t){if(super(),this._onKeyPress=n=>{const a=n.code,l=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&l!==32&&l!==13||this.togglePopup()},this._onMapClick=n=>{const a=n.originalEvent.target,l=this._element;this._popup&&(a===l||l.contains(a))&&this.togglePopup()},this._update=n=>{var a;if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((n==null?void 0:n.type)==="terrain"||(n==null?void 0:n.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ea(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let u="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?u=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?m="rotateX(0deg)":this._pitchAlignment==="map"&&(m=`rotateX(${this._map.getPitch()}deg)`),n&&n.type!=="moveend"||(this._pos=this._pos.round()),K.setTransform(this._element,`${Ns[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${u}`),re.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.k("dragstart"))),this.fire(new h.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=h.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=K.create("div"),this._element.setAttribute("aria-label","Map marker");const n=K.createNS("http://www.w3.org/2000/svg","svg"),a=41,l=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${a}px`),n.setAttributeNS(null,"width",`${l}px`),n.setAttributeNS(null,"viewBox",`0 0 ${l} ${a}`);const u=K.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"stroke","none"),u.setAttributeNS(null,"stroke-width","1"),u.setAttributeNS(null,"fill","none"),u.setAttributeNS(null,"fill-rule","evenodd");const m=K.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"fill-rule","nonzero");const _=K.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(3.0, 29.0)"),_.setAttributeNS(null,"fill","#000000");const y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const $ of y){const oe=K.createNS("http://www.w3.org/2000/svg","ellipse");oe.setAttributeNS(null,"opacity","0.04"),oe.setAttributeNS(null,"cx","10.5"),oe.setAttributeNS(null,"cy","5.80029008"),oe.setAttributeNS(null,"rx",$.rx),oe.setAttributeNS(null,"ry",$.ry),_.appendChild(oe)}const v=K.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill",this._color);const S=K.createNS("http://www.w3.org/2000/svg","path");S.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),v.appendChild(S);const I=K.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"opacity","0.25"),I.setAttributeNS(null,"fill","#000000");const D=K.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),I.appendChild(D);const q=K.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");const N=K.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Z=K.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#000000"),Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962");const U=K.createNS("http://www.w3.org/2000/svg","circle");U.setAttributeNS(null,"fill","#FFFFFF"),U.setAttributeNS(null,"cx","5.5"),U.setAttributeNS(null,"cy","5.5"),U.setAttributeNS(null,"r","5.4999962"),N.appendChild(Z),N.appendChild(U),m.appendChild(_),m.appendChild(v),m.appendChild(I),m.appendChild(q),m.appendChild(N),n.appendChild(m),n.setAttributeNS(null,"height",a*this._scale+"px"),n.setAttributeNS(null,"width",l*this._scale+"px"),this._element.appendChild(n),this._offset=h.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),Ma(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),K.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=h.M.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const l=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[l,-1*(38.1-13.5+l)],"bottom-right":[-l,-1*(38.1-13.5+l)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var n;if(!(!((n=this._map)===null||n===void 0)&&n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const a=this._map,l=a.terrain.depthAtPoint(this._pos),u=a.terrain.getElevationForLngLatZoom(this._lngLat,a.transform.tileZoom);if(a.transform.lngLatToCameraDepth(this._lngLat,u)-l<.006)return void(this._element.style.opacity=this._opacity);const m=-this._offset.y/a.transform._pixelPerMeter,_=Math.sin(a.getPitch()*Math.PI/180)*m,y=a.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),v=a.transform.lngLatToCameraDepth(this._lngLat,u+_);this._element.style.opacity=v-y>.006?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=h.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,n){return t===void 0&&n===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const Eo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Un=0,Nn=!1;const Mo={maxWidth:100,unit:"metric"};function qs(c,t,n){const a=n&&n.maxWidth||100,l=c._container.clientHeight/2,u=c.unproject([0,l]),m=c.unproject([a,l]),_=u.distanceTo(m);if(n&&n.unit==="imperial"){const y=3.2808*_;y>5280?jn(t,a,y/5280,c._getUIString("ScaleControl.Miles")):jn(t,a,y,c._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?jn(t,a,_/1852,c._getUIString("ScaleControl.NauticalMiles")):_>=1e3?jn(t,a,_/1e3,c._getUIString("ScaleControl.Kilometers")):jn(t,a,_,c._getUIString("ScaleControl.Meters"))}function jn(c,t,n,a){const l=function(u){const m=Math.pow(10,`${Math.floor(u)}`.length-1);let _=u/m;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:_>=1?1:function(y){const v=Math.pow(10,Math.ceil(-Math.log(y)/Math.LN10));return Math.round(y*v)/v}(_),m*_}(n);c.style.width=t*(l/n)+"px",c.innerHTML=`${l}&nbsp;${a}`}const Po={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},zo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Pa(c){if(c){if(typeof c=="number"){const t=Math.round(Math.abs(c)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,c),"top-left":new h.P(t,t),"top-right":new h.P(-t,t),bottom:new h.P(0,-c),"bottom-left":new h.P(t,-t),"bottom-right":new h.P(-t,-t),left:new h.P(c,0),right:new h.P(-c,0)}}if(c instanceof h.P||Array.isArray(c)){const t=h.P.convert(c);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:h.P.convert(c.center||[0,0]),top:h.P.convert(c.top||[0,0]),"top-left":h.P.convert(c["top-left"]||[0,0]),"top-right":h.P.convert(c["top-right"]||[0,0]),bottom:h.P.convert(c.bottom||[0,0]),"bottom-left":h.P.convert(c["bottom-left"]||[0,0]),"bottom-right":h.P.convert(c["bottom-right"]||[0,0]),left:h.P.convert(c.left||[0,0]),right:h.P.convert(c.right||[0,0])}}return Pa(new h.P(0,0))}const Do=le;b.AJAXError=h.bd,b.Evented=h.E,b.LngLat=h.M,b.MercatorCoordinate=h.Y,b.Point=h.P,b.addProtocol=h.be,b.config=h.a,b.removeProtocol=h.bf,b.AttributionControl=So,b.BoxZoomHandler=go,b.CanvasSource=$n,b.CooperativeGesturesHandler=Vs,b.DoubleClickZoomHandler=Aa,b.DragPanHandler=vo,b.DragRotateHandler=Ol,b.EdgeInsets=as,b.FullscreenControl=class extends h.E{constructor(c={}){super(),this._onFullscreenChange=()=>{var t;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=n==null?void 0:n.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){K.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const c=this._fullscreenButton=K.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);K.create("span","maplibregl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},b.GeoJSONSource=xt,b.GeolocateControl=class extends h.E{constructor(c){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new h.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new h.M(t.coords.longitude,t.coords.latitude),a=t.coords.accuracy,l=this._map.getBearing(),u=h.e({bearing:l},this.options.fitBoundsOptions),m=Jt.fromLngLat(n,a);this._map.fitBounds(m,u,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new h.M(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Nn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=K.create("button","maplibregl-ctrl-geolocate",this._container),K.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new js({element:this._dotElement}),this._circleElement=K.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new js({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.k("trackuserlocationend")))})}},this.options=h.e({},Eo,c)}onAdd(c){return this._map=c,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t=!1){return h._(this,void 0,void 0,function*(){if(ln!==void 0&&!t)return ln;if(window.navigator.permissions===void 0)return ln=!!window.navigator.geolocation,ln;try{ln=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ln=!!window.navigator.geolocation}return ln})}().then(t=>this._setupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),K.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Un=0,Nn=!1}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),n=c.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const c=this._map.getBounds(),t=c.getSouthEast(),n=c.getNorthEast(),a=t.distanceTo(n),l=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Un--,Nn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Un++,Un>1?(c={maximumAge:6e5,timeout:0},Nn=!0):(c=this.options.positionOptions,Nn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},b.Hash=mo,b.ImageSource=Yr,b.KeyboardHandler=Rl,b.LngLatBounds=Jt,b.LogoControl=qr,b.Map=class extends wo{constructor(c){if(h.bb.mark(h.bc.create),(c=h.e({},Co,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new wa(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),{bearingSnap:c.bearingSnap}),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new h.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new h.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._renderTaskQueue=new Dc,this._controls=[],this._mapId=h.a3(),this._locale=h.e({},To,c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this.transformCameraUpdate=c.transformCameraUpdate,this._imageQueueHandle=ht.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ot(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const n=fo(a=>{this._trackResize&&!this._removed&&this.resize(a)._update()},50);this._resizeObserver=new ResizeObserver(a=>{t?n(a):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new bo(this,c),this._hash=c.hash&&new mo(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,h.e({},c.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new So(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new qr,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new h.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new h.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new h.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new h.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=c.onAdd(this);this._controls.push(c);const a=this._controlPositions[t];return t.indexOf("bottom")!==-1?a.insertBefore(n,a.firstChild):a.appendChild(n),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new h.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}calculateCameraOptionsFromTo(c,t,n,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(c,t,n,a)}resize(c){var t;const n=this._containerDimensions(),a=n[0],l=n[1],u=this._getClampedPixelRatio(a,l);if(this._resizeCanvas(a,l,u),this.painter.resize(a,l,u),this.painter.overLimit()){const _=this.painter.context.gl;this._maxCanvasSize=[_.drawingBufferWidth,_.drawingBufferHeight];const y=this._getClampedPixelRatio(a,l);this._resizeCanvas(a,l,y),this.painter.resize(a,l,y)}this.transform.resize(a,l),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,l);const m=!this._moving;return m&&(this.stop(),this.fire(new h.k("movestart",c)).fire(new h.k("move",c))),this.fire(new h.k("resize",c)),m&&this.fire(new h.k("moveend",c)),this}_getClampedPixelRatio(c,t){const{0:n,1:a}=this._maxCanvasSize,l=this.getPixelRatio(),u=c*l,m=t*l;return Math.min(u>n?n/u:1,m>a?a/m:1)*l}getPixelRatio(){var c;return(c=this._overridePixelRatio)!==null&&c!==void 0?c:devicePixelRatio}setPixelRatio(c){this._overridePixelRatio=c,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(c){return this.transform.setMaxBounds(Jt.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c&&this.setZoom(c),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c&&this.setZoom(c),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c&&this.setPitch(c),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c&&this.setPitch(c),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}project(c){return this.transform.locationPoint(h.M.convert(c),this.style&&this.terrain)}unproject(c){return this.transform.pointLocation(h.P.convert(c),this.terrain)}isMoving(){var c;return this._moving||((c=this.handlers)===null||c===void 0?void 0:c.isMoving())}isZooming(){var c;return this._zooming||((c=this.handlers)===null||c===void 0?void 0:c.isZooming())}isRotating(){var c;return this._rotating||((c=this.handlers)===null||c===void 0?void 0:c.isRotating())}_createDelegatedListener(c,t,n){if(c==="mouseenter"||c==="mouseover"){let a=!1;return{layer:t,listener:n,delegates:{mousemove:u=>{const m=this.getLayer(t)?this.queryRenderedFeatures(u.point,{layers:[t]}):[];m.length?a||(a=!0,n.call(this,new ur(c,this,u.originalEvent,{features:m}))):a=!1},mouseout:()=>{a=!1}}}}if(c==="mouseleave"||c==="mouseout"){let a=!1;return{layer:t,listener:n,delegates:{mousemove:m=>{(this.getLayer(t)?this.queryRenderedFeatures(m.point,{layers:[t]}):[]).length?a=!0:a&&(a=!1,n.call(this,new ur(c,this,m.originalEvent)))},mouseout:m=>{a&&(a=!1,n.call(this,new ur(c,this,m.originalEvent)))}}}}{const a=l=>{const u=this.getLayer(t)?this.queryRenderedFeatures(l.point,{layers:[t]}):[];u.length&&(l.features=u,n.call(this,l),delete l.features)};return{layer:t,listener:n,delegates:{[c]:a}}}}on(c,t,n){if(n===void 0)return super.on(c,t);const a=this._createDelegatedListener(c,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(a);for(const l in a.delegates)this.on(l,a.delegates[l]);return this}once(c,t,n){if(n===void 0)return super.once(c,t);const a=this._createDelegatedListener(c,t,n);for(const l in a.delegates)this.once(l,a.delegates[l]);return this}off(c,t,n){return n===void 0?super.off(c,t):(this._delegatedListeners&&this._delegatedListeners[c]&&(a=>{const l=this._delegatedListeners[c];for(let u=0;u<l.length;u++){const m=l[u];if(m.layer===t&&m.listener===n){for(const _ in m.delegates)this.off(_,m.delegates[_]);return l.splice(u,1),this}}})(),this)}queryRenderedFeatures(c,t){if(!this.style)return[];let n;const a=c instanceof h.P||Array.isArray(c),l=a?c:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(a?{}:c)||{},l instanceof h.P||typeof l[0]=="number")n=[h.P.convert(l)];else{const u=h.P.convert(l[0]),m=h.P.convert(l[1]);n=[u,new h.P(m.x,u.y),m,new h.P(u.x,m.y),u]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(c,t){return this.style.querySourceFeatures(c,t)}setStyle(c,t){return(t=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&c?(this._diffStyle(c,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(c,t))}setTransformRequest(c){return this._requestManager.setTransformRequest(c),this}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(c,t));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!c)),c?(this.style=new wr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c,t,n):this.style.loadJSON(c,t,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new wr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,t){if(typeof c=="string"){const n=this._requestManager.transformRequest(c,gt.Style);h.h(n,new AbortController).then(a=>{this._updateDiff(a.data,t)}).catch(a=>{a&&this.fire(new h.j(a))})}else typeof c=="object"&&this._updateDiff(c,t)}_updateDiff(c,t){try{this.style.setState(c,t)&&this._update(!0)}catch(n){h.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(c,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(c,t){return this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)}isSourceLoaded(c){const t=this.style&&this.style.sourceCaches[c];if(t!==void 0)return t.loaded();this.fire(new h.j(new Error(`There is no source with ID '${c}'`)))}setTerrain(c){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),c){const t=this.style.sourceCaches[c.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${c.source}`);this.terrain===null&&t.reload();for(const n in this.style._layers){const a=this.style._layers[n];a.type==="hillshade"&&a.source===c.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new oi(this.painter,t,c),this.painter.renderToTexture=new ka(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==c.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new h.k("terrain",{terrain:c})),this}getTerrain(){var c,t;return(t=(c=this.terrain)===null||c===void 0?void 0:c.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const c=this.style&&this.style.sourceCaches;for(const t in c){const n=c[t]._tiles;for(const a in n){const l=n[a];if(l.state!=="loaded"&&l.state!=="errored")return!1}}return!0}removeSource(c){return this.style.removeSource(c),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,t,n={}){const{pixelRatio:a=1,sdf:l=!1,stretchX:u,stretchY:m,content:_}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||h.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:y,height:v,data:S}=t,I=t;return this.style.addImage(c,{data:new h.R({width:y,height:v},new Uint8Array(S)),pixelRatio:a,stretchX:u,stretchY:m,content:_,sdf:l,version:0,userImage:I}),I.onAdd&&I.onAdd(this,c),this}}{const{width:y,height:v,data:S}=re.getImageData(t);this.style.addImage(c,{data:new h.R({width:y,height:v},S),pixelRatio:a,stretchX:u,stretchY:m,content:_,sdf:l,version:0})}}updateImage(c,t){const n=this.style.getImage(c);if(!n)return this.fire(new h.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=t instanceof HTMLImageElement||h.b(t)?re.getImageData(t):t,{width:l,height:u,data:m}=a;if(l===void 0||u===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(l!==n.data.width||u!==n.data.height)return this.fire(new h.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const _=!(t instanceof HTMLImageElement||h.b(t));return n.data.replace(m,_),this.style.updateImage(c,n),this}getImage(c){return this.style.getImage(c)}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new h.j(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c){return ht.getImage(this._requestManager.transformRequest(c,gt.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(c,t){return this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)}moveLayer(c,t){return this.style.moveLayer(c,t),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(c,t,n){return this.style.setLayerZoomRange(c,t,n),this._update(!0)}setFilter(c,t,n={}){return this.style.setFilter(c,t,n),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,t,n,a={}){return this.style.setPaintProperty(c,t,n,a),this._update(!0)}getPaintProperty(c,t){return this.style.getPaintProperty(c,t)}setLayoutProperty(c,t,n,a={}){return this.style.setLayoutProperty(c,t,n,a),this._update(!0)}getLayoutProperty(c,t){return this.style.getLayoutProperty(c,t)}setGlyphs(c,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(c,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(c,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(c,t,n,a=>{a||this._update(!0)}),this}removeSprite(c){return this._lazyInitEmptyStyle(),this.style.removeSprite(c),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(c,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(c,t,n=>{n||this._update(!0)}),this}setLight(c,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(c,t){return this.style.setFeatureState(c,t),this._update()}removeFeatureState(c,t){return this.style.removeFeatureState(c,t),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let c=0,t=0;return this._container&&(c=this._container.clientWidth||400,t=this._container.clientHeight||300),[c,t]}_setupContainer(){const c=this._container;c.classList.add("maplibregl-map");const t=this._canvasContainer=K.create("div","maplibregl-canvas-container",c);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=K.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),a=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],a);const l=this._controlContainer=K.create("div","maplibregl-control-container",c),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{u[m]=K.create("div",`maplibregl-ctrl-${m} `,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t,n){this._canvas.width=Math.floor(n*c),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const c={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{t={requestedAttributes:c},a&&(t.statusMessage=a.statusMessage,t.type=a.type)},{once:!0});const n=this._canvas.getContext("webgl2",c)||this._canvas.getContext("webgl",c);if(!n){const a="Failed to initialize WebGL";throw t?(t.message=a,new Error(JSON.stringify(t))):new Error(a)}this.painter=new Cl(n,this.transform),je.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_render(c){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const l=this.transform.zoom,u=re.now();this.style.zoomHistory.update(l,u);const m=new h.a8(l,{now:u,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_=m.crossFadingFactor();_===1&&_===this._crossFadingFactor||(n=!0,this._crossFadingFactor=_),this.style.update(m)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new h.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.bb.mark(h.bc.load),this.fire(new h.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,h.bb.mark(h.bc.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var c;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ht.removeThrottleControl(this._imageQueueHandle),(c=this._resizeObserver)===null||c===void 0||c.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),K.remove(this._canvasContainer),K.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),h.bb.clearMetrics(),this._removed=!0,this.fire(new h.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,re.frameAsync(this._frameRequest).then(c=>{h.bb.frame(c),this._frameRequest=null,this._render(c)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get version(){return Io}getCameraTargetElevation(){return this.transform.elevation}},b.MapMouseEvent=ur,b.MapTouchEvent=os,b.MapWheelEvent=Fn,b.Marker=js,b.NavigationControl=class{constructor(c){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),a=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,n)=>{const a=this._map._getUIString(`NavigationControl.${n}`);t.title=a,t.setAttribute("aria-label",a)},this.options=h.e({},Ao,c),this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),K.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),K.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=K.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ko(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){K.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(c,t){const n=K.create("button",c,this._container);return n.type="button",n.addEventListener("click",t),n}},b.Popup=class extends h.E{constructor(c){super(),this.remove=()=>(this._content&&K.remove(this._content),this._container&&(K.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map),this.fire(new h.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var n;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=K.create("div","maplibregl-popup",this._map.getContainer()),this._tip=K.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const _ of this.options.className.split(" "))this._container.classList.add(_);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ea(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let l=this.options.anchor;const u=Pa(this.options.offset);if(!l){const _=this._container.offsetWidth,y=this._container.offsetHeight;let v;v=a.y+u.bottom.y<y?["top"]:a.y>this._map.transform.height-y?["bottom"]:[],a.x<_/2?v.push("left"):a.x>this._map.transform.width-_/2&&v.push("right"),l=v.length===0?"bottom":v.join("-")}let m=a.add(u[l]);this.options.subpixelPositioning||(m=m.round()),K.setTransform(this._container,`${Ns[l]} translate(${m.x}px,${m.y}px)`),Ma(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(Po),c)}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=h.M.convert(c),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const t=document.createDocumentFragment(),n=document.createElement("body");let a;for(n.innerHTML=c;a=n.firstChild,a;)t.appendChild(a);return this.setDOMContent(t)}getMaxWidth(){var c;return(c=this._container)===null||c===void 0?void 0:c.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=K.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(c){this._container&&this._container.classList.add(c)}removeClassName(c){this._container&&this._container.classList.remove(c)}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){if(this._container)return this._container.classList.toggle(c)}setSubpixelPositioning(c){this.options.subpixelPositioning=c}_createCloseButton(){this.options.closeButton&&(this._closeButton=K.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(zo);c&&c.focus()}},b.RasterDEMTileSource=vs,b.RasterTileSource=kn,b.ScaleControl=class{constructor(c){this._onMove=()=>{qs(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,qs(this._map,this._container,this.options)},this.options=h.e({},Mo,c)}getDefaultPosition(){return"bottom-left"}onAdd(c){return this._map=c,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){K.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},b.ScrollZoomHandler=Os,b.Style=wr,b.TerrainControl=class{constructor(c){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=c}onAdd(c){return this._map=c,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=K.create("button","maplibregl-ctrl-terrain",this._container),K.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){K.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},b.TwoFingersTouchPitchHandler=xo,b.TwoFingersTouchRotateHandler=Ia,b.TwoFingersTouchZoomHandler=Dl,b.TwoFingersTouchZoomRotateHandler=jr,b.VectorTileSource=de,b.VideoSource=Jn,b.addSourceType=(c,t)=>h._(void 0,void 0,void 0,function*(){if(En(c))throw new Error(`A source type called "${c}" already exists.`);((n,a)=>{Qn[n]=a})(c,t)}),b.clearPrewarmedResources=function(){const c=lr;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(gi),lr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},b.getMaxParallelImageRequests=function(){return h.a.MAX_PARALLEL_IMAGE_REQUESTS},b.getRTLTextPluginStatus=function(){return Te().getRTLTextPluginStatus()},b.getVersion=function(){return Do},b.getWorkerCount=function(){return si.workerCount},b.getWorkerUrl=function(){return h.a.WORKER_URL},b.importScriptInWorkers=function(c){return kt().broadcast("importScript",c)},b.prewarm=function(){Ie().acquire(gi)},b.setMaxParallelImageRequests=function(c){h.a.MAX_PARALLEL_IMAGE_REQUESTS=c},b.setRTLTextPlugin=function(c,t){return Te().setRTLTextPlugin(c,t)},b.setWorkerCount=function(c){si.workerCount=c},b.setWorkerUrl=function(c){h.a.WORKER_URL=c}});var R=M;return R})})(Id);var gm=Id.exports;const an=jf(gm);var Ad=_m;function _m(O){var C,M,E;if(O){if(Array.isArray(O)){for(C=[],M=O.length,E=0;E<M;E++){var F=O[E];F!=null&&C.push(F)}return C}if(typeof O=="object"){C={};var R=Object.keys(O);for(M=R.length,E=0;E<M;E++){var b=R[E],h=O[b];h!=null&&(C[b]=h)}return C}}}function ym(O){let C;const M=O[12].default,E=Ha(M,O,O[11],null);return{c(){E&&E.c()},l(F){E&&E.l(F)},m(F,R){E&&E.m(F,R),C=!0},p(F,[R]){E&&E.p&&(!C||R&2048)&&Wa(E,M,F,F[11],C?Ka(M,F[11],R,null):Xa(F[11]),null)},i(F){C||($e(E,F),C=!0)},o(F){st(E,F),C=!1},d(F){E&&E.d(F)}}}function xm(O,C,M){let E,F,R,{$$slots:b={},$$scope:h}=C,{lngLat:le}=C,{class:he=void 0}=C,{draggable:fe=!1}=C,{feature:re=null}=C,{offset:K=void 0}=C,{rotation:je=0}=C,{opacity:Qe=1}=C;const Ye=Sd(),{map:_t,layerEvent:Be,self:De}=fm();yr(O,_t,it=>M(14,R=it)),yr(O,Be,it=>M(13,E=it)),yr(O,De,it=>M(10,F=it));const ht=()=>It("dragstart"),gt=()=>{mi(),It("drag")},Ot=()=>{mi(),It("dragend")};el(De,F=new an.Marker(Ad({draggable:fe,rotation:je,className:he,offset:K,opacity:Qe.toString()})).setLngLat(le).addTo(R),F),fe&&(F.on("dragstart",ht),F.on("drag",gt),F.on("dragend",Ot)),Xs(()=>F==null?void 0:F.remove());function mi(){let it=F==null?void 0:F.getLngLat();it&&(Array.isArray(le)?M(3,le=[it.lng,it.lat]):le&&"lon"in le?M(3,le={lon:it.lng,lat:it.lat}):M(3,le=it))}function It(it){let Tt=F==null?void 0:F.getLngLat();if(!Tt)return;const ar=[Tt.lng,Tt.lat];let Wt={map:R,marker:F,lngLat:ar,features:[{type:"Feature",properties:(re==null?void 0:re.properties)??{},geometry:{type:"Point",coordinates:ar}}]};el(Be,E={...Wt,layerType:"marker",type:it},E),Ye(it,Wt)}return O.$$set=it=>{"lngLat"in it&&M(3,le=it.lngLat),"class"in it&&M(4,he=it.class),"draggable"in it&&M(5,fe=it.draggable),"feature"in it&&M(6,re=it.feature),"offset"in it&&M(7,K=it.offset),"rotation"in it&&M(8,je=it.rotation),"opacity"in it&&M(9,Qe=it.opacity),"$$scope"in it&&M(11,h=it.$$scope)},O.$$.update=()=>{O.$$.dirty&1032&&(F==null||F.setLngLat(le)),O.$$.dirty&1152&&(F==null||F.setOffset(K??[0,0])),O.$$.dirty&1280&&(F==null||F.setRotation(je)),O.$$.dirty&1536&&(F==null||F.setOpacity(Qe.toString()))},[_t,Be,De,le,he,fe,re,K,je,Qe,F,h,b]}class vm extends Or{constructor(C){super(),Vr(this,C,xm,ym,xr,{lngLat:3,class:4,draggable:5,feature:6,offset:7,rotation:8,opacity:9})}}function bm(O,C,M){let E;const{map:F}=Ya();yr(O,F,le=>M(4,E=le));let{position:R="top-left"}=C,{container:b=void 0}=C,h=null;return Xs(()=>{E!=null&&E.loaded()&&h&&E.removeControl(h)}),O.$$set=le=>{"position"in le&&M(1,R=le.position),"container"in le&&M(2,b=le.container)},O.$$.update=()=>{if(O.$$.dirty&30&&E&&!h){let le;typeof b=="string"?le=document.querySelector(b)??void 0:le=b,M(3,h=new an.FullscreenControl({container:le})),E.addControl(h,R)}},[F,R,b,h,E]}class kd extends Or{constructor(C){super(),Vr(this,C,bm,null,xr,{position:1,container:2})}}function wm(O,C,M){let E;const{map:F}=Ya();yr(O,F,K=>M(8,E=K));let{position:R="top-left"}=C,{positionOptions:b=void 0}=C,{fitBoundsOptions:h=void 0}=C,{trackUserLocation:le=!1}=C,{showAccuracyCircle:he=!0}=C,{showUserLocation:fe=!0}=C,re=null;return Xs(()=>{E!=null&&E.loaded()&&re&&E.removeControl(re)}),O.$$set=K=>{"position"in K&&M(1,R=K.position),"positionOptions"in K&&M(2,b=K.positionOptions),"fitBoundsOptions"in K&&M(3,h=K.fitBoundsOptions),"trackUserLocation"in K&&M(4,le=K.trackUserLocation),"showAccuracyCircle"in K&&M(5,he=K.showAccuracyCircle),"showUserLocation"in K&&M(6,fe=K.showUserLocation)},O.$$.update=()=>{O.$$.dirty&510&&E&&!re&&(M(7,re=new an.GeolocateControl({positionOptions:b,fitBoundsOptions:h,trackUserLocation:le,showAccuracyCircle:he,showUserLocation:fe})),E.addControl(re,R))},[F,R,b,h,le,he,fe,re,E]}class Sm extends Or{constructor(C){super(),Vr(this,C,wm,null,xr,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function Tm(O){let C=O.getCenter(),M=Math.round(O.getZoom()*100)/100,E=Math.ceil((M*Math.LN2+Math.log(512/360/.5))/Math.LN10),F=Math.pow(10,E),R=Math.round(C.lat*F)/F,b=Math.round(C.lng*F)/F,h=`${M}/${R}/${b}`,le=O.getBearing(),he=O.getPitch();return(le||he)&&(h+=`/${Math.round(le*10)/10}`),he&&(h+=`/${Math.round(he)}`),`#${h}`}function Im(O){return O.replace("#","").split("/").map(parseFloat)}var hc=Ah;function Ah(O,C){return O===C||O!==O&&C!==C?!0:typeof O!=typeof C||{}.toString.call(O)!={}.toString.call(C)||O!==Object(O)||!O?!1:Array.isArray(O)?pd(O,C):{}.toString.call(O)=="[object Set]"?pd(Array.from(O),Array.from(C)):{}.toString.call(O)=="[object Object]"?Am(O,C):Cm(O,C)}function Cm(O,C){return O.toString()===C.toString()}function pd(O,C){var M=O.length;if(M!=C.length)return!1;for(var E=0;E<M;E++)if(!Ah(O[E],C[E]))return!1;return!0}function Am(O,C){var M=Object.keys(O),E=M.length;if(E!=Object.keys(C).length)return!1;for(var F=0;F<E;F++){var R=M[F];if(!(C.hasOwnProperty(R)&&Ah(O[R],C[R])))return!1}return!0}function km(O,C,M){let E;const{map:F}=Ya();yr(O,F,fe=>M(6,E=fe));let{position:R="top-left"}=C,{showCompass:b=!0}=C,{showZoom:h=!0}=C,{visualizePitch:le=!1}=C,he=null;return Xs(()=>{E!=null&&E.loaded()&&he&&E.removeControl(he)}),O.$$set=fe=>{"position"in fe&&M(1,R=fe.position),"showCompass"in fe&&M(2,b=fe.showCompass),"showZoom"in fe&&M(3,h=fe.showZoom),"visualizePitch"in fe&&M(4,le=fe.visualizePitch)},O.$$.update=()=>{O.$$.dirty&126&&E&&!he&&(M(5,he=new an.NavigationControl({showCompass:b,showZoom:h,visualizePitch:le})),E.addControl(he,R))},[F,R,b,h,le,he,E]}class Ed extends Or{constructor(C){super(),Vr(this,C,km,null,xr,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function Em(O,C,M){let E;const{map:F}=Ya();yr(O,F,he=>M(5,E=he));let{position:R="bottom-left"}=C,{maxWidth:b=void 0}=C,{unit:h="metric"}=C,le=null;return Xs(()=>{E!=null&&E.loaded()&&le&&E.removeControl(le)}),O.$$set=he=>{"position"in he&&M(1,R=he.position),"maxWidth"in he&&M(2,b=he.maxWidth),"unit"in he&&M(3,h=he.unit)},O.$$.update=()=>{O.$$.dirty&62&&E&&!le&&(M(4,le=new an.ScaleControl({maxWidth:b,unit:h})),E.addControl(le,R))},[F,R,b,h,le,E]}class Md extends Or{constructor(C){super(),Vr(this,C,Em,null,xr,{position:1,maxWidth:2,unit:3})}}const Mm=O=>({map:O[0]&8,loadedImages:O[0]&16,allImagesLoaded:O[0]&32}),fd=O=>({map:O[3],loadedImages:O[4],allImagesLoaded:O[5]});function md(O){let C,M,E=O[2]&&gd(O);const F=O[35].default,R=Ha(F,O,O[34],fd);return{c(){E&&E.c(),C=Hi(),R&&R.c()},l(b){E&&E.l(b),C=Wi(b),R&&R.l(b)},m(b,h){E&&E.m(b,h),At(b,C,h),R&&R.m(b,h),M=!0},p(b,h){b[2]?E?(E.p(b,h),h[0]&4&&$e(E,1)):(E=gd(b),E.c(),$e(E,1),E.m(C.parentNode,C)):E&&(In(),st(E,1,1,()=>{E=null}),Cn()),R&&R.p&&(!M||h[0]&56|h[1]&8)&&Wa(R,F,b,b[34],M?Ka(F,b[34],h,Mm):Xa(b[34]),fd)},i(b){M||($e(E),$e(R,b),M=!0)},o(b){st(E),st(R,b),M=!1},d(b){b&&ct(C),E&&E.d(b),R&&R.d(b)}}}function gd(O){let C,M,E,F,R,b,h,le;return C=new Ed({props:{position:O[6]}}),E=new Sm({props:{position:O[6],fitBoundsOptions:{maxZoom:12}}}),R=new kd({props:{position:O[6]}}),h=new Md({props:{position:O[6]}}),{c(){ui(C.$$.fragment),M=Hi(),ui(E.$$.fragment),F=Hi(),ui(R.$$.fragment),b=Hi(),ui(h.$$.fragment)},l(he){di(C.$$.fragment,he),M=Wi(he),di(E.$$.fragment,he),F=Wi(he),di(R.$$.fragment,he),b=Wi(he),di(h.$$.fragment,he)},m(he,fe){pi(C,he,fe),At(he,M,fe),pi(E,he,fe),At(he,F,fe),pi(R,he,fe),At(he,b,fe),pi(h,he,fe),le=!0},p(he,fe){const re={};fe[0]&64&&(re.position=he[6]),C.$set(re);const K={};fe[0]&64&&(K.position=he[6]),E.$set(K);const je={};fe[0]&64&&(je.position=he[6]),R.$set(je);const Qe={};fe[0]&64&&(Qe.position=he[6]),h.$set(Qe)},i(he){le||($e(C.$$.fragment,he),$e(E.$$.fragment,he),$e(R.$$.fragment,he),$e(h.$$.fragment,he),le=!0)},o(he){st(C.$$.fragment,he),st(E.$$.fragment,he),st(R.$$.fragment,he),st(h.$$.fragment,he),le=!1},d(he){he&&(ct(M),ct(F),ct(b)),fi(C,he),fi(E,he),fi(R,he),fi(h,he)}}}function Pm(O){let C,M,E,F,R,b=O[3]&&O[0]&&md(O);return{c(){C=Er("div"),b&&b.c(),this.h()},l(h){C=Mr(h,"DIV",{class:!0});var le=kr(C);b&&b.l(le),le.forEach(ct),this.h()},h(){Zt(C,"class",M=rd(O[1])+" svelte-p00lfq"),Za(C,"expand-map",!O[1])},m(h,le){At(h,C,le),b&&b.m(C,null),E=!0,F||(R=vd(O[9].call(null,C)),F=!0)},p(h,le){h[3]&&h[0]?b?(b.p(h,le),le[0]&9&&$e(b,1)):(b=md(h),b.c(),$e(b,1),b.m(C,null)):b&&(In(),st(b,1,1,()=>{b=null}),Cn()),(!E||le[0]&2&&M!==(M=rd(h[1])+" svelte-p00lfq"))&&Zt(C,"class",M),(!E||le[0]&2)&&Za(C,"expand-map",!h[1])},i(h){E||($e(b),E=!0)},o(h){st(b),E=!1},d(h){h&&ct(C),b&&b.d(),F=!1,R()}}}function zm(O,C,M){let E,F,R,b,{$$slots:h={},$$scope:le}=C,{map:he=null}=C,{class:fe=void 0}=C,{style:re}=C,{diffStyleUpdates:K=!1}=C,{center:je=void 0}=C,{zoom:Qe=void 0}=C,{pitch:Ye=0}=C,{bearing:_t=0}=C,{bounds:Be=void 0}=C,{hash:De=!1}=C,{loaded:ht=!1}=C,{minZoom:gt=0}=C,{maxZoom:Ot=22}=C,{zoomOnDoubleClick:mi=!0}=C,{locale:It=void 0}=C,{interactive:it=!0}=C,{attributionControl:Tt=!0}=C,{cooperativeGestures:ar=!1}=C,{preserveDrawingBuffer:Wt=!1}=C,{maxBounds:Ct=void 0}=C,{images:Xt=[]}=C,{standardControls:zi=!1}=C,{filterLayers:or=void 0}=C,{transformRequest:pt=void 0}=C;const ni=Sd(),{map:Kt,loadedImages:Pr}=dm();yr(O,Kt,Ie=>M(3,R=Ie)),yr(O,Pr,Ie=>M(4,b=Ie));let Xi=new Set;async function Ft(Ie){if(R!=null&&R.loaded())if("url"in Ie){Xi.add(Ie.id);try{let et=await R.loadImage(Ie.url);R==null||R.addImage(Ie.id,et.data,Ie.options),b.add(Ie.id),Pr.set(b)}catch(et){ni("error",et)}finally{Xi.delete(Ie.id)}}else R.addImage(Ie.id,Ie.data,Ie.options),b.add(Ie.id),Pr.set(b)}let Pt,gi,si,Ki;function lr(Ie){if(De){let et=Im(window.location.hash);et.length>=3&&(M(11,Qe=et[0]),M(10,je=[et[2],et[1]])),et.length==5&&(M(15,_t=et[3]),M(14,Ye=et[4]))}return el(Kt,R=new an.Map(Ad({container:Ie,style:re,locale:It,center:je,zoom:Qe,pitch:Ye,bearing:_t,minZoom:gt,maxZoom:Ot,interactive:it,preserveDrawingBuffer:Wt,maxBounds:Ct,bounds:Be,attributionControl:Tt,transformRequest:pt,cooperativeGestures:ar})),R),R.on("load",et=>{M(0,ht=!0),ni("load",R)}),R.on("error",et=>ni("error",{...et,map:R})),R.on("movestart",et=>ni("movestart",{...et,map:R})),R.on("moveend",et=>{if(M(10,je=et.target.getCenter()),M(11,Qe=et.target.getZoom()),M(12,Be=et.target.getBounds()),ni("moveend",{...et,map:R}),De){let kt=window.location.href.replace(/(#.+)?$/,Tm(R));window.history.replaceState(window.history.state,"",kt)}}),R.on("zoomstart",et=>ni("zoomstart",{...et,map:R})),R.on("zoom",et=>{M(11,Qe=et.target.getZoom()),ni("zoom",{...et,map:R})}),R.on("zoomend",et=>{M(11,Qe=et.target.getZoom()),ni("zoomend",{...et,map:R})}),R.on("style.load",()=>{if(R){const et=R.getStyle();if(M(31,Pt=et.layers.map(kt=>kt.id)),M(32,gi=Object.keys(et.sources)),Ki)for(const[kt,Ur]of Object.entries(Ki))R.addSource(kt,Ur);if(si)for(const kt of si)R.addLayer(kt)}}),R.on("styledata",et=>{if(R&&or){const kt=R.getStyle().layers;if(kt)for(let Ur of kt)or(Ur)||R.setLayoutProperty(Ur.id,"visibility","none")}ni("styledata",{...et,map:R})}),{destroy(){M(0,ht=!1),R==null||R.remove(),el(Kt,R=null,R)}}}let Di=re;return O.$$set=Ie=>{"map"in Ie&&M(13,he=Ie.map),"class"in Ie&&M(1,fe=Ie.class),"style"in Ie&&M(16,re=Ie.style),"diffStyleUpdates"in Ie&&M(17,K=Ie.diffStyleUpdates),"center"in Ie&&M(10,je=Ie.center),"zoom"in Ie&&M(11,Qe=Ie.zoom),"pitch"in Ie&&M(14,Ye=Ie.pitch),"bearing"in Ie&&M(15,_t=Ie.bearing),"bounds"in Ie&&M(12,Be=Ie.bounds),"hash"in Ie&&M(18,De=Ie.hash),"loaded"in Ie&&M(0,ht=Ie.loaded),"minZoom"in Ie&&M(19,gt=Ie.minZoom),"maxZoom"in Ie&&M(20,Ot=Ie.maxZoom),"zoomOnDoubleClick"in Ie&&M(21,mi=Ie.zoomOnDoubleClick),"locale"in Ie&&M(22,It=Ie.locale),"interactive"in Ie&&M(23,it=Ie.interactive),"attributionControl"in Ie&&M(24,Tt=Ie.attributionControl),"cooperativeGestures"in Ie&&M(25,ar=Ie.cooperativeGestures),"preserveDrawingBuffer"in Ie&&M(26,Wt=Ie.preserveDrawingBuffer),"maxBounds"in Ie&&M(27,Ct=Ie.maxBounds),"images"in Ie&&M(28,Xt=Ie.images),"standardControls"in Ie&&M(2,zi=Ie.standardControls),"filterLayers"in Ie&&M(29,or=Ie.filterLayers),"transformRequest"in Ie&&M(30,pt=Ie.transformRequest),"$$scope"in Ie&&M(34,le=Ie.$$scope)},O.$$.update=()=>{if(O.$$.dirty[0]&4&&M(6,E=typeof zi=="boolean"?void 0:zi),O.$$.dirty[0]&8&&M(13,he=R),O.$$.dirty[0]&268435465&&ht&&R!=null&&R.loaded())for(let Ie of Xt)!Xi.has(Ie.id)&&!R.hasImage(Ie.id)&&Ft(Ie);if(O.$$.dirty[0]&268435472&&M(5,F=Xt.every(Ie=>b.has(Ie.id))),O.$$.dirty[0]&196616|O.$$.dirty[1]&7&&R&&!hc(re,Di)){const Ie=R.getStyle();if(Pt&&(si=Ie.layers.filter(et=>!Pt.includes(et.id))),gi){const et=Object.keys(Ie.sources).filter(kt=>!gi.includes(kt));Ki={};for(const kt of et)Ki[kt]=Ie.sources[kt]}M(33,Di=re),R.setStyle(re,{diff:K})}O.$$.dirty[0]&1032&&je&&!hc(je,R==null?void 0:R.getCenter())&&(R==null||R.panTo(je)),O.$$.dirty[0]&2056&&Qe&&!hc(Qe,R==null?void 0:R.getZoom())&&(R==null||R.zoomTo(Qe)),O.$$.dirty[0]&4104&&Be&&!hc(Be,R==null?void 0:R.getBounds())&&(R==null||R.fitBounds(Be)),O.$$.dirty[0]&2097160&&(mi?R==null||R.doubleClickZoom.enable():R==null||R.doubleClickZoom.disable())},[ht,fe,zi,R,b,F,E,Kt,Pr,lr,je,Qe,Be,he,Ye,_t,re,K,De,gt,Ot,mi,It,it,Tt,ar,Wt,Ct,Xt,or,pt,Pt,gi,Di,le,h]}class Dm extends Or{constructor(C){super(),Vr(this,C,zm,Pm,xr,{map:13,class:1,style:16,diffStyleUpdates:17,center:10,zoom:11,pitch:14,bearing:15,bounds:12,hash:18,loaded:0,minZoom:19,maxZoom:20,zoomOnDoubleClick:21,locale:22,interactive:23,attributionControl:24,cooperativeGestures:25,preserveDrawingBuffer:26,maxBounds:27,images:28,standardControls:2,filterLayers:29,transformRequest:30},null,[-1,-1])}}const Lm=O=>({features:O[0]&16,data:O[0]&16,map:O[0]&4,close:O[0]&1}),_d=O=>{var C;return{features:O[4],data:(C=O[4])==null?void 0:C[0],map:O[2],close:O[31]}};function yd(O){let C,M,E=(O[4]||O[3]instanceof an.Marker)&&xd(O);return{c(){C=Er("div"),E&&E.c()},l(F){C=Mr(F,"DIV",{});var R=kr(C);E&&E.l(R),R.forEach(ct)},m(F,R){At(F,C,R),E&&E.m(C,null),O[32](C),M=!0},p(F,R){F[4]||F[3]instanceof an.Marker?E?(E.p(F,R),R[0]&24&&$e(E,1)):(E=xd(F),E.c(),$e(E,1),E.m(C,null)):E&&(In(),st(E,1,1,()=>{E=null}),Cn())},i(F){M||($e(E),M=!0)},o(F){st(E),M=!1},d(F){F&&ct(C),E&&E.d(),O[32](null)}}}function xd(O){let C;const M=O[30].default,E=Ha(M,O,O[29],_d);return{c(){E&&E.c()},l(F){E&&E.l(F)},m(F,R){E&&E.m(F,R),C=!0},p(F,R){E&&E.p&&(!C||R[0]&536870933)&&Wa(E,M,F,F[29],C?Ka(M,F[29],R,Lm):Xa(F[29]),_d)},i(F){C||($e(E,F),C=!0)},o(F){st(E,F),C=!1},d(F){E&&E.d(F)}}}function Rm(O){let C,M,E=O[9].default&&yd(O);return{c(){E&&E.c(),C=Sn()},l(F){E&&E.l(F),C=Sn()},m(F,R){E&&E.m(F,R),At(F,C,R),M=!0},p(F,R){F[9].default?E?(E.p(F,R),R[0]&512&&$e(E,1)):(E=yd(F),E.c(),$e(E,1),E.m(C.parentNode,C)):E&&(In(),st(E,1,1,()=>{E=null}),Cn())},i(F){M||($e(E),M=!0)},o(F){st(E),M=!1},d(F){F&&ct(C),E&&E.d(F)}}}function Bm(O,C,M){let E,F,R,b,h,le,{$$slots:he={},$$scope:fe}=C;const re=Af(he);let{closeButton:K=void 0}=C,{closeOnClickOutside:je=!0}=C,{closeOnClickInside:Qe=!1}=C,{closeOnMove:Ye=!1}=C,{openOn:_t="click"}=C,{openIfTopMost:Be=!0}=C,{focusAfterOpen:De=!0}=C,{anchor:ht=void 0}=C,{offset:gt=void 0}=C,{popupClass:Ot=void 0}=C,{maxWidth:mi=void 0}=C,{lngLat:It=void 0}=C,{html:it=void 0}=C,{open:Tt=!1}=C;const{map:ar,popupTarget:Wt,layerEvent:Ct,layer:Xt,eventTopMost:zi}=Ya();yr(O,ar,ke=>M(2,R=ke)),yr(O,Wt,ke=>M(3,h=ke)),yr(O,Ct,ke=>M(28,b=ke)),yr(O,Xt,ke=>M(35,le=ke));const or=["click","dblclick","contextmenu"];let pt,ni=!1,Kt;function Pr(){if(!pt)return;let ke=pt.getElement();!ke||ke===Kt||(Kt=ke,_t==="hover"&&(Kt.style.pointerEvents="none"),Kt.addEventListener("mouseenter",()=>{M(24,ni=!0)},{passive:!0}),Kt.addEventListener("mouseleave",()=>{M(24,ni=!1)},{passive:!0}),Kt.addEventListener("click",()=>{Qe&&M(0,Tt=!1)},{passive:!0}))}kf(()=>{if(R)return R.on("click",et),R.on("contextmenu",et),typeof h=="string"&&(R.on("click",h,gi),R.on("dblclick",h,gi),R.on("contextmenu",h,gi),R.on("mousemove",h,Ie),R.on("mouseleave",h,Di),R.on("touchstart",h,Ki),R.on("touchend",h,lr)),()=>{R!=null&&R.loaded()&&(pt==null||pt.remove(),R.off("click",et),R.off("contextmenu",et),h instanceof an.Marker?h.getPopup()===pt&&h.setPopup(void 0):typeof h=="string"&&(R.off("click",h,gi),R.off("dblclick",h,gi),R.off("contextmenu",h,gi),R.off("mousemove",h,Ie),R.off("mouseleave",h,Di),R.off("touchstart",h,Ki),R.off("touchend",h,lr)))}});function Xi(ke){return Be?!("marker"in ke)&&!mm(ke)&&zi(ke)!==le:!1}let Ft=null,Pt="normal";function gi(ke){ke.type===_t&&(Xi(ke)||("layerType"in ke?ke.layerType==="deckgl"?(M(10,It=ke.coordinate),M(4,Ft=ke.object?[ke.object]:null)):(M(10,It=ke.lngLat),M(4,Ft=ke.features??[])):(M(10,It=ke.lngLat),M(4,Ft=ke.features??[])),setTimeout(()=>M(0,Tt=!0))))}let si=null;function Ki(ke){si=ke.point}function lr(ke){if(!si||_t!=="hover")return;let zr=si.dist(ke.point);si=null,zr<3&&(M(10,It=ke.lngLat),M(4,Ft=ke.features??[]),pt.isOpen()?M(25,Pt="justOpened"):(M(25,Pt="opening"),M(0,Tt=!0)))}function Di(ke){_t!=="hover"||si||Pt!=="normal"||(M(0,Tt=!1),M(4,Ft=null))}function Ie(ke){if(!(_t!=="hover"||si||Pt!=="normal")){if(Xi(ke)){M(0,Tt=!1),M(4,Ft=null);return}M(0,Tt=!0),M(4,Ft=ke.features??[]),M(10,It=ke.lngLat)}}function et(ke){if(Pt==="justOpened"){M(25,Pt="normal");return}if(!je)return;let zr=[Kt,h instanceof an.Marker?h==null?void 0:h.getElement():null];Tt&&pt.isOpen()&&!zr.some(Jt=>Jt==null?void 0:Jt.contains(ke.originalEvent.target))&&(ke.type==="contextmenu"&&_t==="contextmenu"||ke.type!=="contextmenu")&&M(0,Tt=!1)}Xs(()=>{R&&(pt!=null&&pt.isOpen())&&pt.remove()});let kt;const Ur=()=>M(0,Tt=!1);function Kr(ke){xs[ke?"unshift":"push"](()=>{kt=ke,M(1,kt)})}return O.$$set=ke=>{"closeButton"in ke&&M(11,K=ke.closeButton),"closeOnClickOutside"in ke&&M(12,je=ke.closeOnClickOutside),"closeOnClickInside"in ke&&M(13,Qe=ke.closeOnClickInside),"closeOnMove"in ke&&M(14,Ye=ke.closeOnMove),"openOn"in ke&&M(15,_t=ke.openOn),"openIfTopMost"in ke&&M(16,Be=ke.openIfTopMost),"focusAfterOpen"in ke&&M(17,De=ke.focusAfterOpen),"anchor"in ke&&M(18,ht=ke.anchor),"offset"in ke&&M(19,gt=ke.offset),"popupClass"in ke&&M(20,Ot=ke.popupClass),"maxWidth"in ke&&M(21,mi=ke.maxWidth),"lngLat"in ke&&M(10,It=ke.lngLat),"html"in ke&&M(22,it=ke.html),"open"in ke&&M(0,Tt=ke.open),"$$scope"in ke&&M(29,fe=ke.$$scope)},O.$$.update=()=>{if(O.$$.dirty[0]&14336&&M(27,E=K??(!je&&!Qe)),O.$$.dirty[0]&146685952&&(pt||(M(23,pt=new an.Popup({closeButton:E,closeOnClick:!1,closeOnMove:Ye,focusAfterOpen:De,maxWidth:mi,className:Ot,anchor:ht,offset:gt})),Kt=pt.getElement(),pt.on("open",()=>{M(0,Tt=!0),Pr()}),pt.on("close",ke=>{M(0,Tt=!1)}))),O.$$.dirty[0]&8421384&&pt&&h instanceof an.Marker&&(_t==="click"?h.setPopup(pt):h.getPopup()===pt&&h.setPopup(void 0)),O.$$.dirty[0]&268468224&&or.includes(_t)&&(b==null?void 0:b.type)===_t&&(gi(b),el(Ct,b=null,b)),O.$$.dirty[0]&268468224&&M(26,F=_t==="hover"&&((b==null?void 0:b.type)==="mousemove"||(b==null?void 0:b.type)==="mouseenter")),O.$$.dirty[0]&352354304&&_t==="hover"&&Ct&&(F&&b&&(b.layerType==="deckgl"?(M(10,It=b.coordinate),M(4,Ft=b.object?[b.object]:null)):(M(10,It=b.lngLat),M(4,Ft=b.features??[]))),M(0,Tt=(F||ni)??!1)),O.$$.dirty[0]&12582914&&(kt?pt.setDOMContent(kt):it&&pt.setHTML(it)),O.$$.dirty[0]&8389632&&It&&pt.setLngLat(It),O.$$.dirty[0]&41943045&&R){let ke=pt.isOpen();Tt&&!ke?(pt.addTo(R),Pt==="opening"&&M(25,Pt="justOpened")):!Tt&&ke&&pt.remove()}},[Tt,kt,R,h,Ft,ar,Wt,Ct,Xt,re,It,K,je,Qe,Ye,_t,Be,De,ht,gt,Ot,mi,it,pt,ni,Pt,F,E,b,fe,he,Ur,Kr]}class Fm extends Or{constructor(C){super(),Vr(this,C,Bm,Rm,xr,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var rl=Uint8Array,Pd=Uint16Array,Om=Int32Array,Vm=new rl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Um=new rl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),zd=function(O,C){for(var M=new Pd(31),E=0;E<31;++E)M[E]=C+=1<<O[E-1];for(var F=new Om(M[30]),E=1;E<30;++E)for(var R=M[E];R<M[E+1];++R)F[R]=R-M[E]<<5|E;return{b:M,r:F}},Dd=zd(Vm,2),Nm=Dd.b,jm=Dd.r;Nm[28]=258,jm[258]=28;zd(Um,0);var qm=new Pd(32768);for(Rt=0;Rt<32768;++Rt)Kn=(Rt&43690)>>1|(Rt&21845)<<1,Kn=(Kn&52428)>>2|(Kn&13107)<<2,Kn=(Kn&61680)>>4|(Kn&3855)<<4,qm[Rt]=((Kn&65280)>>8|(Kn&255)<<8)>>1;var Kn,Rt,fc=new rl(288);for(Rt=0;Rt<144;++Rt)fc[Rt]=8;var Rt;for(Rt=144;Rt<256;++Rt)fc[Rt]=9;var Rt;for(Rt=256;Rt<280;++Rt)fc[Rt]=7;var Rt;for(Rt=280;Rt<288;++Rt)fc[Rt]=8;var Rt,Zm=new rl(32);for(Rt=0;Rt<32;++Rt)Zm[Rt]=5;var Rt,Gm=new rl(0),Hm=typeof TextDecoder<"u"&&new TextDecoder,Wm=0;try{Hm.decode(Gm,{stream:!0}),Wm=1}catch{}const Xm=Symbol.for("svelte-maplibre");function Km(){return wd(Xm)}function Ym(O){let C,M,E='<span class="maplibregl-ctrl-icon" aria-hidden="true"></span>',F,R;return{c(){C=Er("div"),M=Er("button"),M.innerHTML=E,this.h()},l(b){C=Mr(b,"DIV",{class:!0});var h=kr(C);M=Mr(h,"BUTTON",{class:!0,type:!0,title:!0,"aria-label":!0,"data-svelte-h":!0}),Ih(M)!=="svelte-19qxjw5"&&(M.innerHTML=E),h.forEach(ct),this.h()},h(){Zt(M,"class","maplibregl-ctrl-geolocate"),Zt(M,"type","button"),Zt(M,"title","Find my location"),Zt(M,"aria-label","Find my location"),Zt(C,"class",O[1]),Za(C,"maplibregl-ctrl",O[0]),Za(C,"maplibregl-ctrl-group",O[0])},m(b,h){At(b,C,h),sn(C,M),O[8](C),F||(R=Ef(M,"click",O[7]),F=!0)},p(b,[h]){h&2&&Zt(C,"class",b[1]),h&3&&Za(C,"maplibregl-ctrl",b[0]),h&3&&Za(C,"maplibregl-ctrl-group",b[0])},i:Ga,o:Ga,d(b){b&&ct(C),O[8](null),F=!1,R()}}}function Jm(O,C,M){let E,{defaultStyling:F=!0}=C,{position:R="top-right"}=C,{class:b=void 0}=C,{lngLat:h}=C;const{map:le}=Km();yr(O,le,Ye=>M(4,E=Ye));let he,fe={onAdd(){return he},onRemove(){var Ye;(Ye=he==null?void 0:he.parentNode)==null||Ye.removeChild(he)}},re;const K=Ye=>{clearTimeout(re),re=setTimeout(async()=>{E==null||E.flyTo({center:Ye})},250)};Xs(()=>{E==null||E.removeControl(fe)});const je=()=>E==null?void 0:E.flyTo({center:h,zoom:15});function Qe(Ye){xs[Ye?"unshift":"push"](()=>{he=Ye,M(3,he)})}return O.$$set=Ye=>{"defaultStyling"in Ye&&M(0,F=Ye.defaultStyling),"position"in Ye&&M(6,R=Ye.position),"class"in Ye&&M(1,b=Ye.class),"lngLat"in Ye&&M(2,h=Ye.lngLat)},O.$$.update=()=>{O.$$.dirty&88&&E&&he&&E.addControl(fe,R),O.$$.dirty&4&&K(h)},[F,b,h,he,E,le,R,je,Qe]}class $m extends Or{constructor(C){super(),Vr(this,C,Jm,Ym,xr,{defaultStyling:0,position:6,class:1,lngLat:2})}}function Qm(O){let C,M;return{c(){C=Er("div"),M=uc(O[0]),this.h()},l(E){C=Mr(E,"DIV",{class:!0});var F=kr(C);M=dc(F,O[0]),F.forEach(ct),this.h()},h(){Zt(C,"class","text-lg font-bold text-black")},m(E,F){At(E,C,F),sn(C,M)},p(E,F){F&1&&Th(M,E[0])},d(E){E&&ct(C)}}}function eg(O){let C,M;return C=new Fm({props:{offset:[0,-10],$$slots:{default:[Qm]},$$scope:{ctx:O}}}),{c(){ui(C.$$.fragment)},l(E){di(C.$$.fragment,E)},m(E,F){pi(C,E,F),M=!0},p(E,F){const R={};F&129&&(R.$$scope={dirty:F,ctx:E}),C.$set(R)},i(E){M||($e(C.$$.fragment,E),M=!0)},o(E){st(C.$$.fragment,E),M=!1},d(E){fi(C,E)}}}function tg(O){let C,M,E,F,R,b,h,le,he,fe,re,K;C=new Ed({props:{position:"top-left"}});function je(Be){O[5](Be)}let Qe={position:"top-left"};O[0]!==void 0&&(Qe.lngLat=O[0]),E=new $m({props:Qe}),xs.push(()=>tl(E,"lngLat",je)),b=new kd({props:{position:"top-left"}}),le=new Md({});function Ye(Be){O[6](Be)}let _t={draggable:!0,$$slots:{default:[eg]},$$scope:{ctx:O}};return O[0]!==void 0&&(_t.lngLat=O[0]),fe=new vm({props:_t}),xs.push(()=>tl(fe,"lngLat",Ye)),{c(){ui(C.$$.fragment),M=Hi(),ui(E.$$.fragment),R=Hi(),ui(b.$$.fragment),h=Hi(),ui(le.$$.fragment),he=Hi(),ui(fe.$$.fragment)},l(Be){di(C.$$.fragment,Be),M=Wi(Be),di(E.$$.fragment,Be),R=Wi(Be),di(b.$$.fragment,Be),h=Wi(Be),di(le.$$.fragment,Be),he=Wi(Be),di(fe.$$.fragment,Be)},m(Be,De){pi(C,Be,De),At(Be,M,De),pi(E,Be,De),At(Be,R,De),pi(b,Be,De),At(Be,h,De),pi(le,Be,De),At(Be,he,De),pi(fe,Be,De),K=!0},p(Be,De){const ht={};!F&&De&1&&(F=!0,ht.lngLat=Be[0],Qo(()=>F=!1)),E.$set(ht);const gt={};De&129&&(gt.$$scope={dirty:De,ctx:Be}),!re&&De&1&&(re=!0,gt.lngLat=Be[0],Qo(()=>re=!1)),fe.$set(gt)},i(Be){K||($e(C.$$.fragment,Be),$e(E.$$.fragment,Be),$e(b.$$.fragment,Be),$e(le.$$.fragment,Be),$e(fe.$$.fragment,Be),K=!0)},o(Be){st(C.$$.fragment,Be),st(E.$$.fragment,Be),st(b.$$.fragment,Be),st(le.$$.fragment,Be),st(fe.$$.fragment,Be),K=!1},d(Be){Be&&(ct(M),ct(R),ct(h),ct(he)),fi(C,Be),fi(E,Be),fi(b,Be),fi(le,Be),fi(fe,Be)}}}function ig(O){let C,M;return C=new Dm({props:{center:O[2],zoom:8,standardControls:!1,attributionControl:!1,style:O[1],class:O[3].class,$$slots:{default:[tg]},$$scope:{ctx:O}}}),{c(){ui(C.$$.fragment)},l(E){di(C.$$.fragment,E)},m(E,F){pi(C,E,F),M=!0},p(E,[F]){const R={};F&2&&(R.style=E[1]),F&8&&(R.class=E[3].class),F&129&&(R.$$scope={dirty:F,ctx:E}),C.$set(R)},i(E){M||($e(C.$$.fragment,E),M=!0)},o(E){st(C.$$.fragment,E),M=!1},d(E){fi(C,E)}}}function rg(O,C,M){let E;const F=["lngLat"];let R=Tn(C,F),b;yr(O,qf,re=>M(4,b=re));let{lngLat:h}=C;const le=h;function he(re){h=re,M(0,h)}function fe(re){h=re,M(0,h)}return O.$$set=re=>{C=Xr(Xr({},C),il(re)),M(3,R=Tn(C,F)),"lngLat"in re&&M(0,h=re.lngLat)},O.$$.update=()=>{O.$$.dirty&16&&M(1,E=`${b==="dark"?"https://api.maptiler.com/maps/49f63854-b0c2-414b-9b03-7db05ff33738/style.json?key=pCvzMcEFa2VIKsE1kbGn":"https://api.maptiler.com/maps/507eef78-4030-433b-aecf-3cb65c91e1b5/style.json?key=pCvzMcEFa2VIKsE1kbGn"}`)},[h,E,le,R,b,he,fe]}let ng=class extends Or{constructor(C){super(),Vr(this,C,rg,ig,xr,{lngLat:0})}};function sg(O){let C,M,E="Lokasi",F,R,b,h,le,he,fe,re,K,je;R=new Mf({});function Qe(De){O[1](De)}let Ye={class:"relative mb-4 w-full lg:max-w-[50%] overflow-visible"};O[0]!==void 0&&(Ye.lngLat=O[0]),h=new hm({props:Ye}),xs.push(()=>tl(h,"lngLat",Qe));function _t(De){O[2](De)}let Be={class:"min-h-[480px] w-full rounded-lg border shadow-md"};return O[0]!==void 0&&(Be.lngLat=O[0]),re=new ng({props:Be}),xs.push(()=>tl(re,"lngLat",_t)),{c(){C=Er("div"),M=Er("h1"),M.textContent=E,F=Hi(),ui(R.$$.fragment),b=Hi(),ui(h.$$.fragment),he=Hi(),fe=Er("div"),ui(re.$$.fragment),this.h()},l(De){C=Mr(De,"DIV",{class:!0});var ht=kr(C);M=Mr(ht,"H1",{class:!0,"data-svelte-h":!0}),Ih(M)!=="svelte-wfgxf5"&&(M.textContent=E),F=Wi(ht),di(R.$$.fragment,ht),ht.forEach(ct),b=Wi(De),di(h.$$.fragment,De),he=Wi(De),fe=Mr(De,"DIV",{class:!0});var gt=kr(fe);di(re.$$.fragment,gt),gt.forEach(ct),this.h()},h(){Zt(M,"class","text-xl font-semibold"),Zt(C,"class","mb-4 flex items-center"),Zt(fe,"class","flex max-h-[720px] w-full gap-4")},m(De,ht){At(De,C,ht),sn(C,M),sn(C,F),pi(R,C,null),At(De,b,ht),pi(h,De,ht),At(De,he,ht),At(De,fe,ht),pi(re,fe,null),je=!0},p(De,[ht]){const gt={};!le&&ht&1&&(le=!0,gt.lngLat=De[0],Qo(()=>le=!1)),h.$set(gt);const Ot={};!K&&ht&1&&(K=!0,Ot.lngLat=De[0],Qo(()=>K=!1)),re.$set(Ot)},i(De){je||($e(R.$$.fragment,De),$e(h.$$.fragment,De),$e(re.$$.fragment,De),je=!0)},o(De){st(R.$$.fragment,De),st(h.$$.fragment,De),st(re.$$.fragment,De),je=!1},d(De){De&&(ct(C),ct(b),ct(he),ct(fe)),fi(R),fi(h,De),fi(re)}}}function ag(O,C,M){let E=[110.44302165,-7.0597536];function F(b){E=b,M(0,E)}function R(b){E=b,M(0,E)}return[E,F,R]}class yg extends Or{constructor(C){super(),Vr(this,C,ag,sg,xr,{})}}export{yg as component};
